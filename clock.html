<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>ì‹œê³„ ë†€ì´í„° ğŸ•</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;-webkit-user-select:none;user-select:none}
.hidden{display:none!important}
body{font-family:'Noto Sans KR',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:linear-gradient(135deg,#0891b2 0%,#06b6d4 50%,#0e7490 100%);margin:0;padding:0;width:100vw;height:100vh;height:100dvh;overflow:hidden;touch-action:manipulation}
.rotate-notice{display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:linear-gradient(135deg,#0891b2,#06b6d4);z-index:9999;flex-direction:column;align-items:center;justify-content:center;color:#fff;font-size:24px;font-weight:700;text-align:center;gap:20px}
.rotate-notice .rotate-icon{font-size:80px;animation:rotateH 2s ease-in-out infinite}
@keyframes rotateH{0%,100%{transform:rotate(0)}50%{transform:rotate(90deg)}}
@media(orientation:portrait){.rotate-notice{display:flex}.container{display:none!important}}
.container{width:1920px;height:1080px;background:#fff;border-radius:25px;box-shadow:0 25px 50px rgba(0,0,0,.12);display:flex;flex-direction:column;overflow:hidden;transform-origin:0 0;position:absolute}

.subject-bar{background:linear-gradient(135deg,#1e3a8a,#3b82f6);display:flex;align-items:center;padding:0 20px;height:56px;flex-shrink:0;gap:4px;position:relative}
.subject-bar::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:linear-gradient(90deg,#67e8f9,#06b6d4,#67e8f9)}
.sb-tab{padding:8px 30px;border:none;border-radius:12px 12px 0 0;background:0;font-size:18px;font-weight:800;color:rgba(255,255,255,.5);cursor:pointer;font-family:inherit;transition:.2s;display:flex;align-items:center;gap:8px;text-decoration:none}
.sb-tab.active{background:#fff;color:#1e3a8a}
.sb-tab.locked{cursor:default}
.sb-tab .lock{font-size:12px;opacity:.5}
.sb-spacer{flex:1}
.sb-btns{display:flex;gap:8px}
.sb-btn{background:rgba(255,255,255,.15);border:2px solid rgba(255,255,255,.2);border-radius:10px;padding:6px 14px;font-size:18px;color:#fff;cursor:pointer;transition:.15s}
.sb-btn:active{background:rgba(255,255,255,.3)}

.main-layout{display:grid;grid-template-columns:300px 1fr 300px;gap:14px;padding:14px;flex:1;overflow:hidden}

.left-panel{display:flex;flex-direction:column;gap:10px;overflow:hidden}
.profile-section{background:linear-gradient(145deg,#0891b2,#06b6d4 50%,#67e8f9);border-radius:20px;padding:20px;border:3px solid #a5f3fc;box-shadow:0 6px 20px rgba(8,145,178,.3);flex-shrink:0;position:relative;overflow:hidden}
.profile-section::before{content:'';position:absolute;inset:0;background:url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='15' cy='15' r='1.5' fill='white' opacity='.3'><animate attributeName='opacity' values='.3;.1;.3' dur='2s' repeatCount='indefinite'/></circle><circle cx='85' cy='25' r='1' fill='white' opacity='.25'><animate attributeName='opacity' values='.25;.08;.25' dur='1.5s' repeatCount='indefinite'/></circle><circle cx='25' cy='75' r='1.2' fill='white' opacity='.3'><animate attributeName='opacity' values='.3;.1;.3' dur='1.8s' repeatCount='indefinite'/></circle></svg>") repeat;pointer-events:none}
.profile-content{position:relative;z-index:1;display:flex;align-items:center;gap:15px}
.profile-avatar{width:90px;height:90px;background:linear-gradient(145deg,#67e8f9,#22d3ee);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:50px;border:3px solid #fff;box-shadow:0 4px 15px rgba(103,232,249,.4);animation:avGlow 3s ease-in-out infinite;flex-shrink:0;cursor:pointer}
@keyframes avGlow{0%,100%{box-shadow:0 4px 15px rgba(103,232,249,.4);transform:scale(1)}50%{box-shadow:0 8px 25px rgba(103,232,249,.6);transform:scale(1.05)}}
.profile-info{flex:1;color:#fff}
.profile-name{font-size:28px;font-weight:800;text-shadow:2px 2px 4px rgba(0,0,0,.3);margin-bottom:8px;cursor:pointer}
.profile-level-container{background:rgba(255,255,255,.2);border-radius:12px;padding:8px 12px}
.profile-level{font-size:22px;font-weight:700;color:#e0f2fe;display:flex;align-items:center;gap:8px}
.level-badge{background:linear-gradient(145deg,#67e8f9,#22d3ee);color:#164e63;padding:4px 12px;border-radius:8px;font-size:22px;font-weight:800;border:1px solid #fff}
.progress-bar{width:100%;height:6px;background:rgba(255,255,255,.3);border-radius:3px;margin-top:5px;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,#67e8f9,#22d3ee,#67e8f9);background-size:200% 100%;border-radius:3px;transition:width .5s;animation:pShine 2s linear infinite}
@keyframes pShine{0%{background-position:-200% 0}100%{background-position:200% 0}}

.tab-headers{display:grid;grid-template-columns:1fr 1fr;gap:8px;flex-shrink:0}
.tab-btn{background:linear-gradient(145deg,#e2e8f0,#cbd5e1);border:2px solid #94a3b8;border-radius:12px;padding:8px;font-size:20px;font-weight:700;cursor:pointer;transition:.2s;color:#475569;display:flex;align-items:center;justify-content:center;height:62px;white-space:nowrap;font-family:inherit}
.tab-btn.active{background:linear-gradient(145deg,#06b6d4,#0891b2);color:#fff;border-color:#06b6d4}
.tab-btn:active{transform:scale(.97)}
.tab-content{display:none;flex:1;overflow:hidden}
.tab-content.active{display:flex;flex-direction:column}

.side-info{background:linear-gradient(145deg,#ecfeff,#cffafe);border-radius:16px;padding:18px;border:2px solid #06b6d4;display:flex;flex-direction:column;gap:10px;height:100%;overflow:hidden}
.side-title{font-size:24px;font-weight:700;color:#164e63;text-align:center;flex-shrink:0}
.side-stat{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;background:#fff;border-radius:8px;font-size:20px;font-weight:600;color:#1e293b}
.side-val{font-size:32px;font-weight:800;color:#0891b2}

.game-launch-btn{flex-shrink:0;background:linear-gradient(145deg,#67e8f9,#22d3ee);color:#164e63;border:3px solid #fff;border-radius:16px;padding:20px;font-size:26px;font-weight:800;cursor:pointer;text-align:center;box-shadow:0 4px 15px rgba(103,232,249,.4);font-family:inherit;animation:gPulse 2s ease-in-out infinite}
@keyframes gPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.02)}}
.game-launch-btn:active{transform:scale(.97)}

.center-panel{display:flex;flex-direction:column;overflow:hidden;position:relative}
.game-view{display:none;flex-direction:column;flex:1;overflow:hidden}
.game-view.active{display:flex}

/* ì‹œê°„ ì—¬í–‰ì */
.travel-area{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;position:relative;transition:background 1s}
.travel-bg{position:absolute;inset:0;border-radius:16px;transition:background 1s;overflow:hidden}
.travel-bg-dawn{background:linear-gradient(180deg,#1e1b4b 0%,#312e81 20%,#6366f1 50%,#a78bfa 70%,#fde68a 100%)}
.travel-bg-morning{background:linear-gradient(180deg,#bfdbfe 0%,#93c5fd 20%,#60a5fa 50%,#93c5fd 80%,#86efac 100%)}
.travel-bg-noon{background:linear-gradient(180deg,#e0f2fe 0%,#7dd3fc 25%,#38bdf8 50%,#0ea5e9 75%,#86efac 100%)}
.travel-bg-evening{background:linear-gradient(180deg,#312e81 0%,#7c3aed 20%,#f97316 40%,#fb923c 60%,#fde68a 80%,#4ade80 100%)}
.travel-bg-night{background:linear-gradient(180deg,#020617 0%,#0f172a 25%,#1e293b 50%,#1e3a5f 80%,#1e293b 100%)}
.travel-scene-svg{position:absolute;inset:0;pointer-events:none;z-index:1}
.travel-scene-svg svg{width:100%;height:100%}
.travel-stars{position:absolute;inset:0;pointer-events:none}
.travel-question{position:relative;z-index:5;font-size:36px;font-weight:800;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.5);background:rgba(0,0,0,.3);padding:16px 36px;border-radius:16px;backdrop-filter:blur(4px)}
.travel-clock-wrap{position:relative;z-index:5}
.travel-result{position:relative;z-index:5;font-size:28px;font-weight:700;min-height:40px;text-align:center;color:#fff;text-shadow:0 2px 4px rgba(0,0,0,.3)}
.travel-confirm-btn{position:relative;z-index:5;background:linear-gradient(145deg,#22d3ee,#06b6d4);color:#fff;border:3px solid #a5f3fc;border-radius:16px;padding:16px 52px;font-size:28px;font-weight:800;cursor:pointer;font-family:inherit;box-shadow:0 4px 12px rgba(6,182,212,.4)}
.travel-confirm-btn:active{transform:scale(.95)}

/* SVG ì•„ë‚ ë¡œê·¸ ì‹œê³„ ê³µí†µ */
.analog-clock{cursor:grab}
.analog-clock:active{cursor:grabbing}
.clock-face-ring{fill:none;stroke:#e2e8f0;stroke-width:4}
.clock-face-bg{fill:#f8fafc}
.clock-tick{stroke:#94a3b8;stroke-width:2;stroke-linecap:round}
.clock-tick-major{stroke:#475569;stroke-width:3;stroke-linecap:round}
.clock-number{fill:#1e293b;font-size:28px;font-weight:800;font-family:'Noto Sans KR',sans-serif;text-anchor:middle;dominant-baseline:central}
.clock-center-dot{fill:#0891b2}
.clock-hand-hour{stroke:#1e293b;stroke-width:8;stroke-linecap:round;filter:drop-shadow(0 2px 3px rgba(0,0,0,.2));transition:transform .3s ease}
.clock-hand-minute{stroke:#0891b2;stroke-width:5;stroke-linecap:round;filter:drop-shadow(0 1px 2px rgba(0,0,0,.15));transition:transform .3s ease}
.clock-hand-second{stroke:#ef4444;stroke-width:2;stroke-linecap:round}

/* ë‹¬ë ¥ ë†€ì´ */
.cal-area{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;position:relative}
.cal-calendar{background:#fff;border-radius:16px;border:3px solid #06b6d4;box-shadow:0 4px 16px rgba(6,182,212,.2);overflow:hidden;min-width:700px}
.cal-header{display:flex;align-items:center;justify-content:center;gap:16px;background:linear-gradient(145deg,#06b6d4,#0891b2);padding:16px;color:#fff}
.cal-header-title{font-size:32px;font-weight:800}
.cal-header-btn{background:rgba(255,255,255,.2);border:2px solid rgba(255,255,255,.4);border-radius:8px;padding:8px 16px;font-size:24px;color:#fff;cursor:pointer;font-family:inherit}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;padding:16px}
.cal-day-header{text-align:center;font-size:22px;font-weight:800;color:#0891b2;padding:10px}
.cal-day-header.sun{color:#ef4444}
.cal-day-header.sat{color:#3b82f6}
.cal-cell{text-align:center;padding:16px 8px;font-size:26px;font-weight:600;color:#334155;border-radius:8px;cursor:pointer;transition:.15s;min-height:54px}
.cal-cell:hover{background:#ecfeff}
.cal-cell.today{background:linear-gradient(145deg,#06b6d4,#0891b2);color:#fff;border-radius:50%;font-weight:800}
.cal-cell.selected{background:#22d3ee;color:#fff;border-radius:50%}
.cal-cell.correct-cell{background:#22c55e;color:#fff;border-radius:50%;animation:correctFlash .6s}
.cal-cell.wrong-cell{background:#ef4444;color:#fff;border-radius:50%;animation:shake .4s}
.cal-cell.empty{cursor:default}
.cal-question{font-size:34px;font-weight:800;color:#1e293b;background:linear-gradient(145deg,#ecfeff,#cffafe);padding:18px 36px;border-radius:14px;border:3px solid #06b6d4;text-align:center}
.cal-options{display:grid;grid-template-columns:1fr 1fr;gap:14px;width:100%;max-width:560px}
.cal-opt{background:linear-gradient(145deg,#f8fafc,#e2e8f0);border:3px solid #94a3b8;border-bottom:5px solid #64748b;border-radius:14px;padding:18px 36px;font-size:28px;font-weight:700;cursor:pointer;font-family:inherit;color:#334155;transition:.15s}
.cal-opt:active{transform:translateY(2px);border-bottom-width:3px}
.cal-opt.correct{background:linear-gradient(145deg,#22c55e,#16a34a)!important;color:#fff!important;border-color:#16a34a!important}
.cal-opt.wrong{background:linear-gradient(145deg,#ef4444,#dc2626)!important;color:#fff!important;border-color:#dc2626!important}
.cal-result{font-size:26px;font-weight:700;min-height:32px;text-align:center}
.cal-mode{font-size:18px;font-weight:600;color:#64748b;background:#f1f5f9;padding:4px 12px;border-radius:8px}

/* ìŒë‘¥ì´ ì‹œê³„ */
.twin-area{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px}
.twin-question{font-size:32px;font-weight:800;color:#1e293b;background:linear-gradient(145deg,#ecfeff,#cffafe);padding:16px 32px;border-radius:14px;border:3px solid #06b6d4;text-align:center}
.twin-clocks{display:flex;gap:32px;align-items:center}
.twin-clock-box{display:flex;flex-direction:column;align-items:center;gap:10px;background:rgba(255,255,255,.5);padding:16px;border-radius:16px;border:2px solid rgba(6,182,212,.2);backdrop-filter:blur(4px)}
.twin-label{font-size:24px;font-weight:700;color:#475569;background:#f1f5f9;padding:10px 20px;border-radius:8px}
.twin-digital{background:linear-gradient(145deg,#0f172a,#1e293b);border:4px solid #475569;border-radius:16px;padding:28px 52px;box-shadow:inset 0 4px 12px rgba(0,0,0,.4),0 4px 12px rgba(0,0,0,.2);position:relative;overflow:hidden}
.twin-digital::before{content:'';position:absolute;top:0;left:0;right:0;height:40%;background:linear-gradient(180deg,rgba(255,255,255,.05),transparent);pointer-events:none}
.twin-digital-time{font-size:92px;font-weight:900;font-family:'Courier New',monospace;color:#22d3ee;text-shadow:0 0 20px rgba(34,211,238,.6),0 0 40px rgba(34,211,238,.3),0 0 60px rgba(34,211,238,.15);letter-spacing:4px}
.twin-digital-ampm{font-size:26px;font-weight:700;color:#67e8f9;text-align:center;margin-top:4px}
.twin-input-area{display:flex;gap:8px;align-items:center}
.twin-input{width:100px;height:80px;text-align:center;font-size:44px;font-weight:800;border:3px solid #06b6d4;border-radius:12px;background:#fff;color:#1e293b;font-family:inherit}
.twin-input:focus{outline:none;border-color:#22d3ee;box-shadow:0 0 12px rgba(34,211,238,.3)}
.twin-colon{font-size:48px;font-weight:900;color:#475569}
.twin-submit{background:linear-gradient(145deg,#22d3ee,#06b6d4);color:#fff;border:3px solid #a5f3fc;border-radius:14px;padding:16px 44px;font-size:28px;font-weight:800;cursor:pointer;font-family:inherit}
.twin-submit:active{transform:scale(.95)}
.twin-result{font-size:28px;font-weight:700;min-height:36px;text-align:center;color:#1e293b}
.twin-vs{font-size:52px;font-weight:900;color:#06b6d4;text-shadow:0 0 16px rgba(6,182,212,.4);animation:twinVsPulse 2s ease-in-out infinite}
@keyframes twinVsPulse{0%,100%{transform:scale(1);text-shadow:0 0 16px rgba(6,182,212,.4)}50%{transform:scale(1.1);text-shadow:0 0 24px rgba(6,182,212,.6)}}

/* ë‚´ ê¸°ë¡ */
.records-area{flex:1;display:flex;flex-direction:column;gap:20px;padding:20px;overflow-y:auto}
.record-card{background:linear-gradient(145deg,#fff,#f8fafc);border:2px solid #e2e8f0;border-radius:16px;padding:24px;box-shadow:0 4px 12px rgba(0,0,0,.06)}
.record-card h3{font-size:24px;font-weight:800;color:#1e293b;margin-bottom:10px}
.record-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.record-item{text-align:center;padding:16px;background:linear-gradient(145deg,#ecfeff,#cffafe);border-radius:12px;border:2px solid #a5f3fc}
.record-num{font-size:44px;font-weight:900;color:#0891b2}
.record-label{font-size:18px;font-weight:600;color:#164e63;margin-top:4px}

.right-panel{display:flex;flex-direction:column;gap:12px;overflow:hidden}
.action-btn{border:none;border-radius:20px;font-size:38px;font-weight:800;cursor:pointer;transition:.1s;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;flex:1;min-height:60px;font-family:inherit;color:#fff}
.action-btn .icon{font-size:64px;opacity:.9;line-height:1}
.action-btn:active{transform:scale(.95)}
.action-btn.btn-cyan{background:linear-gradient(145deg,#06b6d4,#0891b2);box-shadow:0 2px 8px rgba(6,182,212,.2)}
.action-btn.btn-red{background:linear-gradient(145deg,#f87171,#ef4444);box-shadow:0 2px 8px rgba(248,113,113,.2)}
.action-btn.btn-green{background:linear-gradient(145deg,#10b981,#059669);box-shadow:0 2px 8px rgba(16,185,129,.2)}
.action-btn.btn-teal{background:linear-gradient(145deg,#14b8a6,#0d9488);box-shadow:0 2px 8px rgba(20,184,166,.2)}
.action-btn:disabled{background:linear-gradient(145deg,#e5e7eb,#d1d5db)!important;color:#9ca3af;cursor:not-allowed;box-shadow:none}

/* íˆì–´ë¡œ: ì‹œê³„ ìŠ¤í”¼ë“œëŸ° */
.hero-game{position:absolute;top:0;left:0;width:1920px;height:1080px;z-index:5000;display:flex;flex-direction:column;background:linear-gradient(180deg,#ecfeff 0%,#cffafe 50%,#a5f3fc 100%)}
.hero-game.hidden{display:none}
.hg-header{display:flex;align-items:center;justify-content:space-between;padding:12px 24px;background:rgba(255,255,255,.85);backdrop-filter:blur(8px);border-bottom:2px solid #06b6d4}
.hg-stat{font-size:24px;font-weight:800;color:#0e7490;-webkit-text-stroke:.5px rgba(0,0,0,.1)}
.hg-hearts{font-size:28px;letter-spacing:4px}
.hg-ctrls{display:flex;gap:8px}
.hg-ctrl-btn{width:44px;height:44px;border-radius:12px;border:2px solid #06b6d4;background:#fff;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.15s}
.hg-ctrl-btn:hover{background:#ecfeff}
.hg-timer-wrap{padding:8px 24px}
.hg-timer-bar{height:12px;border-radius:6px;background:#e2e8f0;overflow:hidden}
.hg-timer-fill{height:100%;border-radius:6px;background:linear-gradient(90deg,#22c55e,#84cc16);transition:width .1s linear}
.hg-timer-fill.warn{background:linear-gradient(90deg,#f59e0b,#eab308)}
.hg-timer-fill.danger{background:linear-gradient(90deg,#ef4444,#f97316)}
.hg-body{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;overflow:hidden;position:relative}
.hg-clock-area{position:relative}
.hg-legend{display:flex;gap:24px;font-size:20px;font-weight:700}
.hg-legend .hour-label{color:#dc2626}
.hg-legend .min-label{color:#2563eb}
.hg-options{display:grid;grid-template-columns:1fr 1fr;gap:10px;width:480px;max-width:90%}
.hg-opt{padding:12px 8px;font-size:26px;font-weight:800;border:3px solid #06b6d4;border-radius:16px;background:#fff;color:#0e7490;cursor:pointer;transition:.15s;border-bottom:5px solid #0891b2}
.hg-opt:hover{background:#ecfeff;transform:translateY(-2px)}
.hg-opt:active{transform:translateY(2px);border-bottom:2px solid #0891b2}
.hg-opt.correct{background:#22c55e;color:#fff;border-color:#16a34a}
.hg-opt.wrong{background:#ef4444;color:#fff;border-color:#dc2626;animation:shake .4s}
.hg-combo{font-size:22px;font-weight:800;color:#f59e0b;text-shadow:0 2px 4px rgba(0,0,0,.1);min-height:30px}
.hg-overlay{position:absolute;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:10}
.hg-overlay.hidden{display:none}
.hg-overlay-box{background:#fff;border-radius:24px;padding:40px;text-align:center;box-shadow:0 8px 32px rgba(0,0,0,.2);min-width:320px}
.hg-overlay-box h2{font-size:32px;margin-bottom:16px;color:#0e7490}
.hg-overlay-box .score{font-size:28px;font-weight:800;color:#f59e0b;margin-bottom:8px}
.hg-overlay-box .best{font-size:18px;color:#64748b;margin-bottom:16px}
.hg-overlay-box .msg{font-size:20px;color:#475569;margin-bottom:24px}
.hg-overlay-box button{padding:14px 32px;border-radius:14px;font-size:20px;font-weight:700;border:none;cursor:pointer;margin:0 8px;transition:.15s}
.hg-overlay-box .btn-retry{background:#06b6d4;color:#fff}
.hg-overlay-box .btn-retry:hover{background:#0891b2}
.hg-overlay-box .btn-exit{background:#e2e8f0;color:#475569}
.hg-overlay-box .btn-exit:hover{background:#cbd5e1}
.hg-deco{position:absolute;pointer-events:none;z-index:1;opacity:0.08;animation:decoFloat var(--dur,6s) ease-in-out infinite}
@keyframes decoFloat{0%,100%{transform:translateY(0) rotate(0deg)}25%{transform:translateY(-15px) rotate(5deg)}50%{transform:translateY(-5px) rotate(-3deg)}75%{transform:translateY(-20px) rotate(4deg)}}
.hg-bg-sparkle{position:absolute;pointer-events:none;z-index:2;animation:bgSparkle var(--dur,3s) ease-in-out infinite}
@keyframes bgSparkle{0%,100%{transform:scale(.6);opacity:.3}50%{transform:scale(1.2);opacity:.8}}

/* ëª¨ë‹¬ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:6000;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(10px)}
.modal-overlay.hidden{display:none}
.modal-box{background:#fff;border-radius:20px;width:90%;max-width:500px;max-height:80vh;overflow-y:auto;box-shadow:0 25px 50px rgba(0,0,0,.3)}
.modal-head{background:linear-gradient(145deg,#06b6d4,#0891b2);color:#fff;padding:16px 20px;border-radius:20px 20px 0 0;display:flex;justify-content:space-between;align-items:center}
.modal-head h3{margin:0;font-size:18px}
.modal-close{background:0;border:0;color:#fff;font-size:24px;cursor:pointer}
.modal-body{padding:20px}
.modal-section{margin-bottom:16px;padding:14px;border-radius:10px;background:#f8fafc}
.modal-section h4{margin:0 0 10px;font-weight:700;color:#374151;font-size:15px}
.modal-input{width:100%;padding:10px;border:2px solid #e5e7eb;border-radius:8px;font-size:14px;box-sizing:border-box;margin-bottom:8px}
.modal-input:focus{outline:none;border-color:#06b6d4}
.modal-btn{padding:10px 16px;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;width:100%;background:linear-gradient(145deg,#06b6d4,#0891b2);color:#fff;margin-top:6px}
.char-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(70px,1fr));gap:12px}
.char-item{background:linear-gradient(145deg,#f8fafc,#e2e8f0);border:2px solid #cbd5e1;border-radius:14px;padding:12px;text-align:center;cursor:pointer;font-size:32px;height:70px;display:flex;align-items:center;justify-content:center;transition:.2s}
.char-item.selected{background:linear-gradient(145deg,#67e8f9,#22d3ee);border-color:#22d3ee}

/* ì‹œê°„ì—¬í–‰ì SVG ì¥ì‹ */
.travel-decor{position:absolute;pointer-events:none;z-index:2}
.travel-sun{top:30px;right:60px;animation:sunGlow 4s ease-in-out infinite}
@keyframes sunGlow{0%,100%{transform:scale(1);filter:drop-shadow(0 0 12px rgba(251,191,36,.6))}50%{transform:scale(1.08);filter:drop-shadow(0 0 24px rgba(251,191,36,.9))}}
.travel-moon{top:30px;right:60px;animation:moonFloat 5s ease-in-out infinite}
@keyframes moonFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.travel-star{animation:starTwinkle 2s ease-in-out infinite}
@keyframes starTwinkle{0%,100%{opacity:.7;transform:scale(1)}50%{opacity:1;transform:scale(1.2)}}

/* ë‹¬ë ¥ ë†€ì´ ë°°ê²½ ì¥ì‹ â€” removed cook steam/flame */

@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}}
@keyframes correctPop{0%{transform:scale(0);opacity:0}50%{transform:scale(1.3);opacity:1}100%{transform:scale(1);opacity:0}}
@keyframes correctFlash{0%{box-shadow:inset 0 0 0 4px #22c55e}50%{box-shadow:inset 0 0 40px 4px rgba(34,197,94,.4)}100%{box-shadow:none}}
@keyframes wrongFlash{0%{box-shadow:inset 0 0 0 4px #ef4444}50%{box-shadow:inset 0 0 40px 4px rgba(239,68,68,.4)}100%{box-shadow:none}}
@keyframes particleBurst{0%{transform:translate(0,0) scale(1);opacity:1}100%{transform:translate(var(--tx),var(--ty)) scale(0);opacity:0}}

/* ===== ë¹„ì£¼ì–¼ ì—…ê·¸ë ˆì´ë“œ ===== */

/* ë°°ê²½ ì”¬: ë‹¬ë ¥ë†€ì´ â€” ë‹¬ë ¥ íŒ¨í„´ */
.cal-view::before{content:'';position:absolute;inset:0;border-radius:16px;opacity:.5;pointer-events:none;background:url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect x='20' y='20' width='40' height='45' rx='4' fill='none' stroke='%2306b6d4' stroke-width='.5' opacity='.15'/><rect x='20' y='20' width='40' height='10' rx='2' fill='%2306b6d4' opacity='.08'/><circle cx='30' cy='16' r='2' fill='%2306b6d4' opacity='.1'/><circle cx='50' cy='16' r='2' fill='%2306b6d4' opacity='.1'/><rect x='140' y='120' width='40' height='45' rx='4' fill='none' stroke='%2306b6d4' stroke-width='.5' opacity='.12'/><rect x='140' y='120' width='40' height='10' rx='2' fill='%2306b6d4' opacity='.06'/></svg>") repeat}
.cal-view{position:relative}

/* ë°°ê²½ ì”¬: ìŒë‘¥ì´ì‹œê³„ â€” ì‹œê³„ê³µë°© */
.twin-view::before{content:'';position:absolute;inset:0;pointer-events:none;z-index:0;border-radius:16px;background:
  url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1300 900'><defs><linearGradient id='wb' x1='0' y1='0' x2='0' y2='1'><stop offset='0%' stop-color='%23ecfeff'/><stop offset='100%' stop-color='%23e0f2fe'/></linearGradient></defs><rect fill='url(%23wb)' width='1300' height='900'/><g opacity='.08'><circle cx='100' cy='130' r='55' fill='none' stroke='%2306b6d4' stroke-width='3'><animateTransform attributeName='transform' type='rotate' values='0 100 130;360 100 130' dur='25s' repeatCount='indefinite'/></circle><g transform='translate(100,130)'><rect x='-4' y='-58' width='8' height='12' rx='2' fill='%2306b6d4'/><rect x='-4' y='46' width='8' height='12' rx='2' fill='%2306b6d4'/><rect x='-58' y='-4' width='12' height='8' rx='2' fill='%2306b6d4'/><rect x='46' y='-4' width='12' height='8' rx='2' fill='%2306b6d4'/><animateTransform attributeName='transform' type='rotate' values='0 100 130;360 100 130' dur='25s' repeatCount='indefinite'/></g><circle cx='100' cy='130' r='8' fill='%2306b6d4'/></g><g opacity='.08'><circle cx='1200' cy='120' r='45' fill='none' stroke='%2306b6d4' stroke-width='3'><animateTransform attributeName='transform' type='rotate' values='360 1200 120;0 1200 120' dur='20s' repeatCount='indefinite'/></circle><g transform='translate(1200,120)'><rect x='-3' y='-48' width='6' height='10' rx='2' fill='%2306b6d4'/><rect x='-3' y='38' width='6' height='10' rx='2' fill='%2306b6d4'/><rect x='-48' y='-3' width='10' height='6' rx='2' fill='%2306b6d4'/><rect x='38' y='-3' width='10' height='6' rx='2' fill='%2306b6d4'/><animateTransform attributeName='transform' type='rotate' values='360 1200 120;0 1200 120' dur='20s' repeatCount='indefinite'/></g><circle cx='1200' cy='120' r='6' fill='%2306b6d4'/></g><g opacity='.06'><circle cx='200' cy='800' r='30' fill='none' stroke='%2306b6d4' stroke-width='2'><animateTransform attributeName='transform' type='rotate' values='0 200 800;360 200 800' dur='18s' repeatCount='indefinite'/></circle><circle cx='1100' cy='780' r='25' fill='none' stroke='%2306b6d4' stroke-width='2'><animateTransform attributeName='transform' type='rotate' values='360 1100 780;0 1100 780' dur='15s' repeatCount='indefinite'/></circle></g><g opacity='.05'><circle cx='650' cy='50' r='20' fill='none' stroke='%2306b6d4' stroke-width='1.5'><animateTransform attributeName='transform' type='rotate' values='0 650 50;360 650 50' dur='12s' repeatCount='indefinite'/></circle></g></svg>") center/cover no-repeat;opacity:.6}
.twin-view{position:relative}

/* ë°°ê²½ ì”¬: ë‚´ê¸°ë¡ â€” íŠ¸ë¡œí”¼ë£¸ */
.record-view::before{content:'';position:absolute;inset:0;pointer-events:none;z-index:0;border-radius:16px;background:
  url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1300 900'><defs><linearGradient id='rb' x1='0' y1='0' x2='0' y2='1'><stop offset='0%' stop-color='%23ecfeff'/><stop offset='100%' stop-color='%23cffafe'/></linearGradient></defs><rect fill='url(%23rb)' width='1300' height='900'/><g opacity='.06'><polygon points='100,60 108,82 132,82 113,96 120,118 100,104 80,118 87,96 68,82 92,82' fill='%23fbbf24'/><polygon points='1200,80 1206,96 1222,96 1209,106 1214,122 1200,112 1186,122 1191,106 1178,96 1194,96' fill='%23fbbf24'/><polygon points='650,40 656,56 672,56 659,66 664,82 650,72 636,82 641,66 628,56 644,56' fill='%2306b6d4'><animate attributeName='opacity' values='.06;.12;.06' dur='3s' repeatCount='indefinite'/></polygon></g><g opacity='.05'><path d='M60,800 L60,750 Q60,740 70,740 L110,740 Q120,740 120,750 L120,800' fill='none' stroke='%23fbbf24' stroke-width='2'/><path d='M50,750 Q90,720 130,750' fill='none' stroke='%23fbbf24' stroke-width='2'/><rect x='82' y='800' width='16' height='20' fill='%23fbbf24'/><path d='M1180,810 L1180,760 Q1180,750 1190,750 L1220,750 Q1230,750 1230,760 L1230,810' fill='none' stroke='%23fbbf24' stroke-width='2'/><path d='M1170,760 Q1205,730 1240,760' fill='none' stroke='%23fbbf24' stroke-width='2'/></g></svg>") center/cover no-repeat;opacity:.6}
.record-view{position:relative}
.record-card{backdrop-filter:blur(4px);background:linear-gradient(145deg,rgba(255,255,255,.9),rgba(248,250,252,.85))!important;border:2px solid #a5f3fc!important;box-shadow:0 4px 16px rgba(6,182,212,.1)!important}
.record-num{text-shadow:0 0 12px rgba(8,145,178,.3)}

/* ì‹œê°„ì—¬í–‰ì â€” ì´ë¯¸ ë™ì  ë°°ê²½ì´ ìˆìœ¼ë¯€ë¡œ positionë§Œ */
.travel-view{position:relative}

/* 3D ì•„ì¼€ì´ë“œ ë²„íŠ¼ */
.tab-btn{border-bottom:5px solid #7c8ba5;transition:.15s}
.tab-btn:active{transform:translateY(3px) scaleX(1.02) scaleY(.95)!important;border-bottom-width:2px}
.tab-btn.active{border-color:#0e7490;border-bottom:5px solid #0e7490}
.tab-btn.active:active{border-bottom-width:2px}

.action-btn{border-bottom:6px solid rgba(0,0,0,.25);transition:.1s}
.action-btn:active:not(:disabled){transform:translateY(4px) scaleX(1.03) scaleY(.94)!important;border-bottom-width:2px}
.action-btn.btn-cyan{border-bottom-color:#0e7490}
.action-btn.btn-red{border-bottom-color:#b91c1c}
.action-btn.btn-green{border-bottom-color:#047857}
.action-btn.btn-teal{border-bottom-color:#0d6e6e}

.travel-confirm-btn{border-bottom:5px solid #0e7490;transition:.15s}
.travel-confirm-btn:active{transform:translateY(3px) scaleX(1.02) scaleY(.95)!important;border-bottom-width:2px}
.cal-opt{border-bottom:5px solid #64748b;transition:.15s}
.cal-opt:active{transform:translateY(3px) scaleX(1.02) scaleY(.95)!important;border-bottom-width:2px}
.twin-submit{border-bottom:5px solid #0e7490;transition:.15s}
.twin-submit:active{transform:translateY(3px) scaleX(1.02) scaleY(.95)!important;border-bottom-width:2px}

.game-launch-btn{border-bottom:6px solid #0e7490;position:relative;overflow:hidden}
.game-launch-btn:active{transform:translateY(4px) scaleX(1.02) scaleY(.95)!important;border-bottom-width:2px;animation:none}
.game-launch-btn::after{content:'';position:absolute;top:0;left:-100%;width:60%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.35),transparent);animation:btnSweep 3s ease-in-out infinite}
@keyframes btnSweep{0%,100%{left:-100%}50%{left:120%}}

/* íŒ¨ë„ ë³´ê°• */
.right-panel{background:linear-gradient(180deg,rgba(236,254,255,.3),rgba(207,250,254,.15));border-radius:20px;padding:10px}
.side-info{position:relative;overflow:hidden}
.side-info::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,#06b6d4,#22d3ee,#06b6d4);border-radius:4px 4px 0 0}
.side-val{text-shadow:0 0 12px rgba(6,182,212,.35)}
.side-stat{transition:transform .2s}
.side-stat:hover{transform:translateX(3px)}

/* ë””ìì¸ í¬ë®¬ëŸ¬ */
.game-launch-btn,.side-title,.travel-question{-webkit-text-stroke:.5px rgba(0,0,0,.1);paint-order:stroke fill}
.score-popup{position:absolute;font-size:28px;font-weight:900;pointer-events:none;animation:scorePop .8s ease-out forwards;z-index:20}
@keyframes scorePop{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-60px) scale(1.3)}}
.game-view.active{animation:viewFadeIn .35s ease-out}
@keyframes viewFadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.levelup-overlay{position:fixed;inset:0;z-index:8000;display:flex;align-items:center;justify-content:center;background:rgba(6,182,212,.15);pointer-events:none;animation:lvFlash .8s ease-out forwards}
@keyframes lvFlash{0%{background:rgba(6,182,212,.25)}100%{background:transparent}}
.levelup-box{font-size:52px;font-weight:900;color:#0891b2;text-shadow:0 4px 20px rgba(6,182,212,.5);animation:lvPop .8s cubic-bezier(.175,.885,.32,1.275) forwards}
@keyframes lvPop{0%{opacity:0;transform:scale(0) rotate(-10deg)}50%{opacity:1;transform:scale(1.3) rotate(3deg)}100%{opacity:0;transform:scale(1) rotate(0)}}
@keyframes heartLost{0%{transform:scale(1)}50%{transform:scale(1.3)}100%{transform:scale(1)}}

/* ë§ˆìŠ¤ì½”íŠ¸ â€” í’€ë°”ë”” ì—…ê·¸ë ˆì´ë“œ */
.mascot{position:absolute;z-index:5;pointer-events:none;animation:mascotBob 3s ease-in-out infinite}
@keyframes mascotBob{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
.mascot-bubble{position:absolute;background:#fff;border-radius:16px;padding:6px 14px;font-size:13px;font-weight:700;color:#164e63;box-shadow:0 3px 12px rgba(0,0,0,.12);white-space:nowrap;opacity:0;transition:opacity .3s;top:-40px;left:50%;transform:translateX(-50%)}
.mascot-bubble::after{content:'';position:absolute;bottom:-6px;left:50%;transform:translateX(-50%);border-left:6px solid transparent;border-right:6px solid transparent;border-top:6px solid #fff}
.mascot-bubble.show{opacity:1}
.mascot-happy-anim{animation:mascotBounce .6s ease-out!important}
@keyframes mascotBounce{0%{transform:translateY(0)}30%{transform:translateY(-12px) scale(1.08)}50%{transform:translateY(-3px)}100%{transform:translateY(0)}}
.mascot-worried-anim{animation:mascotWobble .5s ease-out!important}
@keyframes mascotWobble{0%,100%{transform:translateX(0)}20%{transform:translateX(-4px) rotate(-3deg)}40%{transform:translateX(4px) rotate(3deg)}60%{transform:translateX(-3px) rotate(-2deg)}80%{transform:translateX(2px) rotate(1deg)}}
.mascot-sparkle{position:absolute;font-size:14px;pointer-events:none;animation:sparkleFloat 1s ease-out forwards;z-index:10}
@keyframes sparkleFloat{0%{opacity:1;transform:translateY(0) scale(0)}30%{opacity:1;transform:translateY(-10px) scale(1.2)}100%{opacity:0;transform:translateY(-30px) scale(.5)}}
/* cook-btn-start removed â€” replaced by cal game */
.hand-toggle{display:flex;gap:10px;position:relative;z-index:5}
.hand-btn{background:linear-gradient(145deg,#e2e8f0,#cbd5e1);border:2px solid #94a3b8;border-radius:12px;padding:10px 20px;font-size:16px;font-weight:700;cursor:pointer;font-family:inherit;color:#475569;transition:.2s}
.hand-btn.active{background:linear-gradient(145deg,#06b6d4,#0891b2);color:#fff;border-color:#22d3ee;box-shadow:0 0 12px rgba(6,182,212,.4)}
.hand-btn:active{transform:scale(.95)}
.clock-hand-hour.dimmed,.clock-hand-minute.dimmed{opacity:.2!important;transition:opacity .3s}
.travel-guide,.twin-guide{font-size:15px;font-weight:600;color:#fff;background:rgba(0,0,0,.25);padding:6px 14px;border-radius:10px;position:relative;z-index:5;text-align:center;backdrop-filter:blur(2px)}

/* ===== ì• ë‹ˆë©”ì´ì…˜ê¸‰ ë¹„ì£¼ì–¼ ì—…ê·¸ë ˆì´ë“œ v2 ===== */

/* 1. ì‹œê°„ì—¬í–‰ â€” ì‹œê³„ ì£¼ë³€ í†±ë‹ˆë°”í€´ ì¥ì‹ */
.travel-clock-wrap{position:relative}
.travel-clock-wrap::before,.travel-clock-wrap::after{content:'';position:absolute;pointer-events:none;z-index:0;opacity:.12}
.travel-clock-wrap::before{top:-20px;left:-30px;width:70px;height:70px;background:url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 70 70'><circle cx='35' cy='35' r='28' fill='none' stroke='%2306b6d4' stroke-width='2'/><g fill='%2306b6d4'><rect x='31' y='2' width='8' height='10' rx='2'/><rect x='31' y='58' width='8' height='10' rx='2'/><rect x='2' y='31' width='10' height='8' rx='2'/><rect x='58' y='31' width='10' height='8' rx='2'/></g><circle cx='35' cy='35' r='6' fill='%2306b6d4'/><animateTransform attributeName='transform' type='rotate' values='0 35 35;360 35 35' dur='20s' repeatCount='indefinite'/></svg>") center/contain no-repeat;animation:gearSpin 20s linear infinite}
.travel-clock-wrap::after{bottom:-15px;right:-25px;width:55px;height:55px;background:url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 55 55'><circle cx='27.5' cy='27.5' r='20' fill='none' stroke='%2322d3ee' stroke-width='2'/><g fill='%2322d3ee'><rect x='24' y='2' width='7' height='8' rx='2'/><rect x='24' y='45' width='7' height='8' rx='2'/><rect x='2' y='24' width='8' height='7' rx='2'/><rect x='45' y='24' width='8' height='7' rx='2'/></g><circle cx='27.5' cy='27.5' r='4' fill='%2322d3ee'/><animateTransform attributeName='transform' type='rotate' values='360 27.5 27.5;0 27.5 27.5' dur='15s' repeatCount='indefinite'/></svg>") center/contain no-repeat;animation:gearSpinR 15s linear infinite}
@keyframes gearSpin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
@keyframes gearSpinR{from{transform:rotate(360deg)}to{transform:rotate(0)}}

/* 2. ë‹¬ë ¥ â€” í—¤ë”/ìš”ì¼/ì˜¤ëŠ˜ í„ìŠ¤/ì§ˆë¬¸ë°•ìŠ¤ ë§í’ì„  ê°•í™” */
.cal-header{background:linear-gradient(145deg,#0891b2,#06b6d4);border-radius:16px 16px 0 0;padding:14px 16px}
.cal-header-title{text-shadow:0 2px 6px rgba(0,0,0,.2)}
.cal-header-btn{background:rgba(255,255,255,.25);border:2px solid rgba(255,255,255,.5);border-radius:50%;width:36px;height:36px;padding:0;display:flex;align-items:center;justify-content:center;transition:.15s}
.cal-header-btn:hover{background:rgba(255,255,255,.4);transform:scale(1.1)}
.cal-day-header{padding:8px;font-weight:800;border-radius:6px;background:rgba(6,182,212,.05)}
.cal-day-header.sun{background:rgba(239,68,68,.08)}
.cal-day-header.sat{background:rgba(59,130,246,.08)}
.cal-cell.today{animation:todayPulse 2s ease-in-out infinite}
@keyframes todayPulse{0%,100%{box-shadow:0 0 0 0 rgba(6,182,212,.4)}50%{box-shadow:0 0 0 8px rgba(6,182,212,0)}}
.cal-question{position:relative;background:linear-gradient(145deg,#ecfeff,#cffafe);border:3px solid #06b6d4;border-radius:16px;padding:18px 36px;font-size:34px;box-shadow:0 0 0 1px #22d3ee,0 4px 12px rgba(6,182,212,.15)}
.cal-question::after{content:'';position:absolute;bottom:-10px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-top:10px solid #cffafe}

/* 3. ìŒë‘¥ì´ì‹œê³„ â€” VS/ë°°ê²½/ì—°ê²°ë¹” */
.twin-vs svg{animation:twinVsSpin 4s ease-in-out infinite}
@keyframes twinVsSpin{0%,100%{transform:rotate(0) scale(1)}25%{transform:rotate(5deg) scale(1.1)}75%{transform:rotate(-5deg) scale(1.1)}}
.twin-clock-box{transition:transform .3s,box-shadow .3s}
.twin-clock-box:hover{transform:translateY(-3px);box-shadow:0 8px 24px rgba(6,182,212,.2)}
.twin-correct-beam{position:absolute;top:50%;left:50%;width:200px;height:4px;margin-left:-100px;margin-top:-2px;background:linear-gradient(90deg,transparent,#22d3ee,#06b6d4,#22d3ee,transparent);border-radius:2px;animation:beamPulse 1s ease-out forwards;z-index:10;pointer-events:none}
@keyframes beamPulse{0%{opacity:0;transform:scaleX(0)}50%{opacity:1;transform:scaleX(1.2)}100%{opacity:0;transform:scaleX(1)}}

/* 4. ë‚´ê¸°ë¡ â€” ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜ ì™„ì „ì²´ */
.record-card{backdrop-filter:blur(6px)!important;background:linear-gradient(145deg,rgba(255,255,255,.92),rgba(248,250,252,.88))!important;border:2px solid rgba(6,182,212,.25)!important;box-shadow:0 4px 20px rgba(6,182,212,.1),inset 0 1px 0 rgba(255,255,255,.5)!important;transition:transform .3s,box-shadow .3s}
.record-card:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(6,182,212,.18),inset 0 1px 0 rgba(255,255,255,.5)!important}
.record-card h3{background:linear-gradient(135deg,#0891b2,#06b6d4);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.record-num{text-shadow:0 0 16px rgba(8,145,178,.35),0 0 32px rgba(8,145,178,.15);font-size:44px!important}

/* 5. ë°°ê²½ ì”¬ ë³´ê°• â€” ë‹¬ë ¥ ê³„ì ˆ ë– ë‹¤ë‹ˆê¸° */
.cal-view::before{background:url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 300'><rect x='20' y='20' width='40' height='45' rx='4' fill='none' stroke='%2306b6d4' stroke-width='.5' opacity='.12'/><rect x='20' y='20' width='40' height='10' rx='2' fill='%2306b6d4' opacity='.06'/><circle cx='30' cy='16' r='2' fill='%2306b6d4' opacity='.08'/><circle cx='50' cy='16' r='2' fill='%2306b6d4' opacity='.08'/><rect x='200' y='180' width='40' height='45' rx='4' fill='none' stroke='%2306b6d4' stroke-width='.5' opacity='.1'/><rect x='200' y='180' width='40' height='10' rx='2' fill='%2306b6d4' opacity='.05'/><text x='40' y='230' font-size='18' opacity='.08'>ğŸŒ¸</text><text x='260' y='50' font-size='18' opacity='.08'>â˜€ï¸</text><text x='150' y='280' font-size='18' opacity='.08'>ğŸ‚</text><text x='270' y='250' font-size='18' opacity='.08'>â„ï¸</text></svg>") repeat!important;animation:calBgDrift 30s linear infinite}
@keyframes calBgDrift{from{background-position:0 0}to{background-position:300px 300px}}

/* 6. ìŒë‘¥ì´ì‹œê³„ ë°°ê²½ ë³´ê°• â€” ì§„ìì‹œê³„ + í†±ë‹ˆ opacity ì˜¬ë¦¼ */
.twin-view::before{opacity:.7!important}

/* 7. ë‚´ê¸°ë¡ ë°°ê²½ â€” ë³„ ê¹œë¹¡ + opacity ì˜¬ë¦¼ */
.record-view::before{opacity:.8!important}

/* 8. ì „ì²´ ê³µí†µ â€” ì‚¬ì´ë“œ íŒ¨ë„ ìˆ«ì íŠ¸ëœì§€ì…˜ + íƒ­ í˜¸ë²„ ê¸€ë¡œìš° */
.side-val{transition:all .3s ease;text-shadow:0 0 14px rgba(6,182,212,.4)}
.tab-btn:hover:not(.active){box-shadow:0 0 12px rgba(6,182,212,.2);background:linear-gradient(145deg,#f0f9ff,#e0f2fe)}
.tab-btn.active{box-shadow:0 2px 12px rgba(6,182,212,.3)}

/* 9. ì „ì²´ ë°°ê²½ ê¹Šì€ ê·¸ë¼ë°ì´ì…˜ */
body{background:linear-gradient(135deg,#0e7490 0%,#0891b2 25%,#06b6d4 50%,#0891b2 75%,#0e7490 100%)!important}

/* 10. ë§ˆìŠ¤ì½”íŠ¸ ë§í’ì„  ìœ„ì¹˜ ì¡°ì • (í’€ë°”ë””ìš©) */
.mascot-bubble{top:-45px}
</style>
</head>
<body>
<div class="rotate-notice"><div class="rotate-icon">ğŸ“±</div>í™”ë©´ì„ ê°€ë¡œë¡œ ëŒë ¤ì£¼ì„¸ìš”!</div>

<div class="container">
  <div class="subject-bar">
    <button class="sb-tab active">ğŸ• ì‹œê³„</button>
    <div class="sb-spacer"></div>
    <div class="sb-btns">
      <button class="sb-btn" id="sb-sound" onclick="toggleSound()">ğŸ”Š</button>
      <button class="sb-btn" onclick="showAdmin()">âš™ï¸</button>
    </div>
  </div>

  <div class="main-layout">
    <!-- ì™¼ìª½ íŒ¨ë„ -->
    <div class="left-panel">
      <div class="profile-section">
        <div class="profile-content">
          <div class="profile-avatar" onclick="showCharModal()"><span id="pf-char">ğŸ§’</span></div>
          <div class="profile-info">
            <div class="profile-name" onclick="changeName()"><span id="pf-name">ì‹œê³„ë°•ì‚¬</span></div>
            <div class="profile-level-container">
              <div class="profile-level">
                <span class="level-badge">LV.<span id="pf-level">1</span></span>
                <span id="pf-done">0</span>/<span id="pf-total">10</span>
              </div>
              <div class="progress-bar"><div class="progress-fill" id="pf-bar" style="width:0%"></div></div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-headers">
        <button class="tab-btn active" onclick="switchTab('travel')">ğŸ•° ì‹œê°„ì—¬í–‰</button>
        <button class="tab-btn" onclick="switchTab('cal')">ğŸ“… ë‹¬ë ¥ ë†€ì´</button>
        <button class="tab-btn" onclick="switchTab('twin')">ğŸ‘¯ ìŒë‘¥ì´ì‹œê³„</button>
        <button class="tab-btn" onclick="switchTab('record')">ğŸ“Š ë‚´ ê¸°ë¡</button>
      </div>

      <div class="tab-content travel-side active">
        <div class="side-info">
          <div class="side-title">ğŸ•° ì‹œê°„ ì—¬í–‰ì</div>
          <div class="side-stat"><span>ë¬¸ì œ</span><span class="side-val" id="travel-qnum">1</span></div>
          <div class="side-stat"><span>ì ìˆ˜</span><span class="side-val" id="travel-score-side">0</span></div>
          <div class="side-stat"><span>ì—°ì† ì •ë‹µ</span><span class="side-val" id="travel-streak">0</span></div>
        </div>
      </div>

      <div class="tab-content cal-side">
        <div class="side-info">
          <div class="side-title">ğŸ“… ë‹¬ë ¥ ë†€ì´</div>
          <div class="side-stat"><span>ë¬¸ì œ ìˆ˜</span><span class="side-val" id="cal-qnum-side">0</span></div>
          <div class="side-stat"><span>ì ìˆ˜</span><span class="side-val" id="cal-score-side">0</span></div>
          <div class="side-stat"><span>ì—°ì† ì •ë‹µ</span><span class="side-val" id="cal-streak-side">0</span></div>
        </div>
      </div>

      <div class="tab-content twin-side">
        <div class="side-info">
          <div class="side-title">ğŸ‘¯ ìŒë‘¥ì´ ì‹œê³„</div>
          <div class="side-stat"><span>ë¬¸ì œ</span><span class="side-val" id="twin-qnum">1</span></div>
          <div class="side-stat"><span>ì ìˆ˜</span><span class="side-val" id="twin-score-side">0</span></div>
          <div class="side-stat"><span>ì—°ì† ì •ë‹µ</span><span class="side-val" id="twin-streak-side">0</span></div>
        </div>
      </div>

      <div class="tab-content record-side">
        <div class="side-info">
          <div class="side-title">ğŸ“Š ì¢…í•© ê¸°ë¡</div>
          <div class="side-stat"><span>ì´ ë¬¸ì œ</span><span class="side-val" id="rec-total">0</span></div>
          <div class="side-stat"><span>ì •ë‹µë¥ </span><span class="side-val" id="rec-rate">0%</span></div>
        </div>
      </div>

      <div class="game-launch-btn" onclick="startHeroGame()">âš¡ ì‹œê³„ ìŠ¤í”¼ë“œëŸ°!</div>
    </div>

    <!-- ì¤‘ì•™ íŒ¨ë„ -->
    <div class="center-panel">
      <!-- ì‹œê°„ ì—¬í–‰ì -->
      <div class="game-view travel-view active" id="travel-view">
        <!-- ë§ˆìŠ¤ì½”íŠ¸ "ë˜‘ë”±ì´" í’€ë°”ë”” -->
        <div class="mascot" id="mascot-travel" style="top:8px;right:220px">
          <svg width="100" height="auto" viewBox="0 0 100 140">
            <ellipse cx="50" cy="132" rx="22" ry="4" fill="rgba(0,0,0,.08)"/>
            <ellipse cx="35" cy="122" rx="10" ry="6" fill="#0891b2"><animate attributeName="cx" values="35;33;35;37;35" dur="2s" repeatCount="indefinite"/></ellipse>
            <ellipse cx="65" cy="122" rx="10" ry="6" fill="#0891b2"><animate attributeName="cx" values="65;67;65;63;65" dur="2s" repeatCount="indefinite" begin=".5s"/></ellipse>
            <defs><linearGradient id="trvBodyG" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#0891b2"/></linearGradient></defs>
            <ellipse cx="50" cy="78" rx="36" ry="34" fill="url(#trvBodyG)"/>
            <ellipse cx="50" cy="78" rx="32" ry="30" fill="#ecfeff" opacity=".15"/>
            <ellipse cx="40" cy="62" rx="5" ry="3.5" fill="#fff" opacity=".2"/>
            <text x="28" y="72" font-size="9" font-weight="700" fill="#fff" opacity=".5" font-family="sans-serif">12</text>
            <text x="66" y="82" font-size="9" font-weight="700" fill="#fff" opacity=".5" font-family="sans-serif">3</text>
            <text x="46" y="102" font-size="9" font-weight="700" fill="#fff" opacity=".5" font-family="sans-serif">6</text>
            <text x="22" y="82" font-size="9" font-weight="700" fill="#fff" opacity=".5" font-family="sans-serif">9</text>
            <ellipse cx="38" cy="68" rx="7" ry="8" fill="#fff"><animate attributeName="ry" values="8;1;8" dur="4s" repeatCount="indefinite" begin="1s"/></ellipse>
            <circle cx="40" cy="69" r="4" fill="#1e293b"><animate attributeName="r" values="4;.5;4" dur="4s" repeatCount="indefinite" begin="1s"/></circle>
            <circle cx="41.5" cy="67.5" r="1.5" fill="#fff"><animate attributeName="opacity" values="1;.4;1" dur="2s" repeatCount="indefinite"/></circle>
            <ellipse cx="62" cy="68" rx="7" ry="8" fill="#fff"><animate attributeName="ry" values="8;1;8" dur="4s" repeatCount="indefinite" begin="1s"/></ellipse>
            <circle cx="64" cy="69" r="4" fill="#1e293b"><animate attributeName="r" values="4;.5;4" dur="4s" repeatCount="indefinite" begin="1s"/></circle>
            <circle cx="65.5" cy="67.5" r="1.5" fill="#fff"><animate attributeName="opacity" values="1;.4;1" dur="2s" repeatCount="indefinite"/></circle>
            <ellipse cx="30" cy="80" rx="5" ry="3.5" fill="#f9a8d4" opacity=".35"/>
            <ellipse cx="70" cy="80" rx="5" ry="3.5" fill="#f9a8d4" opacity=".35"/>
            <path id="mascot-travel-mouth" d="M40,88 Q50,96 60,88" fill="none" stroke="#0e7490" stroke-width="2.5" stroke-linecap="round"/>
            <line x1="42" y1="42" x2="42" y2="55" stroke="#ef4444" stroke-width="2.5" stroke-linecap="round"><animateTransform attributeName="transform" type="rotate" from="0 50 52" to="360 50 52" dur="8s" repeatCount="indefinite"/></line>
            <line x1="58" y1="40" x2="58" y2="56" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"><animateTransform attributeName="transform" type="rotate" from="90 50 52" to="450 50 52" dur="8s" repeatCount="indefinite"/></line>
            <circle cx="50" cy="52" r="2" fill="#0e7490"/>
          </svg>
          <div class="mascot-bubble" id="bubble-travel">ì‹œê°„ ì—¬í–‰ ì¶œë°œ!</div>
        </div>
        <div class="travel-area" id="travel-area">
          <div class="travel-bg travel-bg-noon" id="travel-bg"></div>
          <!-- íƒœì–‘ SVG -->
          <div class="travel-decor travel-sun" id="travel-sun">
            <svg width="100" height="100" viewBox="0 0 100 100">
              <defs>
                <radialGradient id="sun-glow"><stop offset="0%" stop-color="#fbbf24"/><stop offset="60%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#f59e0b" stop-opacity="0"/></radialGradient>
              </defs>
              <circle cx="50" cy="50" r="40" fill="url(#sun-glow)" opacity=".4"><animate attributeName="r" values="40;45;40" dur="3s" repeatCount="indefinite"/></circle>
              <circle cx="50" cy="50" r="22" fill="#fbbf24"/>
              <circle cx="50" cy="50" r="18" fill="#fde68a"/>
              <circle cx="44" cy="44" r="6" fill="#fff" opacity=".4"/>
              <g stroke="#fbbf24" stroke-width="3.5" stroke-linecap="round">
                <animateTransform attributeName="transform" type="rotate" values="0 50 50;360 50 50" dur="30s" repeatCount="indefinite"/>
                <line x1="50" y1="6" x2="50" y2="18"/><line x1="50" y1="82" x2="50" y2="94"/>
                <line x1="6" y1="50" x2="18" y2="50"/><line x1="82" y1="50" x2="94" y2="50"/>
                <line x1="19" y1="19" x2="27" y2="27"/><line x1="73" y1="73" x2="81" y2="81"/>
                <line x1="81" y1="19" x2="73" y2="27"/><line x1="27" y1="73" x2="19" y2="81"/>
              </g>
            </svg>
          </div>
          <!-- ë‹¬ SVG -->
          <div class="travel-decor travel-moon" id="travel-moon" style="display:none">
            <svg width="90" height="90" viewBox="0 0 90 90">
              <defs>
                <radialGradient id="moon-glow"><stop offset="0%" stop-color="#fde68a" stop-opacity=".3"/><stop offset="100%" stop-color="#fde68a" stop-opacity="0"/></radialGradient>
              </defs>
              <circle cx="45" cy="45" r="38" fill="url(#moon-glow)"><animate attributeName="r" values="38;42;38" dur="4s" repeatCount="indefinite"/></circle>
              <circle cx="45" cy="45" r="24" fill="#fde68a"/>
              <circle cx="56" cy="38" r="20" fill="#312e81"/>
              <circle cx="38" cy="42" r="3" fill="#e0e7ff" opacity=".3"/>
              <circle cx="48" cy="52" r="2" fill="#e0e7ff" opacity=".25"/>
              <circle cx="35" cy="35" r="1.5" fill="#e0e7ff" opacity=".2"/>
            </svg>
          </div>
          <!-- ë³„ë“¤ SVG -->
          <div class="travel-decor travel-star" id="travel-stars-decor" style="display:none;top:10px;left:20px">
            <svg width="280" height="140" viewBox="0 0 280 140">
              <polygon points="20,5 23,15 33,15 25,22 28,32 20,26 12,32 15,22 7,15 17,15" fill="#fde68a" opacity=".8"><animate attributeName="opacity" values=".8;.3;.8" dur="2s" repeatCount="indefinite"/></polygon>
              <polygon points="80,12 82,18 88,18 83,22 85,28 80,25 75,28 77,22 72,18 78,18" fill="#e0f2fe" opacity=".7"><animate attributeName="opacity" values=".7;.2;.7" dur="1.6s" repeatCount="indefinite" begin=".4s"/></polygon>
              <polygon points="140,8 142,14 148,14 143,18 145,24 140,21 135,24 137,18 132,14 138,14" fill="#fde68a" opacity=".75"><animate attributeName="opacity" values=".75;.25;.75" dur="2.3s" repeatCount="indefinite" begin=".8s"/></polygon>
              <polygon points="200,18 202,24 208,24 203,28 205,34 200,31 195,34 197,28 192,24 198,24" fill="#fff" opacity=".6"><animate attributeName="opacity" values=".6;.2;.6" dur="1.8s" repeatCount="indefinite" begin="1.2s"/></polygon>
              <polygon points="250,10 252,16 258,16 253,20 255,26 250,23 245,26 247,20 242,16 248,16" fill="#e0f2fe" opacity=".65"><animate attributeName="opacity" values=".65;.15;.65" dur="2.1s" repeatCount="indefinite" begin=".6s"/></polygon>
              <polygon points="50,50 52,56 58,56 53,60 55,66 50,63 45,66 47,60 42,56 48,56" fill="#fff" opacity=".5"><animate attributeName="opacity" values=".5;.15;.5" dur="2.5s" repeatCount="indefinite" begin="1s"/></polygon>
              <polygon points="170,45 172,51 178,51 173,55 175,61 170,58 165,61 167,55 162,51 168,51" fill="#fde68a" opacity=".55"><animate attributeName="opacity" values=".55;.2;.55" dur="1.9s" repeatCount="indefinite" begin=".3s"/></polygon>
            </svg>
          </div>
          <div class="travel-question" id="travel-q">ì•„ì¹¨ 7ì‹œë¡œ ê°€ì!</div>
          <div class="travel-guide">ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ë°”ëŠ˜ì„ ê³¨ë¼ì„œ ì‹œê³„ë¥¼ ëŒë ¤ë´!</div>
          <div class="travel-clock-wrap" id="travel-clock-wrap"></div>
          <div class="hand-toggle" id="travel-hand-toggle">
            <button class="hand-btn active" id="travel-hand-hour" onclick="selectHand('travel','hour')">ğŸ• ì§§ì€ ë°”ëŠ˜ (ì‹œ)</button>
            <button class="hand-btn" id="travel-hand-minute" onclick="selectHand('travel','minute')">ğŸ•‘ ê¸´ ë°”ëŠ˜ (ë¶„)</button>
          </div>
          <div class="travel-result" id="travel-result"></div>
          <button class="travel-confirm-btn" onclick="travelConfirm()">ğŸ• ë„ì°©!</button>
        </div>
      </div>

      <!-- ë‹¬ë ¥ ë†€ì´ -->
      <div class="game-view cal-view" id="cal-view">
        <!-- ë§ˆìŠ¤ì½”íŠ¸ "ë˜‘ë”±ì´" í’€ë°”ë”” (ë‹¬ë ¥ë·°) -->
        <div class="mascot" id="mascot-cal" style="top:8px;right:20px">
          <svg width="100" height="auto" viewBox="0 0 100 140">
            <ellipse cx="50" cy="132" rx="22" ry="4" fill="rgba(0,0,0,.08)"/>
            <ellipse cx="35" cy="122" rx="10" ry="6" fill="#0891b2"><animate attributeName="cx" values="35;33;35;37;35" dur="2s" repeatCount="indefinite"/></ellipse>
            <ellipse cx="65" cy="122" rx="10" ry="6" fill="#0891b2"><animate attributeName="cx" values="65;67;65;63;65" dur="2s" repeatCount="indefinite" begin=".5s"/></ellipse>
            <defs><linearGradient id="calBodyG" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#0891b2"/></linearGradient></defs>
            <ellipse cx="50" cy="78" rx="36" ry="34" fill="url(#calBodyG)"/>
            <ellipse cx="50" cy="78" rx="32" ry="30" fill="#ecfeff" opacity=".15"/>
            <ellipse cx="40" cy="62" rx="5" ry="3.5" fill="#fff" opacity=".2"/>
            <text x="28" y="72" font-size="9" font-weight="700" fill="#fff" opacity=".5" font-family="sans-serif">12</text>
            <text x="66" y="82" font-size="9" font-weight="700" fill="#fff" opacity=".5" font-family="sans-serif">3</text>
            <text x="46" y="102" font-size="9" font-weight="700" fill="#fff" opacity=".5" font-family="sans-serif">6</text>
            <text x="22" y="82" font-size="9" font-weight="700" fill="#fff" opacity=".5" font-family="sans-serif">9</text>
            <ellipse cx="38" cy="68" rx="7" ry="8" fill="#fff"><animate attributeName="ry" values="8;1;8" dur="4s" repeatCount="indefinite" begin="2s"/></ellipse>
            <circle cx="40" cy="69" r="4" fill="#1e293b"><animate attributeName="r" values="4;.5;4" dur="4s" repeatCount="indefinite" begin="2s"/></circle>
            <circle cx="41.5" cy="67.5" r="1.5" fill="#fff"><animate attributeName="opacity" values="1;.4;1" dur="2s" repeatCount="indefinite"/></circle>
            <ellipse cx="62" cy="68" rx="7" ry="8" fill="#fff"><animate attributeName="ry" values="8;1;8" dur="4s" repeatCount="indefinite" begin="2s"/></ellipse>
            <circle cx="64" cy="69" r="4" fill="#1e293b"><animate attributeName="r" values="4;.5;4" dur="4s" repeatCount="indefinite" begin="2s"/></circle>
            <circle cx="65.5" cy="67.5" r="1.5" fill="#fff"><animate attributeName="opacity" values="1;.4;1" dur="2s" repeatCount="indefinite"/></circle>
            <ellipse cx="30" cy="80" rx="5" ry="3.5" fill="#f9a8d4" opacity=".35"/>
            <ellipse cx="70" cy="80" rx="5" ry="3.5" fill="#f9a8d4" opacity=".35"/>
            <path id="mascot-cal-mouth" d="M40,88 Q50,96 60,88" fill="none" stroke="#0e7490" stroke-width="2.5" stroke-linecap="round"/>
            <line x1="42" y1="42" x2="42" y2="55" stroke="#ef4444" stroke-width="2.5" stroke-linecap="round"><animateTransform attributeName="transform" type="rotate" from="0 50 52" to="360 50 52" dur="8s" repeatCount="indefinite"/></line>
            <line x1="58" y1="40" x2="58" y2="56" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"><animateTransform attributeName="transform" type="rotate" from="90 50 52" to="450 50 52" dur="8s" repeatCount="indefinite"/></line>
            <circle cx="50" cy="52" r="2" fill="#0e7490"/>
          </svg>
          <div class="mascot-bubble" id="bubble-cal">ë‹¬ë ¥ì„ ì½ì–´ë³¼ê¹Œ?</div>
        </div>
        <div class="cal-area" id="cal-area">
          <div class="cal-mode" id="cal-mode">ğŸ“… ìš”ì¼ í€´ì¦ˆ</div>
          <div class="cal-question" id="cal-question">ë¬¸ì œê°€ ë‚˜ì˜µë‹ˆë‹¤!</div>
          <div id="cal-calendar-wrap"></div>
          <div class="cal-options" id="cal-options"></div>
          <div class="cal-result" id="cal-result"></div>
        </div>
      </div>

      <!-- ìŒë‘¥ì´ ì‹œê³„ -->
      <div class="game-view twin-view" id="twin-view">
        <!-- ë§ˆìŠ¤ì½”íŠ¸ "ë˜‘ë”±ì´" í’€ë°”ë”” (ìŒë‘¥ì´ë·°) -->
        <div class="mascot" id="mascot-twin" style="top:8px;right:20px">
          <svg width="100" height="auto" viewBox="0 0 100 140">
            <ellipse cx="50" cy="132" rx="22" ry="4" fill="rgba(0,0,0,.08)"/>
            <ellipse cx="35" cy="122" rx="10" ry="6" fill="#0891b2"><animate attributeName="cx" values="35;33;35;37;35" dur="2s" repeatCount="indefinite" begin=".4s"/></ellipse>
            <ellipse cx="65" cy="122" rx="10" ry="6" fill="#0891b2"><animate attributeName="cx" values="65;67;65;63;65" dur="2s" repeatCount="indefinite" begin="1s"/></ellipse>
            <defs><linearGradient id="twnBodyG" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#0891b2"/></linearGradient></defs>
            <ellipse cx="50" cy="78" rx="36" ry="34" fill="url(#twnBodyG)"/>
            <ellipse cx="50" cy="78" rx="32" ry="30" fill="#ecfeff" opacity=".15"/>
            <ellipse cx="40" cy="62" rx="5" ry="3.5" fill="#fff" opacity=".2"/>
            <text x="28" y="72" font-size="9" font-weight="700" fill="#fff" opacity=".5" font-family="sans-serif">12</text>
            <text x="66" y="82" font-size="9" font-weight="700" fill="#fff" opacity=".5" font-family="sans-serif">3</text>
            <text x="46" y="102" font-size="9" font-weight="700" fill="#fff" opacity=".5" font-family="sans-serif">6</text>
            <text x="22" y="82" font-size="9" font-weight="700" fill="#fff" opacity=".5" font-family="sans-serif">9</text>
            <ellipse cx="38" cy="68" rx="7" ry="8" fill="#fff"><animate attributeName="ry" values="8;1;8" dur="4s" repeatCount="indefinite" begin="1.5s"/></ellipse>
            <circle cx="40" cy="69" r="4" fill="#1e293b"><animate attributeName="r" values="4;.5;4" dur="4s" repeatCount="indefinite" begin="1.5s"/></circle>
            <circle cx="41.5" cy="67.5" r="1.5" fill="#fff"><animate attributeName="opacity" values="1;.4;1" dur="2s" repeatCount="indefinite"/></circle>
            <ellipse cx="62" cy="68" rx="7" ry="8" fill="#fff"><animate attributeName="ry" values="8;1;8" dur="4s" repeatCount="indefinite" begin="1.5s"/></ellipse>
            <circle cx="64" cy="69" r="4" fill="#1e293b"><animate attributeName="r" values="4;.5;4" dur="4s" repeatCount="indefinite" begin="1.5s"/></circle>
            <circle cx="65.5" cy="67.5" r="1.5" fill="#fff"><animate attributeName="opacity" values="1;.4;1" dur="2s" repeatCount="indefinite"/></circle>
            <ellipse cx="30" cy="80" rx="5" ry="3.5" fill="#f9a8d4" opacity=".35"/>
            <ellipse cx="70" cy="80" rx="5" ry="3.5" fill="#f9a8d4" opacity=".35"/>
            <path id="mascot-twin-mouth" d="M40,88 Q50,96 60,88" fill="none" stroke="#0e7490" stroke-width="2.5" stroke-linecap="round"/>
            <line x1="42" y1="42" x2="42" y2="55" stroke="#ef4444" stroke-width="2.5" stroke-linecap="round"><animateTransform attributeName="transform" type="rotate" from="240 50 52" to="600 50 52" dur="8s" repeatCount="indefinite"/></line>
            <line x1="58" y1="40" x2="58" y2="56" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"><animateTransform attributeName="transform" type="rotate" from="300 50 52" to="660 50 52" dur="8s" repeatCount="indefinite"/></line>
            <circle cx="50" cy="52" r="2" fill="#0e7490"/>
          </svg>
          <div class="mascot-bubble" id="bubble-twin">ìŒë‘¥ì´ë¥¼ ì°¾ì•„ë´!</div>
        </div>
        <div class="twin-area" id="twin-area">
          <div class="twin-question" id="twin-q">ì•„ë‚ ë¡œê·¸ ì‹œê³„ë¥¼ ë³´ê³  ë””ì§€í„¸ ì‹œê°„ì„ ë§ì¶°ë³´ì„¸ìš”!</div>
          <div class="twin-clocks" id="twin-clocks">
            <div class="twin-clock-box">
              <div class="twin-label">ì•„ë‚ ë¡œê·¸</div>
              <div id="twin-analog-wrap"></div>
            </div>
            <div class="twin-vs"><svg width="48" height="48" viewBox="0 0 48 48"><path d="M4 16h32l-8-8" fill="none" stroke="#06b6d4" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M44 32H12l8 8" fill="none" stroke="#22d3ee" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
            <div class="twin-clock-box">
              <div class="twin-label">ë””ì§€í„¸</div>
              <div class="twin-digital" id="twin-digital">
                <div class="twin-digital-time" id="twin-digi-display">--:--</div>
                <div class="twin-digital-ampm" id="twin-digi-ampm"></div>
              </div>
            </div>
          </div>
          <div class="twin-input-area" id="twin-input-area">
            <input class="twin-input" id="twin-hour-input" type="number" min="1" max="12" placeholder="ì‹œ">
            <span class="twin-colon">:</span>
            <input class="twin-input" id="twin-min-input" type="number" min="0" max="59" placeholder="ë¶„">
            <button class="twin-submit" onclick="twinConfirm()">í™•ì¸!</button>
          </div>
          <div class="hand-toggle hidden" id="twin-hand-toggle">
            <button class="hand-btn active" id="twin-hand-hour" onclick="selectHand('twin','hour')">ğŸ• ì§§ì€ ë°”ëŠ˜ (ì‹œ)</button>
            <button class="hand-btn" id="twin-hand-minute" onclick="selectHand('twin','minute')">ğŸ•‘ ê¸´ ë°”ëŠ˜ (ë¶„)</button>
          </div>
          <button class="twin-submit" id="twin-drag-confirm" style="display:none" onclick="twinConfirm()">ğŸ• ì´ ì‹œê°„ì´ì•¼!</button>
          <div class="twin-result" id="twin-result"></div>
        </div>
      </div>

      <!-- ë‚´ ê¸°ë¡ -->
      <div class="game-view record-view" id="record-view">
        <!-- ë§ˆìŠ¤ì½”íŠ¸ "ë˜‘ë”±ì´" í’€ë°”ë”” (ê¸°ë¡ë·°) -->
        <div class="mascot" id="mascot-record" style="bottom:20px;right:20px">
          <svg width="100" height="auto" viewBox="0 0 100 140">
            <ellipse cx="50" cy="132" rx="22" ry="4" fill="rgba(0,0,0,.08)"/>
            <ellipse cx="35" cy="122" rx="10" ry="6" fill="#0891b2"><animate attributeName="cx" values="35;33;35;37;35" dur="2s" repeatCount="indefinite" begin=".3s"/></ellipse>
            <ellipse cx="65" cy="122" rx="10" ry="6" fill="#0891b2"><animate attributeName="cx" values="65;67;65;63;65" dur="2s" repeatCount="indefinite" begin=".9s"/></ellipse>
            <defs><linearGradient id="recBodyG" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#0891b2"/></linearGradient></defs>
            <ellipse cx="50" cy="78" rx="36" ry="34" fill="url(#recBodyG)"/>
            <ellipse cx="50" cy="78" rx="32" ry="30" fill="#ecfeff" opacity=".15"/>
            <ellipse cx="40" cy="62" rx="5" ry="3.5" fill="#fff" opacity=".2"/>
            <text x="28" y="72" font-size="9" font-weight="700" fill="#fff" opacity=".5" font-family="sans-serif">12</text>
            <text x="66" y="82" font-size="9" font-weight="700" fill="#fff" opacity=".5" font-family="sans-serif">3</text>
            <text x="46" y="102" font-size="9" font-weight="700" fill="#fff" opacity=".5" font-family="sans-serif">6</text>
            <text x="22" y="82" font-size="9" font-weight="700" fill="#fff" opacity=".5" font-family="sans-serif">9</text>
            <ellipse cx="38" cy="68" rx="7" ry="8" fill="#fff"><animate attributeName="ry" values="8;1;8" dur="4s" repeatCount="indefinite" begin="2s"/></ellipse>
            <circle cx="40" cy="69" r="4" fill="#1e293b"><animate attributeName="r" values="4;.5;4" dur="4s" repeatCount="indefinite" begin="2s"/></circle>
            <circle cx="41.5" cy="67.5" r="1.5" fill="#fff"><animate attributeName="opacity" values="1;.4;1" dur="2s" repeatCount="indefinite"/></circle>
            <ellipse cx="62" cy="68" rx="7" ry="8" fill="#fff"><animate attributeName="ry" values="8;1;8" dur="4s" repeatCount="indefinite" begin="2s"/></ellipse>
            <circle cx="64" cy="69" r="4" fill="#1e293b"><animate attributeName="r" values="4;.5;4" dur="4s" repeatCount="indefinite" begin="2s"/></circle>
            <circle cx="65.5" cy="67.5" r="1.5" fill="#fff"><animate attributeName="opacity" values="1;.4;1" dur="2s" repeatCount="indefinite"/></circle>
            <ellipse cx="30" cy="80" rx="5" ry="3.5" fill="#f9a8d4" opacity=".35"/>
            <ellipse cx="70" cy="80" rx="5" ry="3.5" fill="#f9a8d4" opacity=".35"/>
            <path id="mascot-record-mouth" d="M40,88 Q50,96 60,88" fill="none" stroke="#0e7490" stroke-width="2.5" stroke-linecap="round"/>
            <line x1="42" y1="42" x2="42" y2="55" stroke="#ef4444" stroke-width="2.5" stroke-linecap="round"><animateTransform attributeName="transform" type="rotate" from="330 50 52" to="690 50 52" dur="8s" repeatCount="indefinite"/></line>
            <line x1="58" y1="40" x2="58" y2="56" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"><animateTransform attributeName="transform" type="rotate" from="45 50 52" to="405 50 52" dur="8s" repeatCount="indefinite"/></line>
            <circle cx="50" cy="52" r="2" fill="#0e7490"/>
          </svg>
          <div class="mascot-bubble" id="bubble-record">ë‚´ ê¸°ë¡!</div>
        </div>
        <div class="records-area">
          <div class="record-card">
            <h3>ğŸ† ì¢…í•© ì„±ì </h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-total">0</div><div class="record-label">ì´ ë¬¸ì œ</div></div>
              <div class="record-item"><div class="record-num" id="r-correct">0</div><div class="record-label">ì •ë‹µ</div></div>
              <div class="record-item"><div class="record-num" id="r-rate">0%</div><div class="record-label">ì •ë‹µë¥ </div></div>
            </div>
          </div>
          <div class="record-card">
            <h3>ğŸ•° ì‹œê°„ ì—¬í–‰ì</h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-travel-correct">0</div><div class="record-label">ì •ë‹µ</div></div>
              <div class="record-item"><div class="record-num" id="r-travel-best">0</div><div class="record-label">ìµœê³  ì—°ì†</div></div>
              <div class="record-item"><div class="record-num" id="r-travel-score">0</div><div class="record-label">ìµœê³  ì ìˆ˜</div></div>
            </div>
          </div>
          <div class="record-card">
            <h3>ğŸ“… ë‹¬ë ¥ ë†€ì´</h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-cal-correct">0</div><div class="record-label">ì •ë‹µ</div></div>
              <div class="record-item"><div class="record-num" id="r-cal-streak">0</div><div class="record-label">ìµœê³  ì—°ì†</div></div>
              <div class="record-item"><div class="record-num" id="r-cal-score">0</div><div class="record-label">ìµœê³  ì ìˆ˜</div></div>
            </div>
          </div>
          <div class="record-card">
            <h3>ğŸ‘¯ ìŒë‘¥ì´ ì‹œê³„</h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-twin-correct">0</div><div class="record-label">ì •ë‹µ</div></div>
              <div class="record-item"><div class="record-num" id="r-twin-best">0</div><div class="record-label">ìµœê³  ì—°ì†</div></div>
              <div class="record-item"><div class="record-num" id="r-twin-score">0</div><div class="record-label">ìµœê³  ì ìˆ˜</div></div>
            </div>
          </div>
          <div class="record-card">
            <h3>âš¡ ì‹œê³„ ìŠ¤í”¼ë“œëŸ°</h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-hero-score">0</div><div class="record-label">ìµœê³  ì ìˆ˜</div></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ íŒ¨ë„ -->
    <div class="right-panel" id="right-panel">
      <button class="action-btn btn-cyan" id="act1" onclick="actionBtn(1)"><span class="icon">ğŸ’¡</span>íŒíŠ¸</button>
      <button class="action-btn btn-green" id="act2" onclick="actionBtn(2)"><span class="icon">â­</span>ë‹¤ìŒ</button>
      <button class="action-btn btn-red" id="act3" onclick="actionBtn(3)"><span class="icon">ğŸ”„</span>ë‹¤ì‹œ</button>
    </div>
  </div>

<!-- íˆì–´ë¡œ ê²Œì„: ì‹œê³„ ìŠ¤í”¼ë“œëŸ° (container ë‚´ë¶€) -->
<div id="hero-game" class="hero-game hidden">
  <div class="hg-header">
    <div class="hg-stat">â­ <span id="hg-score">0</span>ì </div>
    <div class="hg-stat">ë ˆë²¨ <span id="hg-level">1</span></div>
    <div class="hg-hearts" id="hg-hearts">â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸</div>
    <div class="hg-ctrls">
      <button class="hg-ctrl-btn" onclick="hgPause()">â¸</button>
      <button class="hg-ctrl-btn" onclick="hgExit()">âœ•</button>
    </div>
  </div>
  <div class="hg-timer-wrap"><div class="hg-timer-bar"><div class="hg-timer-fill" id="hg-timer-fill" style="width:100%"></div></div></div>
  <div class="hg-body">
    <div class="hg-clock-area" id="hg-clock-area"></div>
    <div class="hg-legend"><span class="hour-label">â— ì§§ì€ ë°”ëŠ˜ = ì‹œ</span><span class="min-label">â— ê¸´ ë°”ëŠ˜ = ë¶„</span></div>
    <div class="hg-options" id="hg-options"></div>
    <div class="hg-combo" id="hg-combo"></div>
  </div>
  <div id="hg-over" class="hg-overlay hidden">
    <div class="hg-overlay-box">
      <h2>ê²Œì„ ë!</h2>
      <div class="score">â­ <span id="hg-final-score">0</span>ì </div>
      <div class="best">ğŸ† ìµœê³ ê¸°ë¡: <span id="hg-best-score">0</span>ì </div>
      <div class="msg" id="hg-over-msg">ì˜í–ˆì–´ìš”!</div>
      <button class="btn-retry" onclick="hgRestart()">ğŸ”„ ë‹¤ì‹œí•˜ê¸°</button>
      <button class="btn-exit" onclick="hgExit()">ğŸ  ëŒì•„ê°€ê¸°</button>
    </div>
  </div>
  <div id="hg-pause-overlay" class="hg-overlay hidden">
    <div class="hg-overlay-box">
      <h2>â¸ ì¼ì‹œì •ì§€</h2>
      <button class="btn-retry" onclick="hgPause()">â–¶ ê³„ì†í•˜ê¸°</button>
      <button class="btn-exit" onclick="hgExit()">ğŸ  ëŒì•„ê°€ê¸°</button>
    </div>
  </div>
</div>
</div>

<!-- ê´€ë¦¬ì ëª¨ë‹¬ -->
<div id="admin-modal" class="modal-overlay hidden">
  <div class="modal-box">
    <div class="modal-head"><h3>âš™ ì„¤ì •</h3><button class="modal-close" onclick="hideAdmin()">Ã—</button></div>
    <div class="modal-body">
      <div class="modal-section">
        <h4>ğŸ‘¤ í”„ë¡œí•„</h4>
        <input class="modal-input" id="adm-name" placeholder="ì´ë¦„ ì…ë ¥" maxlength="10">
        <button class="modal-btn" onclick="saveProfile()">ì €ì¥</button>
      </div>
      <div class="modal-section">
        <h4>ğŸ”„ ì´ˆê¸°í™”</h4>
        <button class="modal-btn" style="background:linear-gradient(145deg,#ef4444,#dc2626)" onclick="resetAll()">ì „ì²´ ì´ˆê¸°í™”</button>
      </div>
    </div>
  </div>
</div>

<!-- ìºë¦­í„° ëª¨ë‹¬ -->
<div id="char-modal" class="modal-overlay hidden">
  <div class="modal-box">
    <div class="modal-head"><h3>ğŸ­ ìºë¦­í„° ì„ íƒ</h3><button class="modal-close" onclick="hideCharModal()">Ã—</button></div>
    <div class="modal-body">
      <div class="char-grid" id="char-grid"></div>
    </div>
  </div>
</div>

<script>
// ===== ì „ì—­ ë³€ìˆ˜ =====
let currentTab = 'travel';
let soundEnabled = true;
const LS = localStorage;

let profile = {
  name: LS.getItem('clockName') || 'ì‹œê³„ë°•ì‚¬',
  char: LS.getItem('clockChar') || 'ğŸ§’',
  totalCorrect: parseInt(LS.getItem('clockCorrect')) || 0,
  totalPlayed: parseInt(LS.getItem('clockPlayed')) || 0
};

// ì‹œê°„ ì—¬í–‰ì
let travel = {
  targetHour: 7, targetMin: 0, currentHour: 12, currentMin: 0,
  score: 0, streak: 0, bestStreak: parseInt(LS.getItem('travelBest')) || 0,
  qNum: 1, correctCount: parseInt(LS.getItem('travelCorrect')) || 0,
  bestScore: parseInt(LS.getItem('travelBestScore')) || 0,
  dragging: false, dragType: null, selectedHand: 'hour'
};

// ë‹¬ë ¥ ë†€ì´
const DAYS = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
const MONTHS = ['1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'];
const SEASONS = {ë´„:[3,4,5], ì—¬ë¦„:[6,7,8], ê°€ì„:[9,10,11], ê²¨ìš¸:[12,1,2]};
let cal = {
  score: 0, streak: 0, bestStreak: parseInt(LS.getItem('calBest')) || 0,
  qNum: 0, correctCount: parseInt(LS.getItem('calCorrect')) || 0,
  bestScore: parseInt(LS.getItem('calBestScore')) || 0,
  category: 'day', currentAnswer: null, answered: false,
  calMonth: new Date().getMonth(), calYear: new Date().getFullYear()
};

// ìŒë‘¥ì´ ì‹œê³„
let twin = {
  mode: 'analog-to-digital', // or 'digital-to-analog'
  targetHour: 3, targetMin: 0,
  currentHour: 12, currentMin: 0,
  score: 0, streak: 0, bestStreak: parseInt(LS.getItem('twinBest')) || 0,
  qNum: 1, correctCount: parseInt(LS.getItem('twinCorrect')) || 0,
  bestScore: parseInt(LS.getItem('twinBestScore')) || 0,
  selectedHand: 'hour'
};

// íˆì–´ë¡œ: ì‹œê³„ ìŠ¤í”¼ë“œëŸ°
let hg = {
  score: 0, lives: 5, level: 1, running: false, paused: false,
  combo: 0, maxCombo: 0, correctCount: 0,
  currentHour: 3, currentMin: 0,
  timerMax: 10, timerLeft: 10, timerInterval: null, timerAnimId: null,
  answering: false,
  bestScore: parseInt(LS.getItem('clockHeroBest')) || 0
};

// ===== SVG ì‹œê³„ ìƒì„± í•¨ìˆ˜ =====
function createAnalogClock(id, size, hour, min, options) {
  options = options || {};
  const r = size / 2;
  const cr = r - 10;
  let svg = `<svg id="${id}" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}" class="analog-clock">`;

  // ì™¸ê³½ ê·¸ë¼ë°ì´ì…˜ ë§
  svg += `<defs>
    <radialGradient id="${id}-bg" cx="50%" cy="45%"><stop offset="0%" stop-color="#fff"/><stop offset="100%" stop-color="#f1f5f9"/></radialGradient>
    <filter id="${id}-shadow"><feDropShadow dx="0" dy="3" stdDeviation="6" flood-color="rgba(0,0,0,.15)"/></filter>
    <linearGradient id="${id}-rim" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#e2e8f0"/><stop offset="50%" stop-color="#94a3b8"/><stop offset="100%" stop-color="#e2e8f0"/></linearGradient>
  </defs>`;

  // ì™¸ê³½
  svg += `<circle cx="${r}" cy="${r}" r="${cr+6}" fill="url(#${id}-rim)" filter="url(#${id}-shadow)"/>`;
  svg += `<circle cx="${r}" cy="${r}" r="${cr}" fill="url(#${id}-bg)"/>`;

  // ì‹œê°„ëŒ€ ë°°ê²½ìƒ‰ (ì‹œê°„ì—¬í–‰ììš©)
  if (options.showTimeBg) {
    svg += `<circle cx="${r}" cy="${r}" r="${cr-4}" fill="${getTimeBgColor(hour)}" opacity=".08"/>`;
  }

  // ëˆˆê¸ˆ
  for (let i = 0; i < 60; i++) {
    const angle = (i * 6 - 90) * Math.PI / 180;
    const isMajor = i % 5 === 0;
    const outerR = cr - 8;
    const innerR = isMajor ? cr - 24 : cr - 16;
    const x1 = r + outerR * Math.cos(angle);
    const y1 = r + outerR * Math.sin(angle);
    const x2 = r + innerR * Math.cos(angle);
    const y2 = r + innerR * Math.sin(angle);
    svg += `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" class="${isMajor ? 'clock-tick-major' : 'clock-tick'}"/>`;
  }

  // ìˆ«ì
  const numR = cr - 38;
  const fontSize = Math.round(size / 10);
  for (let i = 1; i <= 12; i++) {
    const angle = (i * 30 - 90) * Math.PI / 180;
    const x = r + numR * Math.cos(angle);
    const y = r + numR * Math.sin(angle);
    svg += `<text x="${x}" y="${y}" class="clock-number" style="font-size:${fontSize}px">${i}</text>`;
  }

  // ì‹œì¹¨
  const hAngle = ((hour % 12) * 30 + min * 0.5);
  const hLen = cr * 0.5;
  svg += `<line id="${id}-hour" x1="${r}" y1="${r}" x2="${r}" y2="${r - hLen}"
    class="clock-hand-hour" style="transform:rotate(${hAngle}deg);transform-origin:${r}px ${r}px"/>`;

  // ë¶„ì¹¨
  const mAngle = min * 6;
  const mLen = cr * 0.72;
  svg += `<line id="${id}-min" x1="${r}" y1="${r}" x2="${r}" y2="${r - mLen}"
    class="clock-hand-minute" style="transform:rotate(${mAngle}deg);transform-origin:${r}px ${r}px"/>`;

  // ì´ˆì¹¨ (ì˜µì…˜)
  if (options.showSecond) {
    svg += `<line id="${id}-sec" x1="${r}" y1="${r + cr*0.15}" x2="${r}" y2="${r - cr*0.78}"
      class="clock-hand-second" style="transform:rotate(0deg);transform-origin:${r}px ${r}px"/>`;
  }

  // ì¤‘ì‹¬ ì 
  svg += `<circle cx="${r}" cy="${r}" r="8" class="clock-center-dot"/>`;
  svg += `<circle cx="${r}" cy="${r}" r="4" fill="#fff"/>`;

  svg += '</svg>';
  return svg;
}

function setClockHands(id, hour, min) {
  const hAngle = ((hour % 12) * 30 + min * 0.5);
  const mAngle = min * 6;
  const hHand = document.getElementById(id + '-hour');
  const mHand = document.getElementById(id + '-min');
  if (hHand) hHand.style.transform = `rotate(${hAngle}deg)`;
  if (mHand) mHand.style.transform = `rotate(${mAngle}deg)`;
}

function getTimeBgColor(hour) {
  if (hour >= 5 && hour < 7) return '#6366f1';
  if (hour >= 7 && hour < 12) return '#fbbf24';
  if (hour >= 12 && hour < 17) return '#38bdf8';
  if (hour >= 17 && hour < 20) return '#fb923c';
  return '#1e1b4b';
}

function getTimePeriod(hour) {
  if (hour >= 5 && hour < 7) return 'dawn';
  if (hour >= 7 && hour < 12) return 'morning';
  if (hour >= 12 && hour < 17) return 'noon';
  if (hour >= 17 && hour < 20) return 'evening';
  return 'night';
}

function getTimePeriodName(hour) {
  if (hour >= 5 && hour < 7) return 'ìƒˆë²½';
  if (hour >= 7 && hour < 12) return 'ì•„ì¹¨';
  if (hour >= 12 && hour < 17) return 'ë‚®';
  if (hour >= 17 && hour < 20) return 'ì €ë…';
  return 'ë°¤';
}

// ===== SFX (Web Audio) =====
const SFX = {
  _ctx: null,
  _getCtx() { if (!this._ctx) this._ctx = new (window.AudioContext || window.webkitAudioContext)(); return this._ctx; },
  _play(fn) { try { if (!soundEnabled) return; fn(this._getCtx()); } catch(e) {} },
  tick() { this._play(ctx => { const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='sine';o.frequency.value=1200;g.gain.setValueAtTime(.04,ctx.currentTime);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.04);o.start();o.stop(ctx.currentTime+.04); }); },
  tock() { this._play(ctx => { const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='sine';o.frequency.value=800;g.gain.setValueAtTime(.05,ctx.currentTime);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.06);o.start();o.stop(ctx.currentTime+.06); }); },
  chime() { this._play(ctx => { [1047,1319,1568].forEach((f,i) => { const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='sine';o.frequency.value=f;g.gain.setValueAtTime(.05,ctx.currentTime+i*.08);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+i*.08+.2);o.start(ctx.currentTime+i*.08);o.stop(ctx.currentTime+i*.08+.2); }); }); },
  buzz() { this._play(ctx => { const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='sawtooth';o.frequency.setValueAtTime(150,ctx.currentTime);g.gain.setValueAtTime(.06,ctx.currentTime);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.15);o.start();o.stop(ctx.currentTime+.15); }); },
  ding() { this._play(ctx => { const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='sine';o.frequency.value=880;g.gain.setValueAtTime(.07,ctx.currentTime);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.3);o.start();o.stop(ctx.currentTime+.3); }); },
  fanfare() { this._play(ctx => { [523,659,784,1047].forEach((f,i) => { const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='square';o.frequency.value=f;g.gain.setValueAtTime(.04,ctx.currentTime+i*.12);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+i*.12+.25);o.start(ctx.currentTime+i*.12);o.stop(ctx.currentTime+i*.12+.25); }); }); },
  levelup() { this._play(ctx => { for(let i=0;i<8;i++){const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='sine';o.frequency.value=523*(1+i*.15);g.gain.setValueAtTime(.05,ctx.currentTime+i*.06);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+i*.06+.15);o.start(ctx.currentTime+i*.06);o.stop(ctx.currentTime+i*.06+.15);} }); },
  combo(n) { this._play(ctx => { const f=800+Math.min(n,10)*60;const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='sine';o.frequency.setValueAtTime(f,ctx.currentTime);o.frequency.exponentialRampToValueAtTime(f*1.3,ctx.currentTime+.1);g.gain.setValueAtTime(.06,ctx.currentTime);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.12);o.start();o.stop(ctx.currentTime+.12); }); },
  gameStart() { this._play(ctx => { [392,523,659,784].forEach((f,i) => { const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='triangle';o.frequency.value=f;g.gain.setValueAtTime(.06,ctx.currentTime+i*.1);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+i*.1+.2);o.start(ctx.currentTime+i*.1);o.stop(ctx.currentTime+i*.1+.2); }); }); },
  gameOver() { this._play(ctx => { [523,440,349,262].forEach((f,i) => { const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='triangle';o.frequency.value=f;g.gain.setValueAtTime(.06,ctx.currentTime+i*.15);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+i*.15+.3);o.start(ctx.currentTime+i*.15);o.stop(ctx.currentTime+i*.15+.3); }); }); }
};

function showScorePopup(container, points, x, y) {
  const el = document.createElement('div');
  el.className = 'score-popup';
  el.textContent = '+' + points;
  el.style.left = x + 'px'; el.style.top = y + 'px';
  container.appendChild(el);
  setTimeout(() => el.remove(), 900);
}

/* getFoodSVG removed â€” cook game replaced by cal game */

function showLevelUp(lv) {
  SFX.levelup();
  const ov = document.createElement('div');
  ov.className = 'levelup-overlay';
  ov.innerHTML = `<div class="levelup-box">ğŸ• ë ˆë²¨ ${lv} ë‹¬ì„±!</div>`;
  document.body.appendChild(ov);
  setTimeout(() => ov.remove(), 800);
}

function setMascotEmotion(viewId, emotion) {
  const mouth = document.getElementById('mascot-' + viewId + '-mouth');
  const bubble = document.getElementById('bubble-' + viewId);
  const mascotEl = document.getElementById('mascot-' + viewId);
  if (!mouth) return;
  if (mascotEl) mascotEl.classList.remove('mascot-happy-anim', 'mascot-worried-anim');
  void mascotEl?.offsetWidth; // force reflow for re-triggering animation
  if (emotion === 'happy') {
    mouth.setAttribute('d', 'M38,86 Q50,98 62,86');
    if (mascotEl) { mascotEl.classList.add('mascot-happy-anim'); addMascotSparkles(mascotEl); }
    if (bubble) { bubble.textContent = ['ë§ì•˜ì–´!','ìµœê³ !','ì˜í–ˆì–´!','ì™€!','ëŒ€ë‹¨í•´!'][Math.floor(Math.random()*5)]; bubble.classList.add('show'); setTimeout(() => bubble.classList.remove('show'), 2000); }
  } else if (emotion === 'worried') {
    mouth.setAttribute('d', 'M42,94 Q50,87 58,94');
    if (mascotEl) mascotEl.classList.add('mascot-worried-anim');
    if (bubble) { bubble.textContent = ['ì•—!','ë‹¤ì‹œ!','í˜ë‚´!'][Math.floor(Math.random()*3)]; bubble.classList.add('show'); setTimeout(() => bubble.classList.remove('show'), 1500); }
  } else {
    mouth.setAttribute('d', 'M40,88 Q50,96 60,88');
  }
  setTimeout(() => { if (mouth) mouth.setAttribute('d', 'M40,88 Q50,96 60,88'); if (mascotEl) mascotEl.classList.remove('mascot-happy-anim', 'mascot-worried-anim'); }, 2500);
}
function addMascotSparkles(el) {
  const sp = ['\u2728','\u2B50','\uD83D\uDCAB','\uD83C\uDF1F'];
  for (let i = 0; i < 5; i++) {
    const s = document.createElement('div');
    s.className = 'mascot-sparkle';
    s.textContent = sp[Math.floor(Math.random() * sp.length)];
    s.style.left = (Math.random() * 80 + 10) + 'px';
    s.style.top = (Math.random() * 60) + 'px';
    s.style.animationDelay = (i * 0.1) + 's';
    el.appendChild(s);
    setTimeout(() => s.remove(), 1200);
  }
}

// ===== TTS =====
let audioQueue = [];
let isSpeaking = false;
function speak(text) {
  if (!soundEnabled) return;
  speechSynthesis.cancel();
  audioQueue = [];
  isSpeaking = false;
  audioQueue.push(text);
  processQueue();
}
function processQueue() {
  if (isSpeaking || !audioQueue.length) return;
  isSpeaking = true;
  const u = new SpeechSynthesisUtterance(audioQueue.shift());
  u.lang = 'ko-KR'; u.rate = 1.0; u.pitch = 1.1;
  u.onend = () => { isSpeaking = false; processQueue(); };
  u.onerror = () => { isSpeaking = false; processQueue(); };
  speechSynthesis.speak(u);
}
function toggleSound() {
  soundEnabled = !soundEnabled;
  document.getElementById('sb-sound').textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
  if (!soundEnabled) speechSynthesis.cancel();
}

// ===== í”„ë¡œí•„ =====
let _prevMainLevel = 1;
function updateProfileUI() {
  document.getElementById('pf-name').textContent = profile.name;
  document.getElementById('pf-char').textContent = profile.char;
  const lv = Math.floor(profile.totalCorrect / 10) + 1;
  if (lv > _prevMainLevel && _prevMainLevel > 0) showLevelUp(lv);
  _prevMainLevel = lv;
  document.getElementById('pf-level').textContent = lv;
  const prog = (profile.totalCorrect % 10);
  document.getElementById('pf-done').textContent = prog;
  document.getElementById('pf-total').textContent = 10;
  document.getElementById('pf-bar').style.width = (prog * 10) + '%';
}
function changeName() {
  const n = prompt('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', profile.name);
  if (n && n.trim()) { profile.name = n.trim(); LS.setItem('clockName', profile.name); updateProfileUI(); }
}
function showCharModal() {
  document.getElementById('char-modal').classList.remove('hidden');
  const chars = ['ğŸ§’','ğŸ‘¦','ğŸ‘§','ğŸ¦¸â€â™‚ï¸','ğŸ¦¸â€â™€ï¸','ğŸ§™â€â™‚ï¸','ğŸ±','ğŸ¶','ğŸ¦Š','ğŸ»','ğŸ°','ğŸ¸','ğŸ¦','ğŸ¯','ğŸ¼'];
  const g = document.getElementById('char-grid');
  g.innerHTML = chars.map(c => `<div class="char-item${c===profile.char?' selected':''}" onclick="pickChar('${c}')">${c}</div>`).join('');
}
function hideCharModal() { document.getElementById('char-modal').classList.add('hidden'); }
function pickChar(c) { profile.char = c; LS.setItem('clockChar', c); updateProfileUI(); hideCharModal(); }
function showAdmin() { document.getElementById('admin-modal').classList.remove('hidden'); document.getElementById('adm-name').value = profile.name; }
function hideAdmin() { document.getElementById('admin-modal').classList.add('hidden'); }
function saveProfile() {
  const n = document.getElementById('adm-name').value.trim();
  if (n) { profile.name = n; LS.setItem('clockName', n); updateProfileUI(); }
  hideAdmin();
}
function resetAll() {
  if (!confirm('ëª¨ë“  ê¸°ë¡ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤. ì •ë§ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
  ['clockName','clockChar','clockCorrect','clockPlayed','travelBest','travelCorrect','travelBestScore','calCorrect','calBest','calBestScore','twinBest','twinCorrect','twinBestScore','clockHeroBest'].forEach(k => LS.removeItem(k));
  location.reload();
}
function saveStats() {
  LS.setItem('clockCorrect', profile.totalCorrect);
  LS.setItem('clockPlayed', profile.totalPlayed);
  LS.setItem('travelBest', travel.bestStreak);
  LS.setItem('travelCorrect', travel.correctCount);
  LS.setItem('travelBestScore', travel.bestScore);
  LS.setItem('calCorrect', cal.correctCount);
  LS.setItem('calBest', cal.bestStreak);
  LS.setItem('calBestScore', cal.bestScore);
  LS.setItem('twinBest', twin.bestStreak);
  LS.setItem('twinCorrect', twin.correctCount);
  LS.setItem('twinBestScore', twin.bestScore);
  LS.setItem('clockHeroBest', hg.bestScore);
}

// ===== íƒ­ ì „í™˜ =====
function switchTab(tab) {
  speechSynthesis.cancel(); audioQueue = []; isSpeaking = false;
  currentTab = tab;
  document.querySelectorAll('.tab-btn').forEach((b, i) => {
    b.classList.toggle('active', ['travel','cal','twin','record'][i] === tab);
  });
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelector('.' + tab + '-side').classList.add('active');
  document.querySelectorAll('.game-view').forEach(v => v.classList.remove('active'));
  document.querySelector('.' + tab + '-view').classList.add('active');
  updateActionButtons();
  if (tab === 'record') updateRecords();
}

function updateActionButtons() {
  const a1 = document.getElementById('act1');
  const a2 = document.getElementById('act2');
  const a3 = document.getElementById('act3');
  if (currentTab === 'travel') {
    a1.innerHTML = '<span class="icon">ğŸ’¡</span>íŒíŠ¸'; a1.className = 'action-btn btn-cyan'; a1.disabled = false;
    a2.innerHTML = '<span class="icon">â­</span>ë‹¤ìŒ'; a2.className = 'action-btn btn-green'; a2.disabled = false;
    a3.innerHTML = '<span class="icon">ğŸ”„</span>ë‹¤ì‹œ'; a3.className = 'action-btn btn-red'; a3.disabled = false;
  } else if (currentTab === 'cal') {
    a1.innerHTML = '<span class="icon">ğŸ’¡</span>íŒíŠ¸'; a1.className = 'action-btn btn-cyan'; a1.disabled = false;
    a2.innerHTML = '<span class="icon">â­</span>ë‹¤ìŒ'; a2.className = 'action-btn btn-green'; a2.disabled = false;
    a3.innerHTML = '<span class="icon">ğŸ”„</span>ë‹¤ì‹œ'; a3.className = 'action-btn btn-red'; a3.disabled = false;
  } else if (currentTab === 'twin') {
    a1.innerHTML = '<span class="icon">ğŸ’¡</span>íŒíŠ¸'; a1.className = 'action-btn btn-cyan'; a1.disabled = false;
    a2.innerHTML = '<span class="icon">â­</span>ë‹¤ìŒ'; a2.className = 'action-btn btn-green'; a2.disabled = false;
    a3.innerHTML = '<span class="icon">ğŸ”„</span>ë‹¤ì‹œ'; a3.className = 'action-btn btn-red'; a3.disabled = false;
  } else {
    a1.innerHTML = '<span class="icon">ğŸ“Š</span>ê¸°ë¡'; a1.className = 'action-btn btn-cyan'; a1.disabled = true;
    a2.innerHTML = '<span class="icon">â€”</span>â€”'; a2.className = 'action-btn btn-green'; a2.disabled = true;
    a3.innerHTML = '<span class="icon">â€”</span>â€”'; a3.className = 'action-btn btn-red'; a3.disabled = true;
  }
}

function actionBtn(n) {
  if (currentTab === 'travel') {
    if (n === 1) travelHint();
    else if (n === 2) newTravelQuestion();
    else travelReset();
  } else if (currentTab === 'cal') {
    if (n === 1) calHint();
    else if (n === 2) newCalQuestion();
    else calReset();
  } else if (currentTab === 'twin') {
    if (n === 1) twinHint();
    else if (n === 2) newTwinQuestion();
    else twinReset();
  }
}

// ===== ë°”ëŠ˜ ì„ íƒ í† ê¸€ =====
function selectHand(game, hand) {
  const obj = game === 'travel' ? travel : twin;
  obj.selectedHand = hand;
  const prefix = game === 'travel' ? 'travel' : 'twin';
  const hBtn = document.getElementById(prefix + '-hand-hour');
  const mBtn = document.getElementById(prefix + '-hand-minute');
  if (hBtn) { hBtn.classList.toggle('active', hand === 'hour'); }
  if (mBtn) { mBtn.classList.toggle('active', hand === 'minute'); }
  // ë°”ëŠ˜ dimmed í† ê¸€
  const svgId = game === 'travel' ? 'travel-clock' : 'twin-clock';
  const hHand = document.getElementById(svgId + '-hour');
  const mHand = document.getElementById(svgId + '-min');
  if (hHand) hHand.classList.toggle('dimmed', hand !== 'hour');
  if (mHand) mHand.classList.toggle('dimmed', hand !== 'minute');
  SFX.tick();
}

// ===== ì‹œê°„ ì—¬í–‰ì =====
const travelScenarios = [
  {hour:7, min:0, text:'ì•„ì¹¨ 7ì‹œë¡œ ê°€ì! ğŸŒ…', desc:'í•´ê°€ ë– ìš”!'},
  {hour:8, min:30, text:'8ì‹œ 30ë¶„! í•™êµ ê°ˆ ì‹œê°„! ğŸ’', desc:'í•™êµì— ê°€ìš”!'},
  {hour:12, min:0, text:'ì ì‹¬ 12ì‹œ! ğŸ±', desc:'ë°¥ ë¨¹ì„ ì‹œê°„!'},
  {hour:3, min:0, text:'ì˜¤í›„ 3ì‹œ! ê°„ì‹ ì‹œê°„! ğŸª', desc:'ê°„ì‹ ë¨¹ì!'},
  {hour:6, min:0, text:'ì €ë… 6ì‹œ! ë°¥ ì‹œê°„! ğŸ½', desc:'ì €ë…ë°¥ì´ì—ìš”!'},
  {hour:9, min:0, text:'ë°¤ 9ì‹œ! ì˜ ì‹œê°„! ğŸŒ™', desc:'ì˜ ììš”!'},
  {hour:6, min:0, text:'ìƒˆë²½ 6ì‹œ! ì¼ì–´ë‚  ì‹œê°„! â°', desc:'ì¼ì–´ë‚˜ì„¸ìš”!'},
  {hour:10, min:0, text:'ì˜¤ì „ 10ì‹œ! ë†€ì´ ì‹œê°„! ğŸ®', desc:'ì‹ ë‚˜ê²Œ ë†€ì!'},
  {hour:2, min:0, text:'ì˜¤í›„ 2ì‹œ! ë‚®ì  ì‹œê°„! ğŸ˜´', desc:'ì¿¨ì¿¨!'},
  {hour:5, min:0, text:'ì˜¤í›„ 5ì‹œ! ì‚°ì±… ì‹œê°„! ğŸš¶', desc:'ì‚°ì±… ê°€ì!'},
  {hour:7, min:30, text:'ì €ë… 7ì‹œ 30ë¶„! ğŸ›', desc:'ëª©ìš• ì‹œê°„!'},
  {hour:11, min:0, text:'ì˜¤ì „ 11ì‹œ! ğŸµ', desc:'ìŒì•… ì‹œê°„!'}
];

function newTravelQuestion() {
  const scenario = travelScenarios[Math.floor(Math.random() * travelScenarios.length)];
  travel.targetHour = scenario.hour;
  travel.targetMin = scenario.min;
  travel.currentHour = 12;
  travel.currentMin = 0;

  document.getElementById('travel-q').textContent = scenario.text;
  document.getElementById('travel-result').textContent = '';

  // ë°°ê²½ ì—…ë°ì´íŠ¸ â€” ê¸°ë³¸ì€ noon
  updateTravelBg('noon');

  // ì‹œê³„ ì—…ë°ì´íŠ¸ + ë“œë˜ê·¸ ìƒíƒœ ë™ê¸°í™”
  setClockHands('travel-clock', travel.currentHour, travel.currentMin);
  const tSvg = document.getElementById('travel-clock');
  if (tSvg && tSvg._clockSync) tSvg._clockSync(12, 0);

  travel.qNum++;
  document.getElementById('travel-qnum').textContent = travel.qNum;

  // ë°”ëŠ˜ ì„ íƒ ì´ˆê¸°í™” (ì‹œì¹¨ë¶€í„°)
  travel.selectedHand = 'hour';
  selectHand('travel', 'hour');

  speak(scenario.text);
}

function updateTravelBg(period) {
  const bg = document.getElementById('travel-bg');
  bg.className = 'travel-bg travel-bg-' + period;
  // íƒœì–‘/ë‹¬/ë³„ í† ê¸€
  const sun = document.getElementById('travel-sun');
  const moon = document.getElementById('travel-moon');
  const stars = document.getElementById('travel-stars-decor');
  if (sun) sun.style.display = (period === 'morning' || period === 'noon') ? 'block' : 'none';
  if (moon) moon.style.display = (period === 'night' || period === 'evening') ? 'block' : 'none';
  if (stars) stars.style.display = (period === 'night' || period === 'dawn') ? 'block' : 'none';

  // ì‹œê°„ëŒ€ë³„ í’ê²½ SVG
  let existing = bg.querySelector('.travel-scene-svg');
  if (existing) existing.remove();
  const scene = document.createElement('div');
  scene.className = 'travel-scene-svg';
  const sceneSvgs = {
    dawn: `<svg viewBox="0 0 1000 700" preserveAspectRatio="none">
      <path d="M0 600 Q100 520 200 560 Q350 480 500 540 Q650 460 750 520 Q900 470 1000 550 L1000 700 L0 700Z" fill="#312e81" opacity=".6"/>
      <path d="M0 640 Q150 590 300 620 Q500 570 700 610 Q850 580 1000 630 L1000 700 L0 700Z" fill="#4338ca" opacity=".5"/>
      <circle cx="500" cy="620" r="60" fill="#fde68a" opacity=".6"><animate attributeName="cy" values="620;580;620" dur="6s" repeatCount="indefinite"/></circle>
      <line x1="500" y1="555" x2="500" y2="520" stroke="#fde68a" stroke-width="3" opacity=".3"><animate attributeName="opacity" values=".3;.6;.3" dur="3s" repeatCount="indefinite"/></line>
      <line x1="540" y1="565" x2="565" y2="535" stroke="#fde68a" stroke-width="2" opacity=".3"><animate attributeName="opacity" values=".3;.5;.3" dur="2.5s" repeatCount="indefinite"/></line>
      <line x1="460" y1="565" x2="435" y2="535" stroke="#fde68a" stroke-width="2" opacity=".3"><animate attributeName="opacity" values=".2;.5;.2" dur="2.8s" repeatCount="indefinite"/></line>
      <path d="M50 520 Q60 500 70 520" fill="none" stroke="#a78bfa" stroke-width="1.5" opacity=".4"><animateTransform attributeName="transform" type="translate" values="0,0;800,-30" dur="12s" repeatCount="indefinite"/></path>
      <path d="M55 515 Q65 495 75 515" fill="none" stroke="#a78bfa" stroke-width="1.5" opacity=".4"><animateTransform attributeName="transform" type="translate" values="0,0;800,-30" dur="12s" repeatCount="indefinite"/></path>
      <g opacity=".5"><circle cx="100" cy="650" r="5" fill="#f9a8d4"/><circle cx="105" cy="645" r="4" fill="#f472b6"/><circle cx="95" cy="646" r="4" fill="#f9a8d4"/><path d="M100 655 L100 670" stroke="#22c55e" stroke-width="1.5"/></g>
      <g opacity=".5"><circle cx="250" cy="640" r="4.5" fill="#fda4af"/><circle cx="254" cy="636" r="3.5" fill="#fb7185"/><circle cx="246" cy="637" r="3.5" fill="#fda4af"/><path d="M250 645 L250 658" stroke="#22c55e" stroke-width="1.5"/></g>
      <g opacity=".5"><circle cx="800" cy="645" r="5" fill="#c4b5fd"/><circle cx="805" cy="640" r="4" fill="#a78bfa"/><circle cx="795" cy="641" r="4" fill="#c4b5fd"/><path d="M800 650 L800 665" stroke="#22c55e" stroke-width="1.5"/></g>
      <g opacity=".5"><path d="M700 480 Q710 460 720 480" fill="none" stroke="#e0e7ff" stroke-width="1.5"/><path d="M705 475 Q715 455 725 475" fill="none" stroke="#e0e7ff" stroke-width="1.5"/><animateTransform attributeName="transform" type="translate" values="0,0;-600,20" dur="14s" repeatCount="indefinite"/></g>
    </svg>`,
    morning: `<svg viewBox="0 0 1000 700" preserveAspectRatio="none">
      <ellipse cx="200" cy="180" rx="100" ry="35" fill="#fff" opacity=".6"><animateTransform attributeName="transform" type="translate" values="0,0;60,5;0,0" dur="15s" repeatCount="indefinite"/></ellipse>
      <ellipse cx="700" cy="140" rx="80" ry="28" fill="#fff" opacity=".5"><animateTransform attributeName="transform" type="translate" values="0,0;-50,3;0,0" dur="12s" repeatCount="indefinite"/></ellipse>
      <ellipse cx="450" cy="200" rx="60" ry="22" fill="#fff" opacity=".4"><animateTransform attributeName="transform" type="translate" values="0,0;40,0;0,0" dur="18s" repeatCount="indefinite"/></ellipse>
      <g opacity=".2"><path d="M200 500 Q500 200 800 500" fill="none" stroke="#ef4444" stroke-width="6"/><path d="M210 500 Q500 210 790 500" fill="none" stroke="#f97316" stroke-width="6"/><path d="M220 500 Q500 220 780 500" fill="none" stroke="#eab308" stroke-width="6"/><path d="M230 500 Q500 230 770 500" fill="none" stroke="#22c55e" stroke-width="6"/><path d="M240 500 Q500 240 760 500" fill="none" stroke="#3b82f6" stroke-width="6"/><path d="M250 500 Q500 250 750 500" fill="none" stroke="#8b5cf6" stroke-width="6"/></g>
      <path d="M0 620 Q100 580 200 600 L200 700 L0 700Z" fill="#22c55e" opacity=".5"/>
      <path d="M800 600 Q900 570 1000 590 L1000 700 L800 700Z" fill="#22c55e" opacity=".5"/>
      <circle cx="120" cy="610" r="5" fill="#fbbf24" opacity=".5"/><circle cx="140" cy="600" r="4" fill="#f87171" opacity=".5"/><circle cx="160" cy="615" r="5" fill="#c084fc" opacity=".5"/>
      <circle cx="880" cy="590" r="4" fill="#fb923c" opacity=".5"/><circle cx="900" cy="600" r="5" fill="#fbbf24" opacity=".5"/>
      <path d="M100 600 Q105 580 110 600" fill="none" stroke="#22c55e" stroke-width="2" opacity=".3"/>
      <path d="M900 585 Q905 565 910 585" fill="none" stroke="#22c55e" stroke-width="2" opacity=".3"/>
      <path d="M300 300 Q310 280 320 300" fill="none" stroke="#94a3b8" stroke-width="1" opacity=".3"><animateTransform attributeName="transform" type="translate" values="0,0;600,-20" dur="20s" repeatCount="indefinite"/></path>
      <path d="M310 295 Q320 275 330 295" fill="none" stroke="#94a3b8" stroke-width="1" opacity=".3"><animateTransform attributeName="transform" type="translate" values="0,0;600,-20" dur="20s" repeatCount="indefinite"/></path>
    </svg>`,
    noon: `<svg viewBox="0 0 1000 700" preserveAspectRatio="none">
      <ellipse cx="300" cy="160" rx="120" ry="40" fill="#fff" opacity=".5"><animateTransform attributeName="transform" type="translate" values="0,0;80,0;0,0" dur="20s" repeatCount="indefinite"/></ellipse>
      <ellipse cx="700" cy="120" rx="90" ry="32" fill="#fff" opacity=".45"><animateTransform attributeName="transform" type="translate" values="0,0;-60,5;0,0" dur="16s" repeatCount="indefinite"/></ellipse>
      <path d="M0 630 L80 610 L80 630 L140 600 L140 630 L0 640Z" fill="#16a34a" opacity=".35"/>
      <rect x="90" y="600" width="30" height="30" rx="2" fill="#92400e" opacity=".25"/><polygon points="75,600 120,580 165,600" fill="#16a34a" opacity=".35"/>
      <path d="M860 620 L940 600 L940 630 L1000 610 L1000 640 L860 640Z" fill="#16a34a" opacity=".35"/>
      <rect x="920" y="590" width="25" height="35" rx="2" fill="#92400e" opacity=".25"/><polygon points="908,590 945,570 982,590" fill="#16a34a" opacity=".35"/>
      <g opacity=".35"><ellipse cx="150" cy="350" rx="8" ry="5" fill="#f472b6" transform="rotate(-20,150,350)"/><ellipse cx="150" cy="350" rx="8" ry="5" fill="#fb7185" transform="rotate(20,150,350)"/><circle cx="150" cy="350" r="1.5" fill="#1e293b"/><animateTransform attributeName="transform" type="translate" values="0,0;300,-80;600,-30;300,40;0,0" dur="10s" repeatCount="indefinite"/></g>
      <g opacity=".3"><ellipse cx="750" cy="300" rx="7" ry="4" fill="#a78bfa" transform="rotate(-25,750,300)"/><ellipse cx="750" cy="300" rx="7" ry="4" fill="#c4b5fd" transform="rotate(25,750,300)"/><circle cx="750" cy="300" r="1.5" fill="#1e293b"/><animateTransform attributeName="transform" type="translate" values="0,0;-200,-60;-400,20;-200,50;0,0" dur="12s" repeatCount="indefinite"/></g>
      <path d="M420 400 C425 380 430 400 435 380 C440 400 445 380 450 400" fill="none" stroke="#60a5fa" stroke-width="1" opacity=".15"><animate attributeName="d" values="M420,400 C425,380 430,400 435,380 C440,400 445,380 450,400;M420,400 C425,385 430,395 435,385 C440,395 445,385 450,400;M420,400 C425,380 430,400 435,380 C440,400 445,380 450,400" dur="4s" repeatCount="indefinite"/></path>
    </svg>`,
    evening: `<svg viewBox="0 0 1000 700" preserveAspectRatio="none">
      <ellipse cx="250" cy="200" rx="100" ry="30" fill="#fbbf24" opacity=".3"><animateTransform attributeName="transform" type="translate" values="0,0;40,0;0,0" dur="14s" repeatCount="indefinite"/></ellipse>
      <ellipse cx="650" cy="170" rx="80" ry="25" fill="#f97316" opacity=".25"><animateTransform attributeName="transform" type="translate" values="0,0;-35,0;0,0" dur="11s" repeatCount="indefinite"/></ellipse>
      <path d="M0 630 Q200 590 400 620 Q600 590 800 610 Q900 600 1000 620 L1000 700 L0 700Z" fill="#1e293b" opacity=".4"/>
      <rect x="100" y="580" width="40" height="50" fill="#1e293b" opacity=".3"/><rect x="105" y="590" width="12" height="12" fill="#fde68a" opacity=".4"/><rect x="123" y="590" width="12" height="12" fill="#fbbf24" opacity=".3"/>
      <rect x="850" y="575" width="50" height="55" fill="#1e293b" opacity=".3"/><rect x="855" y="585" width="14" height="14" fill="#fde68a" opacity=".4"/><rect x="875" y="585" width="14" height="14" fill="#fbbf24" opacity=".3"/>
      <g opacity=".4"><rect x="495" y="540" width="4" height="90" rx="2" fill="#64748b"/><ellipse cx="497" cy="540" rx="16" ry="8" fill="#475569"/><circle cx="497" cy="538" r="10" fill="#fde68a" opacity=".6"><animate attributeName="opacity" values=".6;.8;.6" dur="3s" repeatCount="indefinite"/></circle><ellipse cx="497" cy="560" rx="20" ry="50" fill="#fde68a" opacity=".06"/></g>
      <path d="M200 350 Q210 330 220 350" fill="none" stroke="#475569" stroke-width="1.5" opacity=".3"><animateTransform attributeName="transform" type="translate" values="0,0;500,-30" dur="15s" repeatCount="indefinite"/></path>
      <path d="M210 345 Q220 325 230 345" fill="none" stroke="#475569" stroke-width="1.5" opacity=".3"><animateTransform attributeName="transform" type="translate" values="0,0;500,-30" dur="15s" repeatCount="indefinite"/></path>
      <path d="M220 340 Q230 320 240 340" fill="none" stroke="#475569" stroke-width="1.5" opacity=".3"><animateTransform attributeName="transform" type="translate" values="0,0;500,-30" dur="15s" repeatCount="indefinite"/></path>
    </svg>`,
    night: `<svg viewBox="0 0 1000 700" preserveAspectRatio="none">
      <circle cx="80" cy="100" r="2" fill="#fde68a" opacity=".6"><animate attributeName="opacity" values=".6;.2;.6" dur="2s" repeatCount="indefinite"/></circle>
      <circle cx="200" cy="60" r="1.5" fill="#fff" opacity=".5"><animate attributeName="opacity" values=".5;.15;.5" dur="1.8s" repeatCount="indefinite" begin=".3s"/></circle>
      <circle cx="350" cy="90" r="2" fill="#e0f2fe" opacity=".55"><animate attributeName="opacity" values=".55;.15;.55" dur="2.5s" repeatCount="indefinite" begin=".7s"/></circle>
      <circle cx="500" cy="50" r="1.8" fill="#fde68a" opacity=".5"><animate attributeName="opacity" values=".5;.1;.5" dur="3s" repeatCount="indefinite"/></circle>
      <circle cx="650" cy="80" r="2.2" fill="#fff" opacity=".6"><animate attributeName="opacity" values=".6;.2;.6" dur="2.2s" repeatCount="indefinite" begin=".5s"/></circle>
      <circle cx="780" cy="55" r="1.5" fill="#e0f2fe" opacity=".45"><animate attributeName="opacity" values=".45;.1;.45" dur="1.6s" repeatCount="indefinite" begin="1s"/></circle>
      <circle cx="900" cy="100" r="2" fill="#fde68a" opacity=".5"><animate attributeName="opacity" values=".5;.2;.5" dur="2.8s" repeatCount="indefinite" begin=".2s"/></circle>
      <circle cx="150" cy="160" r="1.2" fill="#fff" opacity=".35"><animate attributeName="opacity" values=".35;.1;.35" dur="2s" repeatCount="indefinite" begin=".8s"/></circle>
      <circle cx="450" cy="130" r="1.5" fill="#fde68a" opacity=".4"><animate attributeName="opacity" values=".4;.15;.4" dur="2.3s" repeatCount="indefinite" begin=".4s"/></circle>
      <circle cx="850" cy="140" r="1.8" fill="#e0f2fe" opacity=".45"><animate attributeName="opacity" values=".45;.15;.45" dur="1.9s" repeatCount="indefinite" begin="1.2s"/></circle>
      <line x1="300" y1="120" x2="250" y2="170" stroke="#fde68a" stroke-width="1.5" opacity="0"><animate attributeName="opacity" values="0;.7;0" dur="3s" begin="5s" repeatCount="indefinite"/><animateTransform attributeName="transform" type="translate" values="0,0;-80,80" dur="3s" begin="5s" repeatCount="indefinite"/></line>
      <g opacity=".7"><circle cx="350" cy="480" r="3" fill="#bef264"><animate attributeName="opacity" values=".7;.1;.7" dur="2.2s" repeatCount="indefinite"/><animate attributeName="cy" values="480;470;480" dur="4s" repeatCount="indefinite"/></circle><circle cx="550" cy="450" r="2.5" fill="#a3e635"><animate attributeName="opacity" values=".5;.1;.5" dur="1.8s" repeatCount="indefinite" begin=".5s"/><animate attributeName="cy" values="450;440;450" dur="3.5s" repeatCount="indefinite"/></circle><circle cx="700" cy="500" r="3" fill="#bef264"><animate attributeName="opacity" values=".6;.15;.6" dur="2.5s" repeatCount="indefinite" begin="1s"/><animate attributeName="cy" values="500;488;500" dur="4.2s" repeatCount="indefinite"/></circle><circle cx="180" cy="520" r="2.5" fill="#a3e635"><animate attributeName="opacity" values=".5;.1;.5" dur="2s" repeatCount="indefinite" begin="1.5s"/><animate attributeName="cy" values="520;510;520" dur="3.8s" repeatCount="indefinite"/></circle><circle cx="850" cy="470" r="2.8" fill="#bef264"><animate attributeName="opacity" values=".6;.1;.6" dur="1.9s" repeatCount="indefinite" begin=".8s"/><animate attributeName="cy" values="470;458;470" dur="3.2s" repeatCount="indefinite"/></circle></g>
      <path d="M0 640 Q100 610 250 630 Q400 610 550 625 Q700 600 850 620 Q950 610 1000 625 L1000 700 L0 700Z" fill="#0f172a" opacity=".5"/>
      <rect x="100" y="600" width="35" height="40" fill="#1e293b" opacity=".4"/><rect x="105" y="608" width="10" height="10" fill="#fde68a" opacity=".5"/><rect x="120" y="608" width="10" height="10" fill="#fbbf24" opacity=".3"/>
      <rect x="200" y="590" width="50" height="50" fill="#1e293b" opacity=".4"/><rect x="205" y="598" width="12" height="12" fill="#fde68a" opacity=".4"/><rect x="225" y="598" width="12" height="12" fill="#fde68a" opacity=".5"/><rect x="205" y="615" width="12" height="12" fill="#fbbf24" opacity=".3"/><rect x="225" y="615" width="12" height="12" fill="#fde68a" opacity=".4"/>
      <rect x="750" y="595" width="45" height="45" fill="#1e293b" opacity=".4"/><rect x="755" y="603" width="11" height="11" fill="#fde68a" opacity=".5"/><rect x="770" y="603" width="11" height="11" fill="#fbbf24" opacity=".3"/>
      <rect x="870" y="605" width="30" height="35" fill="#1e293b" opacity=".4"/><rect x="875" y="612" width="8" height="8" fill="#fde68a" opacity=".4"/>
    </svg>`
  };
  if (sceneSvgs[period]) {
    scene.innerHTML = sceneSvgs[period];
    bg.appendChild(scene);
  }
}

function travelConfirm() {
  const h = travel.currentHour % 12 || 12;
  const th = travel.targetHour % 12 || 12;
  const hourMatch = (h === th);
  // ë¶„ì€ 5ë¶„ ë‹¨ìœ„ í—ˆìš©
  const minMatch = Math.abs(travel.currentMin - travel.targetMin) <= 5;

  profile.totalPlayed++;
  if (hourMatch && minMatch) {
    travel.score += 10 + travel.streak * 2;
    travel.streak++;
    travel.correctCount++;
    if (travel.streak > travel.bestStreak) travel.bestStreak = travel.streak;
    if (travel.score > travel.bestScore) travel.bestScore = travel.score;
    profile.totalCorrect++;

    const period = getTimePeriod(travel.targetHour);
    updateTravelBg(period);

    document.getElementById('travel-result').innerHTML = `<span style="color:#22c55e">â­• ì •ë‹µ! ${getTimePeriodName(travel.targetHour)}ì´ì—ìš”!</span>`;
    SFX.chime(); setMascotEmotion('travel', 'happy');
    speak(`ì •ë‹µ! ${travel.targetHour}ì‹œ ${travel.targetMin > 0 ? travel.targetMin + 'ë¶„' : ''}! ${getTimePeriodName(travel.targetHour)}ì´ì—ìš”!`);

    // ì •ë‹µ íŒŒí‹°í´ ì´í™íŠ¸
    const area = document.getElementById('travel-area');
    area.style.animation = 'correctFlash .6s ease-out';
    setTimeout(() => area.style.animation = '', 600);
    for (let i = 0; i < 12; i++) {
      const p = document.createElement('div');
      p.style.cssText = `position:absolute;z-index:50;pointer-events:none;font-size:${16+Math.random()*14}px;left:50%;top:50%;--tx:${(Math.random()-.5)*200}px;--ty:${(Math.random()-.5)*200}px;animation:particleBurst .8s ease-out forwards`;
      p.textContent = ['âœ¨','â­','ğŸŒŸ','ğŸ’«'][Math.floor(Math.random()*4)];
      area.appendChild(p);
      setTimeout(() => p.remove(), 800);
    }

    setTimeout(() => newTravelQuestion(), 2000);
  } else {
    travel.streak = 0;
    document.getElementById('travel-result').innerHTML = `<span style="color:#ef4444">âŒ ë‹¤ì‹œ í•´ë³´ì„¸ìš”! ${travel.targetHour}ì‹œ ${travel.targetMin > 0 ? travel.targetMin + 'ë¶„' : 'ì •ê°'}ìœ¼ë¡œ ë§ì¶°ë³´ì„¸ìš”</span>`;
    SFX.buzz(); setMascotEmotion('travel', 'worried');
    speak('ë‹¤ì‹œ í•´ë³´ì„¸ìš”!');
    // ì˜¤ë‹µ shake + flash
    const area = document.getElementById('travel-area');
    area.style.animation = 'wrongFlash .5s ease-out, shake .4s ease-out';
    setTimeout(() => area.style.animation = '', 500);
  }
  updateTravelSide();
  updateProfileUI();
  saveStats();
}

function travelHint() {
  const hStr = travel.targetHour > 12 ? (travel.targetHour - 12) : travel.targetHour;
  speak(`ì§§ì€ ë°”ëŠ˜ì„ ${hStr}ì— ë†“ê³ , ê¸´ ë°”ëŠ˜ì„ ${travel.targetMin === 0 ? '12' : travel.targetMin / 5}ì— ë†“ìœ¼ì„¸ìš”`);
  document.getElementById('travel-result').textContent = `ğŸ’¡ ì§§ì€ ë°”ëŠ˜ â†’ ${hStr}, ê¸´ ë°”ëŠ˜ â†’ ${travel.targetMin === 0 ? '12(ì •ê°)' : travel.targetMin + 'ë¶„'}`;
}

function travelReset() {
  travel.currentHour = 12; travel.currentMin = 0;
  setClockHands('travel-clock', 12, 0);
  const tSvg = document.getElementById('travel-clock');
  if (tSvg && tSvg._clockSync) tSvg._clockSync(12, 0);
  document.getElementById('travel-result').textContent = '';
  updateTravelBg('noon');
}

function updateTravelSide() {
  document.getElementById('travel-score-side').textContent = travel.score;
  document.getElementById('travel-streak').textContent = travel.streak;
}

// ì‹œê³„ ë“œë˜ê·¸ ì²˜ë¦¬
function setupClockDrag(svgId, onChange) {
  const svg = document.getElementById(svgId);
  if (!svg) return;
  const r = svg.viewBox.baseVal.width / 2;
  let draggingHand = null; // 'hour' or 'minute' or null
  let currentHour = 12, currentMin = 0;

  function getAngle(e) {
    const rect = svg.getBoundingClientRect();
    const cx = rect.left + rect.width / 2;
    const cy = rect.top + rect.height / 2;
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    let angle = Math.atan2(clientY - cy, clientX - cx) * 180 / Math.PI + 90;
    if (angle < 0) angle += 360;
    return angle;
  }

  // í„°ì¹˜/í´ë¦­ ì‹œì‘: ì‹œì¹¨ or ë¶„ì¹¨ ì¤‘ ê°€ê¹Œìš´ ìª½ ì„ íƒ
  function getHandTip(handId) {
    const hand = document.getElementById(handId);
    if (!hand) return null;
    const rect = svg.getBoundingClientRect();
    const svgW = svg.viewBox.baseVal.width;
    const scale = rect.width / svgW;
    const transform = hand.style.transform;
    const match = transform.match(/rotate\(([\d.]+)deg\)/);
    const deg = match ? parseFloat(match[1]) : 0;
    const rad = (deg - 90) * Math.PI / 180;
    const len = handId.includes('hour') ? r * 0.5 : r * 0.72;
    return {
      x: rect.left + rect.width / 2 + Math.cos(rad) * len * scale,
      y: rect.top + rect.height / 2 + Math.sin(rad) * len * scale
    };
  }

  function onStart(e) {
    e.preventDefault();
    // í† ê¸€ ë²„íŠ¼ì—ì„œ ì„ íƒëœ ë°”ëŠ˜ ì‚¬ìš©
    const game = svgId.includes('travel') ? travel : twin;
    draggingHand = game.selectedHand || 'hour';
    SFX.tick();
  }

  function onMove(e) {
    if (!draggingHand) return;
    e.preventDefault();
    const angle = getAngle(e);
    if (draggingHand === 'hour') {
      let h = Math.round(angle / 30);
      if (h >= 12) h = 0;
      if (h === 0) h = 12;
      currentHour = h;
    } else {
      let m = Math.round(angle / 6);
      if (m >= 60) m = 0;
      m = Math.round(m / 5) * 5;
      if (m === 60) m = 0;
      currentMin = m;
    }
    if (onChange) onChange(currentHour, currentMin);
  }

  function onEnd() {
    draggingHand = null;
  }

  // ì™¸ë¶€ì—ì„œ ì‹œ/ë¶„ ë™ê¸°í™”í•  ìˆ˜ ìˆë„ë¡
  svg._clockSync = function(h, m) { currentHour = h; currentMin = m; };

  svg.addEventListener('mousedown', onStart);
  svg.addEventListener('touchstart', onStart, {passive: false});
  window.addEventListener('mousemove', onMove);
  window.addEventListener('touchmove', onMove, {passive: false});
  window.addEventListener('mouseup', onEnd);
  window.addEventListener('touchend', onEnd);
}

// ===== ë‹¬ë ¥ ë†€ì´ =====
function initCalGame() {
  generateCalendarSVG();
  newCalQuestion();
}

function generateCalendarSVG() {
  const wrap = document.getElementById('cal-calendar-wrap');
  const year = cal.calYear;
  const month = cal.calMonth;
  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const today = new Date();
  const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;
  const todayDate = today.getDate();

  let html = '<div class="cal-calendar">';
  html += '<div class="cal-header">';
  html += '<button class="cal-header-btn" onclick="calChangeMonth(-1)">\u25C0</button>';
  html += '<div class="cal-header-title">' + year + '\uB144 ' + (month+1) + '\uC6D4</div>';
  html += '<button class="cal-header-btn" onclick="calChangeMonth(1)">\u25B6</button>';
  html += '</div>';
  html += '<div class="cal-grid">';

  // Day headers
  DAYS.forEach(function(d, i) {
    var cls = i === 0 ? ' sun' : i === 6 ? ' sat' : '';
    html += '<div class="cal-day-header' + cls + '">' + d + '</div>';
  });

  // Empty cells before first day
  for (var i = 0; i < firstDay; i++) {
    html += '<div class="cal-cell empty"></div>';
  }

  // Day cells
  for (var d = 1; d <= daysInMonth; d++) {
    var dayOfWeek = (firstDay + d - 1) % 7;
    var isToday = isCurrentMonth && d === todayDate;
    var cls = isToday ? ' today' : '';
    var color = dayOfWeek === 0 ? 'color:#ef4444' : dayOfWeek === 6 ? 'color:#3b82f6' : '';
    html += '<div class="cal-cell' + cls + '" id="cal-d-' + d + '" style="' + color + '" onclick="calCellClick(' + d + ')">' + d + '</div>';
  }

  html += '</div></div>';
  wrap.innerHTML = html;
}

function calChangeMonth(delta) {
  cal.calMonth += delta;
  if (cal.calMonth > 11) { cal.calMonth = 0; cal.calYear++; }
  if (cal.calMonth < 0) { cal.calMonth = 11; cal.calYear--; }
  generateCalendarSVG();
}

function newCalQuestion() {
  cal.answered = false;
  cal.qNum++;
  document.getElementById('cal-result').textContent = '';

  // Remove previous highlights
  document.querySelectorAll('.cal-cell.selected,.cal-cell.correct-cell,.cal-cell.wrong-cell').forEach(function(c) {
    c.classList.remove('selected','correct-cell','wrong-cell');
  });

  // Cycle categories
  var categories = ['day', 'month', 'date'];
  cal.category = categories[cal.qNum % 3];

  var qEl = document.getElementById('cal-question');
  var optEl = document.getElementById('cal-options');

  if (cal.category === 'day') {
    document.getElementById('cal-mode').textContent = '\uD83D\uDCC5 ìš”ì¼ í€´ì¦ˆ';
    var dayQuestions = [
      function() { var d = Math.floor(Math.random()*7); var off = [1,2,3][Math.floor(Math.random()*3)]; var labels = ['\uB0B4\uC77C','\uBAA8\uB808','\uAE00\uD53C']; return { q: '\uC624\uB298\uC774 ' + DAYS[d] + '\uC694\uC77C\uC774\uBA74 ' + labels[off-1] + '\uC740?', a: DAYS[(d+off)%7]+'\uC694\uC77C' }; },
      function() { var d = Math.floor(Math.random()*7); var off = [1,2][Math.floor(Math.random()*2)]; var labels = ['\uC5B4\uC81C','\uADF8\uC800\uAED8']; return { q: '\uC624\uB298\uC774 ' + DAYS[d] + '\uC694\uC77C\uC774\uBA74 ' + labels[off-1] + '\uC740?', a: DAYS[(d-off+7)%7]+'\uC694\uC77C' }; },
      function() { var d = Math.floor(Math.random()*7); return { q: DAYS[d] + '\uC694\uC77C\uC740 \uC8FC\uB9D0\uC77C\uAE4C \uD3C9\uC77C\uC77C\uAE4C?', a: (d===0||d===6) ? '\uC8FC\uB9D0' : '\uD3C9\uC77C' }; }
    ];
    var picked = dayQuestions[Math.floor(Math.random()*dayQuestions.length)]();
    cal.currentAnswer = picked.a;
    qEl.textContent = picked.q;

    // Generate options
    var opts = [picked.a];
    if (picked.a === '\uC8FC\uB9D0' || picked.a === '\uD3C9\uC77C') {
      opts = ['\uC8FC\uB9D0', '\uD3C9\uC77C', '\uACF5\uD734\uC77C', '\uBC29\uD559'];
    } else {
      while (opts.length < 4) {
        var r = DAYS[Math.floor(Math.random()*7)] + '\uC694\uC77C';
        if (opts.indexOf(r) === -1) opts.push(r);
      }
    }
    opts.sort(function() { return Math.random() - 0.5; });
    optEl.innerHTML = opts.map(function(o) { return '<button class="cal-opt" onclick="calAnswer(this,\'' + o + '\')">' + o + '</button>'; }).join('');
    optEl.style.display = 'grid';
    speak(picked.q);

  } else if (cal.category === 'month') {
    document.getElementById('cal-mode').textContent = '\uD83D\uDDD3 ì›”/ê³„ì ˆ í€´ì¦ˆ';
    var monthQuestions = [
      function() { var m = Math.floor(Math.random()*12); return { q: MONTHS[m] + ' \uB2E4\uC74C \uB2EC\uC740?', a: MONTHS[(m+1)%12] }; },
      function() { var m = Math.floor(Math.random()*12); return { q: MONTHS[m] + ' \uC804 \uB2EC\uC740?', a: MONTHS[(m-1+12)%12] }; },
      function() { var sNames = Object.keys(SEASONS); var s = sNames[Math.floor(Math.random()*4)]; var ms = SEASONS[s]; return { q: s + '\uC740 \uBA87 \uC6D4\uBD80\uD130 \uBA87 \uC6D4\uAE4C\uC9C0?', a: ms[0] + '~' + ms[2] + '\uC6D4' }; },
      function() { var m = Math.floor(Math.random()*12)+1; var sName = Object.entries(SEASONS).find(function(e){ return e[1].indexOf(m) !== -1; }); return { q: m + '\uC6D4\uC740 \uBB34\uC2A8 \uACC4\uC808?', a: sName ? sName[0] : '\uACA8\uC6B8' }; }
    ];
    var picked = monthQuestions[Math.floor(Math.random()*monthQuestions.length)]();
    cal.currentAnswer = picked.a;
    qEl.textContent = picked.q;

    var opts = [picked.a];
    if (picked.a.indexOf('~') !== -1) {
      opts = Object.values(SEASONS).map(function(ms) { return ms[0] + '~' + ms[2] + '\uC6D4'; });
    } else if (['\uBD04','\uC5EC\uB984','\uAC00\uC744','\uACA8\uC6B8'].indexOf(picked.a) !== -1) {
      opts = ['\uBD04','\uC5EC\uB984','\uAC00\uC744','\uACA8\uC6B8'];
    } else {
      while (opts.length < 4) {
        var r = MONTHS[Math.floor(Math.random()*12)];
        if (opts.indexOf(r) === -1) opts.push(r);
      }
    }
    opts.sort(function() { return Math.random() - 0.5; });
    optEl.innerHTML = opts.map(function(o) { return '<button class="cal-opt" onclick="calAnswer(this,\'' + o + '\')">' + o + '</button>'; }).join('');
    optEl.style.display = 'grid';
    speak(picked.q);

  } else {
    // Date finding on calendar
    document.getElementById('cal-mode').textContent = '\uD83D\uDD0D ë‚ ì§œ ì°¾ê¸°';
    var year = cal.calYear;
    var month = cal.calMonth;
    var firstDay = new Date(year, month, 1).getDay();
    var daysInMonth = new Date(year, month + 1, 0).getDate();

    var dateQuestions = [
      function() {
        var targetDay = Math.floor(Math.random() * 7);
        var nth = Math.floor(Math.random() * 3) + 1;
        var nthNames = ['\uCCAB \uBC88\uC9F8', '\uB450 \uBC88\uC9F8', '\uC138 \uBC88\uC9F8'];
        var count = 0, answer = -1;
        for (var d = 1; d <= daysInMonth; d++) {
          if ((firstDay + d - 1) % 7 === targetDay) {
            count++;
            if (count === nth) { answer = d; break; }
          }
        }
        if (answer === -1) {
          for (var d2 = 1; d2 <= daysInMonth; d2++) {
            if ((firstDay + d2 - 1) % 7 === targetDay) { answer = d2; break; }
          }
          return { q: '\uC774\uBC88 \uB2EC \uCCAB \uBC88\uC9F8 ' + DAYS[targetDay] + '\uC694\uC77C\uC740 \uBA70\uCE60? (\uB2EC\uB825\uC5D0\uC11C \uCC3E\uC544 \uD074\uB9AD!)', a: answer };
        }
        return { q: '\uC774\uBC88 \uB2EC ' + nthNames[nth-1] + ' ' + DAYS[targetDay] + '\uC694\uC77C\uC740 \uBA70\uCE60? (\uB2EC\uB825\uC5D0\uC11C \uCC3E\uC544 \uD074\uB9AD!)', a: answer };
      },
      function() {
        return { q: '\uC774\uBC88 \uB2EC\uC758 \uB9C8\uC9C0\uB9C9 \uB0A0\uC740 \uBA70\uCE60? (\uB2EC\uB825\uC5D0\uC11C \uCC3E\uC544 \uD074\uB9AD!)', a: daysInMonth };
      },
      function() {
        var targetDay = Math.floor(Math.random() * 7);
        var count = 0;
        for (var d = 1; d <= daysInMonth; d++) {
          if ((firstDay + d - 1) % 7 === targetDay) count++;
        }
        return { q: '\uC774\uBC88 \uB2EC\uC5D0 ' + DAYS[targetDay] + '\uC694\uC77C\uC740 \uBAA8\uB450 \uBA87 \uBC88?', a: count + '\uBC88', useButtons: true };
      }
    ];

    var picked = dateQuestions[Math.floor(Math.random() * dateQuestions.length)]();
    cal.currentAnswer = picked.useButtons ? picked.a : picked.a;
    qEl.textContent = picked.q;

    if (picked.useButtons) {
      var opts = [picked.a];
      while (opts.length < 4) {
        var r = (Math.floor(Math.random() * 3) + 3) + '\uBC88';
        if (opts.indexOf(r) === -1) opts.push(r);
      }
      opts.sort(function() { return Math.random() - 0.5; });
      optEl.innerHTML = opts.map(function(o) { return '<button class="cal-opt" onclick="calAnswer(this,\'' + o + '\')">' + o + '</button>'; }).join('');
      optEl.style.display = 'grid';
    } else {
      optEl.innerHTML = '';
      optEl.style.display = 'none';
      cal.currentAnswer = picked.a; // number (date)
    }
    speak(picked.q);
  }

  updateCalSide();
}

function calCellClick(day) {
  if (cal.answered) return;
  if (cal.category !== 'date' || typeof cal.currentAnswer !== 'number') return;

  cal.answered = true;
  var cell = document.getElementById('cal-d-' + day);

  if (day === cal.currentAnswer) {
    cell.classList.add('correct-cell');
    cal.score += 10 + cal.streak * 2;
    cal.streak++;
    cal.correctCount++;
    if (cal.streak > cal.bestStreak) cal.bestStreak = cal.streak;
    if (cal.score > cal.bestScore) cal.bestScore = cal.score;
    profile.totalCorrect++;
    profile.totalPlayed++;
    document.getElementById('cal-result').innerHTML = '<span style="color:#22c55e">\u2B55 \uC815\uB2F5! \uC798\uD588\uC5B4!</span>';
    SFX.chime();
    setMascotEmotion('cal', 'happy');
    speak('\uC815\uB2F5! ' + day + '\uC77C\uC774\uC5D0\uC694!');

    var area = document.getElementById('cal-area');
    area.style.animation = 'correctFlash .6s ease-out';
    setTimeout(function() { area.style.animation = ''; }, 600);
    for (var i = 0; i < 8; i++) {
      var p = document.createElement('div');
      p.style.cssText = 'position:absolute;z-index:50;pointer-events:none;font-size:' + (14+Math.random()*12) + 'px;left:50%;top:50%;--tx:' + ((Math.random()-.5)*200) + 'px;--ty:' + ((Math.random()-.5)*200) + 'px;animation:particleBurst .7s ease-out forwards';
      p.textContent = ['\u2B50','\u2728','\uD83D\uDCC5','\uD83C\uDF1F'][Math.floor(Math.random()*4)];
      area.appendChild(p);
      setTimeout(function(el) { return function() { el.remove(); }; }(p), 700);
    }
    setTimeout(function() { newCalQuestion(); }, 2000);
  } else {
    cell.classList.add('wrong-cell');
    cal.streak = 0;
    profile.totalPlayed++;
    var correctCell = document.getElementById('cal-d-' + cal.currentAnswer);
    if (correctCell) correctCell.classList.add('correct-cell');
    document.getElementById('cal-result').innerHTML = '<span style="color:#ef4444">\u274C ' + cal.currentAnswer + '\uC77C\uC774 \uC815\uB2F5\uC774\uC5D0\uC694!</span>';
    SFX.buzz();
    setMascotEmotion('cal', 'worried');
    speak('\uC544\uC26C\uC6CC\uC694! \uC815\uB2F5\uC740 ' + cal.currentAnswer + '\uC77C\uC774\uC5D0\uC694');
    setTimeout(function() { newCalQuestion(); }, 2500);
  }
  updateCalSide();
  updateProfileUI();
  saveStats();
}

function calAnswer(btn, selected) {
  if (cal.answered) return;
  cal.answered = true;

  var correct = cal.currentAnswer;
  var opts = document.querySelectorAll('.cal-opt');
  opts.forEach(function(o) {
    o.style.pointerEvents = 'none';
    if (o.textContent === correct) o.classList.add('correct');
    else if (o === btn && selected !== correct) o.classList.add('wrong');
  });

  profile.totalPlayed++;

  if (selected === correct) {
    cal.score += 10 + cal.streak * 2;
    cal.streak++;
    cal.correctCount++;
    if (cal.streak > cal.bestStreak) cal.bestStreak = cal.streak;
    if (cal.score > cal.bestScore) cal.bestScore = cal.score;
    profile.totalCorrect++;
    document.getElementById('cal-result').innerHTML = '<span style="color:#22c55e">\u2B55 \uC815\uB2F5! \uC798\uD588\uC5B4!</span>';
    SFX.chime();
    setMascotEmotion('cal', 'happy');
    speak('\uC815\uB2F5!');

    var area = document.getElementById('cal-area');
    area.style.animation = 'correctFlash .6s ease-out';
    setTimeout(function() { area.style.animation = ''; }, 600);
    for (var i = 0; i < 8; i++) {
      var p = document.createElement('div');
      p.style.cssText = 'position:absolute;z-index:50;pointer-events:none;font-size:' + (14+Math.random()*12) + 'px;left:50%;top:50%;--tx:' + ((Math.random()-.5)*200) + 'px;--ty:' + ((Math.random()-.5)*200) + 'px;animation:particleBurst .7s ease-out forwards';
      p.textContent = ['\u2B50','\u2728','\uD83D\uDCC5','\uD83C\uDF1F'][Math.floor(Math.random()*4)];
      area.appendChild(p);
      setTimeout(function(el) { return function() { el.remove(); }; }(p), 700);
    }
    setTimeout(function() { newCalQuestion(); }, 2000);
  } else {
    cal.streak = 0;
    document.getElementById('cal-result').innerHTML = '<span style="color:#ef4444">\u274C \uC815\uB2F5\uC740 ' + correct + '!</span>';
    SFX.buzz();
    setMascotEmotion('cal', 'worried');
    speak('\uC544\uC26C\uC6CC\uC694! \uC815\uB2F5\uC740 ' + correct + '\uC774\uC5D0\uC694');

    var area = document.getElementById('cal-area');
    area.style.animation = 'wrongFlash .5s ease-out, shake .4s ease-out';
    setTimeout(function() { area.style.animation = ''; }, 500);
    setTimeout(function() { newCalQuestion(); }, 2500);
  }
  updateCalSide();
  updateProfileUI();
  saveStats();
}

function calHint() {
  if (cal.category === 'day') {
    speak('\uC694\uC77C \uC21C\uC11C\uB97C \uC0DD\uAC01\uD574\uBD10! \uC77C \uC6D4 \uD654 \uC218 \uBAA9 \uAE08 \uD1A0!');
    document.getElementById('cal-result').textContent = '\uD83D\uDCA1 \uC77C\u2192\uC6D4\u2192\uD654\u2192\uC218\u2192\uBAA9\u2192\uAE08\u2192\uD1A0\u2192\uC77C...';
  } else if (cal.category === 'month') {
    speak('\uACC4\uC808\uC744 \uC0DD\uAC01\uD574\uBD10! \uBD04 3 4 5, \uC5EC\uB984 6 7 8, \uAC00\uC744 9 10 11, \uACA8\uC6B8 12 1 2!');
    document.getElementById('cal-result').textContent = '\uD83D\uDCA1 \uBD043-5, \uC5EC\uB9846-8, \uAC00\uC7449-11, \uACA8\uC6B812-2';
  } else {
    speak('\uB2EC\uB825\uC5D0\uC11C \uC694\uC77C\uC744 \uB530\uB77C \uB0B4\uB824\uAC00\uBA74\uC11C \uCC3E\uC544\uBD10!');
    document.getElementById('cal-result').textContent = '\uD83D\uDCA1 \uB2EC\uB825\uC5D0\uC11C \uC138\uB85C\uB85C \uB530\uB77C\uAC00 \uBD10!';
  }
}

function calReset() {
  document.getElementById('cal-result').textContent = '';
  document.querySelectorAll('.cal-cell.selected,.cal-cell.correct-cell,.cal-cell.wrong-cell').forEach(function(c) {
    c.classList.remove('selected','correct-cell','wrong-cell');
  });
}

function updateCalSide() {
  document.getElementById('cal-qnum-side').textContent = cal.qNum;
  document.getElementById('cal-score-side').textContent = cal.score;
  document.getElementById('cal-streak-side').textContent = cal.streak;
}

// ===== ìŒë‘¥ì´ ì‹œê³„ =====
function initTwinGame() { newTwinQuestion(); }

function newTwinQuestion() {
  twin.targetHour = Math.floor(Math.random() * 12) + 1;
  twin.targetMin = [0, 15, 30, 45, 0, 0, 30, 0, 15, 30][Math.floor(Math.random() * 10)];
  twin.mode = Math.random() > 0.5 ? 'analog-to-digital' : 'digital-to-analog';

  document.getElementById('twin-result').textContent = '';
  twin.qNum++;
  document.getElementById('twin-qnum').textContent = twin.qNum;

  if (twin.mode === 'analog-to-digital') {
    // ì•„ë‚ ë¡œê·¸ ì‹œê³„ ë³´ì—¬ì£¼ê³  ë””ì§€í„¸ ì‹œê°„ ìˆ«ì ì…ë ¥
    document.getElementById('twin-q').textContent = 'ğŸ‘€ ì‹œê³„ë¥¼ ì˜ ë³´ê³  ëª‡ ì‹œì¸ì§€ ìˆ«ìë¡œ ì¨ë´!';
    setClockHands('twin-clock', twin.targetHour, twin.targetMin);
    document.getElementById('twin-digi-display').textContent = '--:--';
    document.getElementById('twin-digi-ampm').textContent = '';
    document.getElementById('twin-input-area').style.display = 'flex';
    document.getElementById('twin-hour-input').value = '';
    document.getElementById('twin-min-input').value = '';
    document.getElementById('twin-drag-confirm').style.display = 'none';
    document.getElementById('twin-hand-toggle').classList.add('hidden');

    // ì•„ë‚ ë¡œê·¸ ë³´ì´ê¸° (ê³ ì •), ë””ì§€í„¸ íë¦¬ê²Œ (ì…ë ¥ ëª¨ë“œ)
    document.getElementById('twin-analog-wrap').style.opacity = '1';
    document.getElementById('twin-analog-wrap').style.pointerEvents = 'none';
    document.getElementById('twin-digital').style.opacity = '0.5';
    speak('ì‹œê³„ë¥¼ ì˜ ë³´ê³  ëª‡ ì‹œì¸ì§€ ìˆ«ìë¡œ ì¨ë´!');
  } else {
    // ë””ì§€í„¸ ë³´ì—¬ì£¼ê³  ì•„ë‚ ë¡œê·¸ ì‹œê³„ ë“œë˜ê·¸ë¡œ ë§ì¶”ê¸°
    document.getElementById('twin-q').textContent = 'ğŸ”¢ ìˆ«ìë¥¼ ë³´ê³  ë°”ëŠ˜ì„ ëŒë ¤ ë§ì¶°ë´!';
    const hStr = twin.targetHour.toString();
    const mStr = twin.targetMin.toString().padStart(2, '0');
    document.getElementById('twin-digi-display').textContent = `${hStr}:${mStr}`;
    document.getElementById('twin-digi-ampm').textContent = '';

    // ì•„ë‚ ë¡œê·¸ ì‹œê³„ë¥¼ 12:00ìœ¼ë¡œ ë¦¬ì…‹, ë“œë˜ê·¸ ê°€ëŠ¥
    twin.currentHour = 12; twin.currentMin = 0;
    setClockHands('twin-clock', 12, 0);
    const twinSvg = document.getElementById('twin-clock');
    if (twinSvg && twinSvg._clockSync) twinSvg._clockSync(12, 0);

    document.getElementById('twin-input-area').style.display = 'none';
    document.getElementById('twin-drag-confirm').style.display = 'block';
    document.getElementById('twin-hand-toggle').classList.remove('hidden');

    // ë°”ëŠ˜ ì„ íƒ ì´ˆê¸°í™”
    twin.selectedHand = 'hour';
    selectHand('twin', 'hour');

    // ì•„ë‚ ë¡œê·¸ í™œì„± (ë“œë˜ê·¸ ê°€ëŠ¥), ë””ì§€í„¸ ë°ê²Œ (ë³´ì—¬ì£¼ê¸°)
    document.getElementById('twin-analog-wrap').style.opacity = '1';
    document.getElementById('twin-analog-wrap').style.pointerEvents = 'auto';
    document.getElementById('twin-digital').style.opacity = '1';
    speak('ìˆ«ìë¥¼ ë³´ê³  ë°”ëŠ˜ì„ ëŒë ¤ ë§ì¶°ë´!');
  }
}

function twinConfirm() {
  let hInput, mInput;

  if (twin.mode === 'analog-to-digital') {
    // ìˆ«ì ì…ë ¥ì—ì„œ ì½ê¸°
    hInput = parseInt(document.getElementById('twin-hour-input').value);
    mInput = parseInt(document.getElementById('twin-min-input').value) || 0;
    if (isNaN(hInput) || hInput < 1 || hInput > 12) {
      speak('ì‹œë¥¼ 1ë¶€í„° 12 ì‚¬ì´ë¡œ ì…ë ¥í•˜ì„¸ìš”!');
      document.getElementById('twin-result').textContent = 'âš  ì‹œë¥¼ 1~12 ì‚¬ì´ë¡œ ì…ë ¥í•˜ì„¸ìš”';
      return;
    }
  } else {
    // ë“œë˜ê·¸ ê²°ê³¼ì—ì„œ ì½ê¸°
    hInput = twin.currentHour;
    mInput = twin.currentMin;
  }

  profile.totalPlayed++;
  const hourMatch = (hInput % 12 || 12) === (twin.targetHour % 12 || 12);
  const minMatch = Math.abs(mInput - twin.targetMin) <= 5;

  if (hourMatch && minMatch) {
    twin.score += 10 + twin.streak * 2;
    twin.streak++;
    twin.correctCount++;
    if (twin.streak > twin.bestStreak) twin.bestStreak = twin.streak;
    if (twin.score > twin.bestScore) twin.bestScore = twin.score;
    profile.totalCorrect++;

    document.getElementById('twin-result').innerHTML = '<span style="color:#22c55e">â­• ì •ë‹µ! ì˜í–ˆì–´ìš”!</span>';
    SFX.chime(); setMascotEmotion('twin', 'happy');
    // ì–‘ìª½ ëª¨ë‘ ë³´ì´ê¸°
    if (twin.mode === 'analog-to-digital') {
      const h = twin.targetHour.toString();
      const m = twin.targetMin.toString().padStart(2, '0');
      document.getElementById('twin-digi-display').textContent = `${h}:${m}`;
      document.getElementById('twin-digital').style.opacity = '1';
    } else {
      setClockHands('twin-clock', twin.targetHour, twin.targetMin);
      document.getElementById('twin-analog-wrap').style.opacity = '1';
    }
    speak(`ì •ë‹µ! ${twin.targetHour}ì‹œ ${twin.targetMin > 0 ? twin.targetMin + 'ë¶„' : 'ì •ê°'}ì´ì—ìš”!`);
    // ì •ë‹µ ì´í™íŠ¸: ì–‘ìª½ ì‹œê³„ ê¸€ë¡œìš° + íŒŒí‹°í´ + ì—°ê²° ë¹”
    const twinArea = document.getElementById('twin-area');
    twinArea.style.animation = 'correctFlash .6s ease-out';
    setTimeout(() => twinArea.style.animation = '', 600);
    const twinClocks = document.getElementById('twin-clocks');
    if (twinClocks) { const beam = document.createElement('div'); beam.className = 'twin-correct-beam'; twinClocks.style.position = 'relative'; twinClocks.appendChild(beam); setTimeout(() => beam.remove(), 1000); }
    for (let i = 0; i < 10; i++) {
      const p = document.createElement('div');
      p.style.cssText = `position:absolute;z-index:50;pointer-events:none;font-size:${14+Math.random()*12}px;left:50%;top:45%;--tx:${(Math.random()-.5)*250}px;--ty:${(Math.random()-.5)*180}px;animation:particleBurst .7s ease-out forwards`;
      p.textContent = ['â­','âœ¨','ğŸŒŸ','ğŸ’«'][Math.floor(Math.random()*4)];
      twinArea.appendChild(p);
      setTimeout(() => p.remove(), 700);
    }
    setTimeout(() => newTwinQuestion(), 2000);
  } else {
    twin.streak = 0;
    const correct = `${twin.targetHour}ì‹œ ${twin.targetMin > 0 ? twin.targetMin + 'ë¶„' : 'ì •ê°'}`;
    document.getElementById('twin-result').innerHTML = `<span style="color:#ef4444">âŒ ë‹¤ì‹œ í•´ë³´ì„¸ìš”!</span>`;
    SFX.buzz(); setMascotEmotion('twin', 'worried');
    speak('ë‹¤ì‹œ í•´ë³´ì„¸ìš”!');
    // ì˜¤ë‹µ ì´í™íŠ¸
    const twinArea = document.getElementById('twin-area');
    twinArea.style.animation = 'wrongFlash .5s ease-out, shake .4s ease-out';
    setTimeout(() => twinArea.style.animation = '', 500);
  }
  updateTwinSide();
  updateProfileUI();
  saveStats();
}

function twinHint() {
  const h = twin.targetHour;
  const m = twin.targetMin;
  if (twin.mode === 'analog-to-digital') {
    speak(`ì§§ì€ ë°”ëŠ˜ì´ ${h} ê·¼ì²˜ì— ìˆê³ , ê¸´ ë°”ëŠ˜ì´ ${m === 0 ? '12' : m / 5}ì— ìˆì–´ìš”`);
    document.getElementById('twin-result').textContent = `ğŸ’¡ ì§§ì€ ë°”ëŠ˜ â†’ ${h}, ê¸´ ë°”ëŠ˜ â†’ ${m === 0 ? '12' : m / 5}`;
  } else {
    speak(`ì§§ì€ ë°”ëŠ˜ì„ ${h}ì—, ê¸´ ë°”ëŠ˜ì„ ${m === 0 ? '12' : m / 5}ì— ë†“ìœ¼ì„¸ìš”`);
    document.getElementById('twin-result').textContent = `ğŸ’¡ ì§§ì€ ë°”ëŠ˜ â†’ ${h}, ê¸´ ë°”ëŠ˜ â†’ ${m === 0 ? '12(ì •ê°)' : m + 'ë¶„'}`;
  }
}

function twinReset() {
  document.getElementById('twin-hour-input').value = '';
  document.getElementById('twin-min-input').value = '';
  document.getElementById('twin-result').textContent = '';
  if (twin.mode === 'digital-to-analog') {
    twin.currentHour = 12; twin.currentMin = 0;
    setClockHands('twin-clock', 12, 0);
    const twinSvg = document.getElementById('twin-clock');
    if (twinSvg && twinSvg._clockSync) twinSvg._clockSync(12, 0);
  }
}

function updateTwinSide() {
  document.getElementById('twin-score-side').textContent = twin.score;
  document.getElementById('twin-streak-side').textContent = twin.streak;
}

// ===== ë‚´ ê¸°ë¡ =====
function updateRecords() {
  const total = profile.totalPlayed;
  const correct = profile.totalCorrect;
  const rate = total > 0 ? Math.round(correct / total * 100) : 0;
  document.getElementById('r-total').textContent = total;
  document.getElementById('r-correct').textContent = correct;
  document.getElementById('r-rate').textContent = rate + '%';
  document.getElementById('rec-total').textContent = total;
  document.getElementById('rec-rate').textContent = rate + '%';

  document.getElementById('r-travel-correct').textContent = travel.correctCount;
  document.getElementById('r-travel-best').textContent = travel.bestStreak;
  document.getElementById('r-travel-score').textContent = travel.bestScore;

  document.getElementById('r-cal-correct').textContent = cal.correctCount;
  document.getElementById('r-cal-streak').textContent = cal.bestStreak;
  document.getElementById('r-cal-score').textContent = cal.bestScore;

  document.getElementById('r-twin-correct').textContent = twin.correctCount;
  document.getElementById('r-twin-best').textContent = twin.bestStreak;
  document.getElementById('r-twin-score').textContent = twin.bestScore;
  document.getElementById('r-hero-score').textContent = hg.bestScore;
}

// ===== íˆì–´ë¡œ: ì‹œê³„ ìŠ¤í”¼ë“œëŸ° =====
function startHeroGame() {
  try{document.documentElement.requestFullscreen?.()}catch(e){}
  hg.score = 0; hg.lives = 5; hg.level = 1; hg.running = true; hg.paused = false;
  hg.combo = 0; hg.maxCombo = 0; hg.correctCount = 0; hg.answering = false;
  hg.timerMax = 10; hg.timerLeft = 10;
  document.getElementById('hero-game').classList.remove('hidden');
  document.getElementById('hg-over').classList.add('hidden');
  document.getElementById('hg-pause-overlay').classList.add('hidden');
  updateHgUI();
  SFX.gameStart();
  addHgDecorations();
  // 3-2-1 ì¹´ìš´íŠ¸ë‹¤ìš´
  var count = 3;
  var clockArea = document.getElementById('hg-clock-area');
  var optArea = document.getElementById('hg-options');
  optArea.innerHTML = '';
  function countdown() {
    if (count > 0) {
      clockArea.innerHTML = '<div style="font-size:120px;font-weight:900;color:#0e7490;text-shadow:0 4px 12px rgba(0,0,0,.15)">' + count + '</div>';
      SFX.tick();
      count--;
      setTimeout(countdown, 800);
    } else {
      clockArea.innerHTML = '<div style="font-size:80px;font-weight:900;color:#22c55e;text-shadow:0 4px 12px rgba(0,0,0,.15)">ì‹œì‘!</div>';
      SFX.chime();
      setTimeout(function() { hgNewRound(); }, 600);
    }
  }
  countdown();
}

function addHgDecorations() {
  var body = document.getElementById('hg-body') || document.querySelector('.hg-body');
  if (!body) return;
  body.querySelectorAll('.hg-deco,.hg-bg-sparkle').forEach(function(c) { c.remove(); });
  var clockSVGs = [
    '<svg width="60" height="60" viewBox="0 0 60 60"><circle cx="30" cy="30" r="18" fill="none" stroke="#0891b2" stroke-width="3"/><circle cx="30" cy="30" r="8" fill="none" stroke="#0891b2" stroke-width="2"/><rect x="28" y="8" width="4" height="10" rx="2" fill="#0891b2" transform="rotate(0 30 30)"/><rect x="28" y="8" width="4" height="10" rx="2" fill="#0891b2" transform="rotate(45 30 30)"/><rect x="28" y="8" width="4" height="10" rx="2" fill="#0891b2" transform="rotate(90 30 30)"/><rect x="28" y="8" width="4" height="10" rx="2" fill="#0891b2" transform="rotate(135 30 30)"/><rect x="28" y="8" width="4" height="10" rx="2" fill="#0891b2" transform="rotate(180 30 30)"/><rect x="28" y="8" width="4" height="10" rx="2" fill="#0891b2" transform="rotate(225 30 30)"/><rect x="28" y="8" width="4" height="10" rx="2" fill="#0891b2" transform="rotate(270 30 30)"/><rect x="28" y="8" width="4" height="10" rx="2" fill="#0891b2" transform="rotate(315 30 30)"/></svg>',
    '<svg width="45" height="45" viewBox="0 0 45 45"><circle cx="22" cy="22" r="12" fill="none" stroke="#06b6d4" stroke-width="2.5"/><circle cx="22" cy="22" r="5" fill="none" stroke="#06b6d4" stroke-width="2"/><rect x="20" y="6" width="4" height="8" rx="2" fill="#06b6d4" transform="rotate(0 22 22)"/><rect x="20" y="6" width="4" height="8" rx="2" fill="#06b6d4" transform="rotate(60 22 22)"/><rect x="20" y="6" width="4" height="8" rx="2" fill="#06b6d4" transform="rotate(120 22 22)"/><rect x="20" y="6" width="4" height="8" rx="2" fill="#06b6d4" transform="rotate(180 22 22)"/><rect x="20" y="6" width="4" height="8" rx="2" fill="#06b6d4" transform="rotate(240 22 22)"/><rect x="20" y="6" width="4" height="8" rx="2" fill="#06b6d4" transform="rotate(300 22 22)"/></svg>',
    '<svg width="40" height="55" viewBox="0 0 40 55"><rect x="5" y="2" width="30" height="4" rx="2" fill="#0e7490"/><rect x="5" y="49" width="30" height="4" rx="2" fill="#0e7490"/><polygon points="8,6 32,6 22,27 32,49 8,49 18,27" fill="none" stroke="#0e7490" stroke-width="2"/><polygon points="15,35 25,35 22,47 18,47" fill="#67e8f9" opacity=".6"/></svg>',
    '<svg width="50" height="50" viewBox="0 0 50 50"><circle cx="25" cy="25" r="22" fill="none" stroke="#0891b2" stroke-width="2.5"/><circle cx="25" cy="25" r="2" fill="#0891b2"/><line x1="25" y1="25" x2="25" y2="12" stroke="#dc2626" stroke-width="3" stroke-linecap="round"/><line x1="25" y1="25" x2="35" y2="20" stroke="#2563eb" stroke-width="2" stroke-linecap="round"/></svg>',
    '<svg width="55" height="55" viewBox="0 0 55 55"><circle cx="28" cy="30" r="20" fill="none" stroke="#0e7490" stroke-width="2.5"/><circle cx="28" cy="30" r="2" fill="#0e7490"/><line x1="28" y1="30" x2="28" y2="18" stroke="#dc2626" stroke-width="2.5" stroke-linecap="round"/><line x1="28" y1="30" x2="36" y2="26" stroke="#2563eb" stroke-width="2" stroke-linecap="round"/><circle cx="12" cy="14" r="6" fill="none" stroke="#0e7490" stroke-width="2"/><circle cx="44" cy="14" r="6" fill="none" stroke="#0e7490" stroke-width="2"/><line x1="16" y1="10" x2="24" y2="16" stroke="#0e7490" stroke-width="2"/><line x1="40" y1="10" x2="32" y2="16" stroke="#0e7490" stroke-width="2"/></svg>',
    '<svg width="45" height="45" viewBox="0 0 45 45"><text x="22" y="32" text-anchor="middle" font-size="28" font-weight="900" fill="#0891b2">12</text></svg>',
    '<svg width="40" height="40" viewBox="0 0 40 40"><text x="20" y="30" text-anchor="middle" font-size="28" font-weight="900" fill="#06b6d4">3</text></svg>',
    '<svg width="40" height="40" viewBox="0 0 40 40"><text x="20" y="30" text-anchor="middle" font-size="28" font-weight="900" fill="#0e7490">6</text></svg>',
    '<svg width="45" height="50" viewBox="0 0 45 50"><path d="M22 8 C22 8 10 18 10 32 L10 38 L35 38 L35 32 C35 18 22 8 22 8Z" fill="none" stroke="#eab308" stroke-width="2.5"/><circle cx="22" cy="42" r="4" fill="#eab308"/><line x1="22" y1="2" x2="22" y2="8" stroke="#eab308" stroke-width="2.5"/></svg>',
    '<svg width="45" height="45" viewBox="0 0 45 45"><polygon points="22,2 28,16 44,18 32,28 35,44 22,36 9,44 12,28 0,18 16,16" fill="none" stroke="#fbbf24" stroke-width="2"/></svg>'
  ];
  for (var i = 0; i < 10; i++) {
    var d = document.createElement('div');
    d.className = 'hg-deco';
    d.innerHTML = clockSVGs[i];
    d.style.left = (i * 180 + Math.random() * 100) + 'px';
    d.style.top = (60 + Math.random() * 500) + 'px';
    d.style.setProperty('--dur', (5 + Math.random() * 4) + 's');
    d.style.animationDelay = -(i * 0.6) + 's';
    body.appendChild(d);
  }
  var sparkColors = ['#06b6d4','#22d3ee','#67e8f9','#0891b2','#0e7490','#164e63'];
  for (var i = 0; i < 12; i++) {
    var s = document.createElement('div');
    s.className = 'hg-bg-sparkle';
    var sz = 4 + Math.random() * 6;
    s.style.cssText = 'width:'+sz+'px;height:'+sz+'px;border-radius:50%;background:'+sparkColors[i%sparkColors.length]+';left:'+(Math.random()*95)+'%;top:'+(Math.random()*80)+'%';
    s.style.setProperty('--dur', (2 + Math.random() * 2) + 's');
    s.style.animationDelay = -(Math.random() * 3) + 's';
    body.appendChild(s);
  }
}

function hgGenerateClock(hour, min) {
  var sz = 420, r = sz / 2, cr = r - 16;
  var svg = '<svg width="' + sz + '" height="' + sz + '" viewBox="0 0 ' + sz + ' ' + sz + '">';
  // Shadow + face
  svg += '<defs><filter id="hgcs"><feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="rgba(0,0,0,.2)"/></filter></defs>';
  svg += '<circle cx="' + r + '" cy="' + r + '" r="' + (cr + 10) + '" fill="#94a3b8" filter="url(#hgcs)"/>';
  svg += '<circle cx="' + r + '" cy="' + r + '" r="' + cr + '" fill="#fffbe8"/>';
  // Ticks
  for (var i = 0; i < 60; i++) {
    var a = (i * 6 - 90) * Math.PI / 180;
    var isMajor = i % 5 === 0;
    var or2 = cr - 10;
    var ir = isMajor ? cr - 32 : cr - 18;
    svg += '<line x1="' + (r + or2 * Math.cos(a)) + '" y1="' + (r + or2 * Math.sin(a)) + '" x2="' + (r + ir * Math.cos(a)) + '" y2="' + (r + ir * Math.sin(a)) + '" stroke="' + (isMajor ? '#334155' : '#94a3b8') + '" stroke-width="' + (isMajor ? 3.5 : 1.5) + '" stroke-linecap="round"/>';
  }
  // Numbers
  var numR = cr - 52;
  for (var n = 1; n <= 12; n++) {
    var na = (n * 30 - 90) * Math.PI / 180;
    svg += '<text x="' + (r + numR * Math.cos(na)) + '" y="' + (r + numR * Math.sin(na)) + '" text-anchor="middle" dominant-baseline="central" font-size="38" font-weight="900" fill="#1e293b">' + n + '</text>';
  }
  // Hour hand â€” RED, THICK
  var hAngle = ((hour % 12) * 30 + min * 0.5);
  var hLen = cr * 0.45;
  var hRad = (hAngle - 90) * Math.PI / 180;
  svg += '<line x1="' + (r - 18 * Math.cos(hRad)) + '" y1="' + (r - 18 * Math.sin(hRad)) + '" x2="' + (r + hLen * Math.cos(hRad)) + '" y2="' + (r + hLen * Math.sin(hRad)) + '" stroke="#dc2626" stroke-width="14" stroke-linecap="round"/>';
  // Minute hand â€” BLUE, thinner
  var mAngle = min * 6;
  var mLen = cr * 0.7;
  var mRad = (mAngle - 90) * Math.PI / 180;
  svg += '<line x1="' + (r - 14 * Math.cos(mRad)) + '" y1="' + (r - 14 * Math.sin(mRad)) + '" x2="' + (r + mLen * Math.cos(mRad)) + '" y2="' + (r + mLen * Math.sin(mRad)) + '" stroke="#2563eb" stroke-width="8" stroke-linecap="round"/>';
  // Center
  svg += '<circle cx="' + r + '" cy="' + r + '" r="12" fill="#1e293b"/>';
  svg += '<circle cx="' + r + '" cy="' + r + '" r="6" fill="#fff"/>';
  svg += '</svg>';
  return svg;
}

function hgGenerateTime() {
  var hour, min;
  if (hg.level === 1) {
    var hours = [1,2,3,4,5,7,8,9,10,11];
    hour = hours[Math.floor(Math.random() * hours.length)];
    min = 0;
  } else if (hg.level === 2) {
    hour = Math.floor(Math.random() * 12) + 1;
    min = Math.random() < 0.5 ? 0 : 30;
  } else if (hg.level === 3) {
    hour = Math.floor(Math.random() * 12) + 1;
    min = [0, 15, 30, 45][Math.floor(Math.random() * 4)];
  } else if (hg.level === 4) {
    hour = Math.floor(Math.random() * 12) + 1;
    min = Math.floor(Math.random() * 12) * 5;
  } else {
    hour = Math.floor(Math.random() * 12) + 1;
    min = Math.floor(Math.random() * 60);
  }
  return { hour: hour, min: min };
}

function hgFormatTime(hour, min) {
  if (min === 0) return hour + 'ì‹œ';
  return hour + 'ì‹œ ' + min + 'ë¶„';
}

function hgGenerateOptions(hour, min) {
  var correct = hgFormatTime(hour, min);
  var options = [correct];
  var tries = 0;
  while (options.length < 4 && tries < 200) {
    tries++;
    var fakeH = hour, fakeM = min;
    var r = Math.random();
    if (hg.level <= 2) {
      fakeH = hour + (Math.floor(Math.random() * 3) + 1) * (Math.random() < 0.5 ? 1 : -1);
      if (fakeH > 12) fakeH -= 12;
      if (fakeH < 1) fakeH += 12;
      fakeM = min;
    } else {
      if (r < 0.5) {
        fakeH = hour + (Math.floor(Math.random() * 3) + 1) * (Math.random() < 0.5 ? 1 : -1);
        if (fakeH > 12) fakeH -= 12;
        if (fakeH < 1) fakeH += 12;
      } else {
        var step = hg.level === 3 ? 15 : (hg.level === 4 ? 5 : 1);
        var shift = (Math.floor(Math.random() * 3) + 1) * step * (Math.random() < 0.5 ? 1 : -1);
        fakeM = (min + shift + 60) % 60;
      }
    }
    var fake = hgFormatTime(fakeH, fakeM);
    if (!options.includes(fake)) options.push(fake);
  }
  while (options.length < 4) {
    var safeH = (hour + options.length) % 12 + 1;
    var safe = hgFormatTime(safeH, 0);
    if (!options.includes(safe)) options.push(safe);
    else options.push(hgFormatTime(safeH, 30));
  }
  for (var i = options.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var tmp = options[i]; options[i] = options[j]; options[j] = tmp;
  }
  return { options: options, correct: correct };
}

function hgNewRound() {
  if (!hg.running || hg.paused) return;
  hg.answering = false;
  var time = hgGenerateTime();
  hg.currentHour = time.hour;
  hg.currentMin = time.min;

  document.getElementById('hg-clock-area').innerHTML = hgGenerateClock(time.hour, time.min);

  var result = hgGenerateOptions(time.hour, time.min);
  var optsEl = document.getElementById('hg-options');
  optsEl.innerHTML = result.options.map(function(opt) {
    return '<button class="hg-opt" onclick="hgAnswer(\'' + opt + '\', \'' + result.correct + '\')">' + opt + '</button>';
  }).join('');

  hg.timerLeft = hg.timerMax;
  if (hg.timerInterval) clearInterval(hg.timerInterval);
  hg.timerInterval = setInterval(hgTimerTick, 100);
  hgUpdateTimerBar();
}

function hgTimerTick() {
  if (hg.paused || hg.answering) return;
  hg.timerLeft -= 0.1;
  hgUpdateTimerBar();
  if (hg.timerLeft <= 0) {
    clearInterval(hg.timerInterval);
    hg.answering = true;
    hg.combo = 0;
    hg.lives--;
    updateHgUI();
    SFX.buzz();
    var correct = hgFormatTime(hg.currentHour, hg.currentMin);
    var opts = document.querySelectorAll('.hg-opt');
    opts.forEach(function(btn) {
      btn.disabled = true;
      if (btn.textContent === correct) btn.classList.add('correct');
    });
    document.getElementById('hg-combo').textContent = 'â° ì‹œê°„ ì´ˆê³¼!';
    speak('ì‹œê°„ ì´ˆê³¼! ì •ë‹µì€ ' + correct);
    if (hg.lives <= 0) {
      setTimeout(hgGameOver, 1500);
    } else {
      setTimeout(hgNewRound, 1500);
    }
  }
}

function hgUpdateTimerBar() {
  var fill = document.getElementById('hg-timer-fill');
  var pct = Math.max(0, (hg.timerLeft / hg.timerMax) * 100);
  fill.style.width = pct + '%';
  fill.className = 'hg-timer-fill';
  if (pct < 30) fill.classList.add('danger');
  else if (pct < 60) fill.classList.add('warn');
}

function hgAnswer(selected, correct) {
  if (hg.answering || !hg.running || hg.paused) return;
  hg.answering = true;
  clearInterval(hg.timerInterval);

  var opts = document.querySelectorAll('.hg-opt');
  opts.forEach(function(btn) { btn.disabled = true; });

  if (selected === correct) {
    hg.combo++;
    if (hg.combo > hg.maxCombo) hg.maxCombo = hg.combo;
    hg.correctCount++;
    var bonus = hg.combo >= 5 ? 5 : (hg.combo >= 3 ? 3 : 0);
    hg.score += 10 + bonus;
    updateHgUI();
    SFX.ding();
    speak('ì •ë‹µ!');

    opts.forEach(function(btn) {
      if (btn.textContent === correct) btn.classList.add('correct');
    });

    if (hg.combo >= 3) {
      document.getElementById('hg-combo').textContent = 'ğŸ”¥ ì—°ì† ' + hg.combo + 'ì •ë‹µ! (+' + bonus + 'ë³´ë„ˆìŠ¤)';
    } else {
      document.getElementById('hg-combo').textContent = 'âœ… ì •ë‹µ!';
    }

    var popup = document.createElement('div');
    popup.className = 'score-popup';
    popup.textContent = '+' + (10 + bonus);
    popup.style.cssText = 'left:50%;top:40%;color:#22c55e';
    document.querySelector('.hg-body').appendChild(popup);
    setTimeout(function() { popup.remove(); }, 800);

    if (hg.correctCount % 5 === 0) hgLevelUp();

    setTimeout(hgNewRound, 1000);
  } else {
    hg.combo = 0;
    hg.lives--;
    updateHgUI();
    SFX.buzz();

    opts.forEach(function(btn) {
      if (btn.textContent === selected) btn.classList.add('wrong');
      if (btn.textContent === correct) btn.classList.add('correct');
    });

    document.getElementById('hg-combo').textContent = 'âŒ ì •ë‹µ: ' + correct;
    speak('ì •ë‹µì€ ' + correct);

    if (hg.lives <= 0) {
      setTimeout(hgGameOver, 1500);
    } else {
      setTimeout(hgNewRound, 1500);
    }
  }
}

function hgLevelUp() {
  hg.level++;
  var timers = [10, 8, 7, 6, 5];
  hg.timerMax = timers[Math.min(hg.level - 1, timers.length - 1)];
  updateHgUI();
  showLevelUp(hg.level);

  var game = document.getElementById('hero-game');
  var themes = [
    'linear-gradient(180deg,#ecfeff 0%,#cffafe 50%,#a5f3fc 100%)',
    'linear-gradient(180deg,#fef3c7 0%,#fde68a 30%,#fbbf24 60%,#86efac 100%)',
    'linear-gradient(180deg,#fed7aa 0%,#fdba74 30%,#fb923c 60%,#fbbf24 100%)',
    'linear-gradient(180deg,#e0f2fe 0%,#bfdbfe 30%,#93c5fd 60%,#e0e7ff 100%)'
  ];
  game.style.background = themes[(hg.level - 1) % themes.length];
}

function updateHgUI() {
  document.getElementById('hg-score').textContent = hg.score;
  document.getElementById('hg-level').textContent = hg.level;
  var heartsEl = document.getElementById('hg-hearts');
  var hearts = '';
  for (var i = 0; i < 5; i++) hearts += i < hg.lives ? 'â¤ï¸' : 'ğŸ–¤';
  heartsEl.textContent = hearts;
}

function hgGameOver() {
  hg.running = false;
  clearInterval(hg.timerInterval);
  if (hg.score > hg.bestScore) {
    hg.bestScore = hg.score;
    LS.setItem('clockHeroBest', hg.bestScore);
  }
  document.getElementById('hg-final-score').textContent = hg.score;
  document.getElementById('hg-best-score').textContent = hg.bestScore;
  var msgs = ['ì˜í–ˆì–´ìš”! ğŸ’ª', 'ëŒ€ë‹¨í•´ìš”! ğŸ‰', 'ì‹œê³„ ë°•ì‚¬! ğŸ“', 'ìµœê³ ì˜ˆìš”! â­'];
  document.getElementById('hg-over-msg').textContent = hg.score >= 100 ? msgs[3] : hg.score >= 50 ? msgs[2] : hg.score >= 20 ? msgs[1] : msgs[0];
  document.getElementById('hg-over').classList.remove('hidden');
  SFX.gameOver();
  speak('ê²Œì„ ë! ' + hg.score + 'ì !');
  saveStats();
}

function hgRestart() {
  document.getElementById('hg-over').classList.add('hidden');
  startHeroGame();
}

function hgPause() {
  if (!hg.running) return;
  hg.paused = !hg.paused;
  var pauseEl = document.getElementById('hg-pause-overlay');
  if (hg.paused) {
    pauseEl.classList.remove('hidden');
    clearInterval(hg.timerInterval);
  } else {
    pauseEl.classList.add('hidden');
    if (!hg.answering) {
      hg.timerInterval = setInterval(hgTimerTick, 100);
    }
  }
}

function hgExit() {
  hg.running = false;
  hg.paused = false;
  clearInterval(hg.timerInterval);
  document.getElementById('hero-game').classList.add('hidden');
  document.getElementById('hero-game').style.background = '';
  speechSynthesis.cancel();
  if(document.fullscreenElement)document.exitFullscreen?.();
}

// ===== ì´ˆê¸°í™” =====
document.addEventListener('DOMContentLoaded', function() {
  // fitScale
  function fitScale() {
    const c = document.querySelector('.container');
    if (!c || getComputedStyle(c).display === 'none') return;
    const M = 0.03;
    const vp = window.visualViewport || {width: window.innerWidth, height: window.innerHeight};
    const aW = vp.width * (1 - M * 2);
    const aH = vp.height * (1 - M * 2);
    const s = Math.min(aW / 1920, aH / 1080);
    c.style.transform = `scale(${s})`;
    c.style.left = ((vp.width - 1920 * s) / 2) + 'px';
    c.style.top = ((vp.height - 1080 * s) / 2) + 'px';
  }
  fitScale();
  window.addEventListener('resize', fitScale);
  if (window.visualViewport) window.visualViewport.addEventListener('resize', fitScale);

  // í”„ë¡œí•„
  _prevMainLevel = Math.floor(profile.totalCorrect / 10) + 1;
  updateProfileUI();
  updateActionButtons();

  // ì‹œê°„ì—¬í–‰ì ì‹œê³„ ìƒì„±
  document.getElementById('travel-clock-wrap').innerHTML = createAnalogClock('travel-clock', 340, 12, 0, {showTimeBg: true});
  setupClockDrag('travel-clock', function(h, m) {
    travel.currentHour = h;
    travel.currentMin = m;
    setClockHands('travel-clock', h, m);
  });
  newTravelQuestion();

  // ë‹¬ë ¥ ë†€ì´
  initCalGame();

  // ìŒë‘¥ì´ ì‹œê³„
  document.getElementById('twin-analog-wrap').innerHTML = createAnalogClock('twin-clock', 340, 3, 0);
  setupClockDrag('twin-clock', function(h, m) {
    twin.currentHour = h;
    twin.currentMin = m;
    setClockHands('twin-clock', h, m);
  });
  initTwinGame();
});

// ë”ë¸”íƒ­ ë°©ì§€
let lastTouchEnd = 0;
document.addEventListener('touchend', function(e) {
  const now = Date.now();
  if (now - lastTouchEnd <= 300) e.preventDefault();
  lastTouchEnd = now;
}, false);
document.addEventListener('visibilitychange', () => {
  if (document.hidden) {
    speechSynthesis.cancel(); audioQueue = []; isSpeaking = false;
    if (hg.running && !hg.paused) hgPause();
  }
});
window.matchMedia('(orientation: portrait)').addEventListener('change', e => {
  if (e.matches) {
    speechSynthesis.cancel(); audioQueue = []; isSpeaking = false;
    if (hg.running && !hg.paused) hgPause();
  }
});
</script>
</body>
</html>
