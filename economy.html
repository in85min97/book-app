<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>ê²½ì œ ë†€ì´í„° ğŸ’°</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;-webkit-user-select:none;user-select:none}
body{font-family:'Noto Sans KR',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:linear-gradient(135deg,#059669 0%,#10b981 50%,#047857 100%);margin:0;padding:0;width:100vw;height:100vh;height:100dvh;overflow:hidden;touch-action:manipulation}
.rotate-notice{display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:linear-gradient(135deg,#059669,#10b981);z-index:9999;flex-direction:column;align-items:center;justify-content:center;color:#fff;font-size:24px;font-weight:700;text-align:center;gap:20px}
.rotate-notice .rotate-icon{font-size:80px;animation:rotateH 2s ease-in-out infinite}
@keyframes rotateH{0%,100%{transform:rotate(0)}50%{transform:rotate(90deg)}}
@media(orientation:portrait){.rotate-notice{display:flex}.container{display:none!important}}
.container{width:1920px;height:1080px;background:#fff;border-radius:25px;box-shadow:0 25px 50px rgba(0,0,0,.12);display:flex;flex-direction:column;overflow:hidden;transform-origin:0 0;position:absolute}

/* ê³¼ëª©ë°” */
.subject-bar{background:linear-gradient(135deg,#1e3a8a,#3b82f6);display:flex;align-items:center;padding:0 20px;height:56px;flex-shrink:0;gap:4px;position:relative}
.subject-bar::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:linear-gradient(90deg,#6ee7b7,#10b981,#6ee7b7)}
.sb-tab{padding:8px 30px;border:none;border-radius:12px 12px 0 0;background:0;font-size:18px;font-weight:800;color:rgba(255,255,255,.5);cursor:pointer;font-family:inherit;transition:.2s;display:flex;align-items:center;gap:8px;text-decoration:none}
.sb-tab.active{background:#fff;color:#065f46}
.sb-tab.locked{cursor:default}
.sb-tab .lock{font-size:12px;opacity:.5}
.sb-spacer{flex:1}
.sb-btns{display:flex;gap:8px}
.sb-btn{background:rgba(255,255,255,.15);border:2px solid rgba(255,255,255,.2);border-radius:10px;padding:6px 14px;font-size:18px;color:#fff;cursor:pointer;transition:.15s}
.sb-btn:active{background:rgba(255,255,255,.3)}

/* ë©”ì¸ */
.main-layout{display:grid;grid-template-columns:300px 1fr 300px;gap:14px;padding:14px;flex:1;overflow:hidden}

/* ì™¼ìª½ */
.left-panel{display:flex;flex-direction:column;gap:10px;overflow:hidden}
.profile-section{background:linear-gradient(145deg,#047857,#059669 50%,#10b981);border-radius:20px;padding:20px;border:3px solid #a7f3d0;box-shadow:0 6px 20px rgba(5,150,105,.3);flex-shrink:0;position:relative;overflow:hidden}
.profile-section::before{content:'';position:absolute;inset:0;background:url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='15' cy='15' r='1.5' fill='white' opacity='.3'><animate attributeName='opacity' values='.3;.1;.3' dur='2s' repeatCount='indefinite'/></circle><circle cx='85' cy='25' r='1' fill='white' opacity='.25'><animate attributeName='opacity' values='.25;.08;.25' dur='1.5s' repeatCount='indefinite'/></circle><circle cx='25' cy='75' r='1.2' fill='white' opacity='.3'><animate attributeName='opacity' values='.3;.1;.3' dur='1.8s' repeatCount='indefinite'/></circle></svg>") repeat;pointer-events:none}
.profile-content{position:relative;z-index:1;display:flex;align-items:center;gap:15px}
.profile-avatar{width:90px;height:90px;background:linear-gradient(145deg,#6ee7b7,#34d399);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:50px;border:3px solid #fff;box-shadow:0 4px 15px rgba(110,231,183,.4);animation:avGlow 3s ease-in-out infinite;flex-shrink:0;cursor:pointer}
@keyframes avGlow{0%,100%{box-shadow:0 4px 15px rgba(110,231,183,.4);transform:scale(1)}50%{box-shadow:0 8px 25px rgba(110,231,183,.6);transform:scale(1.05)}}
.profile-info{flex:1;color:#fff}
.profile-name{font-size:28px;font-weight:800;text-shadow:2px 2px 4px rgba(0,0,0,.3);margin-bottom:8px;cursor:pointer}
.profile-level-container{background:rgba(255,255,255,.2);border-radius:12px;padding:8px 12px}
.profile-level{font-size:18px;font-weight:700;color:#a7f3d0;display:flex;align-items:center;gap:8px}
.level-badge{background:linear-gradient(145deg,#6ee7b7,#34d399);color:#064e3b;padding:4px 12px;border-radius:8px;font-size:18px;font-weight:800;border:1px solid #fff}
.progress-bar{width:100%;height:6px;background:rgba(255,255,255,.3);border-radius:3px;margin-top:5px;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,#6ee7b7,#34d399,#6ee7b7);background-size:200% 100%;border-radius:3px;transition:width .5s;animation:pShine 2s linear infinite}
@keyframes pShine{0%{background-position:-200% 0}100%{background-position:200% 0}}

/* íƒ­ */
.tab-headers{display:grid;grid-template-columns:1fr 1fr;gap:8px;flex-shrink:0}
.tab-btn{background:linear-gradient(145deg,#e2e8f0,#cbd5e1);border:2px solid #94a3b8;border-radius:12px;padding:8px;font-size:15px;font-weight:700;cursor:pointer;transition:.2s;color:#475569;display:flex;align-items:center;justify-content:center;height:48px;white-space:nowrap;font-family:inherit}
.tab-btn.active{background:linear-gradient(145deg,#10b981,#059669);color:#fff;border-color:#10b981}
.tab-btn:active{transform:scale(.97)}
.tab-content{display:none;flex:1;overflow:hidden}
.tab-content.active{display:flex;flex-direction:column}

/* ì‚¬ì´ë“œ ì •ë³´ */
.side-info{background:linear-gradient(145deg,#ecfdf5,#d1fae5);border-radius:16px;padding:15px;border:2px solid #10b981;display:flex;flex-direction:column;gap:8px;height:100%;overflow:hidden}
.side-title{font-size:17px;font-weight:700;color:#064e3b;text-align:center;flex-shrink:0}
.side-stat{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;background:#fff;border-radius:8px;font-size:15px;font-weight:600;color:#1e293b}
.side-val{font-size:20px;font-weight:800;color:#059669}

/* ê²Œì„ ëŸ°ì¹˜ */
.game-launch-btn{flex-shrink:0;background:linear-gradient(145deg,#6ee7b7,#34d399);color:#064e3b;border:3px solid #fff;border-radius:16px;padding:14px;font-size:20px;font-weight:800;cursor:pointer;text-align:center;box-shadow:0 4px 15px rgba(110,231,183,.4);font-family:inherit;animation:gPulse 2s ease-in-out infinite}
@keyframes gPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.02)}}
.game-launch-btn:active{transform:scale(.97)}

/* ì¤‘ì•™ */
.center-panel{display:flex;flex-direction:column;overflow:hidden;position:relative}
.game-view{display:none;flex-direction:column;flex:1;overflow:hidden}
.game-view.active{display:flex}

/* ====== ë¶•ì–´ë¹µ ì¥ì‚¬ ====== */
.fish-area{flex:1;display:flex;flex-direction:column;gap:8px;padding:10px;overflow-y:auto}
.fish-phase{display:none;flex-direction:column;gap:12px;flex:1}
.fish-phase.active{display:flex}
.fish-title{font-size:24px;font-weight:900;color:#064e3b;text-align:center;padding:10px;background:linear-gradient(145deg,#ecfdf5,#d1fae5);border-radius:14px;border:2px solid #6ee7b7}
.fish-day-info{font-size:18px;font-weight:700;color:#065f46;text-align:center}
.shop-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;padding:8px}
.shop-item{background:linear-gradient(145deg,#fff,#f0fdf4);border:3px solid #a7f3d0;border-radius:16px;padding:12px 16px;text-align:center;cursor:pointer;transition:.2s}
.shop-item:active{transform:scale(.96)}
.shop-item.selected{border-color:#059669;background:linear-gradient(145deg,#d1fae5,#a7f3d0);box-shadow:0 0 16px rgba(5,150,105,.3)}
.shop-emoji{font-size:72px;margin-bottom:8px;filter:drop-shadow(0 2px 4px rgba(0,0,0,.15))}
.shop-name{font-size:18px;font-weight:800;color:#064e3b}
.shop-price{font-size:16px;font-weight:700;color:#059669;margin-top:4px}
.fish-slider-row{display:flex;align-items:center;gap:16px;padding:12px 20px;background:#fff;border-radius:14px;border:2px solid #a7f3d0}
.fish-slider-label{font-size:18px;font-weight:700;color:#064e3b;min-width:100px}
.fish-slider{flex:1;height:12px;-webkit-appearance:none;appearance:none;background:linear-gradient(90deg,#a7f3d0,#10b981);border-radius:6px;outline:none;cursor:pointer}
.fish-slider::-webkit-slider-thumb{-webkit-appearance:none;width:28px;height:28px;background:linear-gradient(145deg,#6ee7b7,#059669);border:3px solid #fff;border-radius:50%;box-shadow:0 2px 8px rgba(0,0,0,.2);cursor:pointer}
.fish-slider-val{font-size:24px;font-weight:900;color:#059669;min-width:80px;text-align:right}
.fish-btn{background:linear-gradient(145deg,#10b981,#059669);color:#fff;border:3px solid #6ee7b7;border-radius:16px;padding:14px 30px;font-size:22px;font-weight:800;cursor:pointer;font-family:inherit;text-align:center;box-shadow:0 4px 12px rgba(5,150,105,.3)}
.fish-btn:active{transform:scale(.96)}
.fish-btn.restart{background:linear-gradient(145deg,#6ee7b7,#34d399);color:#064e3b}
.weather-card{background:linear-gradient(145deg,#fff,#ecfdf5);border:3px solid #6ee7b7;border-radius:20px;padding:20px;text-align:center;min-height:180px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;position:relative;overflow:hidden}
.weather-card::before{content:'';position:absolute;inset:0;opacity:.08;pointer-events:none}
.weather-emoji{font-size:100px;filter:drop-shadow(0 4px 8px rgba(0,0,0,.15))}
.weather-name{font-size:22px;font-weight:800;color:#064e3b}
.weather-desc{font-size:16px;color:#065f46;font-weight:600}
.result-box{background:linear-gradient(145deg,#ecfdf5,#d1fae5);border:3px solid #10b981;border-radius:20px;padding:20px;text-align:center}
.result-row{display:flex;justify-content:space-between;align-items:center;padding:10px 16px;font-size:18px;font-weight:700;color:#064e3b;border-bottom:1px solid #a7f3d0}
.result-row:last-child{border-bottom:none}
.result-val{font-size:22px;font-weight:900;color:#059669}
.result-val.loss{color:#ef4444}
.result-val.profit{color:#059669}
/* ë¶•ì–´ë¹µ í‹€ SVG */
.fish-grill-container{display:flex;justify-content:center;padding:8px 0}
.fish-grill-svg{width:100%;max-width:500px;height:auto;filter:drop-shadow(0 4px 12px rgba(0,0,0,.2))}
/* ì¥ì‚¬ ê²°ê³¼ ë™ì „ ì´í™íŠ¸ */
.fish-coin-rain{position:absolute;inset:0;pointer-events:none;z-index:20;overflow:hidden}
.fish-flying-coin{position:absolute;animation:fishCoinFly 1.2s ease-out forwards}
@keyframes fishCoinFly{0%{transform:translate(0,0) rotate(0) scale(1);opacity:1}100%{transform:translate(var(--tx,0),var(--ty,-100px)) rotate(360deg) scale(0.3);opacity:0}}
.fish-summary{background:linear-gradient(145deg,#064e3b,#065f46);border-radius:20px;padding:24px;text-align:center;color:#fff}
.fish-summary h2{font-size:28px;font-weight:900;margin-bottom:16px;color:#6ee7b7}
.summary-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.summary-item{background:rgba(255,255,255,.1);border-radius:12px;padding:14px}
.summary-num{font-size:32px;font-weight:900;color:#6ee7b7}
.summary-label{font-size:14px;color:#a7f3d0;margin-top:4px}

/* ====== ì§€ê°‘ íƒˆì¶œ ====== */
.wallet-area{flex:1;display:flex;flex-direction:column;gap:10px;padding:10px;overflow:hidden;position:relative}
.wallet-header{display:flex;justify-content:space-between;align-items:center;padding:12px 20px;background:linear-gradient(145deg,#ecfdf5,#d1fae5);border-radius:14px;border:2px solid #6ee7b7;flex-shrink:0}
.wallet-money{font-size:28px;font-weight:900;color:#064e3b}
.wallet-piggy{font-size:24px;font-weight:700;color:#059669;display:flex;align-items:center;gap:8px}
.wallet-piggy .piggy-icon{font-size:36px;transition:transform .3s;display:inline-flex;align-items:center}
.piggy-svg{width:48px;height:48px;filter:drop-shadow(0 2px 6px rgba(236,72,153,.3))}
.piggy-svg .piggy-ear{animation:piggyEarWiggle 2s ease-in-out infinite}
@keyframes piggyEarWiggle{0%,100%{transform:rotate(0)}50%{transform:rotate(-5deg)}}
.piggy-svg .piggy-eye-blink{animation:piggyBlink 3s ease-in-out infinite}
@keyframes piggyBlink{0%,42%,46%,100%{ry:3}44%{ry:0.5}}
.wallet-piggy .piggy-icon.bounce{animation:piggyBounce .5s ease-out}
@keyframes piggyBounce{0%{transform:scale(1)}30%{transform:scale(1.3) rotate(-10deg)}60%{transform:scale(1.1) rotate(5deg)}100%{transform:scale(1)}}
.product-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:4px;flex:1;overflow-y:auto;align-content:start;grid-auto-rows:1fr}
.product-item{background:linear-gradient(145deg,#fff,#f0fdf4);border:3px solid #d1fae5;border-radius:16px;padding:14px 12px;text-align:center;cursor:pointer;transition:.2s;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px}
.product-item:active{transform:scale(.95)}
.product-item.in-cart{border-color:#059669;background:linear-gradient(145deg,#d1fae5,#a7f3d0)}
.product-item.over-budget{border-color:#ef4444;background:linear-gradient(145deg,#fef2f2,#fecaca)}
.product-emoji{font-size:72px;filter:drop-shadow(0 2px 4px rgba(0,0,0,.12));transition:transform .2s;line-height:1}
.product-item:hover .product-emoji{transform:scale(1.1)}
.product-item.in-cart .product-emoji{animation:cartBounce .4s ease-out}
@keyframes cartBounce{0%{transform:scale(1)}40%{transform:scale(1.2)}100%{transform:scale(1)}}
.product-name{font-size:14px;font-weight:700;color:#064e3b}
.product-price{font-size:16px;font-weight:800;color:#059669}
.cart-bar{display:flex;align-items:center;gap:12px;padding:10px 16px;background:#fff;border-radius:14px;border:2px solid #a7f3d0;flex-shrink:0}
.cart-label{font-size:16px;font-weight:700;color:#064e3b;white-space:nowrap}
.cart-items{flex:1;display:flex;gap:6px;overflow-x:auto;min-height:36px;align-items:center}
.cart-item-tag{background:linear-gradient(145deg,#d1fae5,#a7f3d0);border-radius:8px;padding:4px 10px;font-size:14px;font-weight:700;color:#064e3b;white-space:nowrap;cursor:pointer}
.cart-item-tag:active{transform:scale(.9)}
.cart-total{font-size:20px;font-weight:900;color:#059669;white-space:nowrap}
.wallet-status{text-align:center;font-size:20px;font-weight:800;padding:8px;border-radius:12px;flex-shrink:0;min-height:44px;transition:.3s}
.wallet-crying{position:absolute;font-size:40px;pointer-events:none;z-index:10;animation:walletCry 1s ease-out forwards}
@keyframes walletCry{0%{transform:translateY(0) scale(1);opacity:1}100%{transform:translateY(-60px) scale(.5);opacity:0}}
.piggy-particle{position:absolute;pointer-events:none;z-index:10;animation:piggyPart .6s ease-out forwards}
@keyframes piggyPart{0%{transform:translate(0,0) scale(1);opacity:1}100%{transform:translate(var(--tx,0),var(--ty,-30px)) scale(0);opacity:0}}

/* ====== ë¬¼ë¬¼êµí™˜ ====== */
.trade-area{flex:1;display:flex;flex-direction:column;gap:10px;padding:10px;overflow:hidden;position:relative}
.trade-goal{font-size:20px;font-weight:800;color:#064e3b;text-align:center;padding:12px;background:linear-gradient(145deg,#ecfdf5,#d1fae5);border-radius:14px;border:2px solid #6ee7b7;flex-shrink:0}
.trade-inventory{display:flex;align-items:center;gap:10px;padding:10px 16px;background:#fff;border-radius:14px;border:2px solid #a7f3d0;flex-shrink:0;flex-wrap:wrap}
.trade-inv-label{font-size:16px;font-weight:700;color:#064e3b}
.inv-item{background:linear-gradient(145deg,#d1fae5,#a7f3d0);border-radius:12px;padding:8px 14px;font-size:18px;font-weight:700;color:#064e3b;display:flex;align-items:center;gap:6px}
.inv-item .inv-emoji{font-size:32px;filter:drop-shadow(0 1px 3px rgba(0,0,0,.1))}
.trade-table{flex:1;display:flex;flex-direction:column;gap:8px;overflow-y:auto;padding:4px}
.trade-row{display:flex;align-items:center;gap:12px;padding:16px 20px;background:linear-gradient(145deg,#fff,#f0fdf4);border:2px solid #d1fae5;border-radius:16px;cursor:pointer;transition:.2s}
.trade-row:hover{border-color:#10b981;box-shadow:0 2px 8px rgba(16,185,129,.2)}
.trade-row:active{transform:scale(.98)}
.trade-row.disabled{opacity:.4;pointer-events:none}
.trade-give{display:flex;align-items:center;gap:8px;font-size:20px;font-weight:700;color:#dc2626;min-width:160px}
.trade-give .trade-item-emoji,.trade-receive .trade-item-emoji{font-size:40px;filter:drop-shadow(0 2px 4px rgba(0,0,0,.12))}
.trade-arrow-svg{width:60px;height:36px;flex-shrink:0}
.trade-receive{display:flex;align-items:center;gap:8px;font-size:20px;font-weight:700;color:#059669;min-width:160px}
.trade-result{text-align:center;font-size:22px;font-weight:800;padding:12px;border-radius:14px;flex-shrink:0;min-height:50px;transition:.3s}
.trade-success-overlay{position:absolute;inset:0;pointer-events:none;z-index:20;overflow:hidden}
.trade-confetti{position:absolute;width:8px;height:8px;border-radius:2px;pointer-events:none;animation:tradeConf var(--dur,1s) ease-out forwards}
@keyframes tradeConf{0%{transform:translate(0,0) rotate(0deg);opacity:1}100%{transform:translate(var(--tx,0),var(--ty,200px)) rotate(720deg);opacity:0}}
.trade-star-burst{position:absolute;pointer-events:none;z-index:25;animation:starBurst .8s ease-out forwards}
@keyframes starBurst{0%{transform:translate(0,0) scale(0) rotate(0);opacity:1}50%{transform:translate(var(--tx,0),var(--ty,0)) scale(1.5) rotate(180deg);opacity:1}100%{transform:translate(calc(var(--tx,0) * 2),calc(var(--ty,0) * 2)) scale(0) rotate(360deg);opacity:0}}
/* ìƒí’ˆ ë°˜ì§ì´ ì´í™íŠ¸ */
.sparkle-effect{position:absolute;pointer-events:none;z-index:10;animation:sparkleFloat 0.6s ease-out forwards}
@keyframes sparkleFloat{0%{transform:scale(0) rotate(0);opacity:1}100%{transform:scale(1.5) rotate(180deg);opacity:0}}

/* ë‚´ ê¸°ë¡ */
.records-area{flex:1;display:flex;flex-direction:column;gap:16px;padding:16px;overflow-y:auto}
.record-card{background:linear-gradient(145deg,#fff,#f8fafc);border:2px solid #e2e8f0;border-radius:16px;padding:18px;box-shadow:0 4px 12px rgba(0,0,0,.06)}
.record-card h3{font-size:18px;font-weight:800;color:#1e293b;margin-bottom:10px}
.record-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.record-item{text-align:center;padding:12px;background:linear-gradient(145deg,#ecfdf5,#d1fae5);border-radius:12px;border:2px solid #a7f3d0}
.record-num{font-size:32px;font-weight:900;color:#059669}
.record-label{font-size:13px;font-weight:600;color:#064e3b;margin-top:4px}

/* ì˜¤ë¥¸ìª½ */
.right-panel{display:flex;flex-direction:column;gap:12px;overflow:hidden}
.action-btn{border:none;border-radius:20px;font-size:32px;font-weight:800;cursor:pointer;transition:.1s;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;flex:1;min-height:60px;font-family:inherit;color:#fff}
.action-btn .icon{font-size:52px;opacity:.9;filter:drop-shadow(0 2px 4px rgba(0,0,0,.15))}
.action-btn:active{transform:scale(.95)}
.action-btn.btn-emerald{background:linear-gradient(145deg,#10b981,#059669);box-shadow:0 2px 8px rgba(16,185,129,.3)}
.action-btn.btn-cyan{background:linear-gradient(145deg,#06b6d4,#0891b2);box-shadow:0 2px 8px rgba(6,182,212,.2)}
.action-btn.btn-red{background:linear-gradient(145deg,#f87171,#ef4444);box-shadow:0 2px 8px rgba(248,113,113,.2)}
.action-btn.btn-green{background:linear-gradient(145deg,#10b981,#059669);box-shadow:0 2px 8px rgba(16,185,129,.2)}
.action-btn.btn-orange{background:linear-gradient(145deg,#f97316,#ea580c);box-shadow:0 2px 8px rgba(249,115,22,.2)}
.action-btn:disabled{background:linear-gradient(145deg,#e5e7eb,#d1d5db)!important;color:#9ca3af;cursor:not-allowed;box-shadow:none}

/* ====== íˆì–´ë¡œ: ë™ì „ ëŸ¬ì‹œ ====== */
.hero-game{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:5000;display:flex;flex-direction:column;background:linear-gradient(180deg,#ecfdf5 0%,#a7f3d0 25%,#6ee7b7 75%,#34d399 100%);overflow:hidden}
.hero-game.hidden{display:none}
.hg-header{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:rgba(255,255,255,.35);backdrop-filter:blur(12px);flex-shrink:0;z-index:10;border-bottom:2px solid rgba(255,255,255,.4)}
.hg-stat{font-size:22px;font-weight:800;color:#064e3b}
.hg-target{font-size:22px;font-weight:800;color:#dc2626;background:rgba(255,255,255,.6);padding:4px 16px;border-radius:10px}
.hg-hearts{font-size:24px;letter-spacing:3px}
.hg-ctrls{display:flex;gap:8px}
.hg-ctrl-btn{background:rgba(255,255,255,.6);border:2px solid rgba(255,255,255,.8);border-radius:50%;width:44px;height:44px;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#475569}
.hg-ctrl-btn:active{transform:scale(.9)}
.hg-arena{flex:1;position:relative;overflow:hidden}
.hg-ground{position:absolute;bottom:0;left:0;right:0;height:8%;background:linear-gradient(180deg,#059669,#047857);border-top:4px solid #6ee7b7;border-radius:50% 50% 0 0/20px 20px 0 0}
.hg-wallet{position:absolute;bottom:9%;left:50%;transform:translateX(-50%);z-index:5;filter:drop-shadow(0 4px 12px rgba(0,0,0,.2));pointer-events:none}
.hg-wallet svg{width:120px;height:100px}
.wallet-mouth{animation:walletMouth 2s ease-in-out infinite}
@keyframes walletMouth{0%,100%{d:path('M25,30 Q50,35 75,30')}50%{d:path('M25,30 Q50,42 75,30')}}
.falling-coin{position:absolute;z-index:5;cursor:pointer;transition:transform .1s;animation:coinSpin 1.5s linear infinite}
.falling-coin:active{transform:scale(.85)}
@keyframes coinSpin{0%{filter:brightness(1)}50%{filter:brightness(1.2)}100%{filter:brightness(1)}}
.falling-coin .coin-body{width:72px;height:72px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:900;color:#fff;text-shadow:0 1px 3px rgba(0,0,0,.3)}
.falling-coin .coin-svg{width:72px;height:72px;filter:drop-shadow(0 4px 8px rgba(0,0,0,.25))}
.coin-10{background:linear-gradient(145deg,#d97706,#b45309)}
.coin-50{background:linear-gradient(145deg,#f59e0b,#d97706)}
.coin-100{background:linear-gradient(145deg,#6ee7b7,#10b981)}
.coin-500{background:linear-gradient(145deg,#fbbf24,#f59e0b)}
.coin-debt{background:linear-gradient(145deg,#ef4444,#dc2626);animation:debtGlow .5s infinite}
@keyframes debtGlow{0%,100%{box-shadow:0 4px 16px rgba(239,68,68,.4)}50%{box-shadow:0 4px 24px rgba(239,68,68,.8)}}
.coin-powerup{background:linear-gradient(145deg,#8b5cf6,#7c3aed);animation:puGlow .5s infinite}
@keyframes puGlow{0%,100%{box-shadow:0 4px 16px rgba(139,92,246,.4)}50%{box-shadow:0 4px 24px rgba(139,92,246,.8)}}
.hg-flash{position:absolute;inset:0;pointer-events:none;z-index:30;animation:screenFlash .3s ease-out forwards}
@keyframes screenFlash{0%{background:rgba(34,197,94,.3)}100%{background:transparent}}
.hg-miss-flash{position:absolute;inset:0;pointer-events:none;z-index:30;animation:missFlash .4s ease-out forwards}
@keyframes missFlash{0%{background:rgba(239,68,68,.3)}50%{background:rgba(239,68,68,.15)}100%{background:transparent}}
.hg-arena-shake{animation:arenaShake .4s ease-out}
@keyframes arenaShake{0%,100%{transform:translateX(0)}20%{transform:translateX(-8px)}40%{transform:translateX(8px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}
.coin-collect{position:absolute;font-size:28px;font-weight:900;pointer-events:none;z-index:20;animation:coinCollect .8s ease-out forwards}
@keyframes coinCollect{0%{transform:translateY(0) scale(1);opacity:1}100%{transform:translateY(-60px) scale(.5);opacity:0}}
.coin-burst{position:absolute;pointer-events:none;z-index:15;animation:coinBurst .6s ease-out forwards}
@keyframes coinBurst{0%{transform:translate(0,0) scale(1);opacity:1}100%{transform:translate(var(--tx,0),var(--ty,-30px)) scale(0);opacity:0}}
@keyframes comboPop{0%{transform:translate(-50%,-50%) scale(0);opacity:0}30%{transform:translate(-50%,-50%) scale(1.2);opacity:1}100%{transform:translate(-50%,-50%) scale(.8);opacity:0}}
.hg-cloud{position:absolute;font-size:36px;opacity:.25;pointer-events:none;animation:cFloat 20s linear infinite;z-index:1}
@keyframes cFloat{0%{transform:translateX(-100px)}100%{transform:translateX(calc(100vw + 100px))}}
.hg-overlay{position:absolute;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:100;backdrop-filter:blur(5px)}
.hg-overlay.hidden{display:none}
.hg-overlay-box{background:#fff;border-radius:24px;padding:40px;text-align:center;box-shadow:0 25px 50px rgba(0,0,0,.3);min-width:320px}
.hg-overlay-box h2{font-size:36px;font-weight:900;color:#1e293b;margin-bottom:12px}
.hg-overlay-box .score{font-size:28px;font-weight:700;color:#059669;margin-bottom:8px}
.hg-overlay-box .msg{font-size:18px;color:#64748b;margin-bottom:20px}
.hg-overlay-box button{display:block;width:100%;padding:14px;border:none;border-radius:14px;font-size:18px;font-weight:800;cursor:pointer;margin-bottom:8px;font-family:inherit}
.hg-overlay-box .btn-retry{background:linear-gradient(145deg,#10b981,#059669);color:#fff}
.hg-overlay-box .btn-exit{background:linear-gradient(145deg,#e2e8f0,#cbd5e1);color:#475569}

/* ëª¨ë‹¬ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:6000;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(10px)}
.modal-overlay.hidden{display:none}
.modal-box{background:#fff;border-radius:20px;width:90%;max-width:500px;max-height:80vh;overflow-y:auto;box-shadow:0 25px 50px rgba(0,0,0,.3)}
.modal-head{background:linear-gradient(145deg,#10b981,#059669);color:#fff;padding:16px 20px;border-radius:20px 20px 0 0;display:flex;justify-content:space-between;align-items:center}
.modal-head h3{margin:0;font-size:18px}
.modal-close{background:0;border:0;color:#fff;font-size:24px;cursor:pointer}
.modal-body{padding:20px}
.modal-section{margin-bottom:16px;padding:14px;border-radius:10px;background:#f8fafc}
.modal-section h4{margin:0 0 10px;font-weight:700;color:#374151;font-size:15px}
.modal-input{width:100%;padding:10px;border:2px solid #e5e7eb;border-radius:8px;font-size:14px;box-sizing:border-box;margin-bottom:8px}
.modal-input:focus{outline:none;border-color:#10b981}
.modal-btn{padding:10px 16px;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;width:100%;background:linear-gradient(145deg,#10b981,#059669);color:#fff;margin-top:6px}
.char-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(70px,1fr));gap:12px}
.char-item{background:linear-gradient(145deg,#f8fafc,#e2e8f0);border:2px solid #cbd5e1;border-radius:14px;padding:12px;text-align:center;cursor:pointer;font-size:32px;height:70px;display:flex;align-items:center;justify-content:center;transition:.2s}
.char-item.selected{background:linear-gradient(145deg,#6ee7b7,#34d399);border-color:#10b981}
</style>
</head>
<body>
<!-- SVG ì •ì˜ -->
<svg xmlns="http://www.w3.org/2000/svg" style="position:absolute;width:0;height:0;overflow:hidden">
<defs>
  <!-- ê¸ˆìƒ‰ ë™ì „ ê·¸ë¼ë°ì´ì…˜ -->
  <radialGradient id="coinGold" cx="35%" cy="35%">
    <stop offset="0%" stop-color="#fef08a"/>
    <stop offset="40%" stop-color="#fbbf24"/>
    <stop offset="80%" stop-color="#d97706"/>
    <stop offset="100%" stop-color="#92400e"/>
  </radialGradient>
  <radialGradient id="coinSilver" cx="35%" cy="35%">
    <stop offset="0%" stop-color="#e2e8f0"/>
    <stop offset="40%" stop-color="#94a3b8"/>
    <stop offset="80%" stop-color="#64748b"/>
    <stop offset="100%" stop-color="#475569"/>
  </radialGradient>
  <radialGradient id="coinCopper" cx="35%" cy="35%">
    <stop offset="0%" stop-color="#fcd34d"/>
    <stop offset="40%" stop-color="#b45309"/>
    <stop offset="80%" stop-color="#78350f"/>
    <stop offset="100%" stop-color="#451a03"/>
  </radialGradient>
  <radialGradient id="coinGreen" cx="35%" cy="35%">
    <stop offset="0%" stop-color="#a7f3d0"/>
    <stop offset="40%" stop-color="#34d399"/>
    <stop offset="80%" stop-color="#059669"/>
    <stop offset="100%" stop-color="#047857"/>
  </radialGradient>
  <!-- ë‚ ì”¨ SVG ê·¸ë¼ë°ì´ì…˜ -->
  <linearGradient id="sunGrad" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#fbbf24"/>
    <stop offset="100%" stop-color="#f59e0b"/>
  </linearGradient>
  <linearGradient id="cloudGrad" x1="0" y1="0" x2="0" y2="1">
    <stop offset="0%" stop-color="#e2e8f0"/>
    <stop offset="100%" stop-color="#94a3b8"/>
  </linearGradient>
  <linearGradient id="rainGrad" x1="0" y1="0" x2="0" y2="1">
    <stop offset="0%" stop-color="#60a5fa"/>
    <stop offset="100%" stop-color="#3b82f6"/>
  </linearGradient>
  <linearGradient id="snowGrad" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#e0f2fe"/>
    <stop offset="100%" stop-color="#bae6fd"/>
  </linearGradient>
  <linearGradient id="stormGrad" x1="0" y1="0" x2="0" y2="1">
    <stop offset="0%" stop-color="#6b7280"/>
    <stop offset="100%" stop-color="#374151"/>
  </linearGradient>
  <!-- êµí™˜ í™”ì‚´í‘œ ê·¸ë¼ë°ì´ì…˜ -->
  <linearGradient id="arrowGrad" x1="0" y1="0" x2="1" y2="0">
    <stop offset="0%" stop-color="#ef4444"/>
    <stop offset="50%" stop-color="#f59e0b"/>
    <stop offset="100%" stop-color="#10b981"/>
  </linearGradient>
</defs>
</svg>

<div class="rotate-notice"><div class="rotate-icon">ğŸ“±</div>í™”ë©´ì„ ê°€ë¡œë¡œ ëŒë ¤ì£¼ì„¸ìš”!</div>

<div class="container">
  <div class="subject-bar">
    <a class="sb-tab" href="hangul.html">ğŸ“ í•œê¸€</a>
    <a class="sb-tab" href="math.html">ğŸ”¢ ìˆ«ì</a>
    <button class="sb-tab active">ğŸ’° ê²½ì œ</button>
    <div class="sb-spacer"></div>
    <div class="sb-btns">
      <button class="sb-btn" id="sb-sound" onclick="toggleSound()">ğŸ”Š</button>
      <button class="sb-btn" onclick="showAdmin()">âš™ï¸</button>
    </div>
  </div>

  <div class="main-layout">
    <!-- ì™¼ìª½ íŒ¨ë„ -->
    <div class="left-panel">
      <div class="profile-section">
        <div class="profile-content">
          <div class="profile-avatar" onclick="showCharModal()"><span id="pf-char">ğŸ§’</span></div>
          <div class="profile-info">
            <div class="profile-name" onclick="changeName()"><span id="pf-name">ê²½ì œì™•</span></div>
            <div class="profile-level-container">
              <div class="profile-level">
                <span class="level-badge">LV.<span id="pf-level">1</span></span>
                <span id="pf-done">0</span>/<span id="pf-total">10</span>
              </div>
              <div class="progress-bar"><div class="progress-fill" id="pf-bar" style="width:0%"></div></div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-headers">
        <button class="tab-btn active" onclick="switchTab('fish')">ğŸŸ ë¶•ì–´ë¹µ</button>
        <button class="tab-btn" onclick="switchTab('wallet')">ğŸ‘› ì§€ê°‘íƒˆì¶œ</button>
        <button class="tab-btn" onclick="switchTab('trade')">ğŸ”„ ë¬¼ë¬¼êµí™˜</button>
        <button class="tab-btn" onclick="switchTab('record')">ğŸ“Š ë‚´ ê¸°ë¡</button>
      </div>

      <!-- ë¶•ì–´ë¹µ ì‚¬ì´ë“œ -->
      <div class="tab-content fish-side active">
        <div class="side-info">
          <div class="side-title">ğŸŸ ë¶•ì–´ë¹µ ì¥ì‚¬</div>
          <div class="side-stat"><span>ë‚ ì§œ</span><span class="side-val" id="fish-day">1ì¼ì°¨</span></div>
          <div class="side-stat"><span>ì†Œì§€ê¸ˆ</span><span class="side-val" id="fish-money-side">5000ì›</span></div>
          <div class="side-stat"><span>ì´ ìˆ˜ìµ</span><span class="side-val" id="fish-profit-side">0ì›</span></div>
          <div class="side-stat"><span>íŒë§¤ ìˆ˜</span><span class="side-val" id="fish-sold-side">0ê°œ</span></div>
        </div>
      </div>

      <!-- ì§€ê°‘ ì‚¬ì´ë“œ -->
      <div class="tab-content wallet-side">
        <div class="side-info">
          <div class="side-title">ğŸ‘› ì§€ê°‘ íƒˆì¶œ</div>
          <div class="side-stat"><span>ìš©ëˆ</span><span class="side-val" id="wallet-budget-side">3000ì›</span></div>
          <div class="side-stat"><span>ì‚¬ìš©</span><span class="side-val" id="wallet-spent-side">0ì›</span></div>
          <div class="side-stat"><span>ì €ê¸ˆí†µ</span><span class="side-val" id="wallet-saved-side">0ì›</span></div>
          <div class="side-stat"><span>ì—°ì† ì„±ê³µ</span><span class="side-val" id="wallet-streak-side">0</span></div>
        </div>
      </div>

      <!-- êµí™˜ ì‚¬ì´ë“œ -->
      <div class="tab-content trade-side">
        <div class="side-info">
          <div class="side-title">ğŸ”„ ë¬¼ë¬¼êµí™˜</div>
          <div class="side-stat"><span>êµí™˜ íšŸìˆ˜</span><span class="side-val" id="trade-count-side">0</span></div>
          <div class="side-stat"><span>ëª©í‘œ</span><span class="side-val" id="trade-goal-side">?</span></div>
          <div class="side-stat"><span>ì„±ê³µ</span><span class="side-val" id="trade-success-side">0</span></div>
        </div>
      </div>

      <!-- ê¸°ë¡ ì‚¬ì´ë“œ -->
      <div class="tab-content record-side">
        <div class="side-info">
          <div class="side-title">ğŸ“Š ì¢…í•© ê¸°ë¡</div>
          <div class="side-stat"><span>ì´ í™œë™</span><span class="side-val" id="rec-total-side">0</span></div>
          <div class="side-stat"><span>ì„±ê³µë¥ </span><span class="side-val" id="rec-rate-side">0%</span></div>
        </div>
      </div>

      <div class="game-launch-btn" onclick="startHeroGame()">ğŸª™ ë™ì „ ëŸ¬ì‹œ ì‹œì‘!</div>
    </div>

    <!-- ì¤‘ì•™ íŒ¨ë„ -->
    <div class="center-panel">
      <!-- ë¶•ì–´ë¹µ ì¥ì‚¬ -->
      <div class="game-view fish-view active" id="fish-view">
        <div class="fish-area" id="fish-area">
          <!-- êµ¬ë§¤ ë‹¨ê³„ -->
          <div class="fish-phase active" id="fish-phase-buy">
            <div class="fish-title">ğŸ›’ ì¬ë£Œ êµ¬ë§¤ â€” <span id="fish-day-label">1ì¼ì°¨</span></div>
            <div class="fish-day-info">ì†Œì§€ê¸ˆ: <span id="fish-budget-label">5000</span>ì›</div>
            <div class="shop-grid" id="shop-grid"></div>
            <div style="text-align:center">
              <div style="font-size:18px;font-weight:700;color:#064e3b;margin-bottom:8px">ì¬ë£Œë¹„ í•©ê³„: <span id="fish-cost-label" style="color:#059669;font-size:22px">0</span>ì›</div>
              <button class="fish-btn" onclick="fishBuyDone()">âœ… êµ¬ë§¤ ì™„ë£Œ</button>
            </div>
          </div>
          <!-- ê°€ê²© ì„¤ì • -->
          <div class="fish-phase" id="fish-phase-price">
            <div class="fish-title">ğŸ’° íŒë§¤ê°€ ì„¤ì •</div>
            <div style="text-align:center;font-size:18px;font-weight:700;color:#064e3b">ì¬ë£Œ ì›ê°€: <span id="fish-unit-cost" style="color:#ef4444">0</span>ì› / 1ê°œë‹¹</div>
            <div class="fish-slider-row">
              <div class="fish-slider-label">íŒë§¤ê°€</div>
              <input type="range" class="fish-slider" id="fish-price-slider" min="100" max="2000" step="100" value="500" oninput="updatePriceLabel()">
              <div class="fish-slider-val"><span id="fish-price-label">500</span>ì›</div>
            </div>
            <div style="text-align:center;font-size:16px;color:#065f46;font-weight:600">ë¹„ì‹¸ë©´ ì†ë‹˜ì´ ì ì–´ìš”! ì‹¸ë©´ ë§ì´ ì™€ìš”!</div>
            <div style="text-align:center"><button class="fish-btn" onclick="fishSetPrice()">ğŸª ì¥ì‚¬ ì‹œì‘!</button></div>
          </div>
          <!-- ì¥ì‚¬ (ë‚ ì”¨+ê²°ê³¼) -->
          <div class="fish-phase" id="fish-phase-sell">
            <div class="fish-title">ğŸª ì˜¤ëŠ˜ì˜ ì¥ì‚¬ â€” <span id="fish-sell-day">1ì¼ì°¨</span></div>
            <div style="display:flex;gap:16px;flex:1">
              <div style="flex:1;display:flex;flex-direction:column;gap:12px">
                <div class="weather-card" id="weather-card">
                  <div class="weather-emoji" id="weather-emoji">â˜€ï¸</div>
                  <div class="weather-name" id="weather-name">ë§‘ìŒ</div>
                  <div class="weather-desc" id="weather-desc">ì†ë‹˜ì´ ë§ì´ ì™€ìš”!</div>
                </div>
              </div>
              <div style="flex:1;display:flex;flex-direction:column;gap:8px">
                <div class="result-box" id="sell-result">
                  <div class="result-row"><span>íŒë§¤ê°€</span><span class="result-val" id="res-price">500ì›</span></div>
                  <div class="result-row"><span>ì†ë‹˜ ìˆ˜</span><span class="result-val" id="res-customers">0ëª…</span></div>
                  <div class="result-row"><span>ë§¤ì¶œ</span><span class="result-val" id="res-revenue">0ì›</span></div>
                  <div class="result-row"><span>ì¬ë£Œë¹„</span><span class="result-val" id="res-cost">0ì›</span></div>
                  <div class="result-row"><span>ì´ìµ</span><span class="result-val profit" id="res-profit">0ì›</span></div>
                </div>
              </div>
            </div>
            <div style="text-align:center"><button class="fish-btn" id="fish-next-btn" onclick="fishNextDay()">â¡ï¸ ë‹¤ìŒ ë‚ </button></div>
          </div>
          <!-- 3ì¼ ê²°ì‚° -->
          <div class="fish-phase" id="fish-phase-summary">
            <div class="fish-summary" id="fish-summary">
              <h2>ğŸ“Š 3ì¼ ê²°ì‚°!</h2>
              <div class="summary-grid" id="summary-grid"></div>
              <div style="margin-top:16px">
                <button class="fish-btn restart" onclick="fishRestart()">ğŸ”„ ë‹¤ì‹œ ì¥ì‚¬í•˜ê¸°</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ì§€ê°‘ íƒˆì¶œ -->
      <div class="game-view wallet-view" id="wallet-view">
        <div class="wallet-area" id="wallet-area">
          <div class="wallet-header">
            <div class="wallet-money">ğŸ’° ìš©ëˆ: <span id="wallet-budget">3000</span>ì›</div>
            <div class="wallet-piggy"><span class="piggy-icon" id="piggy-icon"><svg class="piggy-svg" viewBox="0 0 60 50" xmlns="http://www.w3.org/2000/svg">
              <ellipse cx="30" cy="30" rx="22" ry="16" fill="#f9a8d4" stroke="#ec4899" stroke-width="1.5"/>
              <ellipse cx="14" cy="20" rx="6" ry="5" fill="#f9a8d4" stroke="#ec4899" stroke-width="1" class="piggy-ear" transform-origin="14 25"/>
              <ellipse cx="46" cy="20" rx="6" ry="5" fill="#f9a8d4" stroke="#ec4899" stroke-width="1" class="piggy-ear" transform-origin="46 25"/>
              <ellipse cx="22" cy="27" rx="3" ry="3" fill="#1e293b" class="piggy-eye-blink"/>
              <ellipse cx="38" cy="27" rx="3" ry="3" fill="#1e293b" class="piggy-eye-blink"/>
              <circle cx="23" cy="26" r="1" fill="#fff"/>
              <circle cx="39" cy="26" r="1" fill="#fff"/>
              <ellipse cx="30" cy="34" rx="7" ry="5" fill="#fb7185"/>
              <ellipse cx="27" cy="33" rx="1.5" ry="2" fill="#be185d"/>
              <ellipse cx="33" cy="33" rx="1.5" ry="2" fill="#be185d"/>
              <rect x="22" y="10" width="16" height="3" rx="1.5" fill="#fbbf24" stroke="#f59e0b" stroke-width=".5"/>
              <line x1="18" y1="44" x2="18" y2="48" stroke="#ec4899" stroke-width="2.5" stroke-linecap="round"/>
              <line x1="26" y1="44" x2="26" y2="48" stroke="#ec4899" stroke-width="2.5" stroke-linecap="round"/>
              <line x1="34" y1="44" x2="34" y2="48" stroke="#ec4899" stroke-width="2.5" stroke-linecap="round"/>
              <line x1="42" y1="44" x2="42" y2="48" stroke="#ec4899" stroke-width="2.5" stroke-linecap="round"/>
              <path d="M45,38 Q52,38 50,42" fill="none" stroke="#ec4899" stroke-width="2" stroke-linecap="round"/>
            </svg></span> ì €ê¸ˆí†µ: <span id="wallet-saved">0</span>ì›</div>
          </div>
          <div class="product-grid" id="product-grid"></div>
          <div class="cart-bar">
            <div class="cart-label">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ:</div>
            <div class="cart-items" id="cart-items"></div>
            <div class="cart-total">í•©ê³„: <span id="cart-total">0</span>ì›</div>
          </div>
          <div class="wallet-status" id="wallet-status"></div>
        </div>
      </div>

      <!-- ë¬¼ë¬¼êµí™˜ -->
      <div class="game-view trade-view" id="trade-view">
        <div class="trade-area" id="trade-area">
          <div class="trade-goal" id="trade-goal-text">ğŸ¯ ëª©í‘œ: ì¼€ì´í¬ ğŸ‚ë¥¼ êµ¬í•˜ì„¸ìš”!</div>
          <div class="trade-inventory" id="trade-inventory">
            <div class="trade-inv-label">ë‚´ ë¬¼ê±´:</div>
          </div>
          <div class="trade-table" id="trade-table"></div>
          <div class="trade-result" id="trade-result"></div>
        </div>
      </div>

      <!-- ë‚´ ê¸°ë¡ -->
      <div class="game-view record-view" id="record-view">
        <div class="records-area">
          <div class="record-card">
            <h3>ğŸ† ì¢…í•© ì„±ì </h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-total">0</div><div class="record-label">ì´ í™œë™</div></div>
              <div class="record-item"><div class="record-num" id="r-correct">0</div><div class="record-label">ì„±ê³µ</div></div>
              <div class="record-item"><div class="record-num" id="r-rate">0%</div><div class="record-label">ì„±ê³µë¥ </div></div>
            </div>
          </div>
          <div class="record-card">
            <h3>ğŸŸ ë¶•ì–´ë¹µ ì¥ì‚¬</h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-fish-games">0</div><div class="record-label">ì¥ì‚¬ íšŸìˆ˜</div></div>
              <div class="record-item"><div class="record-num" id="r-fish-profit">0</div><div class="record-label">ìµœê³  ìˆ˜ìµ</div></div>
              <div class="record-item"><div class="record-num" id="r-fish-sold">0</div><div class="record-label">ì´ íŒë§¤</div></div>
            </div>
          </div>
          <div class="record-card">
            <h3>ğŸ‘› ì§€ê°‘ íƒˆì¶œ</h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-wallet-games">0</div><div class="record-label">ë„ì „ íšŸìˆ˜</div></div>
              <div class="record-item"><div class="record-num" id="r-wallet-saved">0</div><div class="record-label">ìµœê³  ì €ê¸ˆ</div></div>
              <div class="record-item"><div class="record-num" id="r-wallet-streak">0</div><div class="record-label">ìµœê³  ì—°ì†</div></div>
            </div>
          </div>
          <div class="record-card">
            <h3>ğŸ”„ ë¬¼ë¬¼êµí™˜</h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-trade-games">0</div><div class="record-label">ë„ì „ íšŸìˆ˜</div></div>
              <div class="record-item"><div class="record-num" id="r-trade-success">0</div><div class="record-label">ì„±ê³µ</div></div>
              <div class="record-item"><div class="record-num" id="r-trade-trades">0</div><div class="record-label">ì´ êµí™˜</div></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ íŒ¨ë„ -->
    <div class="right-panel" id="right-panel">
      <button class="action-btn btn-cyan" id="act1" onclick="actionBtn(1)"><span class="icon">ğŸ’¡</span>íŒíŠ¸</button>
      <button class="action-btn btn-green" id="act2" onclick="actionBtn(2)"><span class="icon">ğŸ”„</span>ë‹¤ì‹œ</button>
      <button class="action-btn btn-red" id="act3" onclick="actionBtn(3)"><span class="icon">â­</span>ë‹¤ìŒ</button>
    </div>
  </div>
</div>

<!-- íˆì–´ë¡œ ê²Œì„: ë™ì „ ëŸ¬ì‹œ -->
<div id="hero-game" class="hero-game hidden">
  <div class="hg-header">
    <div class="hg-stat">ğŸ’° <span id="hg-money">0</span>ì›</div>
    <div class="hg-target">ğŸ¯ ëª©í‘œ: <span id="hg-target">500</span>ì›</div>
    <div class="hg-stat">ë ˆë²¨ <span id="hg-level">1</span></div>
    <div class="hg-hearts" id="hg-hearts">â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸</div>
    <div class="hg-ctrls">
      <button class="hg-ctrl-btn" onclick="hgPause()">â¸</button>
      <button class="hg-ctrl-btn" onclick="hgExit()">âœ•</button>
    </div>
  </div>
  <div class="hg-arena" id="hg-arena">
    <div class="hg-ground"></div>
    <div class="hg-wallet"><svg viewBox="0 0 120 100" xmlns="http://www.w3.org/2000/svg">
      <defs><linearGradient id="walletBody" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#a78bfa"/><stop offset="100%" stop-color="#7c3aed"/></linearGradient></defs>
      <rect x="10" y="30" width="100" height="60" rx="12" fill="url(#walletBody)" stroke="#6d28d9" stroke-width="2"/>
      <rect x="10" y="30" width="100" height="20" rx="10" fill="#c4b5fd"/>
      <path class="wallet-mouth" d="M25,30 Q50,35 75,30" fill="none" stroke="#4c1d95" stroke-width="3" stroke-linecap="round"/>
      <circle cx="90" cy="60" r="10" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
      <text x="90" y="64" text-anchor="middle" font-size="10" font-weight="900" fill="#92400e">$</text>
      <rect x="14" y="35" width="30" height="6" rx="3" fill="rgba(255,255,255,.3)"/>
      <circle cx="30" cy="75" r="3" fill="rgba(255,255,255,.2)"/>
      <circle cx="80" cy="75" r="2" fill="rgba(255,255,255,.15)"/>
    </svg></div>
  </div>
  <div id="hg-over" class="hg-overlay hidden">
    <div class="hg-overlay-box">
      <h2>ê²Œì„ ë!</h2>
      <div class="score">ğŸ’° <span id="hg-final-score">0</span>ì </div>
      <div class="msg" id="hg-over-msg">ì˜í–ˆì–´ìš”!</div>
      <button class="btn-retry" onclick="hgRestart()">ğŸ”„ ë‹¤ì‹œí•˜ê¸°</button>
      <button class="btn-exit" onclick="hgExit()">ğŸ  ëŒì•„ê°€ê¸°</button>
    </div>
  </div>
  <div id="hg-pause" class="hg-overlay hidden">
    <div class="hg-overlay-box">
      <h2>â¸ ì¼ì‹œì •ì§€</h2>
      <button class="btn-retry" onclick="hgPause()">â–¶ ê³„ì†í•˜ê¸°</button>
      <button class="btn-exit" onclick="hgExit()">ğŸ  ëŒì•„ê°€ê¸°</button>
    </div>
  </div>
</div>

<!-- ê´€ë¦¬ì ëª¨ë‹¬ -->
<div id="admin-modal" class="modal-overlay hidden">
  <div class="modal-box">
    <div class="modal-head"><h3>âš™ ì„¤ì •</h3><button class="modal-close" onclick="hideAdmin()">Ã—</button></div>
    <div class="modal-body">
      <div class="modal-section">
        <h4>ğŸ‘¤ í”„ë¡œí•„</h4>
        <input class="modal-input" id="adm-name" placeholder="ì´ë¦„ ì…ë ¥" maxlength="10">
        <button class="modal-btn" onclick="saveProfile()">ì €ì¥</button>
      </div>
      <div class="modal-section">
        <h4>ğŸ”„ ì´ˆê¸°í™”</h4>
        <button class="modal-btn" style="background:linear-gradient(145deg,#ef4444,#dc2626)" onclick="resetAll()">ì „ì²´ ì´ˆê¸°í™”</button>
      </div>
    </div>
  </div>
</div>

<!-- ìºë¦­í„° ëª¨ë‹¬ -->
<div id="char-modal" class="modal-overlay hidden">
  <div class="modal-box">
    <div class="modal-head"><h3>ğŸ­ ìºë¦­í„° ì„ íƒ</h3><button class="modal-close" onclick="hideCharModal()">Ã—</button></div>
    <div class="modal-body">
      <div class="char-grid" id="char-grid"></div>
    </div>
  </div>
</div>

<script>
// ===== ì „ì—­ ë³€ìˆ˜ =====
let currentTab = 'fish';
let soundEnabled = true;
const LS = localStorage;

// í”„ë¡œí•„
let profile = {
  name: LS.getItem('econName') || 'ê²½ì œì™•',
  char: LS.getItem('econChar') || 'ğŸ§’',
  totalCorrect: parseInt(LS.getItem('econCorrect')) || 0,
  totalPlayed: parseInt(LS.getItem('econPlayed')) || 0
};

// ë¶•ì–´ë¹µ ì¥ì‚¬ ìƒíƒœ
let fish = {
  day: 1, money: 5000, totalProfit: 0, totalSold: 0,
  ingredients: [], cost: 0, unitCost: 0, sellPrice: 500,
  dailyResults: [],
  games: parseInt(LS.getItem('fishGames')) || 0,
  bestProfit: parseInt(LS.getItem('fishBestProfit')) || 0,
  lifetimeSold: parseInt(LS.getItem('fishLifetimeSold')) || 0
};

// ì§€ê°‘ íƒˆì¶œ ìƒíƒœ
let wallet = {
  budget: 3000, spent: 0, saved: 0, cart: [], streak: 0,
  bestStreak: parseInt(LS.getItem('walletBestStreak')) || 0,
  bestSaved: parseInt(LS.getItem('walletBestSaved')) || 0,
  games: parseInt(LS.getItem('walletGames')) || 0
};

// ë¬¼ë¬¼êµí™˜ ìƒíƒœ
let trade = {
  inventory: {}, goal: '', goalEmoji: '', tradeCount: 0,
  success: parseInt(LS.getItem('tradeSuccess')) || 0,
  games: parseInt(LS.getItem('tradeGames')) || 0,
  lifetimeTrades: parseInt(LS.getItem('tradeTotalTrades')) || 0
};

// íˆì–´ë¡œ ê²Œì„ ìƒíƒœ
let hg = {
  money: 0, target: 500, lives: 5, level: 1, score: 0,
  running: false, paused: false,
  coins: [], spawnTimer: null, animId: null,
  combo: 0, cleared: 0, hasPiggy: false, hasCalc: false
};

// ===== TTS =====
let audioQueue = [];
let isSpeaking = false;
function speak(text) {
  if (!soundEnabled) return;
  audioQueue.push(text);
  processQueue();
}
function processQueue() {
  if (isSpeaking || !audioQueue.length) return;
  isSpeaking = true;
  const u = new SpeechSynthesisUtterance(audioQueue.shift());
  u.lang = 'ko-KR'; u.rate = 0.9; u.pitch = 1.1;
  u.onend = () => { isSpeaking = false; processQueue(); };
  u.onerror = () => { isSpeaking = false; processQueue(); };
  speechSynthesis.speak(u);
}
function toggleSound() {
  soundEnabled = !soundEnabled;
  document.getElementById('sb-sound').textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
  if (!soundEnabled) speechSynthesis.cancel();
}

// ===== í”„ë¡œí•„ =====
function updateProfile() {
  document.getElementById('pf-name').textContent = profile.name;
  document.getElementById('pf-char').textContent = profile.char;
  const lv = Math.floor(profile.totalCorrect / 10) + 1;
  document.getElementById('pf-level').textContent = lv;
  const prog = (profile.totalCorrect % 10);
  document.getElementById('pf-done').textContent = prog;
  document.getElementById('pf-total').textContent = 10;
  document.getElementById('pf-bar').style.width = (prog * 10) + '%';
}
function changeName() {
  const n = prompt('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', profile.name);
  if (n && n.trim()) { profile.name = n.trim(); LS.setItem('econName', profile.name); updateProfile(); }
}
function showCharModal() {
  document.getElementById('char-modal').classList.remove('hidden');
  const chars = ['ğŸ§’','ğŸ‘¦','ğŸ‘§','ğŸ¦¸â€â™‚ï¸','ğŸ¦¸â€â™€ï¸','ğŸ§™â€â™‚ï¸','ğŸ±','ğŸ¶','ğŸ¦Š','ğŸ»','ğŸ°','ğŸ¸','ğŸ¦','ğŸ¯','ğŸ¼'];
  const g = document.getElementById('char-grid');
  g.innerHTML = chars.map(c => `<div class="char-item${c===profile.char?' selected':''}" onclick="pickChar('${c}')">${c}</div>`).join('');
}
function hideCharModal() { document.getElementById('char-modal').classList.add('hidden'); }
function pickChar(c) { profile.char = c; LS.setItem('econChar', c); updateProfile(); hideCharModal(); }
function showAdmin() { document.getElementById('admin-modal').classList.remove('hidden'); document.getElementById('adm-name').value = profile.name; }
function hideAdmin() { document.getElementById('admin-modal').classList.add('hidden'); }
function saveProfile() {
  const n = document.getElementById('adm-name').value.trim();
  if (n) { profile.name = n; LS.setItem('econName', n); updateProfile(); }
  hideAdmin();
}
function resetAll() {
  if (!confirm('ëª¨ë“  ê¸°ë¡ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤. ì •ë§ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
  ['econName','econChar','econCorrect','econPlayed',
   'fishGames','fishBestProfit','fishLifetimeSold',
   'walletBestStreak','walletBestSaved','walletGames',
   'tradeSuccess','tradeGames','tradeTotalTrades'].forEach(k => LS.removeItem(k));
  location.reload();
}
function saveStats() {
  LS.setItem('econCorrect', profile.totalCorrect);
  LS.setItem('econPlayed', profile.totalPlayed);
  LS.setItem('fishGames', fish.games);
  LS.setItem('fishBestProfit', fish.bestProfit);
  LS.setItem('fishLifetimeSold', fish.lifetimeSold);
  LS.setItem('walletBestStreak', wallet.bestStreak);
  LS.setItem('walletBestSaved', wallet.bestSaved);
  LS.setItem('walletGames', wallet.games);
  LS.setItem('tradeSuccess', trade.success);
  LS.setItem('tradeGames', trade.games);
  LS.setItem('tradeTotalTrades', trade.lifetimeTrades);
}

// ===== íƒ­ ì „í™˜ =====
function switchTab(tab) {
  speechSynthesis.cancel();
  audioQueue = [];
  isSpeaking = false;
  currentTab = tab;
  document.querySelectorAll('.tab-btn').forEach((b, i) => {
    b.classList.toggle('active', ['fish','wallet','trade','record'][i] === tab);
  });
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelector('.' + tab + '-side').classList.add('active');
  document.querySelectorAll('.game-view').forEach(v => v.classList.remove('active'));
  document.querySelector('.' + tab + '-view').classList.add('active');
  updateActionButtons();
  if (tab === 'record') updateRecords();
}

function updateActionButtons() {
  const a1 = document.getElementById('act1');
  const a2 = document.getElementById('act2');
  const a3 = document.getElementById('act3');
  if (currentTab === 'fish') {
    a1.innerHTML = '<span class="icon">ğŸ’¡</span>íŒíŠ¸'; a1.className = 'action-btn btn-cyan'; a1.disabled = false;
    a2.innerHTML = '<span class="icon">ğŸ”„</span>ë‹¤ì‹œ'; a2.className = 'action-btn btn-green'; a2.disabled = false;
    a3.innerHTML = '<span class="icon">â­</span>ë‹¤ìŒ'; a3.className = 'action-btn btn-emerald'; a3.disabled = false;
  } else if (currentTab === 'wallet') {
    a1.innerHTML = '<span class="icon">âœ…</span>êµ¬ë§¤!'; a1.className = 'action-btn btn-green'; a1.disabled = false;
    a2.innerHTML = '<span class="icon">ğŸ—‘</span>ë¹„ìš°ê¸°'; a2.className = 'action-btn btn-red'; a2.disabled = false;
    a3.innerHTML = '<span class="icon">â­</span>ë‹¤ìŒ'; a3.className = 'action-btn btn-emerald'; a3.disabled = false;
  } else if (currentTab === 'trade') {
    a1.innerHTML = '<span class="icon">ğŸ’¡</span>íŒíŠ¸'; a1.className = 'action-btn btn-cyan'; a1.disabled = false;
    a2.innerHTML = '<span class="icon">ğŸ”„</span>ë‹¤ì‹œ'; a2.className = 'action-btn btn-green'; a2.disabled = false;
    a3.innerHTML = '<span class="icon">â­</span>ë‹¤ìŒ'; a3.className = 'action-btn btn-emerald'; a3.disabled = false;
  } else {
    a1.innerHTML = '<span class="icon">ğŸ“Š</span>ê¸°ë¡'; a1.className = 'action-btn btn-cyan'; a1.disabled = true;
    a2.innerHTML = '<span class="icon">â€”</span>â€”'; a2.className = 'action-btn btn-green'; a2.disabled = true;
    a3.innerHTML = '<span class="icon">â€”</span>â€”'; a3.className = 'action-btn btn-red'; a3.disabled = true;
  }
}

function actionBtn(n) {
  if (currentTab === 'fish') {
    if (n === 1) fishHint();
    else if (n === 2) fishRestart();
    else fishSkipDay();
  } else if (currentTab === 'wallet') {
    if (n === 1) walletConfirm();
    else if (n === 2) walletClearCart();
    else walletNewRound();
  } else if (currentTab === 'trade') {
    if (n === 1) tradeHint();
    else if (n === 2) initTradeGame();
    else initTradeGame();
  }
}

// ===== SVG í—¬í¼ =====
function weatherSVG(type) {
  const svgs = {
    'ë§‘ìŒ': `<svg viewBox="0 0 120 120" style="width:110px;height:110px"><circle cx="60" cy="60" r="28" fill="url(#sunGrad)"><animate attributeName="r" values="28;30;28" dur="2s" repeatCount="indefinite"/></circle>${[0,45,90,135,180,225,270,315].map(a=>`<line x1="60" y1="60" x2="${60+Math.cos(a*Math.PI/180)*46}" y2="${60+Math.sin(a*Math.PI/180)*46}" stroke="#fbbf24" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-width" values="4;6;4" dur="1.5s" begin="${a/360}s" repeatCount="indefinite"/></line>`).join('')}</svg>`,
    'íë¦¼': `<svg viewBox="0 0 120 120" style="width:110px;height:110px"><circle cx="45" cy="72" r="14" fill="#fbbf24" opacity=".6"/><line x1="45" y1="52" x2="45" y2="46" stroke="#fbbf24" stroke-width="3" stroke-linecap="round" opacity=".6"/><line x1="32" y1="60" x2="28" y2="56" stroke="#fbbf24" stroke-width="3" stroke-linecap="round" opacity=".6"/><ellipse cx="65" cy="65" rx="30" ry="18" fill="url(#cloudGrad)"/><ellipse cx="48" cy="58" rx="18" ry="14" fill="#cbd5e1"/><ellipse cx="78" cy="60" rx="16" ry="12" fill="#e2e8f0"/></svg>`,
    'ë¹„': `<svg viewBox="0 0 120 120" style="width:110px;height:110px"><ellipse cx="60" cy="42" rx="32" ry="18" fill="url(#cloudGrad)"/><ellipse cx="40" cy="36" rx="20" ry="14" fill="#94a3b8"/><ellipse cx="76" cy="38" rx="18" ry="12" fill="#cbd5e1"/>${[35,50,65,80].map((x,i)=>`<line x1="${x}" y1="65" x2="${x-5}" y2="85" stroke="url(#rainGrad)" stroke-width="2.5" stroke-linecap="round"><animate attributeName="y1" values="65;70;65" dur="0.8s" begin="${i*0.2}s" repeatCount="indefinite"/><animate attributeName="y2" values="85;92;85" dur="0.8s" begin="${i*0.2}s" repeatCount="indefinite"/></line>`).join('')}</svg>`,
    'ëˆˆ': `<svg viewBox="0 0 120 120" style="width:110px;height:110px"><ellipse cx="60" cy="38" rx="32" ry="18" fill="url(#snowGrad)"/><ellipse cx="40" cy="32" rx="20" ry="14" fill="#e0f2fe"/><ellipse cx="76" cy="34" rx="18" ry="12" fill="#bae6fd"/>${[30,50,70,90].map((x,i)=>`<text x="${x}" y="${75+i*5}" font-size="14" fill="#60a5fa" opacity=".8"><animate attributeName="y" values="${65+i*5};${95+i*5};${65+i*5}" dur="${1.5+i*0.3}s" repeatCount="indefinite"/><animate attributeName="opacity" values=".8;.3;.8" dur="${1.5+i*0.3}s" repeatCount="indefinite"/>â„</text>`).join('')}</svg>`,
    'í­í’': `<svg viewBox="0 0 120 120" style="width:110px;height:110px"><ellipse cx="60" cy="38" rx="34" ry="20" fill="url(#stormGrad)"/><ellipse cx="38" cy="32" rx="22" ry="16" fill="#4b5563"/><ellipse cx="78" cy="34" rx="18" ry="13" fill="#6b7280"/><polygon points="55,58 48,78 56,73 50,95 68,68 58,72 65,58" fill="#fbbf24"><animate attributeName="opacity" values="1;.4;1" dur=".3s" repeatCount="indefinite"/></polygon>${[35,80].map((x,i)=>`<line x1="${x}" y1="60" x2="${x-8}" y2="88" stroke="#60a5fa" stroke-width="2" stroke-linecap="round" opacity=".6"><animate attributeName="opacity" values=".6;0;.6" dur="0.6s" begin="${i*0.3}s" repeatCount="indefinite"/></line>`).join('')}</svg>`
  };
  return svgs[type] || `<span style="font-size:100px">${type}</span>`;
}

function tradeSvgArrow() {
  return `<svg class="trade-arrow-svg" viewBox="0 0 60 32" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="arrGr${Math.random().toString(36).slice(2,6)}" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stop-color="#f87171"/><stop offset="50%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#34d399"/></linearGradient></defs>
    <path d="M4,16 L44,16" stroke="url(#arrowGrad)" stroke-width="4" stroke-linecap="round"/>
    <polygon points="42,8 56,16 42,24" fill="#34d399"/>
    <circle cx="8" cy="16" r="3" fill="#f87171" opacity=".5"><animate attributeName="cx" values="8;38;8" dur="1.5s" repeatCount="indefinite"/></circle>
  </svg>`;
}

function svgFishGrill() {
  let slots = '';
  for(let r=0;r<2;r++) for(let c=0;c<3;c++){
    const x=30+c*145, y=20+r*85;
    slots += `<rect x="${x}" y="${y}" width="125" height="70" rx="8" fill="#78350f" stroke="#451a03" stroke-width="2"/>`;
    slots += `<ellipse cx="${x+62}" cy="${y+35}" rx="48" ry="25" fill="#d97706" opacity=".8"/>`;
    // ë¶•ì–´ë¹µ ëª¨ì–‘
    slots += `<path d="M${x+30},${y+20} Q${x+62},${y+8} ${x+94},${y+20} Q${x+100},${y+35} ${x+94},${y+50} Q${x+62},${y+62} ${x+30},${y+50} Q${x+24},${y+35} ${x+30},${y+20}Z" fill="#b45309" stroke="#92400e" stroke-width="1"/>`;
    slots += `<ellipse cx="${x+50}" cy="${y+32}" rx="4" ry="3" fill="#451a03" opacity=".6"/>`;
    // ì¦ê¸°
    slots += `<path d="M${x+55},${y+5} Q${x+58},${y-5} ${x+62},${y+2}" fill="none" stroke="rgba(255,255,255,.4)" stroke-width="2" stroke-linecap="round"><animate attributeName="opacity" values=".4;.1;.4" dur="${1.5+r*0.3}s" repeatCount="indefinite"/></path>`;
  }
  return `<svg class="fish-grill-svg" viewBox="0 0 480 195" xmlns="http://www.w3.org/2000/svg">
    <rect x="5" y="5" width="470" height="185" rx="14" fill="#292524" stroke="#78350f" stroke-width="4"/>
    <rect x="10" y="10" width="460" height="175" rx="10" fill="linear-gradient(145deg,#44403c,#292524)" opacity=".3"/>
    ${slots}
  </svg>`;
}

function coinRainEffect(container) {
  const overlay = document.createElement('div');
  overlay.className = 'fish-coin-rain';
  overlay.style.position = 'relative';
  container.style.position = 'relative';
  container.appendChild(overlay);
  for(let i=0;i<12;i++){
    const coin = document.createElement('div');
    coin.className = 'fish-flying-coin';
    coin.innerHTML = `<svg viewBox="0 0 30 30" width="30" height="30"><circle cx="15" cy="15" r="13" fill="url(#coinGold)" stroke="rgba(255,255,255,.5)" stroke-width="1.5"/><text x="15" y="19" text-anchor="middle" font-size="9" font-weight="900" fill="#fff">$</text></svg>`;
    coin.style.cssText = `left:${10+Math.random()*80}%;top:${30+Math.random()*40}%;--tx:${(Math.random()-.5)*120}px;--ty:${-80-Math.random()*120}px;animation-delay:${Math.random()*0.5}s`;
    overlay.appendChild(coin);
  }
  setTimeout(()=>overlay.remove(), 1800);
}

function spawnSparkleAt(container, x, y) {
  for(let i=0;i<5;i++){
    const sp = document.createElement('div');
    sp.className = 'sparkle-effect';
    sp.innerHTML = `<svg viewBox="0 0 20 20" width="20" height="20"><polygon points="10,0 12,7 20,7 14,12 16,20 10,15 4,20 6,12 0,7 8,7" fill="#fbbf24" opacity=".8"/></svg>`;
    const angle = (Math.PI*2/5)*i;
    const dist = 15+Math.random()*20;
    sp.style.cssText = `left:${x+Math.cos(angle)*dist}px;top:${y+Math.sin(angle)*dist}px;position:absolute;animation-delay:${i*0.05}s`;
    container.appendChild(sp);
    setTimeout(()=>sp.remove(), 600);
  }
}

// ===== ë¶•ì–´ë¹µ ì¥ì‚¬ =====
const INGREDIENTS = [
  { name: 'ë°€ê°€ë£¨', emoji: 'ğŸŒ¾', price: 500, desc: 'ë°˜ì£½ìš©' },
  { name: 'ì•™ê¸ˆ', emoji: 'ğŸ«˜', price: 800, desc: 'íŒ¥ì•™ê¸ˆ' },
  { name: 'ê°€ìŠ¤', emoji: 'ğŸ”¥', price: 300, desc: 'ë¶ˆì´ì•¼' },
  { name: 'ì„¤íƒ•', emoji: 'ğŸ¬', price: 200, desc: 'ë‹¬ì½¤' },
  { name: 'ë²„í„°', emoji: 'ğŸ§ˆ', price: 400, desc: 'ê³ ì†Œ' },
  { name: 'í¬ë¦¼', emoji: 'ğŸ¦', price: 600, desc: 'ìŠˆí¬ë¦¼' }
];

const WEATHERS = [
  { name: 'ë§‘ìŒ', emoji: 'â˜€ï¸', desc: 'ì†ë‹˜ì´ ë§ì´ ì™€ìš”!', multiplier: 1.5 },
  { name: 'íë¦¼', emoji: 'â›…', desc: 'ë³´í†µì´ì—ìš”', multiplier: 1.0 },
  { name: 'ë¹„', emoji: 'ğŸŒ§ï¸', desc: 'ì†ë‹˜ì´ ì ì–´ìš”...', multiplier: 0.5 },
  { name: 'ëˆˆ', emoji: 'â„ï¸', desc: 'ì¶”ì›Œì„œ ë¶•ì–´ë¹µ ì¸ê¸°!', multiplier: 1.8 },
  { name: 'í­í’', emoji: 'â›ˆï¸', desc: 'ì†ë‹˜ì´ ê±°ì˜ ì—†ì–´ìš”', multiplier: 0.3 }
];

function initFishGame() {
  fish.day = 1;
  fish.money = 5000;
  fish.totalProfit = 0;
  fish.totalSold = 0;
  fish.ingredients = [];
  fish.cost = 0;
  fish.dailyResults = [];
  showFishPhase('buy');
  renderShop();
  updateFishSide();
}

function showFishPhase(phase) {
  document.querySelectorAll('.fish-phase').forEach(p => p.classList.remove('active'));
  document.getElementById('fish-phase-' + phase).classList.add('active');
}

function renderShop() {
  const grid = document.getElementById('shop-grid');
  document.getElementById('fish-day-label').textContent = fish.day + 'ì¼ì°¨';
  document.getElementById('fish-budget-label').textContent = fish.money;
  fish.ingredients = [];
  fish.cost = 0;
  document.getElementById('fish-cost-label').textContent = 0;

  grid.innerHTML = INGREDIENTS.map((ing, i) =>
    `<div class="shop-item" id="shop-${i}" onclick="toggleIngredient(${i})">
      <div class="shop-emoji">${ing.emoji}</div>
      <div class="shop-name">${ing.name}</div>
      <div class="shop-price">${ing.price}ì›</div>
    </div>`
  ).join('');

  // ë¶•ì–´ë¹µ í‹€ SVG í‘œì‹œ
  let grillContainer = document.querySelector('.fish-grill-container');
  if(!grillContainer){
    grillContainer = document.createElement('div');
    grillContainer.className = 'fish-grill-container';
    const buyPhase = document.getElementById('fish-phase-buy');
    const titleEl = buyPhase.querySelector('.fish-title');
    titleEl.insertAdjacentElement('afterend', grillContainer);
  }
  grillContainer.innerHTML = svgFishGrill();
}

function toggleIngredient(idx) {
  const el = document.getElementById('shop-' + idx);
  const ing = INGREDIENTS[idx];
  const inList = fish.ingredients.indexOf(idx);
  if (inList >= 0) {
    fish.ingredients.splice(inList, 1);
    fish.cost -= ing.price;
    el.classList.remove('selected');
  } else {
    if (fish.cost + ing.price > fish.money) {
      speak('ëˆì´ ë¶€ì¡±í•´ìš”!');
      return;
    }
    fish.ingredients.push(idx);
    fish.cost += ing.price;
    el.classList.add('selected');
  }
  document.getElementById('fish-cost-label').textContent = fish.cost;
}

function fishBuyDone() {
  if (fish.ingredients.length < 2) {
    speak('ì¬ë£Œë¥¼ 2ê°œ ì´ìƒ ì‚¬ì•¼ í•´ìš”!');
    return;
  }
  // í•„ìˆ˜ì¬ë£Œ ì²´í¬: ë°€ê°€ë£¨(0) + ì•™ê¸ˆ(1) í•„ìˆ˜
  if (!fish.ingredients.includes(0) || !fish.ingredients.includes(1)) {
    speak('ë°€ê°€ë£¨ì™€ ì•™ê¸ˆì€ ê¼­ í•„ìš”í•´ìš”!');
    return;
  }

  fish.money -= fish.cost;
  // ì¬ë£Œ ê°œìˆ˜ë¡œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ë¶•ì–´ë¹µ ìˆ˜ ê²°ì • (10ê°œ ê¸°ë³¸ + ì¶”ê°€ ì¬ë£Œë‹¹ 2ê°œ)
  fish.unitCost = Math.round(fish.cost / (10 + (fish.ingredients.length - 2) * 2));
  document.getElementById('fish-unit-cost').textContent = fish.unitCost;

  // ì´ì „ ê°€ê²© ìœ ì§€
  document.getElementById('fish-price-slider').value = fish.sellPrice;
  document.getElementById('fish-price-label').textContent = fish.sellPrice;

  showFishPhase('price');
  speak('ì¬ë£Œë¥¼ ìƒ€ì–´ìš”! ì´ì œ ë¶•ì–´ë¹µ ê°€ê²©ì„ ì •í•´ë³¼ê¹Œìš”?');
}

function updatePriceLabel() {
  const val = document.getElementById('fish-price-slider').value;
  document.getElementById('fish-price-label').textContent = val;
}

function fishSetPrice() {
  fish.sellPrice = parseInt(document.getElementById('fish-price-slider').value);

  // ë‚ ì”¨ ê²°ì •
  const weather = WEATHERS[Math.floor(Math.random() * WEATHERS.length)];
  document.getElementById('weather-emoji').innerHTML = weatherSVG(weather.name);
  document.getElementById('weather-name').textContent = weather.name;
  document.getElementById('weather-desc').textContent = weather.desc;

  // ì†ë‹˜ ìˆ˜ ê³„ì‚°: ê°€ê²©ì´ ì‹¸ë©´ ì†ë‹˜ ë§ìŒ, ë¹„ì‹¸ë©´ ì ìŒ
  const priceRatio = fish.unitCost / fish.sellPrice; // ì›ê°€ ëŒ€ë¹„ íŒë§¤ê°€ ë¹„ìœ¨
  let baseCustomers;
  if (fish.sellPrice <= 300) baseCustomers = 12;
  else if (fish.sellPrice <= 500) baseCustomers = 10;
  else if (fish.sellPrice <= 800) baseCustomers = 7;
  else if (fish.sellPrice <= 1200) baseCustomers = 4;
  else baseCustomers = 2;

  const maxFish = 10 + (fish.ingredients.length - 2) * 2;
  let customers = Math.min(Math.round(baseCustomers * weather.multiplier), maxFish);
  customers = Math.max(1, customers + Math.floor(Math.random() * 3) - 1);

  const revenue = customers * fish.sellPrice;
  const dailyProfit = revenue - fish.cost;

  fish.totalSold += customers;
  fish.totalProfit += dailyProfit;
  fish.money += revenue;
  fish.lifetimeSold += customers;

  fish.dailyResults.push({ day: fish.day, weather: weather.name, customers, revenue, cost: fish.cost, profit: dailyProfit });

  document.getElementById('fish-sell-day').textContent = fish.day + 'ì¼ì°¨';
  document.getElementById('res-price').textContent = fish.sellPrice + 'ì›';
  document.getElementById('res-customers').textContent = customers + 'ëª…';
  document.getElementById('res-revenue').textContent = revenue + 'ì›';
  document.getElementById('res-cost').textContent = fish.cost + 'ì›';

  const profitEl = document.getElementById('res-profit');
  profitEl.textContent = (dailyProfit >= 0 ? '+' : '') + dailyProfit + 'ì›';
  profitEl.className = 'result-val ' + (dailyProfit >= 0 ? 'profit' : 'loss');

  document.getElementById('fish-next-btn').textContent = fish.day < 3 ? 'â¡ï¸ ë‹¤ìŒ ë‚ ' : 'ğŸ“Š ê²°ì‚° ë³´ê¸°';

  showFishPhase('sell');

  if (dailyProfit >= 0) {
    speak(`${customers}ëª…ì´ ì™”ì–´ìš”! ${dailyProfit}ì› ë²Œì—ˆì–´ìš”!`);
    // ë™ì „ ë‚ ë¦¬ê¸° ì´í™íŠ¸
    setTimeout(()=>{
      const sellResult = document.getElementById('sell-result');
      if(sellResult) coinRainEffect(sellResult);
    }, 300);
  } else {
    speak(`${customers}ëª…ë°–ì— ì•ˆ ì™”ì–´ìš”. ${Math.abs(dailyProfit)}ì› ì†í•´ì˜ˆìš”.`);
  }

  profile.totalPlayed++;
  if (dailyProfit > 0) profile.totalCorrect++;
  updateFishSide();
  updateProfile();
  saveStats();
}

function fishNextDay() {
  if (fish.day >= 3) {
    fishShowSummary();
    return;
  }
  fish.day++;
  showFishPhase('buy');
  renderShop();
  updateFishSide();
}

function fishShowSummary() {
  fish.games++;
  if (fish.totalProfit > fish.bestProfit) fish.bestProfit = fish.totalProfit;

  const grid = document.getElementById('summary-grid');
  grid.innerHTML = `
    <div class="summary-item"><div class="summary-num">${fish.totalSold}ê°œ</div><div class="summary-label">ì´ íŒë§¤</div></div>
    <div class="summary-item"><div class="summary-num">${fish.totalProfit >= 0 ? '+' : ''}${fish.totalProfit}ì›</div><div class="summary-label">ì´ ìˆ˜ìµ</div></div>
    <div class="summary-item"><div class="summary-num">${fish.money}ì›</div><div class="summary-label">ìµœì¢… ì†Œì§€ê¸ˆ</div></div>
  `;
  // ì¼ë³„ ìƒì„¸
  let details = '<div style="margin-top:16px;text-align:left">';
  fish.dailyResults.forEach(d => {
    details += `<div style="padding:8px 12px;margin:4px 0;background:rgba(255,255,255,.1);border-radius:8px;font-size:14px;color:#a7f3d0">
      ${d.day}ì¼ì°¨ ${d.weather} â€” ì†ë‹˜ ${d.customers}ëª…, ìˆ˜ìµ ${d.profit >= 0 ? '+' : ''}${d.profit}ì›
    </div>`;
  });
  details += '</div>';
  document.getElementById('fish-summary').querySelector('.summary-grid').insertAdjacentHTML('afterend', details);

  showFishPhase('summary');
  if (fish.totalProfit > 0) {
    speak(`3ì¼ ë™ì•ˆ ${fish.totalProfit}ì› ë²Œì—ˆì–´ìš”! ëŒ€ë‹¨í•œ ì‚¬ì¥ë‹˜!`);
  } else {
    speak(`ì´ëŸ°, ${Math.abs(fish.totalProfit)}ì› ì†í•´ë´¤ì–´ìš”. ë‹¤ìŒì— ì˜í•´ë´ìš”!`);
  }
  saveStats();
}

function fishRestart() {
  // summary ì•ˆì˜ ì¶”ê°€ details ì •ë¦¬
  const summary = document.getElementById('fish-summary');
  const extraDiv = summary.querySelector('.summary-grid + div');
  if (extraDiv) extraDiv.remove();
  initFishGame();
}

function fishHint() {
  const phase = document.querySelector('.fish-phase.active');
  if (phase.id === 'fish-phase-buy') {
    speak('ë°€ê°€ë£¨ì™€ ì•™ê¸ˆì€ ê¼­ ì‚¬ì•¼ í•´ìš”! ë‚˜ë¨¸ì§€ëŠ” ê³¨ë¼ë³´ì„¸ìš”.');
  } else if (phase.id === 'fish-phase-price') {
    speak(`ì¬ë£Œë¹„ê°€ ${fish.unitCost}ì›ì´ë‹ˆê¹Œ, ê·¸ë³´ë‹¤ ë¹„ì‹¸ê²Œ íŒ”ì•„ì•¼ ì´ìµì´ì—ìš”!`);
  } else {
    speak('ë‚ ì”¨ê°€ ì¢‹ìœ¼ë©´ ì†ë‹˜ì´ ë§ì•„ìš”!');
  }
}

function fishSkipDay() {
  const phase = document.querySelector('.fish-phase.active');
  if (phase.id === 'fish-phase-sell') {
    fishNextDay();
  }
}

function updateFishSide() {
  document.getElementById('fish-day').textContent = fish.day + 'ì¼ì°¨';
  document.getElementById('fish-money-side').textContent = fish.money + 'ì›';
  document.getElementById('fish-profit-side').textContent = fish.totalProfit + 'ì›';
  document.getElementById('fish-sold-side').textContent = fish.totalSold + 'ê°œ';
}

// ===== ì§€ê°‘ íƒˆì¶œ =====
const PRODUCTS = [
  { name: 'ì‚¬íƒ•', emoji: 'ğŸ¬', price: 200 },
  { name: 'ê³¼ì', emoji: 'ğŸª', price: 500 },
  { name: 'ì•„ì´ìŠ¤í¬ë¦¼', emoji: 'ğŸ¦', price: 800 },
  { name: 'ì¸í˜•', emoji: 'ğŸ§¸', price: 1500 },
  { name: 'ê³µ', emoji: 'âš½', price: 1000 },
  { name: 'ìƒ‰ì—°í•„', emoji: 'ğŸ–ï¸', price: 600 },
  { name: 'í’ì„ ', emoji: 'ğŸˆ', price: 300 },
  { name: 'ìŠ¤í‹°ì»¤', emoji: 'â­', price: 100 },
  { name: 'ìš”êµ¬ë¥´íŠ¸', emoji: 'ğŸ¥›', price: 400 },
  { name: 'ì ¤ë¦¬', emoji: 'ğŸ¡', price: 350 },
  { name: 'ë¡œë´‡', emoji: 'ğŸ¤–', price: 2000 },
  { name: 'ì£¼ìŠ¤', emoji: 'ğŸ§ƒ', price: 700 }
];

function initWalletGame() {
  // ìš©ëˆ ëœë¤: 2000, 3000, 5000 ì¤‘
  const budgets = [2000, 3000, 5000];
  wallet.budget = budgets[Math.floor(Math.random() * budgets.length)];
  wallet.spent = 0;
  wallet.saved = 0;
  wallet.cart = [];

  document.getElementById('wallet-budget').textContent = wallet.budget;
  document.getElementById('wallet-saved').textContent = 0;
  document.getElementById('cart-total').textContent = 0;
  document.getElementById('cart-items').innerHTML = '';
  document.getElementById('wallet-status').textContent = '';
  document.getElementById('wallet-status').style.background = '';

  // ìƒí’ˆ 8ê°œ ëœë¤ ì„ íƒ
  const shuffled = [...PRODUCTS].sort(() => Math.random() - 0.5).slice(0, 8);
  const grid = document.getElementById('product-grid');
  grid.innerHTML = shuffled.map((p, i) =>
    `<div class="product-item" id="prod-${i}" data-price="${p.price}" data-name="${p.name}" data-emoji="${p.emoji}" onclick="toggleProduct(${i})">
      <div class="product-emoji">${p.emoji}</div>
      <div class="product-name">${p.name}</div>
      <div class="product-price">${p.price}ì›</div>
    </div>`
  ).join('');

  updateWalletSide();
  speak(`ì˜¤ëŠ˜ ìš©ëˆì€ ${wallet.budget}ì›ì´ì—ìš”! ë­˜ ì‚¬ë³¼ê¹Œ?`);
}

function toggleProduct(idx) {
  const el = document.getElementById('prod-' + idx);
  const price = parseInt(el.dataset.price);
  const name = el.dataset.name;
  const emoji = el.dataset.emoji;

  const cartIdx = wallet.cart.findIndex(c => c.idx === idx);
  if (cartIdx >= 0) {
    // ì¥ë°”êµ¬ë‹ˆì—ì„œ ì œê±°
    wallet.cart.splice(cartIdx, 1);
    el.classList.remove('in-cart', 'over-budget');
  } else {
    // ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€
    wallet.cart.push({ idx, name, emoji, price });
    el.classList.add('in-cart');
    // ë°˜ì§ì´ ì´í™íŠ¸
    const rect = el.getBoundingClientRect();
    const area = document.getElementById('wallet-area');
    const areaRect = area.getBoundingClientRect();
    spawnSparkleAt(area, rect.left - areaRect.left + rect.width/2, rect.top - areaRect.top + rect.height/2);
  }

  updateCartDisplay();
}

function updateCartDisplay() {
  wallet.spent = wallet.cart.reduce((s, c) => s + c.price, 0);
  document.getElementById('cart-total').textContent = wallet.spent;
  document.getElementById('cart-items').innerHTML = wallet.cart.map(c =>
    `<div class="cart-item-tag" onclick="toggleProduct(${c.idx})">${c.emoji} ${c.price}ì›</div>`
  ).join('');

  // ì´ˆê³¼ ì‹œ í‘œì‹œ
  const status = document.getElementById('wallet-status');
  if (wallet.spent > wallet.budget) {
    status.textContent = 'ğŸ˜¢ ì§€ê°‘ì´ ìš¸ê³  ìˆì–´ìš”! ë­˜ ë¹¼ë³¼ê¹Œ?';
    status.style.background = 'linear-gradient(145deg,#fef2f2,#fecaca)';
    status.style.color = '#dc2626';
    // ì˜¤ë²„ ìƒíƒœ í‘œì‹œ
    wallet.cart.forEach(c => {
      document.getElementById('prod-' + c.idx).classList.add('over-budget');
    });
    // ìš¸ìŒ ì´í™íŠ¸
    spawnCryEffect();
  } else {
    status.textContent = wallet.spent > 0 ? `ë‚¨ëŠ” ëˆ: ${wallet.budget - wallet.spent}ì›` : '';
    status.style.background = wallet.spent > 0 ? 'linear-gradient(145deg,#ecfdf5,#d1fae5)' : '';
    status.style.color = '#059669';
    wallet.cart.forEach(c => {
      const el = document.getElementById('prod-' + c.idx);
      el.classList.remove('over-budget');
      el.classList.add('in-cart');
    });
  }

  updateWalletSide();
}

function spawnCryEffect() {
  const area = document.getElementById('wallet-area');
  const cry = document.createElement('div');
  cry.className = 'wallet-crying';
  cry.textContent = 'ğŸ’§';
  cry.style.cssText = `left:${50 + Math.random() * 200}px;top:${20 + Math.random() * 30}px`;
  area.appendChild(cry);
  setTimeout(() => cry.remove(), 1000);
}

function walletConfirm() {
  if (wallet.cart.length === 0) {
    speak('ì•„ë¬´ê²ƒë„ ì•ˆ ìƒ€ì–´ìš”! ë¬¼ê±´ì„ ê³¨ë¼ë³¼ê¹Œìš”?');
    return;
  }
  if (wallet.spent > wallet.budget) {
    speak('ëˆì´ ë¶€ì¡±í•´ìš”! ë­˜ ë¹¼ë³¼ê¹Œìš”?');
    return;
  }

  wallet.games++;
  wallet.saved = wallet.budget - wallet.spent;
  profile.totalPlayed++;
  profile.totalCorrect++;
  wallet.streak++;
  if (wallet.streak > wallet.bestStreak) wallet.bestStreak = wallet.streak;
  if (wallet.saved > wallet.bestSaved) wallet.bestSaved = wallet.saved;

  if (wallet.saved > 0) {
    piggyEffect();
    speak(`ì˜í–ˆì–´ìš”! ${wallet.saved}ì›ì„ ì €ê¸ˆí–ˆì–´ìš”! ë¼ì§€ì €ê¸ˆí†µì´ ê¸°ë»í•´ìš”!`);
  } else {
    speak('ë”± ë§ê²Œ ì¼ì–´ìš”!');
  }

  document.getElementById('wallet-status').textContent = `âœ… êµ¬ë§¤ ì™„ë£Œ! ${wallet.saved > 0 ? wallet.saved + 'ì› ì €ê¸ˆ!' : 'ë”± ë§ê²Œ ì¼ì–´ìš”!'}`;
  document.getElementById('wallet-status').style.background = 'linear-gradient(145deg,#ecfdf5,#d1fae5)';
  document.getElementById('wallet-status').style.color = '#059669';

  updateWalletSide();
  updateProfile();
  saveStats();
}

function piggyEffect() {
  const icon = document.getElementById('piggy-icon');
  icon.classList.add('bounce');
  setTimeout(() => icon.classList.remove('bounce'), 500);
  document.getElementById('wallet-saved').textContent = wallet.saved;

  // íŒŒí‹°í´
  const area = document.getElementById('wallet-area');
  const sparks = ['â­','âœ¨','ğŸª™','ğŸ’›'];
  for (let i = 0; i < 6; i++) {
    const p = document.createElement('div');
    p.className = 'piggy-particle';
    p.textContent = sparks[Math.floor(Math.random() * sparks.length)];
    const angle = (Math.PI * 2 / 6) * i;
    const dist = 30 + Math.random() * 40;
    p.style.cssText = `right:${80 + Math.random() * 40}px;top:${20 + Math.random() * 20}px;font-size:${18+Math.random()*12}px;--tx:${Math.cos(angle)*dist}px;--ty:${Math.sin(angle)*dist-20}px`;
    area.appendChild(p);
    setTimeout(() => p.remove(), 600);
  }
}

function walletClearCart() {
  wallet.cart.forEach(c => {
    const el = document.getElementById('prod-' + c.idx);
    if (el) el.classList.remove('in-cart', 'over-budget');
  });
  wallet.cart = [];
  updateCartDisplay();
}

function walletNewRound() {
  initWalletGame();
}

function updateWalletSide() {
  document.getElementById('wallet-budget-side').textContent = wallet.budget + 'ì›';
  document.getElementById('wallet-spent-side').textContent = wallet.spent + 'ì›';
  document.getElementById('wallet-saved-side').textContent = wallet.saved + 'ì›';
  document.getElementById('wallet-streak-side').textContent = wallet.streak;
}

// ===== ë¬¼ë¬¼êµí™˜ =====
const TRADE_ITEMS = [
  { name: 'ì‚¬ê³¼', emoji: 'ğŸ' },
  { name: 'ìƒì„ ', emoji: 'ğŸŸ' },
  { name: 'ë¹µ', emoji: 'ğŸ' },
  { name: 'ìš°ìœ ', emoji: 'ğŸ¥›' },
  { name: 'ë‹¬ê±€', emoji: 'ğŸ¥š' },
  { name: 'ê½ƒ', emoji: 'ğŸŒ¸' },
  { name: 'ë‚˜ë¬´', emoji: 'ğŸªµ' },
  { name: 'ì¼€ì´í¬', emoji: 'ğŸ‚' },
  { name: 'ì¥ë‚œê°', emoji: 'ğŸ§¸' },
  { name: 'ë³„ì‚¬íƒ•', emoji: 'â­' }
];

const TRADE_RECIPES = [
  // ê° ë ˆì‹œí”¼: { exchanges: [{give: {name, count}, receive: {name, count}}...], start: {name, count}, goal: name }
  {
    start: { name: 'ì‚¬ê³¼', emoji: 'ğŸ', count: 5 },
    goal: { name: 'ì¼€ì´í¬', emoji: 'ğŸ‚' },
    exchanges: [
      { give: { name: 'ì‚¬ê³¼', emoji: 'ğŸ', count: 3 }, receive: { name: 'ìš°ìœ ', emoji: 'ğŸ¥›', count: 1 } },
      { give: { name: 'ì‚¬ê³¼', emoji: 'ğŸ', count: 2 }, receive: { name: 'ë‹¬ê±€', emoji: 'ğŸ¥š', count: 2 } },
      { give: { name: 'ìš°ìœ ', emoji: 'ğŸ¥›', count: 1 }, receive: { name: 'ë¹µ', emoji: 'ğŸ', count: 2 } },
      { give: { name: 'ë‹¬ê±€', emoji: 'ğŸ¥š', count: 2 }, receive: { name: 'ë¹µ', emoji: 'ğŸ', count: 1 } },
      { give: { name: 'ë¹µ', emoji: 'ğŸ', count: 3 }, receive: { name: 'ì¼€ì´í¬', emoji: 'ğŸ‚', count: 1 } }
    ]
  },
  {
    start: { name: 'ìƒì„ ', emoji: 'ğŸŸ', count: 4 },
    goal: { name: 'ì¥ë‚œê°', emoji: 'ğŸ§¸' },
    exchanges: [
      { give: { name: 'ìƒì„ ', emoji: 'ğŸŸ', count: 2 }, receive: { name: 'ì‚¬ê³¼', emoji: 'ğŸ', count: 3 } },
      { give: { name: 'ìƒì„ ', emoji: 'ğŸŸ', count: 2 }, receive: { name: 'ê½ƒ', emoji: 'ğŸŒ¸', count: 2 } },
      { give: { name: 'ì‚¬ê³¼', emoji: 'ğŸ', count: 3 }, receive: { name: 'ë‚˜ë¬´', emoji: 'ğŸªµ', count: 2 } },
      { give: { name: 'ê½ƒ', emoji: 'ğŸŒ¸', count: 2 }, receive: { name: 'ë³„ì‚¬íƒ•', emoji: 'â­', count: 1 } },
      { give: { name: 'ë‚˜ë¬´', emoji: 'ğŸªµ', count: 2 }, receive: { name: 'ì¥ë‚œê°', emoji: 'ğŸ§¸', count: 1 } }
    ]
  },
  {
    start: { name: 'ê½ƒ', emoji: 'ğŸŒ¸', count: 6 },
    goal: { name: 'ë³„ì‚¬íƒ•', emoji: 'â­' },
    exchanges: [
      { give: { name: 'ê½ƒ', emoji: 'ğŸŒ¸', count: 3 }, receive: { name: 'ì‚¬ê³¼', emoji: 'ğŸ', count: 2 } },
      { give: { name: 'ê½ƒ', emoji: 'ğŸŒ¸', count: 2 }, receive: { name: 'ë¹µ', emoji: 'ğŸ', count: 1 } },
      { give: { name: 'ì‚¬ê³¼', emoji: 'ğŸ', count: 2 }, receive: { name: 'ë‹¬ê±€', emoji: 'ğŸ¥š', count: 3 } },
      { give: { name: 'ë¹µ', emoji: 'ğŸ', count: 1 }, receive: { name: 'ìš°ìœ ', emoji: 'ğŸ¥›', count: 1 } },
      { give: { name: 'ë‹¬ê±€', emoji: 'ğŸ¥š', count: 3 }, receive: { name: 'ë³„ì‚¬íƒ•', emoji: 'â­', count: 1 } },
      { give: { name: 'ìš°ìœ ', emoji: 'ğŸ¥›', count: 1 }, receive: { name: 'ë³„ì‚¬íƒ•', emoji: 'â­', count: 1 } }
    ]
  }
];

let currentRecipe = null;

function initTradeGame() {
  trade.tradeCount = 0;
  trade.inventory = {};

  // ëœë¤ ë ˆì‹œí”¼ ì„ íƒ
  currentRecipe = TRADE_RECIPES[Math.floor(Math.random() * TRADE_RECIPES.length)];

  // ì‹œì‘ ì•„ì´í…œ ì§€ê¸‰
  trade.inventory[currentRecipe.start.name] = { count: currentRecipe.start.count, emoji: currentRecipe.start.emoji };

  trade.games++;
  document.getElementById('trade-goal-text').textContent = `ğŸ¯ ëª©í‘œ: ${currentRecipe.goal.name} ${currentRecipe.goal.emoji}ë¥¼ êµ¬í•˜ì„¸ìš”!`;
  document.getElementById('trade-goal-side').textContent = currentRecipe.goal.emoji;
  document.getElementById('trade-result').textContent = '';
  document.getElementById('trade-result').style.background = '';

  renderTradeInventory();
  renderTradeTable();
  updateTradeSide();
  speak(`${currentRecipe.start.name} ${currentRecipe.start.count}ê°œë¡œ ì‹œì‘! ${currentRecipe.goal.name}ì„ êµ¬í•´ë³´ì„¸ìš”!`);
  saveStats();
}

function renderTradeInventory() {
  const inv = document.getElementById('trade-inventory');
  let html = '<div class="trade-inv-label">ë‚´ ë¬¼ê±´:</div>';
  for (const [name, data] of Object.entries(trade.inventory)) {
    if (data.count > 0) {
      html += `<div class="inv-item"><span class="inv-emoji">${data.emoji}</span> ${name} x${data.count}</div>`;
    }
  }
  if (Object.values(trade.inventory).every(d => d.count === 0)) {
    html += '<div style="color:#94a3b8;font-size:14px">ì•„ë¬´ê²ƒë„ ì—†ì–´ìš”...</div>';
  }
  inv.innerHTML = html;
}

function renderTradeTable() {
  const table = document.getElementById('trade-table');
  table.innerHTML = currentRecipe.exchanges.map((ex, i) => {
    const hasEnough = trade.inventory[ex.give.name] && trade.inventory[ex.give.name].count >= ex.give.count;
    return `<div class="trade-row${hasEnough ? '' : ' disabled'}" onclick="executeTrade(${i})">
      <div class="trade-give"><span class="trade-item-emoji">${ex.give.emoji}</span> ${ex.give.name} x${ex.give.count}</div>
      ${tradeSvgArrow()}
      <div class="trade-receive"><span class="trade-item-emoji">${ex.receive.emoji}</span> ${ex.receive.name} x${ex.receive.count}</div>
    </div>`;
  }).join('');
}

function executeTrade(idx) {
  const ex = currentRecipe.exchanges[idx];
  // ì•„ì´í…œ ì¶©ë¶„í•œì§€ í™•ì¸
  if (!trade.inventory[ex.give.name] || trade.inventory[ex.give.name].count < ex.give.count) {
    speak(`${ex.give.name}ì´ ë¶€ì¡±í•´ìš”!`);
    return;
  }

  // êµí™˜ ì‹¤í–‰
  trade.inventory[ex.give.name].count -= ex.give.count;
  if (!trade.inventory[ex.receive.name]) {
    trade.inventory[ex.receive.name] = { count: 0, emoji: ex.receive.emoji };
  }
  trade.inventory[ex.receive.name].count += ex.receive.count;

  trade.tradeCount++;
  trade.lifetimeTrades++;

  speak(`${ex.give.name} ${ex.give.count}ê°œë¥¼ ì£¼ê³  ${ex.receive.name} ${ex.receive.count}ê°œë¥¼ ë°›ì•˜ì–´ìš”!`);

  renderTradeInventory();
  renderTradeTable();
  updateTradeSide();

  // ëª©í‘œ ë‹¬ì„± ì²´í¬
  if (trade.inventory[currentRecipe.goal.name] && trade.inventory[currentRecipe.goal.name].count > 0) {
    tradeSuccess();
  }
}

function tradeSuccess() {
  trade.success++;
  profile.totalPlayed++;
  profile.totalCorrect++;

  const result = document.getElementById('trade-result');
  result.textContent = `ğŸ‰ ${currentRecipe.goal.name}ì„ êµ¬í–ˆì–´ìš”! ${trade.tradeCount}ë²ˆ êµí™˜í–ˆì–´ìš”!`;
  result.style.background = 'linear-gradient(145deg,#ecfdf5,#d1fae5)';
  result.style.color = '#059669';

  speak(`ëŒ€ë‹¨í•´ìš”! ${currentRecipe.goal.name}ì„ êµ¬í–ˆì–´ìš”! ëˆì´ ìˆìœ¼ë©´ ì´ë ‡ê²Œ ë³µì¡í•˜ê²Œ ì•ˆ í•´ë„ ë˜ê² ì£ ?`);

  // ì„±ê³µ ì´í™íŠ¸
  tradeSuccessEffect();

  updateTradeSide();
  updateProfile();
  saveStats();
}

function tradeSuccessEffect() {
  const area = document.getElementById('trade-area');
  const overlay = document.createElement('div');
  overlay.className = 'trade-success-overlay';
  area.appendChild(overlay);
  const colors = ['#10b981','#6ee7b7','#34d399','#fbbf24','#f59e0b','#3b82f6','#8b5cf6'];
  // ì»¨í˜í‹°
  for (let i = 0; i < 25; i++) {
    const c = document.createElement('div');
    c.className = 'trade-confetti';
    c.style.cssText = `left:${Math.random()*100}%;top:-10px;background:${colors[Math.floor(Math.random()*colors.length)]};--tx:${(Math.random()-.5)*200}px;--ty:${200+Math.random()*300}px;--dur:${.8+Math.random()*.6}s;animation-delay:${Math.random()*.3}s;width:${6+Math.random()*8}px;height:${6+Math.random()*8}px;border-radius:${Math.random()>.5?'50%':'2px'}`;
    overlay.appendChild(c);
  }
  // SVG ë³„ ë²„ìŠ¤íŠ¸
  for (let i = 0; i < 8; i++) {
    const star = document.createElement('div');
    star.className = 'trade-star-burst';
    const angle = (Math.PI*2/8)*i;
    const dist = 60+Math.random()*80;
    const size = 20+Math.random()*16;
    const col = colors[Math.floor(Math.random()*colors.length)];
    star.innerHTML = `<svg viewBox="0 0 24 24" width="${size}" height="${size}"><polygon points="12,0 15,8 24,8 17,14 19,24 12,18 5,24 7,14 0,8 9,8" fill="${col}"/></svg>`;
    star.style.cssText = `left:50%;top:50%;--tx:${Math.cos(angle)*dist}px;--ty:${Math.sin(angle)*dist}px;animation-delay:${i*0.05}s`;
    overlay.appendChild(star);
  }
  setTimeout(() => overlay.remove(), 1500);
}

function tradeHint() {
  // ê°€ëŠ¥í•œ êµí™˜ ì¤‘ ì²« ë²ˆì§¸ íŒíŠ¸
  for (const ex of currentRecipe.exchanges) {
    if (trade.inventory[ex.give.name] && trade.inventory[ex.give.name].count >= ex.give.count) {
      speak(`${ex.give.name}ì„ ${ex.receive.name}ìœ¼ë¡œ ë°”ê¿”ë³´ì„¸ìš”!`);
      return;
    }
  }
  speak('êµí™˜í•  ìˆ˜ ìˆëŠ” ê²Œ ì—†ì–´ìš”. ë‹¤ì‹œ ì‹œì‘í•´ë³¼ê¹Œìš”?');
}

function updateTradeSide() {
  document.getElementById('trade-count-side').textContent = trade.tradeCount;
  document.getElementById('trade-success-side').textContent = trade.success;
}

// ===== ë‚´ ê¸°ë¡ =====
function updateRecords() {
  document.getElementById('r-total').textContent = profile.totalPlayed;
  document.getElementById('r-correct').textContent = profile.totalCorrect;
  document.getElementById('r-rate').textContent = profile.totalPlayed ? Math.round(profile.totalCorrect / profile.totalPlayed * 100) + '%' : '0%';
  document.getElementById('rec-total-side').textContent = profile.totalPlayed;
  document.getElementById('rec-rate-side').textContent = profile.totalPlayed ? Math.round(profile.totalCorrect / profile.totalPlayed * 100) + '%' : '0%';
  document.getElementById('r-fish-games').textContent = fish.games;
  document.getElementById('r-fish-profit').textContent = fish.bestProfit + 'ì›';
  document.getElementById('r-fish-sold').textContent = fish.lifetimeSold;
  document.getElementById('r-wallet-games').textContent = wallet.games;
  document.getElementById('r-wallet-saved').textContent = wallet.bestSaved + 'ì›';
  document.getElementById('r-wallet-streak').textContent = wallet.bestStreak;
  document.getElementById('r-trade-games').textContent = trade.games;
  document.getElementById('r-trade-success').textContent = trade.success;
  document.getElementById('r-trade-trades').textContent = trade.lifetimeTrades;
}

// ===== íˆì–´ë¡œ: ë™ì „ ëŸ¬ì‹œ =====
const COIN_TYPES = [
  { value: 10, label: '10', cls: 'coin-10' },
  { value: 50, label: '50', cls: 'coin-50' },
  { value: 100, label: '100', cls: 'coin-100' },
  { value: 500, label: '500', cls: 'coin-500' }
];

function startHeroGame() {
  document.getElementById('hero-game').classList.remove('hidden');
  hg.money = 0; hg.lives = 5; hg.level = 1; hg.score = 0;
  hg.running = true; hg.paused = false;
  hg.coins = []; hg.combo = 0; hg.cleared = 0;
  hg.hasPiggy = false; hg.hasCalc = false;
  hg.target = generateTarget(1);
  updateHgUI();
  addHgClouds();
  hgLoop();
}

function generateTarget(level) {
  // ë ˆë²¨ì— ë”°ë¼ ëª©í‘œ ê¸ˆì•¡ ì¦ê°€
  const bases = [100, 200, 300, 500, 750, 1000, 1500, 2000];
  const base = bases[Math.min(level - 1, bases.length - 1)];
  // 50ì› ë‹¨ìœ„ë¡œ ë°˜ì˜¬ë¦¼
  return Math.round((base + Math.floor(Math.random() * base * 0.5)) / 50) * 50;
}

function addHgClouds() {
  const arena = document.getElementById('hg-arena');
  arena.querySelectorAll('.hg-cloud').forEach(c => c.remove());
  for (let i = 0; i < 5; i++) {
    const c = document.createElement('div');
    c.className = 'hg-cloud'; c.textContent = 'â˜ï¸';
    c.style.top = (Math.random() * 35) + '%';
    c.style.animationDelay = -(Math.random() * 20) + 's';
    c.style.fontSize = (28 + Math.random() * 28) + 'px';
    arena.appendChild(c);
  }
}

function hgLoop() {
  const interval = Math.max(800, 2500 - hg.level * 200);
  if (hg.spawnTimer) clearInterval(hg.spawnTimer);
  hg.spawnTimer = setInterval(() => {
    if (!hg.paused && hg.running) hgSpawn();
  }, interval);
  function tick() {
    if (!hg.running) return;
    if (!hg.paused) hgMove();
    hg.animId = requestAnimationFrame(tick);
  }
  hg.animId = requestAnimationFrame(tick);
}

function hgSpawn() {
  const arena = document.getElementById('hg-arena');
  const w = arena.offsetWidth;

  // 8% íŒŒì›Œì—…
  if (Math.random() < 0.08) { hgSpawnPower(); return; }
  // 12% ë¹š í­íƒ„
  if (Math.random() < 0.12) { hgSpawnDebt(); return; }

  // ì¼ë°˜ ë™ì „ (SVG)
  const coin = COIN_TYPES[Math.floor(Math.random() * COIN_TYPES.length)];
  const el = document.createElement('div');
  el.className = 'falling-coin';
  const gradId = coin.value === 10 ? 'coinCopper' : coin.value === 50 ? 'coinGold' : coin.value === 100 ? 'coinGreen' : 'coinGold';
  el.innerHTML = `<svg class="coin-svg" viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg">
    <circle cx="36" cy="36" r="33" fill="url(#${gradId})" stroke="rgba(255,255,255,.6)" stroke-width="3"/>
    <circle cx="36" cy="36" r="26" fill="none" stroke="rgba(255,255,255,.25)" stroke-width="1.5"/>
    <ellipse cx="26" cy="26" rx="12" ry="8" fill="rgba(255,255,255,.2)" transform="rotate(-30,26,26)"/>
    <text x="36" y="42" text-anchor="middle" font-size="${coin.value>=100?'14':'18'}" font-weight="900" fill="#fff" style="text-shadow:0 1px 3px rgba(0,0,0,.4)">${coin.label}</text>
  </svg>`;
  el.style.left = (Math.random() * (w - 70) + 10) + 'px';
  el.style.top = '-80px';
  el.style.pointerEvents = 'auto';
  el.onclick = (e) => { e.stopPropagation(); hgCollectCoin(coin.value, el); };
  arena.appendChild(el);

  const speed = 0.4 + hg.level * 0.06 + Math.random() * 0.15;
  const sway = (Math.random() - 0.5) * 1.2;
  hg.coins.push({ el, y: -80, x: parseFloat(el.style.left), speed, sway, value: coin.value, type: 'coin' });
}

function hgSpawnDebt() {
  const arena = document.getElementById('hg-arena');
  const w = arena.offsetWidth;
  const el = document.createElement('div');
  el.className = 'falling-coin';
  el.innerHTML = `<div class="coin-body coin-debt">ğŸ’€</div>`;
  el.style.left = (Math.random() * (w - 70) + 10) + 'px';
  el.style.top = '-80px';
  el.style.pointerEvents = 'auto';
  el.onclick = (e) => { e.stopPropagation(); hgHitDebt(el); };
  arena.appendChild(el);

  const speed = 0.5 + Math.random() * 0.2;
  hg.coins.push({ el, y: -80, x: parseFloat(el.style.left), speed, sway: 0, value: 0, type: 'debt' });
}

function hgSpawnPower() {
  const types = [
    { emoji: 'ğŸ·ï¸', fx: 'coupon', label: 'í• ì¸' },
    { emoji: 'ğŸ·', fx: 'piggy', label: 'ì €ê¸ˆ' },
    { emoji: 'ğŸ§®', fx: 'calc', label: 'ê³„ì‚°' }
  ];
  const t = types[Math.floor(Math.random() * types.length)];
  const arena = document.getElementById('hg-arena');
  const w = arena.offsetWidth;
  const el = document.createElement('div');
  el.className = 'falling-coin';
  el.innerHTML = `<div class="coin-body coin-powerup">${t.emoji}</div>`;
  el.style.left = (Math.random() * (w - 70) + 10) + 'px';
  el.style.top = '-80px';
  el.style.pointerEvents = 'auto';
  el.onclick = (e) => { e.stopPropagation(); hgPowerUp(t.fx, el); };
  arena.appendChild(el);

  const speed = 0.3 + Math.random() * 0.1;
  hg.coins.push({ el, y: -80, x: parseFloat(el.style.left), speed, sway: 0, value: 0, type: 'power', fx: t.fx });
}

function hgCollectCoin(value, el) {
  hg.money += value;

  // ìˆ˜ì§‘ ì´í™íŠ¸
  hgCollectEffect(el, '+' + value + 'ì›', '#059669');

  hg.coins = hg.coins.filter(c => c.el !== el);
  el.remove();

  // ëª©í‘œ ë‹¬ì„± ì²´í¬
  if (hg.money === hg.target) {
    hgRoundClear();
  } else if (hg.money > hg.target) {
    if (hg.hasPiggy) {
      // ë¼ì§€ì €ê¸ˆí†µ: ì´ˆê³¼ë¶„ ì €ì¶•
      const excess = hg.money - hg.target;
      hg.score += 2;
      speak('ë¼ì§€ì €ê¸ˆí†µì´ ì´ˆê³¼ë¶„ì„ ì €ì¶•í–ˆì–´ìš”!');
      hg.hasPiggy = false;
      hg.money = hg.target;
      hgRoundClear();
    } else {
      hgOverBudget();
    }
  }

  updateHgUI();
}

function hgHitDebt(el) {
  const loss = [50, 100, 200][Math.floor(Math.random() * 3)];
  hg.money = Math.max(0, hg.money - loss);

  hgCollectEffect(el, '-' + loss + 'ì›', '#ef4444');
  speak('ì•—! ë¹šì´ì—ìš”!');

  // ë¹¨ê°„ í”Œë˜ì‹œ
  const flash = document.createElement('div');
  flash.className = 'hg-miss-flash';
  document.getElementById('hg-arena').appendChild(flash);
  setTimeout(() => flash.remove(), 400);

  hg.coins = hg.coins.filter(c => c.el !== el);
  el.remove();
  updateHgUI();
}

function hgPowerUp(fx, el) {
  if (fx === 'coupon') {
    hg.target = Math.round(hg.target / 2 / 50) * 50;
    if (hg.target < 50) hg.target = 50;
    speak('í• ì¸ ì¿ í°! ëª©í‘œê°€ ì ˆë°˜ìœ¼ë¡œ!');
  } else if (fx === 'piggy') {
    hg.hasPiggy = true;
    speak('ë¼ì§€ì €ê¸ˆí†µ! ì´ˆê³¼í•´ë„ ê´œì°®ì•„ìš”!');
  } else if (fx === 'calc') {
    hg.hasCalc = true;
    speak(`ë‚¨ì€ ê¸ˆì•¡ì€ ${hg.target - hg.money}ì›ì´ì—ìš”!`);
    setTimeout(() => { hg.hasCalc = false; }, 5000);
  }

  hgCollectEffect(el, fx === 'coupon' ? 'ğŸ·ï¸' : fx === 'piggy' ? 'ğŸ·' : 'ğŸ§®', '#8b5cf6');
  hg.coins = hg.coins.filter(c => c.el !== el);
  el.remove();
  updateHgUI();
}

function hgCollectEffect(el, text, color) {
  const a = document.getElementById('hg-arena');
  const ce = document.createElement('div');
  ce.className = 'coin-collect';
  ce.textContent = text;
  ce.style.cssText = `left:${el.style.left};top:${el.style.top};color:${color}`;
  a.appendChild(ce);
  setTimeout(() => ce.remove(), 800);

  // ë°˜ì§ì´ íŒŒí‹°í´
  const sparks = ['âœ¨','â­','ğŸª™'];
  for (let i = 0; i < 4; i++) {
    const p = document.createElement('div');
    p.className = 'coin-burst';
    p.textContent = sparks[Math.floor(Math.random() * sparks.length)];
    const angle = (Math.PI * 2 / 4) * i;
    const dist = 25 + Math.random() * 30;
    p.style.cssText = `left:${parseFloat(el.style.left)+32}px;top:${parseFloat(el.style.top)+32}px;font-size:${16+Math.random()*10}px;--tx:${Math.cos(angle)*dist}px;--ty:${Math.sin(angle)*dist-15}px`;
    a.appendChild(p);
    setTimeout(() => p.remove(), 600);
  }
}

function hgRoundClear() {
  hg.combo++;
  hg.cleared++;
  const bonus = Math.min(hg.combo, 5);
  hg.score += 5 + bonus;

  if (hg.combo >= 3) {
    const a = document.getElementById('hg-arena');
    const ce = document.createElement('div');
    ce.textContent = `${hg.combo} COMBO!`;
    ce.style.cssText = 'position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:60px;font-weight:900;color:#059669;text-shadow:0 4px 8px rgba(0,0,0,.3);z-index:50;pointer-events:none;animation:comboPop 1s ease-out forwards';
    a.appendChild(ce);
    setTimeout(() => ce.remove(), 1000);
  }

  // ì´ˆë¡ í”Œë˜ì‹œ
  const flash = document.createElement('div');
  flash.className = 'hg-flash';
  document.getElementById('hg-arena').appendChild(flash);
  setTimeout(() => flash.remove(), 300);

  speak('ë”± ë§ì•˜ì–´ìš”!');

  // ë‹¤ìŒ ë¼ìš´ë“œ
  setTimeout(() => {
    hg.money = 0;
    const nl = Math.floor(hg.cleared / 3) + 1;
    if (nl > hg.level) { hg.level = nl; hgUpdateBg(); }
    hg.target = generateTarget(hg.level);
    hg.hasPiggy = false;
    hg.hasCalc = false;
    updateHgUI();
  }, 800);
}

function hgOverBudget() {
  hg.lives--;
  hg.combo = 0;
  speak('ê±°ìŠ¤ë¦„ëˆ ì—†ì–´ìš”!');

  // ë¹¨ê°„ í”Œë˜ì‹œ + í”ë“¤ë¦¼
  const a = document.getElementById('hg-arena');
  const flash = document.createElement('div');
  flash.className = 'hg-miss-flash';
  a.appendChild(flash);
  setTimeout(() => flash.remove(), 400);
  a.classList.add('hg-arena-shake');
  setTimeout(() => a.classList.remove('hg-arena-shake'), 400);

  updateHgUI();

  if (hg.lives <= 0) {
    hgEnd();
  } else {
    // ë¦¬ì…‹
    setTimeout(() => {
      hg.money = 0;
      hg.target = generateTarget(hg.level);
      hg.hasPiggy = false;
      hg.hasCalc = false;
      updateHgUI();
    }, 1000);
  }
}

function hgMove() {
  const arena = document.getElementById('hg-arena');
  const groundY = arena.offsetHeight * 0.90;
  const arenaW = arena.offsetWidth;
  hg.coins = hg.coins.filter(item => {
    item.y += item.speed;
    if (item.sway) {
      item.x += Math.sin(item.y / 80) * item.sway * 0.3;
      item.x = Math.max(5, Math.min(arenaW - 70, item.x));
      item.el.style.left = item.x + 'px';
    }
    item.el.style.top = item.y + 'px';
    if (item.y >= groundY) {
      item.el.remove();
      // ë™ì „ ë†“ì¹¨ì€ ë²Œì¹™ ì—†ìŒ (ë¹šë§Œ ìœ„í—˜)
      return false;
    }
    return true;
  });
}

function hgUpdateBg() {
  const bgs = [
    'linear-gradient(180deg,#ecfdf5 0%,#a7f3d0 25%,#6ee7b7 75%,#34d399 100%)',
    'linear-gradient(180deg,#fef3c7 0%,#fde68a 25%,#fbbf24 75%,#f59e0b 100%)',
    'linear-gradient(180deg,#dbeafe 0%,#93c5fd 25%,#60a5fa 75%,#3b82f6 100%)',
    'linear-gradient(180deg,#fce7f3 0%,#f9a8d4 25%,#f472b6 75%,#ec4899 100%)'
  ];
  document.getElementById('hero-game').style.background = bgs[(hg.level - 1) % bgs.length];
}

function updateHgUI() {
  document.getElementById('hg-money').textContent = hg.money;
  document.getElementById('hg-target').textContent = hg.target;
  document.getElementById('hg-level').textContent = hg.level;
  document.getElementById('hg-hearts').textContent = 'â¤ï¸'.repeat(hg.lives) + 'ğŸ–¤'.repeat(Math.max(0, 5 - hg.lives));

  // ê³„ì‚°ê¸° íŒŒì›Œì—…: ë‚¨ì€ ê¸ˆì•¡ í‘œì‹œ
  if (hg.hasCalc && hg.target > hg.money) {
    document.getElementById('hg-target').textContent = hg.target + ' (ë‚¨ì€:' + (hg.target - hg.money) + ')';
  }
}

function hgEnd() {
  hg.running = false;
  if (hg.spawnTimer) clearInterval(hg.spawnTimer);
  if (hg.animId) cancelAnimationFrame(hg.animId);
  hg.coins.forEach(c => c.el.remove());
  hg.coins = [];
  document.getElementById('hg-final-score').textContent = hg.score;
  let msg = 'ì˜í–ˆì–´ìš”!';
  if (hg.score >= 30) msg = 'ê²½ì œ ì²œì¬! ëŒ€ë‹¨í•´ìš”!';
  else if (hg.score >= 20) msg = 'ì™€! ì •ë§ ì˜í–ˆì–´ìš”!';
  else if (hg.score >= 10) msg = 'ë©‹ì ¸ìš”! ê³„ì† ì—°ìŠµ!';
  document.getElementById('hg-over-msg').textContent = msg;
  document.getElementById('hg-over').classList.remove('hidden');
  speak(msg);
}

function hgRestart() {
  document.getElementById('hg-over').classList.add('hidden');
  document.getElementById('hg-arena').querySelectorAll('.falling-coin,.coin-collect,.coin-burst').forEach(e => e.remove());
  hg.money = 0; hg.lives = 5; hg.level = 1; hg.score = 0;
  hg.running = true; hg.paused = false;
  hg.coins = []; hg.combo = 0; hg.cleared = 0;
  hg.hasPiggy = false; hg.hasCalc = false;
  hg.target = generateTarget(1);
  updateHgUI(); hgUpdateBg(); hgLoop();
}

function hgPause() {
  hg.paused = !hg.paused;
  document.getElementById('hg-pause').classList.toggle('hidden', !hg.paused);
}

function hgExit() {
  hg.running = false;
  if (hg.spawnTimer) clearInterval(hg.spawnTimer);
  if (hg.animId) cancelAnimationFrame(hg.animId);
  hg.coins.forEach(c => c.el.remove());
  hg.coins = [];
  document.getElementById('hg-over').classList.add('hidden');
  document.getElementById('hg-pause').classList.add('hidden');
  document.getElementById('hero-game').classList.add('hidden');
}

// ===== ì´ˆê¸°í™” =====
document.addEventListener('DOMContentLoaded', function() {
  // fitScale
  function fitScale() {
    const c = document.querySelector('.container');
    if (!c || getComputedStyle(c).display === 'none') return;
    const M = 0.03;
    const aW = window.innerWidth * (1 - M * 2);
    const aH = window.innerHeight * (1 - M * 2);
    const s = Math.min(aW / 1920, aH / 1080);
    c.style.transform = `scale(${s})`;
    c.style.left = ((window.innerWidth - 1920 * s) / 2) + 'px';
    c.style.top = ((window.innerHeight - 1080 * s) / 2) + 'px';
  }
  fitScale();
  window.addEventListener('resize', fitScale);
  if (window.visualViewport) window.visualViewport.addEventListener('resize', fitScale);

  // í”„ë¡œí•„
  updateProfile();
  updateActionButtons();

  // ê²Œì„ ì´ˆê¸°í™”
  initFishGame();
  initWalletGame();
  initTradeGame();
});

// ë”ë¸”íƒ­ ë°©ì§€
let lastTouchEnd = 0;
document.addEventListener('touchend', function(e) {
  const now = Date.now();
  if (now - lastTouchEnd <= 300) e.preventDefault();
  lastTouchEnd = now;
}, false);
</script>
</body>
</html>
