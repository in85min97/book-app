<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Ïà´Ïûê ÎÜÄÏù¥ÌÑ∞ üî¢</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;-webkit-user-select:none;user-select:none}
body{font-family:'Noto Sans KR',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:linear-gradient(135deg,#f97316 0%,#ea580c 50%,#c2410c 100%);margin:0;padding:0;width:100vw;height:100vh;height:100dvh;overflow:hidden;touch-action:manipulation}
.rotate-notice{display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:linear-gradient(135deg,#f97316,#ea580c);z-index:9999;flex-direction:column;align-items:center;justify-content:center;color:#fff;font-size:24px;font-weight:700;text-align:center;gap:20px}
.rotate-notice .rotate-icon{font-size:80px;animation:rotateH 2s ease-in-out infinite}
@keyframes rotateH{0%,100%{transform:rotate(0)}50%{transform:rotate(90deg)}}
@media(orientation:portrait){.rotate-notice{display:flex}.container{display:none!important}}
.container{width:1920px;height:1080px;background:#fff;border-radius:25px;box-shadow:0 25px 50px rgba(0,0,0,.12);display:flex;flex-direction:column;overflow:hidden;transform-origin:0 0;position:absolute}

/* Í≥ºÎ™©Î∞î */
.subject-bar{background:linear-gradient(135deg,#1e3a8a,#3b82f6);display:flex;align-items:center;padding:0 20px;height:56px;flex-shrink:0;gap:4px;position:relative}
.subject-bar::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:linear-gradient(90deg,#fbbf24,#f59e0b,#fbbf24)}
.sb-tab{padding:8px 30px;border:none;border-radius:12px 12px 0 0;background:0;font-size:18px;font-weight:800;color:rgba(255,255,255,.5);cursor:pointer;font-family:inherit;transition:.2s;display:flex;align-items:center;gap:8px;text-decoration:none}
.sb-tab.active{background:#fff;color:#1e3a8a}
.sb-tab.locked{cursor:default}
.sb-tab .lock{font-size:12px;opacity:.5}
.sb-spacer{flex:1}
.sb-btns{display:flex;gap:8px}
.sb-btn{background:rgba(255,255,255,.15);border:2px solid rgba(255,255,255,.2);border-radius:10px;padding:6px 14px;font-size:18px;color:#fff;cursor:pointer;transition:.15s}
.sb-btn:active{background:rgba(255,255,255,.3)}

/* Î©îÏù∏ */
.main-layout{display:grid;grid-template-columns:300px 1fr 300px;gap:14px;padding:14px;flex:1;overflow:hidden}

/* ÏôºÏ™Ω */
.left-panel{display:flex;flex-direction:column;gap:10px;overflow:hidden}
.profile-section{background:linear-gradient(145deg,#ea580c,#f97316 50%,#fbbf24);border-radius:20px;padding:20px;border:3px solid #fde68a;box-shadow:0 6px 20px rgba(249,115,22,.3);flex-shrink:0;position:relative;overflow:hidden}
.profile-section::before{content:'';position:absolute;inset:0;background:url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='15' cy='15' r='1.5' fill='white' opacity='.3'><animate attributeName='opacity' values='.3;.1;.3' dur='2s' repeatCount='indefinite'/></circle><circle cx='85' cy='25' r='1' fill='white' opacity='.25'><animate attributeName='opacity' values='.25;.08;.25' dur='1.5s' repeatCount='indefinite'/></circle><circle cx='25' cy='75' r='1.2' fill='white' opacity='.3'><animate attributeName='opacity' values='.3;.1;.3' dur='1.8s' repeatCount='indefinite'/></circle></svg>") repeat;pointer-events:none}
.profile-content{position:relative;z-index:1;display:flex;align-items:center;gap:15px}
.profile-avatar{width:90px;height:90px;background:linear-gradient(145deg,#fbbf24,#f59e0b);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:50px;border:3px solid #fff;box-shadow:0 4px 15px rgba(251,191,36,.4);animation:avGlow 3s ease-in-out infinite;flex-shrink:0;cursor:pointer}
@keyframes avGlow{0%,100%{box-shadow:0 4px 15px rgba(251,191,36,.4);transform:scale(1)}50%{box-shadow:0 8px 25px rgba(251,191,36,.6);transform:scale(1.05)}}
.profile-info{flex:1;color:#fff}
.profile-name{font-size:28px;font-weight:800;text-shadow:2px 2px 4px rgba(0,0,0,.3);margin-bottom:8px;cursor:pointer}
.profile-level-container{background:rgba(255,255,255,.2);border-radius:12px;padding:8px 12px}
.profile-level{font-size:22px;font-weight:700;color:#fde68a;display:flex;align-items:center;gap:8px}
.level-badge{background:linear-gradient(145deg,#fbbf24,#f59e0b);color:#92400e;padding:6px 14px;border-radius:8px;font-size:22px;font-weight:800;border:1px solid #fff}
.progress-bar{width:100%;height:6px;background:rgba(255,255,255,.3);border-radius:3px;margin-top:5px;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,#fbbf24,#f59e0b,#fbbf24);background-size:200% 100%;border-radius:3px;transition:width .5s;animation:pShine 2s linear infinite}
@keyframes pShine{0%{background-position:-200% 0}100%{background-position:200% 0}}

/* ÌÉ≠ */
.tab-headers{display:grid;grid-template-columns:1fr 1fr;gap:8px;flex-shrink:0}
.tab-btn{background:linear-gradient(180deg,#fff7ed,#ffedd5);border:3px solid #fed7aa;border-bottom:5px solid #fdba74;border-radius:14px;padding:8px;font-size:20px;font-weight:700;cursor:pointer;transition:.15s;color:#9a3412;display:flex;align-items:center;justify-content:center;height:62px;white-space:nowrap;font-family:inherit;box-shadow:0 3px 0 rgba(234,88,12,.15),0 4px 8px rgba(0,0,0,.06);text-shadow:0 1px 2px rgba(0,0,0,.08)}
.tab-btn.active{background:linear-gradient(180deg,#fb923c,#f97316);color:#fff;border-color:#ea580c;border-bottom-color:#c2410c;box-shadow:0 3px 0 #c2410c,0 4px 12px rgba(249,115,22,.3);text-shadow:0 2px 4px rgba(0,0,0,.2)}
.tab-btn:active{transform:translateY(3px);border-bottom-width:2px;box-shadow:0 1px 0 rgba(234,88,12,.15)}
.tab-content{display:none;flex:1;overflow:hidden}
.tab-content.active{display:flex;flex-direction:column}

/* ÏÇ¨Ïù¥Îìú Ï†ïÎ≥¥ */
.side-info{background:linear-gradient(145deg,#fff7ed,#ffedd5);border-radius:16px;padding:18px;border:2px solid rgba(249,115,22,.3);display:flex;flex-direction:column;gap:12px;height:100%;overflow:hidden;position:relative}
.side-info::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,#f97316,#fbbf24,#f97316);border-radius:16px 16px 0 0}
.side-title{font-size:24px;font-weight:700;color:#9a3412;text-align:center;flex-shrink:0}
.side-stat{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;background:linear-gradient(145deg,#fff,#fffbf5);border-radius:10px;font-size:20px;font-weight:600;color:#1e293b;border:1px solid rgba(249,115,22,.1);box-shadow:0 2px 4px rgba(0,0,0,.03)}
.side-val{font-size:32px;font-weight:900;color:#ea580c;text-shadow:0 1px 2px rgba(234,88,12,.2)}

/* Í≤åÏûÑ Îü∞Ïπò */
.game-launch-btn{flex-shrink:0;background:linear-gradient(180deg,#fcd34d,#fbbf24,#f59e0b);color:#78350f;border:3px solid #fff;border-bottom:6px solid #d97706;border-radius:16px;padding:18px;font-size:26px;font-weight:800;cursor:pointer;text-align:center;box-shadow:0 4px 0 #b45309,0 6px 16px rgba(251,191,36,.4);font-family:inherit;animation:gPulse 2s ease-in-out infinite;text-shadow:0 1px 2px rgba(0,0,0,.12);position:relative;overflow:hidden}
.game-launch-btn::after{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg,transparent 40%,rgba(255,255,255,.3) 50%,transparent 60%);animation:btnShine 3s linear infinite}
@keyframes btnShine{0%{transform:translateX(-100%) rotate(45deg)}100%{transform:translateX(100%) rotate(45deg)}}
@keyframes gPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.02)}}
.game-launch-btn:active{transform:translateY(4px);border-bottom-width:2px;box-shadow:0 1px 0 #b45309,0 2px 8px rgba(251,191,36,.3)}

/* Ï§ëÏïô */
.center-panel{display:flex;flex-direction:column;overflow:hidden;position:relative}
.game-view{display:none;flex-direction:column;flex:1;overflow:hidden}
.game-view.active{display:flex}

/* Ïà´ÏûêÌå®Îìú */
.numpad{display:grid;grid-template-columns:repeat(6,1fr);gap:10px;padding:14px;flex-shrink:0;background:linear-gradient(180deg,rgba(15,23,42,.6),rgba(15,23,42,.8));border-top:2px solid rgba(251,191,36,.15);border-radius:0 0 16px 16px}
.numpad-btn{background:linear-gradient(180deg,#fff,#f1f5f9);border:3px solid #e2e8f0;border-bottom:5px solid #cbd5e1;border-radius:14px;font-size:40px;font-weight:800;cursor:pointer;transition:all .12s;color:#1e293b;display:flex;align-items:center;justify-content:center;height:88px;box-shadow:0 3px 0 rgba(0,0,0,.08),0 4px 8px rgba(0,0,0,.05);font-family:inherit}
.numpad-btn:active{transform:translateY(3px);border-bottom-width:2px;box-shadow:0 1px 0 rgba(0,0,0,.08);background:linear-gradient(180deg,#fed7aa,#fdba74);border-color:#f97316;border-bottom-color:#ea580c}
.numpad-btn.correct{background:linear-gradient(145deg,#86efac,#4ade80)!important;border-color:#22c55e!important;color:#fff}
.numpad-btn.wrong{background:linear-gradient(145deg,#fca5a5,#f87171)!important;border-color:#ef4444!important;color:#fff;animation:shake .5s}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}}

/* Ìè≠ÌÉÑ Ìï¥Ï≤¥Î∞ò */
.bomb-area{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;gap:10px}
.bomb-container{position:relative;width:420px;height:440px}
.bomb-equation{position:absolute;top:55%;left:50%;transform:translate(-50%,-50%);font-size:52px;font-weight:900;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.5);z-index:2;pointer-events:none;text-align:center}
.bomb-info{font-size:26px;font-weight:700;color:#78350f;text-align:center;padding:12px 24px;background:linear-gradient(145deg,#fef3c7,#fde68a);border-radius:12px}
.bomb-result{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:96px;z-index:10;animation:resPop .8s ease-out forwards;pointer-events:none}
@keyframes resPop{0%{transform:translate(-50%,-50%) scale(0);opacity:0}50%{transform:translate(-50%,-50%) scale(1.3);opacity:1}100%{transform:translate(-50%,-50%) scale(1);opacity:0}}
.bomb-shaking .bomb-container{animation:bShake .3s ease-in-out 3}
@keyframes bShake{0%,100%{transform:translate(0)}25%{transform:translate(-5px,-3px)}75%{transform:translate(5px,3px)}}
/* Ìè≠Î∞ú Ïï†ÎãàÎ©îÏù¥ÏÖò */
.bomb-explode-overlay{position:absolute;inset:0;z-index:20;pointer-events:none;overflow:hidden;border-radius:16px}
.bomb-flash-white{position:absolute;inset:0;background:rgba(255,255,255,.9);animation:bFlashW .3s ease-out forwards}
@keyframes bFlashW{0%{opacity:1}100%{opacity:0}}
.bomb-flash-red{position:absolute;inset:0;background:rgba(239,68,68,.5);animation:bFlashR .6s ease-out forwards}
@keyframes bFlashR{0%{opacity:1}30%{opacity:.6}100%{opacity:0}}
.bomb-particle{position:absolute;border-radius:50%;pointer-events:none;animation:bParticle var(--dur,.8s) cubic-bezier(.25,.46,.45,.94) forwards}
@keyframes bParticle{0%{transform:translate(0,0) scale(1);opacity:1}100%{transform:translate(var(--tx,0),var(--ty,0)) scale(0);opacity:0}}
.bomb-smoke{position:absolute;border-radius:50%;background:rgba(100,116,139,.35);filter:blur(12px);pointer-events:none;animation:bSmoke 1.2s ease-out forwards}
@keyframes bSmoke{0%{transform:translate(0,0) scale(.5);opacity:.6}100%{transform:translate(var(--tx,0),var(--ty,-80px)) scale(2.5);opacity:0}}
.bomb-spark{position:absolute;width:3px;pointer-events:none;border-radius:2px;animation:bSpark var(--dur,.6s) ease-out forwards}
@keyframes bSpark{0%{transform:translate(0,0) rotate(var(--rot,0deg)) scaleY(1);opacity:1}100%{transform:translate(var(--tx,0),var(--ty,0)) rotate(var(--rot,0deg)) scaleY(0);opacity:0}}
.bomb-ring{position:absolute;border-radius:50%;border:4px solid rgba(251,191,36,.6);pointer-events:none;animation:bRing .8s ease-out forwards}
@keyframes bRing{0%{transform:translate(-50%,-50%) scale(0);opacity:1}100%{transform:translate(-50%,-50%) scale(1);opacity:0}}
.bomb-text-pop{position:absolute;font-size:52px;font-weight:900;color:#ef4444;text-shadow:0 4px 12px rgba(0,0,0,.3);pointer-events:none;animation:bTextPop 2s ease-out forwards;z-index:25;white-space:nowrap}
@keyframes bTextPop{0%{transform:translate(-50%,-50%) scale(0);opacity:0}15%{transform:translate(-50%,-50%) scale(1.3);opacity:1}30%{transform:translate(-50%,-50%) scale(1);opacity:1}80%{transform:translate(-50%,-80%) scale(1);opacity:1}100%{transform:translate(-50%,-120%) scale(.8);opacity:0}}
.bomb-shake-hard{animation:bShakeHard .5s ease-out}
@keyframes bShakeHard{0%,100%{transform:translate(0)}10%{transform:translate(-12px,-8px)}20%{transform:translate(10px,6px)}30%{transform:translate(-8px,10px)}40%{transform:translate(12px,-6px)}50%{transform:translate(-6px,8px)}60%{transform:translate(8px,-10px)}70%{transform:translate(-10px,4px)}80%{transform:translate(6px,-4px)}90%{transform:translate(-4px,6px)}}

/* Ìï¥Ï≤¥ ÏÑ±Í≥µ Ïï†ÎãàÎ©îÏù¥ÏÖò */
.bomb-defuse-overlay{position:absolute;inset:0;z-index:20;pointer-events:none;overflow:hidden;border-radius:16px}
.bomb-defuse-flash{position:absolute;inset:0;background:rgba(34,197,94,.35);animation:dFlash .4s ease-out forwards}
@keyframes dFlash{0%{opacity:1}100%{opacity:0}}
.bomb-star{position:absolute;pointer-events:none;animation:dStar var(--dur,.8s) ease-out forwards}
@keyframes dStar{0%{transform:translate(0,0) scale(0) rotate(0deg);opacity:0}30%{transform:translate(calc(var(--tx)*.3),calc(var(--ty)*.3)) scale(1.2) rotate(180deg);opacity:1}100%{transform:translate(var(--tx),var(--ty)) scale(0) rotate(360deg);opacity:0}}
.bomb-check{position:absolute;font-size:96px;pointer-events:none;z-index:25;animation:dCheck 1s ease-out forwards}
@keyframes dCheck{0%{transform:translate(-50%,-50%) scale(0) rotate(-30deg);opacity:0}30%{transform:translate(-50%,-50%) scale(1.3) rotate(10deg);opacity:1}50%{transform:translate(-50%,-50%) scale(1) rotate(0deg);opacity:1}100%{transform:translate(-50%,-70%) scale(.8) rotate(0deg);opacity:0}}

.bomb-input-display{font-size:72px;font-weight:900;color:#f97316;text-align:center;min-height:85px;display:flex;align-items:center;justify-content:center;background:linear-gradient(145deg,#fff,#f8fafc);border:3px solid #e2e8f0;border-radius:16px;padding:10px 36px;min-width:140px;box-shadow:inset 0 2px 4px rgba(0,0,0,.06)}
.bomb-input-display.empty{color:#cbd5e1;font-size:34px}
.bomb-start-screen{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px}
.bomb-start-btn{background:linear-gradient(145deg,#f97316,#ea580c);color:#fff;border:4px solid #fde68a;border-radius:24px;padding:28px 70px;font-size:42px;font-weight:900;cursor:pointer;font-family:inherit;box-shadow:0 8px 24px rgba(249,115,22,.4);animation:gPulse 2s ease-in-out infinite}
.bomb-start-btn:active{transform:scale(.95)}
.bomb-start-title{font-size:48px;font-weight:900;color:#1e293b}
.numpad-confirm{background:linear-gradient(145deg,#22c55e,#16a34a)!important;color:#fff!important;border-color:#22c55e!important;font-size:30px!important}
.numpad-clear{background:linear-gradient(145deg,#f87171,#ef4444)!important;color:#fff!important;border-color:#ef4444!important;font-size:30px!important}

/* Ïà´Ïûê Î®πÎ∞© */
.eating-area{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px}
.eating-char{width:260px;height:260px;position:relative}
.eating-speech{position:absolute;top:-40px;left:50%;transform:translateX(-50%);background:#fff;border:2px solid #e2e8f0;border-radius:16px;padding:10px 20px;font-size:24px;font-weight:700;color:#1e293b;white-space:nowrap;box-shadow:0 4px 12px rgba(0,0,0,.1);z-index:5}
.eating-speech::after{content:'';position:absolute;bottom:-8px;left:50%;transform:translateX(-50%);border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid #fff}
.eating-counter{font-size:62px;font-weight:900;color:#f97316}
.eating-counter span{font-size:30px;color:#94a3b8}
.food-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:18px;padding:16px;max-width:800px;width:100%}
.food-item{background:linear-gradient(145deg,#fff,#f8fafc);border:3px solid #e2e8f0;border-radius:20px;height:120px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:.15s;padding:6px 10px;gap:4px}
.food-label{font-size:14px;font-weight:700;color:#64748b;line-height:1}
.food-item.target-fruit{border-color:#f97316;background:linear-gradient(145deg,#fff7ed,#ffedd5)}
.food-item.wrong-eat{border-color:#ef4444!important;animation:wrongShake .3s ease-out}
.food-item:active{transform:scale(.9)}
.food-item.eaten{opacity:.25;border-color:#22c55e;pointer-events:none}
.eat-particle{position:absolute;pointer-events:none;z-index:10;animation:eatPop var(--dur,.6s) ease-out forwards}
@keyframes eatPop{0%{transform:translate(0,0) scale(1);opacity:1}100%{transform:translate(var(--tx,0),var(--ty,-40px)) scale(0);opacity:0}}
.eat-yum{position:absolute;pointer-events:none;z-index:15;font-size:36px;font-weight:900;animation:eatYum .8s ease-out forwards}
@keyframes eatYum{0%{transform:translate(-50%,0) scale(0);opacity:0}30%{transform:translate(-50%,-20px) scale(1.2);opacity:1}100%{transform:translate(-50%,-60px) scale(.6);opacity:0}}
.eat-success-overlay{position:absolute;inset:0;pointer-events:none;z-index:20;overflow:hidden}
.eat-confetti{position:absolute;width:8px;height:8px;border-radius:2px;pointer-events:none;animation:eatConfetti var(--dur,1s) ease-out forwards}
@keyframes eatConfetti{0%{transform:translate(0,0) rotate(0deg);opacity:1}100%{transform:translate(var(--tx,0),var(--ty,200px)) rotate(720deg);opacity:0}}

/* ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ */
/* ===== ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ (ÎØ∏ÎãàÎ©Ä Ïû¨ÎîîÏûêÏù∏) ===== */
.elevator-area{flex:1;display:flex;flex-direction:column;gap:8px;overflow:hidden}
.elev-question{font-size:32px;font-weight:800;color:#1e293b;background:linear-gradient(145deg,#fff7ed,#ffedd5);padding:16px 28px;border-radius:14px;border:3px solid #fb923c;text-align:center;flex-shrink:0}
.elev-main{flex:1;display:flex;gap:0;overflow:hidden;border-radius:16px;border:2px solid #e2e8f0;box-shadow:0 4px 20px rgba(0,0,0,.08)}
.building-shaft{flex:1;position:relative;overflow:hidden;background:linear-gradient(180deg,#fefce8 0%,#fffbeb 30%,#fff7ed 70%,#ffedd5 100%)}
.shaft-floor{position:absolute;left:0;right:0;height:10%;display:flex;align-items:center;overflow:hidden;border-bottom:1px solid rgba(0,0,0,.06);transition:all .3s}
.shaft-floor:first-child{border-top:none}
.sf-num{width:42px;font-size:20px;font-weight:900;text-align:center;flex-shrink:0;z-index:2;color:#92400e;margin-left:8px}
.sf-content{flex:1;display:flex;align-items:center;justify-content:center;gap:10px;font-size:20px;color:#44403c;font-weight:700;z-index:2}
.sf-emoji{font-size:36px;filter:drop-shadow(0 1px 3px rgba(0,0,0,.15));transition:transform .3s}
.shaft-floor.floor-highlight{background:rgba(249,115,22,.12)}
.shaft-floor.floor-highlight .sf-emoji{transform:scale(1.25);animation:emojiPulse .6s ease-in-out}
@keyframes emojiPulse{0%{transform:scale(1)}50%{transform:scale(1.35)}100%{transform:scale(1.25)}}
/* ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ Ïπ¥ ‚Äî ÍπîÎÅîÌïú ÌïòÏù¥ÎùºÏù¥Ìä∏ */
.elev-car{position:absolute;left:1%;right:1%;height:10%;z-index:10;transition:bottom .8s cubic-bezier(.34,1.56,.64,1);pointer-events:none;border:3px solid #f97316;border-radius:10px;background:rgba(249,115,22,.06);box-shadow:0 0 16px rgba(249,115,22,.25),inset 0 0 12px rgba(249,115,22,.04)}
.elev-car-light{position:absolute;top:4px;right:6px;width:10px;height:10px;background:#22c55e;border-radius:50%;box-shadow:0 0 8px #22c55e;z-index:2;transition:all .3s}
.elev-car.arriving{animation:carPulse .6s ease-out}
@keyframes carPulse{0%{box-shadow:0 0 16px rgba(249,115,22,.25)}50%{box-shadow:0 0 40px rgba(249,115,22,.6);border-color:#fbbf24}100%{box-shadow:0 0 16px rgba(249,115,22,.25)}}
/* Ìå®ÎÑê */
.elev-panel{width:170px;flex-shrink:0;background:linear-gradient(180deg,#f8fafc,#f1f5f9);display:flex;flex-direction:column;align-items:center;padding:14px 10px;gap:10px;border-left:2px solid #e2e8f0}
.elev-led{background:#fff;border:2px solid #fb923c;border-radius:12px;padding:10px 14px;width:110px;text-align:center;box-shadow:0 2px 8px rgba(249,115,22,.1)}
.elev-led-num{font-size:48px;font-weight:900;color:#ea580c;font-family:'Courier New',monospace;letter-spacing:2px;transition:color .3s}
.elev-led-label{font-size:13px;color:#9ca3af;font-weight:700;letter-spacing:1px;margin-top:2px}
.elev-dir{display:flex;gap:6px;width:100%;justify-content:center}
.elev-dir-ind{flex:1;padding:8px;text-align:center;font-size:20px;color:#9ca3af;background:#fff;border:2px solid #e5e7eb;border-radius:8px;font-weight:900;transition:all .3s}
.elev-dir-ind.active{color:#f97316;border-color:#f97316;background:#fff7ed;box-shadow:0 0 8px rgba(249,115,22,.2)}
.elev-btn-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;width:100%;justify-items:center}
.elev-btn{width:60px;height:60px;border-radius:14px;background:#fff;border:2px solid #d1d5db;color:#374151;font-size:24px;font-weight:900;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 4px rgba(0,0,0,.06);font-family:inherit;transition:all .15s}
.elev-btn:active{transform:scale(.9);box-shadow:none}
.elev-btn.current{background:linear-gradient(145deg,#f97316,#ea580c);border-color:#fbbf24;color:#fff;box-shadow:0 0 12px rgba(249,115,22,.3);animation:btnGlow 1.5s ease-in-out infinite}
@keyframes btnGlow{0%,100%{box-shadow:0 0 12px rgba(249,115,22,.3)}50%{box-shadow:0 0 20px rgba(249,115,22,.6)}}
.elev-btn.correct-floor{background:linear-gradient(145deg,#22c55e,#16a34a);border-color:#86efac;color:#fff;box-shadow:0 0 12px rgba(34,197,94,.3)}
.elev-ding{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:60px;pointer-events:none;z-index:20;animation:elevDing 1s ease-out forwards}
@keyframes elevDing{0%{transform:translate(-50%,-50%) scale(0);opacity:0}30%{transform:translate(-50%,-50%) scale(1.3);opacity:1}100%{transform:translate(-50%,-60%) scale(.8);opacity:0}}
.elev-arrive-particle{position:absolute;pointer-events:none;z-index:15;animation:elevPart var(--dur,.7s) ease-out forwards}
@keyframes elevPart{0%{transform:translate(0,0) scale(1);opacity:1}100%{transform:translate(var(--tx,0),var(--ty,-40px)) scale(0);opacity:0}}
.elev-arrive-ring{position:absolute;border-radius:50%;pointer-events:none;z-index:14;animation:elevRing .7s ease-out forwards}
@keyframes elevRing{0%{transform:translate(-50%,-50%) scale(0);opacity:.7}100%{transform:translate(-50%,-50%) scale(1);opacity:0}}
.elev-wrong-shake{animation:elevWrongShake .4s ease-out}
@keyframes elevWrongShake{0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(6px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}
.elev-result{font-size:28px;font-weight:700;text-align:center;padding:14px;border-radius:12px;flex-shrink:0;min-height:52px;transition:all .3s}

/* ÎÇ¥ Í∏∞Î°ù */
.records-area{flex:1;display:flex;flex-direction:column;gap:20px;padding:20px;overflow-y:auto}
.record-card{background:linear-gradient(145deg,#fff,#f8fafc);border:2px solid #e2e8f0;border-radius:16px;padding:22px;box-shadow:0 4px 12px rgba(0,0,0,.06)}
.record-card h3{font-size:24px;font-weight:800;color:#1e293b;margin-bottom:12px}
.record-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
.record-item{text-align:center;padding:16px;background:linear-gradient(145deg,#fff7ed,#ffedd5);border-radius:12px;border:2px solid #fed7aa}
.record-num{font-size:42px;font-weight:900;color:#f97316}
.record-label{font-size:17px;font-weight:600;color:#9a3412;margin-top:6px}

/* Ïò§Î•∏Ï™Ω */
.right-panel{display:flex;flex-direction:column;gap:12px;overflow:hidden;background:linear-gradient(180deg,rgba(249,115,22,.04),rgba(234,88,12,.08));border-radius:20px;padding:10px;border:2px solid rgba(249,115,22,.12);position:relative}
.action-btn{border:none;border-radius:20px;font-size:34px;font-weight:800;cursor:pointer;transition:all .15s;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;flex:1;min-height:70px;font-family:inherit;color:#fff;position:relative;border-bottom:6px solid rgba(0,0,0,.25);border-top:2px solid rgba(255,255,255,.3);box-shadow:0 6px 0 rgba(0,0,0,.12),0 8px 16px rgba(0,0,0,.08),inset 0 1px 0 rgba(255,255,255,.2);text-shadow:0 2px 4px rgba(0,0,0,.3)}
.action-btn .icon{font-size:58px;filter:drop-shadow(0 2px 4px rgba(0,0,0,.2))}
.action-btn:active{transform:translateY(4px);border-bottom-width:2px;box-shadow:0 2px 0 rgba(0,0,0,.12),0 2px 8px rgba(0,0,0,.08),inset 0 1px 0 rgba(255,255,255,.15)}
.action-btn.btn-orange{background:linear-gradient(180deg,#fb923c,#f97316 40%,#ea580c);border-bottom-color:#c2410c}
.action-btn.btn-cyan{background:linear-gradient(180deg,#22d3ee,#06b6d4 40%,#0891b2);border-bottom-color:#0e7490}
.action-btn.btn-red{background:linear-gradient(180deg,#fb7185,#f43f5e 40%,#e11d48);border-bottom-color:#be123c}
.action-btn.btn-green{background:linear-gradient(180deg,#34d399,#10b981 40%,#059669);border-bottom-color:#047857}
.action-btn:disabled{background:linear-gradient(180deg,#e5e7eb,#d1d5db)!important;color:#9ca3af;cursor:not-allowed;box-shadow:none!important;border-bottom-color:#9ca3af!important;border-top-color:transparent!important}

/* ÌûàÏñ¥Î°ú */
.hero-game{position:absolute;top:0;left:0;width:1920px;height:1080px;z-index:5000;display:flex;flex-direction:column;background:linear-gradient(180deg,#dbeafe 0%,#93c5fd 25%,#a7f3d0 75%,#6ee7b7 100%);overflow:hidden}
.hero-game.hidden{display:none}
.hg-header{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:rgba(255,255,255,.35);backdrop-filter:blur(12px);flex-shrink:0;z-index:10;border-bottom:2px solid rgba(255,255,255,.4)}
.hg-stat{font-size:28px;font-weight:800;color:#1e3a8a}
.hg-hearts{font-size:30px;letter-spacing:4px}
.hg-ctrls{display:flex;gap:8px}
.hg-ctrl-btn{background:rgba(255,255,255,.6);border:2px solid rgba(255,255,255,.8);border-radius:50%;width:52px;height:52px;font-size:22px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#475569}
.hg-ctrl-btn:active{transform:scale(.9)}
.hg-arena{flex:1;position:relative;overflow:hidden}
.hg-ground{position:absolute;bottom:0;left:0;right:0;height:10%;background:linear-gradient(180deg,#86efac,#4ade80);border-top:4px solid #34d399;border-radius:50% 50% 0 0/20px 20px 0 0}
.hg-numpad{display:flex;gap:6px;padding:10px 16px;background:rgba(255,255,255,.3);backdrop-filter:blur(8px);flex-shrink:0;justify-content:center;z-index:10}
.hg-num-btn{width:76px;height:76px;border-radius:50%;background:linear-gradient(145deg,#fff,#f1f5f9);border:3px solid #e2e8f0;font-size:36px;font-weight:900;color:#1e293b;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 3px 8px rgba(0,0,0,.1)}
.hg-num-btn:active{transform:scale(.9);background:linear-gradient(145deg,#fed7aa,#fdba74);border-color:#f97316}
.falling-bomb{position:absolute;z-index:5;pointer-events:none}
.ob-bomb{animation:bombSpin 3s linear infinite}
.ob-missile{animation:missileWobble 1.2s ease-in-out infinite}
@keyframes missileWobble{0%,100%{transform:rotate(-2deg)}50%{transform:rotate(2deg)}}
.ob-meteor{animation:meteorSpin 2s linear infinite;filter:drop-shadow(0 0 8px rgba(234,88,12,.5))}
@keyframes meteorSpin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
.ob-robot{animation:robotStep .8s ease-in-out infinite}
@keyframes robotStep{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}
.ob-ghost{animation:ghostDrift 2s ease-in-out infinite}
@keyframes ghostDrift{0%,100%{transform:translateX(0);opacity:.75}50%{transform:translateX(8px);opacity:.95}}
.ob-power{animation:powerGlow 1s ease-in-out infinite;pointer-events:auto;cursor:pointer}
@keyframes powerGlow{0%,100%{filter:drop-shadow(0 0 6px rgba(251,191,36,.4))}50%{filter:drop-shadow(0 0 14px rgba(251,191,36,.9))}}
@keyframes bombSpin{0%{transform:rotate(-5deg)}25%{transform:rotate(5deg)}50%{transform:rotate(-5deg)}75%{transform:rotate(3deg)}100%{transform:rotate(-5deg)}}
.fb-body{width:100px;height:100px;background:linear-gradient(145deg,#475569,#1e293b);border-radius:50%;display:flex;align-items:center;justify-content:center;border:3px solid #ef4444;box-shadow:0 4px 16px rgba(239,68,68,.4),0 0 20px rgba(239,68,68,.2)}
.fb-text{font-size:28px;font-weight:900;color:#fff;text-align:center;line-height:1.2}
.fb-fuse{width:4px;height:16px;background:#a16207;border-radius:2px;margin:0 auto;position:relative}
.fb-fuse::after{content:'';position:absolute;top:-8px;left:50%;transform:translateX(-50%);width:12px;height:12px;background:#fbbf24;border-radius:50%;animation:fGlow .3s infinite;box-shadow:0 0 12px #fbbf24,0 0 24px rgba(251,191,36,.5)}
@keyframes fGlow{0%,100%{opacity:.6;transform:translateX(-50%) scale(.7)}50%{opacity:1;transform:translateX(-50%) scale(1.3)}}
.hg-flash{position:absolute;inset:0;pointer-events:none;z-index:30;animation:screenFlash .3s ease-out forwards}
@keyframes screenFlash{0%{background:rgba(34,197,94,.3)}100%{background:transparent}}
.hg-miss-flash{position:absolute;inset:0;pointer-events:none;z-index:30;animation:missFlash .4s ease-out forwards}
@keyframes missFlash{0%{background:rgba(239,68,68,.3)}50%{background:rgba(239,68,68,.15)}100%{background:transparent}}
.hg-arena-shake{animation:arenaShake .4s ease-out}
@keyframes arenaShake{0%,100%{transform:translateX(0)}20%{transform:translateX(-8px)}40%{transform:translateX(8px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}
.char-explode{position:absolute;font-size:50px;pointer-events:none;z-index:20;animation:expl .8s ease-out forwards}
@keyframes expl{0%{transform:scale(0);opacity:0}30%{transform:scale(1.4);opacity:1}100%{transform:scale(.5);opacity:0}}
.star-burst{position:absolute;font-size:24px;pointer-events:none;z-index:20;animation:sburst .6s ease-out forwards}
@keyframes sburst{0%{transform:translateY(0) scale(1);opacity:1}100%{transform:translateY(-60px) scale(.3);opacity:0}}
@keyframes comboPop{0%{transform:translate(-50%,-50%) scale(0);opacity:0}30%{transform:translate(-50%,-50%) scale(1.2);opacity:1}100%{transform:translate(-50%,-50%) scale(.8);opacity:0}}
.hg-cloud{position:absolute;font-size:36px;opacity:.25;pointer-events:none;animation:cFloat 20s linear infinite;z-index:1}
@keyframes cFloat{0%{transform:translateX(-100px)}100%{transform:translateX(calc(100vw + 100px))}}
.hg-deco{position:absolute;pointer-events:none;z-index:1;opacity:0.08;animation:decoFloat var(--dur,6s) ease-in-out infinite}
@keyframes decoFloat{0%,100%{transform:translateY(0) rotate(0deg)}25%{transform:translateY(-15px) rotate(5deg)}50%{transform:translateY(-5px) rotate(-3deg)}75%{transform:translateY(-20px) rotate(4deg)}}
.hg-bg-sparkle{position:absolute;pointer-events:none;z-index:2;animation:bgSparkle var(--dur,3s) ease-in-out infinite}
@keyframes bgSparkle{0%,100%{transform:scale(.6);opacity:.3}50%{transform:scale(1.2);opacity:.8}}
.hg-overlay{position:absolute;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:100;backdrop-filter:blur(5px)}
.hg-overlay.hidden{display:none}
.hg-overlay-box{background:#fff;border-radius:24px;padding:48px;text-align:center;box-shadow:0 25px 50px rgba(0,0,0,.3);min-width:380px}
.hg-overlay-box h2{font-size:44px;font-weight:900;color:#1e293b;margin-bottom:14px}
.hg-overlay-box .score{font-size:34px;font-weight:700;color:#f97316;margin-bottom:10px}
.hg-overlay-box .msg{font-size:22px;color:#64748b;margin-bottom:24px}
.hg-overlay-box button{display:block;width:100%;padding:18px;border:none;border-radius:14px;font-size:22px;font-weight:800;cursor:pointer;margin-bottom:10px;font-family:inherit}
.hg-overlay-box .btn-retry{background:linear-gradient(145deg,#f97316,#ea580c);color:#fff}
.hg-overlay-box .btn-exit{background:linear-gradient(145deg,#e2e8f0,#cbd5e1);color:#475569}

/* Î™®Îã¨ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:6000;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(10px)}
.modal-overlay.hidden{display:none}
.modal-box{background:#fff;border-radius:20px;width:90%;max-width:500px;max-height:80vh;overflow-y:auto;box-shadow:0 25px 50px rgba(0,0,0,.3)}
.modal-head{background:linear-gradient(145deg,#f97316,#ea580c);color:#fff;padding:16px 20px;border-radius:20px 20px 0 0;display:flex;justify-content:space-between;align-items:center}
.modal-head h3{margin:0;font-size:18px}
.modal-close{background:0;border:0;color:#fff;font-size:24px;cursor:pointer}
.modal-body{padding:20px}
.modal-section{margin-bottom:16px;padding:14px;border-radius:10px;background:#f8fafc}
.modal-section h4{margin:0 0 10px;font-weight:700;color:#374151;font-size:15px}
.modal-input{width:100%;padding:10px;border:2px solid #e5e7eb;border-radius:8px;font-size:14px;box-sizing:border-box;margin-bottom:8px}
.modal-input:focus{outline:none;border-color:#f97316}
.modal-btn{padding:10px 16px;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;width:100%;background:linear-gradient(145deg,#f97316,#ea580c);color:#fff;margin-top:6px}
.char-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(70px,1fr));gap:12px}
.char-item{background:linear-gradient(145deg,#f8fafc,#e2e8f0);border:2px solid #cbd5e1;border-radius:14px;padding:12px;text-align:center;cursor:pointer;font-size:32px;height:70px;display:flex;align-items:center;justify-content:center;transition:.2s}
.char-item.selected{background:linear-gradient(145deg,#fbbf24,#f59e0b);border-color:#f59e0b}

/* ===== Î∞∞Í≤Ω Ïî¨ ===== */
.bomb-view{background:linear-gradient(180deg,#1a1a2e 0%,#16213e 50%,#0f3460 100%);border-radius:16px;overflow:hidden;position:relative}
.bomb-view::before{content:'';position:absolute;inset:0;background:url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 900'><defs><pattern id='g' width='60' height='60' patternUnits='userSpaceOnUse'><path d='M60 0V60H0' fill='none' stroke='rgba(249,115,22,.06)' stroke-width='1'/></pattern></defs><rect width='1200' height='900' fill='url(%23g)'/><rect x='30' y='30' width='140' height='90' rx='8' fill='none' stroke='rgba(249,115,22,.15)' stroke-width='2'/><rect x='35' y='35' width='130' height='50' rx='4' fill='rgba(34,197,94,.03)'/><line x1='40' y1='50' x2='80' y2='50' stroke='rgba(34,197,94,.2)' stroke-width='2'><animate attributeName='x2' values='40;120;40' dur='3s' repeatCount='indefinite'/></line><line x1='40' y1='62' x2='100' y2='62' stroke='rgba(34,197,94,.12)' stroke-width='1.5'><animate attributeName='x2' values='60;140;60' dur='4s' repeatCount='indefinite'/></line><rect x='1030' y='30' width='140' height='90' rx='8' fill='none' stroke='rgba(249,115,22,.15)' stroke-width='2'/><circle cx='1100' cy='60' r='15' fill='none' stroke='rgba(249,115,22,.15)' stroke-width='1.5'><animate attributeName='r' values='10;20;10' dur='2s' repeatCount='indefinite'/><animate attributeName='opacity' values='.3;.08;.3' dur='2s' repeatCount='indefinite'/></circle><path d='M0 800Q150 775 300 810Q450 840 600 800Q750 770 900 810Q1050 840 1200 800' fill='none' stroke='rgba(239,68,68,.1)' stroke-width='3'/><path d='M0 830Q200 800 400 840Q600 860 800 820Q1000 790 1200 830' fill='none' stroke='rgba(251,191,36,.08)' stroke-width='2'/><circle cx='50' cy='850' r='4' fill='%23ef4444' opacity='.5'><animate attributeName='opacity' values='.2;.7;.2' dur='1s' repeatCount='indefinite'/></circle><circle cx='1150' cy='855' r='4' fill='%23ef4444' opacity='.4'><animate attributeName='opacity' values='.4;.1;.4' dur='1.3s' repeatCount='indefinite'/></circle><circle cx='80' cy='840' r='3' fill='%23fbbf24' opacity='.3'><animate attributeName='opacity' values='.3;.08;.3' dur='1.5s' repeatCount='indefinite'/></circle></svg>") no-repeat center/cover;pointer-events:none;z-index:0}
.bomb-view .bomb-start-screen,.bomb-view #bomb-game-screen{position:relative;z-index:1}
.bomb-start-title{font-size:48px;font-weight:900;color:#fff!important;text-shadow:0 4px 12px rgba(0,0,0,.4)}
.bomb-view .bomb-start-screen>div:nth-child(2){color:#94a3b8!important}
.bomb-info{background:linear-gradient(145deg,rgba(251,191,36,.2),rgba(249,115,22,.15))!important;color:#fde68a!important;border:2px solid rgba(251,191,36,.3);backdrop-filter:blur(4px)}
.bomb-input-display{background:linear-gradient(145deg,rgba(255,255,255,.08),rgba(255,255,255,.04))!important;border-color:rgba(251,191,36,.3)!important;color:#fbbf24!important;box-shadow:inset 0 2px 4px rgba(0,0,0,.2),0 0 20px rgba(251,191,36,.1)!important}
.bomb-input-display.empty{color:rgba(148,163,184,.5)!important}
.bomb-start-btn{border-bottom:6px solid #9a3412;box-shadow:0 4px 0 #9a3412,0 8px 24px rgba(249,115,22,.5)!important}
.bomb-start-btn:active{transform:translateY(4px)!important;border-bottom-width:2px;box-shadow:0 1px 0 #9a3412,0 2px 8px rgba(249,115,22,.3)!important}

.eat-view{background:linear-gradient(180deg,#fef7ed 0%,#fff7ed 40%,#fce7c8 100%);border-radius:16px;overflow:hidden;position:relative}
.eat-view::before{content:'';position:absolute;inset:0;background:url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 900'><defs><pattern id='ck2' width='40' height='40' patternUnits='userSpaceOnUse'><rect width='20' height='20' fill='rgba(249,115,22,.06)'/><rect x='20' y='20' width='20' height='20' fill='rgba(249,115,22,.06)'/></pattern></defs><rect y='620' width='1200' height='280' fill='url(%23ck2)'/><rect y='600' width='1200' height='24' rx='4' fill='rgba(180,120,60,.12)'/><rect y='594' width='1200' height='8' rx='3' fill='rgba(180,120,60,.08)'/><rect x='0' y='620' width='1200' height='6' fill='rgba(0,0,0,.04)'/><line x1='40' y1='110' x2='220' y2='110' stroke='rgba(160,100,50,.15)' stroke-width='5' stroke-linecap='round'/><rect x='50' y='72' width='30' height='38' rx='5' fill='rgba(249,115,22,.08)'/><rect x='90' y='60' width='22' height='50' rx='4' fill='rgba(239,68,68,.07)'/><circle cx='130' cy='90' r='14' fill='rgba(251,191,36,.07)'/><rect x='160' y='78' width='18' height='32' rx='3' fill='rgba(34,197,94,.06)'/><line x1='980' y1='110' x2='1160' y2='110' stroke='rgba(160,100,50,.15)' stroke-width='5' stroke-linecap='round'/><rect x='1000' y='65' width='28' height='45' rx='5' fill='rgba(168,85,247,.07)'/><circle cx='1050' cy='88' r='12' fill='rgba(59,130,246,.06)'/><rect x='1080' y='72' width='24' height='38' rx='4' fill='rgba(251,146,60,.07)'/><rect x='1120' y='80' width='20' height='30' rx='3' fill='rgba(34,197,94,.06)'/><rect x='50' y='30' width='120' height='60' rx='4' fill='rgba(135,206,250,.06)' stroke='rgba(135,206,250,.1)' stroke-width='2'/><path d='M50 30Q60 10 80 25' fill='rgba(255,200,150,.06)'/><path d='M170 30Q160 10 140 25' fill='rgba(255,200,150,.06)'/><rect x='1030' y='30' width='120' height='60' rx='4' fill='rgba(135,206,250,.06)' stroke='rgba(135,206,250,.1)' stroke-width='2'/><path d='M1030 30Q1040 10 1060 25' fill='rgba(255,200,150,.06)'/><path d='M1150 30Q1140 10 1120 25' fill='rgba(255,200,150,.06)'/><ellipse cx='400' cy='750' rx='60' ry='6' fill='rgba(180,120,60,.06)'/><circle cx='400' cy='748' r='40' fill='none' stroke='rgba(180,120,60,.06)' stroke-width='2'/><ellipse cx='800' cy='760' rx='55' ry='5' fill='rgba(180,120,60,.05)'/><circle cx='800' cy='758' r='38' fill='none' stroke='rgba(180,120,60,.05)' stroke-width='2'/><path d='M280 700Q290 680 300 700' fill='none' stroke='rgba(249,115,22,.06)' stroke-width='2'><animate attributeName='d' values='M280 700Q290 680 300 700;M280 695Q290 670 300 695;M280 700Q290 680 300 700' dur='3s' repeatCount='indefinite'/></path><path d='M900 690Q910 670 920 690' fill='none' stroke='rgba(249,115,22,.05)' stroke-width='2'><animate attributeName='d' values='M900 690Q910 670 920 690;M900 685Q910 660 920 685;M900 690Q910 670 920 690' dur='3.5s' repeatCount='indefinite'/></path><path d='M580 720Q590 695 600 720' fill='none' stroke='rgba(249,115,22,.04)' stroke-width='1.5'><animate attributeName='d' values='M580 720Q590 695 600 720;M580 715Q590 688 600 715;M580 720Q590 695 600 720' dur='4s' repeatCount='indefinite'/></path></svg>") no-repeat center/cover;pointer-events:none;z-index:0}
.eat-view .eating-area{position:relative;z-index:1}
.food-grid{background:radial-gradient(ellipse at center,rgba(255,255,255,.5) 0%,rgba(255,247,237,.2) 60%,transparent 80%);border-radius:24px;padding:20px!important;border:2px solid rgba(249,115,22,.08)}
.food-item{border-bottom:4px solid #cbd5e1;box-shadow:0 3px 0 rgba(0,0,0,.06),0 4px 8px rgba(0,0,0,.04)}
.food-item:active{transform:translateY(2px) scale(.95)!important;border-bottom-width:2px}

.record-view{background:linear-gradient(180deg,#fffbeb 0%,#fef3c7 40%,#fde68a80 100%);border-radius:16px;overflow:hidden;position:relative}
.record-view::before{content:'';position:absolute;inset:0;background:url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 900'><defs><linearGradient id='rBg' x1='0' y1='0' x2='0' y2='1'><stop offset='0%25' stop-color='%23fffbeb'/><stop offset='100%25' stop-color='%23fef3c7'/></linearGradient><linearGradient id='tGold' x1='0' y1='0' x2='0' y2='1'><stop offset='0%25' stop-color='%23fbbf24'/><stop offset='100%25' stop-color='%23d97706'/></linearGradient></defs><g opacity='.12'><path d='M80,820 L80,680 Q80,660 100,660 L170,660 Q190,660 190,680 L190,820' fill='url(%23tGold)'/><path d='M55,680 Q135,640 215,680' fill='none' stroke='%23fbbf24' stroke-width='3'/><circle cx='135' cy='650' r='10' fill='%23fbbf24'/><rect x='115' y='820' width='40' height='14' rx='4' fill='%23b45309'/><rect x='105' y='834' width='60' height='10' rx='3' fill='%23d97706'/></g><g opacity='.1'><path d='M1010,830 L1010,700 Q1010,682 1028,682 L1092,682 Q1110,682 1110,700 L1110,830' fill='url(%23tGold)'/><path d='M988,700 Q1060,665 1132,700' fill='none' stroke='%23fbbf24' stroke-width='3'/><circle cx='1060' cy='672' r='9' fill='%23fbbf24'/><rect x='1042' y='830' width='36' height='12' rx='3' fill='%23b45309'/><rect x='1034' y='842' width='52' height='8' rx='3' fill='%23d97706'/></g><g opacity='.07' font-family='monospace' fill='%23ea580c'><text x='250' y='120' font-size='22'>1+2=3</text><text x='800' y='100' font-size='20'>5√ó4=20</text><text x='500' y='840' font-size='18'>7-3=4</text><text x='950' y='160' font-size='19'>8√∑2=4</text><text x='100' y='450' font-size='17'>9+6=15</text><text x='1050' y='500' font-size='20'>3√ó7=21</text></g><polygon points='300,60 306,78 325,78 310,90 316,108 300,96 284,108 290,90 275,78 294,78' fill='%23fbbf24' opacity='.15'><animate attributeName='opacity' values='.08;.2;.08' dur='2.5s' repeatCount='indefinite'/></polygon><polygon points='900,50 905,64 920,64 908,73 912,87 900,78 888,87 892,73 880,64 895,64' fill='%23fbbf24' opacity='.12'><animate attributeName='opacity' values='.06;.18;.06' dur='3s' repeatCount='indefinite'/></polygon><polygon points='600,30 604,42 617,42 607,50 610,62 600,54 590,62 593,50 583,42 596,42' fill='%23fb923c' opacity='.14'><animate attributeName='opacity' values='.07;.2;.07' dur='2s' repeatCount='indefinite'/></polygon><polygon points='150,300 153,308 162,308 155,314 157,322 150,317 143,322 145,314 138,308 147,308' fill='%23fbbf24' opacity='.1'><animate attributeName='opacity' values='.05;.15;.05' dur='2.8s' repeatCount='indefinite'/></polygon><polygon points='1080,350 1083,358 1092,358 1085,364 1087,372 1080,367 1073,372 1075,364 1068,358 1077,358' fill='%23f59e0b' opacity='.1'><animate attributeName='opacity' values='.05;.16;.05' dur='3.2s' repeatCount='indefinite'/></polygon><polygon points='450,750 453,758 462,758 455,764 457,772 450,767 443,772 445,764 438,758 447,758' fill='%23fbbf24' opacity='.12'><animate attributeName='opacity' values='.06;.18;.06' dur='2.2s' repeatCount='indefinite'/></polygon><polygon points='750,780 753,788 762,788 755,794 757,802 750,797 743,802 745,794 738,788 747,788' fill='%23f59e0b' opacity='.1'><animate attributeName='opacity' values='.05;.15;.05' dur='2.6s' repeatCount='indefinite'/></polygon><rect x='60' y='860' width='1080' height='40' rx='6' fill='%23d97706' opacity='.04'/><rect x='40' y='870' width='1120' height='30' rx='4' fill='%23b45309' opacity='.03'/></svg>") no-repeat center/cover;pointer-events:none;z-index:0}
.record-view .records-area{position:relative;z-index:1}
.record-card{background:linear-gradient(145deg,rgba(255,255,255,.88),rgba(255,247,237,.85))!important;border:2px solid rgba(251,191,36,.4)!important;box-shadow:0 4px 16px rgba(249,115,22,.1),0 0 0 1px rgba(251,191,36,.15),0 8px 32px rgba(234,88,12,.06)!important;backdrop-filter:blur(8px);transition:transform .2s,box-shadow .2s}
.record-card:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(249,115,22,.15),0 0 0 1px rgba(251,191,36,.25),0 12px 40px rgba(234,88,12,.08)!important}
.record-card h3{padding-bottom:8px;border-bottom:2px solid rgba(249,115,22,.18);background:linear-gradient(90deg,#ea580c,#f97316);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.record-item{box-shadow:0 2px 8px rgba(249,115,22,.06),inset 0 1px 0 rgba(255,255,255,.8);position:relative;overflow:hidden;border:2px solid rgba(251,191,36,.25)!important;transition:transform .15s}
.record-item:hover{transform:scale(1.03)}
.record-item::after{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(251,191,36,.1) 0%,transparent 60%);pointer-events:none}

/* ÎßàÏä§ÏΩîÌä∏ */
.mascot-wrap{position:absolute;bottom:12px;right:12px;z-index:5;pointer-events:none}
.mascot-svg{filter:drop-shadow(0 4px 8px rgba(0,0,0,.15));animation:mascotBob 3s ease-in-out infinite}
@keyframes mascotBob{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.mascot-speech{position:absolute;bottom:100%;right:0;margin-bottom:8px;background:#fff;border:2px solid #fed7aa;border-radius:16px 16px 16px 4px;padding:8px 14px;font-size:14px;font-weight:700;color:#78350f;white-space:nowrap;box-shadow:0 4px 12px rgba(0,0,0,.1);animation:speechIn .3s ease-out;pointer-events:none}
@keyframes speechIn{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}
.mascot-svg.happy{animation:mascotBob 3s ease-in-out infinite,mascotJump .5s ease-out}
@keyframes mascotJump{0%{transform:translateY(0)}40%{transform:translateY(-20px) scale(1.1)}100%{transform:translateY(0) scale(1)}}
.mascot-svg.worried{animation:mascotShake .4s ease-out}
@keyframes mascotShake{0%,100%{transform:rotate(0)}25%{transform:rotate(-8deg)}75%{transform:rotate(8deg)}}
@keyframes sparkleFloat{0%{opacity:1;transform:translateY(0) scale(0)}30%{opacity:1;transform:translateY(-10px) scale(1.2)}100%{opacity:0;transform:translateY(-30px) scale(.5)}}

/* Ìè≠ÌÉÑ Ïû•Ïãù */
.bomb-deco{position:absolute;pointer-events:none;z-index:0;animation:bombDecoFloat var(--dur,6s) ease-in-out infinite}
@keyframes bombDecoFloat{0%,100%{transform:translateY(0) rotate(0deg)}50%{transform:translateY(-12px) rotate(5deg)}}

/* ===== 2Ï∞® ÏóÖÍ∑∏Î†àÏù¥Îìú ===== */

/* 1. text-stroke Í≤åÏûÑ ÌÉÄÏù¥Ìè¨ */
.bomb-start-title{-webkit-text-stroke:2px #7c2d12;paint-order:stroke fill}
.bomb-equation{-webkit-text-stroke:1.5px rgba(0,0,0,.4);paint-order:stroke fill}
.eating-counter{-webkit-text-stroke:1.5px #9a3412;paint-order:stroke fill}
.eating-counter span{-webkit-text-stroke:0}
.side-val{font-size:32px;-webkit-text-stroke:1px #9a3412;paint-order:stroke fill}
.record-num{-webkit-text-stroke:1px #9a3412;paint-order:stroke fill;text-shadow:0 0 12px rgba(249,115,22,.35),0 0 24px rgba(251,191,36,.15)}
.elev-question{-webkit-text-stroke:1px #1e3a8a;paint-order:stroke fill}
.game-launch-btn{-webkit-text-stroke:1px #78350f;paint-order:stroke fill;font-size:26px}
.hg-stat{font-size:28px;-webkit-text-stroke:1px #1e3a8a;paint-order:stroke fill}
.side-title{font-size:24px;-webkit-text-stroke:.5px #7c2d12;paint-order:stroke fill}

/* 2. Ï†êÏàò ÌåùÏóÖ */
.score-popup{position:absolute;pointer-events:none;z-index:30;font-size:36px;font-weight:900;-webkit-text-stroke:1.5px rgba(0,0,0,.3);paint-order:stroke fill;animation:scorePop .8s ease-out forwards}
@keyframes scorePop{0%{transform:translateY(0) scale(0);opacity:0}20%{transform:translateY(-10px) scale(1.3);opacity:1}50%{transform:translateY(-30px) scale(1);opacity:1}100%{transform:translateY(-60px) scale(.7);opacity:0}}

/* 3. ÌÉ≠ Ï†ÑÌôò ÌéòÏù¥Îìú */
.game-view{animation:viewFadeIn .25s ease-out}
.tab-content{animation:viewFadeIn .25s ease-out}
@keyframes viewFadeIn{0%{opacity:0;transform:translateY(6px)}100%{opacity:1;transform:translateY(0)}}

/* 4. side-info Î∞∞Í≤Ω Í∞ïÌôî */
.side-info{background:linear-gradient(145deg,#fef3c7,#ffedd5,#fed7aa)}
.side-stat{background:linear-gradient(145deg,#fff7ed,#fef3c7);border:1.5px solid rgba(249,115,22,.18)}

/* 5. Ïö∞Ï∏° Ìå®ÎÑê Î∞∞Í≤Ω Í∞ïÌôî */
.right-panel{background:linear-gradient(180deg,rgba(249,115,22,.12),rgba(234,88,12,.18),rgba(194,65,12,.12));border:3px solid rgba(249,115,22,.25)}

/* 6. Î≤ÑÌäº squash/stretch */
.tab-btn:active{transform:translateY(3px) scaleX(1.06) scaleY(0.94)}
.action-btn:active{transform:translateY(4px) scaleX(1.06) scaleY(0.92)}
.numpad-btn:active{transform:translateY(3px) scaleX(1.08) scaleY(0.92)}
.bomb-start-btn:active{transform:scale(.92) scaleX(1.08)!important}
.game-launch-btn:active{transform:translateY(4px) scaleX(1.06) scaleY(0.92)}
.food-item:active{transform:translateY(2px) scaleX(1.06) scaleY(0.92)!important}

/* 7. Î®πÎ∞© Ï∫êÎ¶≠ÌÑ∞ idle */
.eating-char svg{animation:charBreathe 3s ease-in-out infinite}
@keyframes charBreathe{0%,100%{transform:scaleY(1) scaleX(1)}50%{transform:scaleY(1.03) scaleX(0.98)}}

/* 8. ÌïòÌä∏ ÏûÉÍ∏∞ */
.hg-heart-lost{display:inline-block;animation:heartLost .5s ease-out forwards}
@keyframes heartLost{0%{transform:scale(1);opacity:1}30%{transform:scale(1.3);opacity:1}60%{transform:scale(.8) rotate(15deg);opacity:.6}100%{transform:scale(0) rotate(30deg);opacity:0}}

/* 9. Î†àÎ≤®ÏóÖ Ïò§Î≤ÑÎ†àÏù¥ */
.levelup-overlay{position:fixed;inset:0;z-index:200;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.4);animation:lvFade .8s ease-out forwards;pointer-events:none}
@keyframes lvFade{0%{opacity:0}15%{opacity:1}70%{opacity:1}100%{opacity:0}}
.levelup-text{font-size:80px;font-weight:900;color:#fbbf24;-webkit-text-stroke:3px #78350f;paint-order:stroke fill;text-shadow:0 4px 12px rgba(0,0,0,.4),0 0 40px rgba(251,191,36,.5);animation:lvPop .8s cubic-bezier(.34,1.56,.64,1) forwards}
@keyframes lvPop{0%{transform:scale(0) rotate(-10deg)}30%{transform:scale(1.3) rotate(5deg)}50%{transform:scale(1) rotate(0deg)}100%{transform:scale(.9) rotate(0deg)}}

/* 10. Ìè≠ÌÉÑ ÏãúÏûë ÌôîÎ©¥ Î≥¥Í∞ï */
.bomb-start-screen{gap:16px!important}
.bomb-start-title{font-size:64px!important;animation:titleFloat 3s ease-in-out infinite}
@keyframes titleFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
.bomb-start-btn{font-size:46px;padding:32px 90px!important}
.bomb-best-display{font-size:26px;font-weight:700;color:#fbbf24;text-shadow:0 0 12px rgba(251,191,36,.4);margin-top:-4px}
.bomb-best-display span{font-size:36px;font-weight:900}
.bomb-countdown{position:absolute;inset:0;z-index:20;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.75);backdrop-filter:blur(6px);border-radius:16px}
.bomb-cd-num{font-size:180px;font-weight:900;color:#fbbf24;text-shadow:0 0 40px rgba(251,191,36,.6),0 0 80px rgba(249,115,22,.3);animation:cdPop .7s ease-out forwards;-webkit-text-stroke:3px #92400e;paint-order:stroke fill}
@keyframes cdPop{0%{transform:scale(2.5);opacity:0}25%{transform:scale(1);opacity:1}75%{transform:scale(1);opacity:1}100%{transform:scale(.4);opacity:0}}
.bomb-float-eq{position:absolute;font-size:20px;font-weight:700;color:rgba(251,191,36,.12);pointer-events:none;z-index:0;white-space:nowrap;animation:floatEq var(--dur,10s) linear infinite}
@keyframes floatEq{0%{transform:translateX(-120%);opacity:0}8%{opacity:1}92%{opacity:1}100%{transform:translateX(calc(1200px));opacity:0}}
</style>
</head>
<body>
<div class="rotate-notice"><div class="rotate-icon">üì±</div>ÌôîÎ©¥ÏùÑ Í∞ÄÎ°úÎ°ú ÎèåÎ†§Ï£ºÏÑ∏Ïöî!</div>

<div class="container">
  <div class="subject-bar">
    <button class="sb-tab active">üî¢ Ïà´Ïûê</button>
    <div class="sb-spacer"></div>
    <div class="sb-btns">
      <button class="sb-btn" id="sb-sound" onclick="toggleSound()">üîä</button>
      <button class="sb-btn" onclick="showAdmin()">‚öôÔ∏è</button>
    </div>
  </div>

  <div class="main-layout">
    <!-- ÏôºÏ™Ω Ìå®ÎÑê -->
    <div class="left-panel">
      <div class="profile-section">
        <div class="profile-content">
          <div class="profile-avatar" onclick="showCharModal()"><span id="pf-char">üßí</span></div>
          <div class="profile-info">
            <div class="profile-name" onclick="changeName()"><span id="pf-name">ÏàòÌïôÏôï</span></div>
            <div class="profile-level-container">
              <div class="profile-level">
                <span class="level-badge">LV.<span id="pf-level">1</span></span>
                <span id="pf-done">0</span>/<span id="pf-total">10</span>
              </div>
              <div class="progress-bar"><div class="progress-fill" id="pf-bar" style="width:0%"></div></div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-headers">
        <button class="tab-btn active" onclick="switchTab('bomb')">üí£ Ìè≠ÌÉÑÌï¥Ï≤¥</button>
        <button class="tab-btn" onclick="switchTab('eat')">üçé Ïà´ÏûêÎ®πÎ∞©</button>
        <button class="tab-btn" onclick="switchTab('elev')">üè¢ ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞</button>
        <button class="tab-btn" onclick="switchTab('record')">üìä ÎÇ¥ Í∏∞Î°ù</button>
      </div>

      <!-- Ìè≠ÌÉÑ ÏÇ¨Ïù¥Îìú -->
      <div class="tab-content bomb-side active">
        <div class="side-info">
          <div class="side-title">üí£ Ìè≠ÌÉÑ Ìï¥Ï≤¥Î∞ò</div>
          <div class="side-stat"><span>ÎùºÏö¥Îìú</span><span class="side-val" id="bomb-round">1</span></div>
          <div class="side-stat"><span>Ï†êÏàò</span><span class="side-val" id="bomb-score">0</span></div>
          <div class="side-stat"><span>Ïó∞ÏÜç Ìï¥Ï≤¥</span><span class="side-val" id="bomb-streak">0</span></div>
          <div class="side-stat"><span>ÏµúÍ≥† Ïó∞ÏÜç</span><span class="side-val" id="bomb-best">0</span></div>
        </div>
      </div>

      <!-- Î®πÎ∞© ÏÇ¨Ïù¥Îìú -->
      <div class="tab-content eat-side">
        <div class="side-info">
          <div class="side-title">üçé Ïà´Ïûê Î®πÎ∞©</div>
          <div class="side-stat"><span>Î™©Ìëú</span><span class="side-val" id="eat-target-side">?</span></div>
          <div class="side-stat"><span>Î®πÏùÄ Ïàò</span><span class="side-val" id="eat-count-side">0</span></div>
          <div class="side-stat"><span>Ï†êÏàò</span><span class="side-val" id="eat-score">0</span></div>
          <div class="side-stat"><span>Ïó∞ÏÜç ÏÑ±Í≥µ</span><span class="side-val" id="eat-streak">0</span></div>
        </div>
      </div>

      <!-- ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ ÏÇ¨Ïù¥Îìú -->
      <div class="tab-content elev-side">
        <div class="side-info">
          <div class="side-title">üè¢ Ï∏µÏàò ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞</div>
          <div class="side-stat"><span>Î¨∏Ï†ú</span><span class="side-val" id="elev-qnum">1</span></div>
          <div class="side-stat"><span>Ï†êÏàò</span><span class="side-val" id="elev-score">0</span></div>
          <div class="side-stat"><span>Î∞©Î¨∏Ìïú Ï∏µ</span><span class="side-val" id="elev-visited">0</span></div>
        </div>
      </div>

      <!-- Í∏∞Î°ù ÏÇ¨Ïù¥Îìú -->
      <div class="tab-content record-side">
        <div class="side-info">
          <div class="side-title">üìä Ï¢ÖÌï© Í∏∞Î°ù</div>
          <div class="side-stat"><span>Ï¥ù Î¨∏Ï†ú</span><span class="side-val" id="rec-total">0</span></div>
          <div class="side-stat"><span>Ï†ïÎãµÎ•†</span><span class="side-val" id="rec-rate">0%</span></div>
        </div>
      </div>

      <div class="game-launch-btn" onclick="startHeroGame()">‚ö° Ïó∞ÏÇ∞ Ìè≠Í≤© ÏãúÏûë!</div>
    </div>

    <!-- Ï§ëÏïô Ìå®ÎÑê -->
    <div class="center-panel">
      <!-- Ìè≠ÌÉÑ Ìï¥Ï≤¥Î∞ò -->
      <div class="game-view bomb-view active" id="bomb-view">
        <!-- ÏãúÏûë ÌôîÎ©¥ -->
        <div class="bomb-start-screen" id="bomb-start-screen">
          <div class="bomb-start-title">üí£ Ìè≠ÌÉÑ Ìï¥Ï≤¥Î∞ò</div>
          <div style="font-size:22px;color:#94a3b8;font-weight:600">ÏàòÏãùÏùÑ ÌíÄÏñ¥ÏÑú Ìè≠ÌÉÑÏùÑ Ìï¥Ï≤¥ÌïòÏÑ∏Ïöî!</div>
          <div class="bomb-best-display" id="bomb-best-display"></div>
          <button class="bomb-start-btn" onclick="bombStart()">üöÄ ÏãúÏûë!</button>
          <!-- ÎßàÏä§ÏΩîÌä∏ ÏàòÎ¶¨ -->
          <div class="mascot-wrap" id="mascot-bomb">
            <div class="mascot-speech" id="mascot-bomb-speech">Ìè≠ÌÉÑ Ìï¥Ï≤¥ÌïòÎü¨ Í∞ÄÏûê!</div>
            <svg class="mascot-svg" id="mascot-bomb-svg" viewBox="0 0 100 125" width="90" height="113">
              <ellipse cx="50" cy="118" rx="22" ry="4" fill="rgba(0,0,0,.08)"/>
              <ellipse cx="35" cy="108" rx="12" ry="6" fill="#ea580c"><animate attributeName="cx" values="35;33;35;37;35" dur="2s" repeatCount="indefinite"/></ellipse>
              <ellipse cx="65" cy="108" rx="12" ry="6" fill="#ea580c"><animate attributeName="cx" values="65;67;65;63;65" dur="2s" repeatCount="indefinite" begin=".5s"/></ellipse>
              <ellipse cx="50" cy="72" rx="38" ry="34" fill="#fb923c"/>
              <ellipse cx="50" cy="72" rx="38" ry="34" fill="url(#mascotGrad)" opacity=".5"/>
              <defs><radialGradient id="mascotGrad" cx="40%" cy="35%"><stop offset="0%" stop-color="#fde68a"/><stop offset="100%" stop-color="#fb923c"/></radialGradient></defs>
              <ellipse cx="38" cy="56" rx="5" ry="4" fill="#fff" opacity=".25"/>
              <ellipse cx="36" cy="64" rx="8" ry="9" fill="#fff"><animate attributeName="ry" values="9;1;9" dur="4s" repeatCount="indefinite" begin="1s"/></ellipse>
              <circle cx="38" cy="65" r="4.5" fill="#1e293b"><animate attributeName="r" values="4.5;.5;4.5" dur="4s" repeatCount="indefinite" begin="1s"/></circle>
              <circle cx="39.5" cy="63.5" r="1.5" fill="#fff"><animate attributeName="opacity" values="1;.4;1" dur="2s" repeatCount="indefinite"/></circle>
              <ellipse cx="64" cy="64" rx="8" ry="9" fill="#fff"><animate attributeName="ry" values="9;1;9" dur="4s" repeatCount="indefinite" begin="1s"/></ellipse>
              <circle cx="66" cy="65" r="4.5" fill="#1e293b"><animate attributeName="r" values="4.5;.5;4.5" dur="4s" repeatCount="indefinite" begin="1s"/></circle>
              <circle cx="67.5" cy="63.5" r="1.5" fill="#fff"><animate attributeName="opacity" values="1;.4;1" dur="2s" repeatCount="indefinite"/></circle>
              <path id="mascot-mouth" d="M38 82 Q50 94 62 82" stroke="#78350f" stroke-width="2.5" fill="none" stroke-linecap="round"/>
              <ellipse cx="26" cy="78" rx="6" ry="4" fill="#fca5a5" opacity=".35"/>
              <ellipse cx="74" cy="78" rx="6" ry="4" fill="#fca5a5" opacity=".35"/>
              <text x="50" y="38" text-anchor="middle" font-size="28" font-weight="900" fill="#78350f"><animateTransform attributeName="transform" type="rotate" from="0 50 32" to="360 50 32" dur="8s" repeatCount="indefinite"/>‚ûï</text>
            </svg>
          </div>
        </div>
        <!-- Í≤åÏûÑ ÌôîÎ©¥ -->
        <div id="bomb-game-screen" style="display:none;flex:1;flex-direction:column">
          <div class="bomb-info" id="bomb-info">ÎùºÏö¥Îìú 1 ‚Äî ÏãúÌïúÌè≠ÌÉÑ</div>
          <div class="bomb-area" id="bomb-area">
            <div class="bomb-container" id="bomb-container">
              <svg viewBox="0 0 280 300" width="350" height="380">
                <defs>
                  <radialGradient id="bGrad" cx="40%" cy="35%"><stop offset="0%" stop-color="#475569"/><stop offset="100%" stop-color="#1e293b"/></radialGradient>
                </defs>
                <rect x="125" y="30" width="30" height="30" rx="5" fill="#64748b"/>
                <path d="M140 30 Q165 5 175 20" stroke="#a16207" stroke-width="4" fill="none" stroke-linecap="round"/>
                <circle cx="175" cy="20" r="10" fill="#fbbf24" opacity=".7"><animate attributeName="r" values="7;13;7" dur=".4s" repeatCount="indefinite"/><animate attributeName="opacity" values=".5;1;.5" dur=".4s" repeatCount="indefinite"/></circle>
                <circle cx="175" cy="20" r="5" fill="#ef4444"><animate attributeName="r" values="3;7;3" dur=".3s" repeatCount="indefinite"/></circle>
                <ellipse cx="140" cy="185" rx="105" ry="95" fill="url(#bGrad)" filter="drop-shadow(0 4px 8px rgba(0,0,0,.3))"/>
                <ellipse cx="110" cy="155" rx="25" ry="18" fill="#fff" opacity=".1" transform="rotate(-20 110 155)"/>
                <circle cx="140" cy="185" r="105" fill="none" stroke="#fbbf24" stroke-width="6" stroke-dasharray="660" stroke-dashoffset="0" opacity=".4" id="bomb-timer-ring">
                  <animate id="bomb-timer-anim" attributeName="stroke-dashoffset" from="0" to="660" dur="15s" fill="freeze" begin="indefinite"/>
                </circle>
              </svg>
              <div class="bomb-equation" id="bomb-eq">?+3=7</div>
            </div>
          </div>
          <div class="bomb-input-display empty" id="bomb-input">Ï†ïÎãµÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî</div>
          <div class="numpad" id="bomb-numpad"></div>
        </div>
      </div>

      <!-- Ïà´Ïûê Î®πÎ∞© -->
      <div class="game-view eat-view" id="eat-view">
        <div class="eating-area">
          <div class="eating-char" id="eating-char">
            <div class="eating-speech" id="eat-speech">5ÎßåÌÅº Î®πÏó¨Ï§ò!</div>
            <svg viewBox="0 0 180 180" width="220" height="220">
              <defs><radialGradient id="cGrad" cx="40%" cy="35%"><stop offset="0%" stop-color="#86efac"/><stop offset="100%" stop-color="#22c55e"/></radialGradient></defs>
              <ellipse cx="90" cy="105" rx="75" ry="65" fill="url(#cGrad)" filter="drop-shadow(0 4px 8px rgba(0,0,0,.15))"/>
              <ellipse cx="65" cy="88" rx="13" ry="15" fill="#fff">
                <animate attributeName="ry" values="15;1;15" dur="0.15s" begin="3s;blink1.end+4s" id="blink1" fill="freeze"/>
              </ellipse>
              <circle cx="68" cy="90" r="7" fill="#1e293b"><animate attributeName="r" values="7;1;7" dur="0.15s" begin="3s;blink1b.end+4s" id="blink1b" fill="freeze"/></circle><circle cx="70" cy="88" r="2.5" fill="#fff"/>
              <ellipse cx="115" cy="88" rx="13" ry="15" fill="#fff">
                <animate attributeName="ry" values="15;1;15" dur="0.15s" begin="3s;blink2.end+4s" id="blink2" fill="freeze"/>
              </ellipse>
              <circle cx="118" cy="90" r="7" fill="#1e293b"><animate attributeName="r" values="7;1;7" dur="0.15s" begin="3s;blink2b.end+4s" id="blink2b" fill="freeze"/></circle><circle cx="120" cy="88" r="2.5" fill="#fff"/>
              <path id="char-mouth" d="M65 120 Q90 140 115 120" stroke="#1e293b" stroke-width="3" fill="none" stroke-linecap="round"/>
              <ellipse cx="50" cy="110" rx="10" ry="7" fill="#fca5a5" opacity=".4"/>
              <ellipse cx="130" cy="110" rx="10" ry="7" fill="#fca5a5" opacity=".4"/>
            </svg>
          </div>
          <svg viewBox="0 0 260 30" width="260" height="30" style="margin-top:-10px">
            <ellipse cx="130" cy="15" rx="125" ry="13" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="2"/>
            <ellipse cx="130" cy="12" rx="100" ry="8" fill="#fff" opacity=".5"/>
          </svg>
          <div class="eating-counter"><span id="eat-count">0</span> <span>/ <span id="eat-target">5</span></span></div>
          <div class="food-grid" id="food-grid"></div>
        </div>
        <!-- ÎßàÏä§ÏΩîÌä∏ ÏàòÎ¶¨ (Î®πÎ∞©) -->
        <div class="mascot-wrap" id="mascot-eat">
          <div class="mascot-speech" id="mascot-eat-speech" style="display:none">ÎßõÏûàÍ≤å Î®πÏñ¥!</div>
          <svg class="mascot-svg" id="mascot-eat-svg" viewBox="0 0 100 125" width="75" height="94">
            <ellipse cx="50" cy="115" rx="22" ry="4" fill="rgba(0,0,0,.08)"/>
            <ellipse cx="35" cy="108" rx="12" ry="6" fill="#ea580c"><animate attributeName="cx" values="35;33;35;37;35" dur="2s" repeatCount="indefinite"/></ellipse>
            <ellipse cx="65" cy="108" rx="12" ry="6" fill="#ea580c"><animate attributeName="cx" values="65;67;65;63;65" dur="2s" repeatCount="indefinite" begin=".5s"/></ellipse>
            <ellipse cx="50" cy="72" rx="38" ry="34" fill="#fb923c"/>
            <ellipse cx="50" cy="72" rx="38" ry="34" fill="url(#mGE)" opacity=".5"/>
            <defs><radialGradient id="mGE" cx="40%" cy="35%"><stop offset="0%" stop-color="#fde68a"/><stop offset="100%" stop-color="#fb923c"/></radialGradient></defs>
            <ellipse cx="38" cy="56" rx="5" ry="4" fill="#fff" opacity=".25"/>
            <ellipse cx="36" cy="64" rx="8" ry="9" fill="#fff"><animate attributeName="ry" values="9;1;9" dur="4s" repeatCount="indefinite" begin=".8s"/></ellipse>
            <circle cx="38" cy="65" r="4.5" fill="#1e293b"><animate attributeName="r" values="4.5;.5;4.5" dur="4s" repeatCount="indefinite" begin=".8s"/></circle>
            <circle cx="39.5" cy="63.5" r="1.5" fill="#fff"><animate attributeName="opacity" values="1;.4;1" dur="2s" repeatCount="indefinite"/></circle>
            <ellipse cx="64" cy="64" rx="8" ry="9" fill="#fff"><animate attributeName="ry" values="9;1;9" dur="4s" repeatCount="indefinite" begin=".8s"/></ellipse>
            <circle cx="66" cy="65" r="4.5" fill="#1e293b"><animate attributeName="r" values="4.5;.5;4.5" dur="4s" repeatCount="indefinite" begin=".8s"/></circle>
            <circle cx="67.5" cy="63.5" r="1.5" fill="#fff"><animate attributeName="opacity" values="1;.4;1" dur="2s" repeatCount="indefinite"/></circle>
            <path id="mascot-eat-mouth" d="M38 82 Q50 94 62 82" stroke="#78350f" stroke-width="2.5" fill="none" stroke-linecap="round"/>
            <ellipse cx="26" cy="78" rx="6" ry="4" fill="#fca5a5" opacity=".35"/>
            <ellipse cx="74" cy="78" rx="6" ry="4" fill="#fca5a5" opacity=".35"/>
            <g transform="translate(34,10)"><rect x="0" y="0" width="3" height="22" rx="1.5" fill="#94a3b8"/><ellipse cx="1.5" cy="0" rx="5" ry="3" fill="#94a3b8"/><rect x="28" y="0" width="3" height="22" rx="1.5" fill="#94a3b8"/><line x1="28" y1="2" x2="24" y2="8" stroke="#94a3b8" stroke-width="2" stroke-linecap="round"/><line x1="28" y1="2" x2="32" y2="8" stroke="#94a3b8" stroke-width="2" stroke-linecap="round"/><line x1="28" y1="2" x2="28" y2="9" stroke="#94a3b8" stroke-width="2" stroke-linecap="round"/></g>
          </svg>
        </div>
      </div>

      <!-- Ï∏µÏàò ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ -->
      <div class="game-view elev-view" id="elev-view">
        <div class="elevator-area">
          <div class="elev-question" id="elev-q">3Ï∏µÏóêÏÑú 4Ïπ∏ Ïò¨ÎùºÍ∞ÄÎ©¥?</div>
          <div class="elev-main">
            <!-- Í±¥Î¨º ÏÉ§ÌîÑÌä∏ -->
            <div class="building-shaft" id="building-shaft">
              <!-- ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ Ïπ¥ -->
              <div class="elev-car" id="elevator-car">
                <div class="elev-car-light" id="elev-car-light"></div>
              </div>
            </div>
            <!-- Î≤ÑÌäº Ìå®ÎÑê -->
            <div class="elev-panel">
              <div class="elev-led">
                <div class="elev-led-num" id="elev-led">1</div>
                <div class="elev-led-label">FLOOR</div>
              </div>
              <div class="elev-dir">
                <div class="elev-dir-ind" id="elev-arrow-up">‚ñ≤</div>
                <div class="elev-dir-ind" id="elev-arrow-down">‚ñº</div>
              </div>
              <div class="elev-btn-grid" id="floor-btns"></div>
            </div>
          </div>
          <div class="elev-result" id="elev-result"></div>
        </div>
        <!-- ÎßàÏä§ÏΩîÌä∏ ÏàòÎ¶¨ (ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞) -->
        <div class="mascot-wrap" id="mascot-elev" style="bottom:60px">
          <svg class="mascot-svg" id="mascot-elev-svg" viewBox="0 0 100 125" width="70" height="88">
            <ellipse cx="50" cy="118" rx="20" ry="3.5" fill="rgba(0,0,0,.07)"/>
            <ellipse cx="35" cy="108" rx="11" ry="5.5" fill="#ea580c"><animate attributeName="cx" values="35;33;35;37;35" dur="2.2s" repeatCount="indefinite" begin=".3s"/></ellipse>
            <ellipse cx="65" cy="108" rx="11" ry="5.5" fill="#ea580c"><animate attributeName="cx" values="65;67;65;63;65" dur="2.2s" repeatCount="indefinite" begin=".8s"/></ellipse>
            <ellipse cx="50" cy="72" rx="38" ry="34" fill="#fb923c"/>
            <ellipse cx="50" cy="72" rx="38" ry="34" fill="url(#mascotGrad2)" opacity=".5"/>
            <defs><radialGradient id="mascotGrad2" cx="40%" cy="35%"><stop offset="0%" stop-color="#fde68a"/><stop offset="100%" stop-color="#fb923c"/></radialGradient></defs>
            <ellipse cx="38" cy="56" rx="5" ry="4" fill="#fff" opacity=".25"/>
            <ellipse cx="36" cy="64" rx="8" ry="9" fill="#fff"><animate attributeName="ry" values="9;1;9" dur="4s" repeatCount="indefinite" begin="1.5s"/></ellipse>
            <circle cx="38" cy="65" r="4.5" fill="#1e293b"><animate attributeName="r" values="4.5;.5;4.5" dur="4s" repeatCount="indefinite" begin="1.5s"/></circle>
            <circle cx="39.5" cy="63.5" r="1.5" fill="#fff"><animate attributeName="opacity" values="1;.4;1" dur="2.5s" repeatCount="indefinite"/></circle>
            <ellipse cx="64" cy="64" rx="8" ry="9" fill="#fff"><animate attributeName="ry" values="9;1;9" dur="4s" repeatCount="indefinite" begin="1.5s"/></ellipse>
            <circle cx="66" cy="65" r="4.5" fill="#1e293b"><animate attributeName="r" values="4.5;.5;4.5" dur="4s" repeatCount="indefinite" begin="1.5s"/></circle>
            <circle cx="67.5" cy="63.5" r="1.5" fill="#fff"><animate attributeName="opacity" values="1;.4;1" dur="2.5s" repeatCount="indefinite"/></circle>
            <path id="mascot-elev-mouth" d="M38 82 Q50 94 62 82" stroke="#78350f" stroke-width="2.5" fill="none" stroke-linecap="round"/>
            <ellipse cx="26" cy="78" rx="6" ry="4" fill="#fca5a5" opacity=".35"/>
            <ellipse cx="74" cy="78" rx="6" ry="4" fill="#fca5a5" opacity=".35"/>
            <text x="50" y="40" text-anchor="middle" font-size="22" font-weight="900" fill="#78350f"><animateTransform attributeName="transform" type="rotate" from="0 50 34" to="360 50 34" dur="10s" repeatCount="indefinite"/>üî¢</text>
          </svg>
        </div>
      </div>

      <!-- ÎÇ¥ Í∏∞Î°ù -->
      <div class="game-view record-view" id="record-view">
        <div class="records-area">
          <div class="record-card">
            <h3>üèÜ Ï¢ÖÌï© ÏÑ±Ï†Å</h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-total">0</div><div class="record-label">Ï¥ù Î¨∏Ï†ú</div></div>
              <div class="record-item"><div class="record-num" id="r-correct">0</div><div class="record-label">Ï†ïÎãµ</div></div>
              <div class="record-item"><div class="record-num" id="r-rate">0%</div><div class="record-label">Ï†ïÎãµÎ•†</div></div>
            </div>
          </div>
          <div class="record-card">
            <h3>üí£ Ìè≠ÌÉÑ Ìï¥Ï≤¥Î∞ò</h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-bomb-defused">0</div><div class="record-label">Ìï¥Ï≤¥ ÏÑ±Í≥µ</div></div>
              <div class="record-item"><div class="record-num" id="r-bomb-best">0</div><div class="record-label">ÏµúÍ≥† Ïó∞ÏÜç</div></div>
              <div class="record-item"><div class="record-num" id="r-bomb-score">0</div><div class="record-label">ÏµúÍ≥† Ï†êÏàò</div></div>
            </div>
          </div>
          <div class="record-card">
            <h3>üçé Ïà´Ïûê Î®πÎ∞©</h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-eat-fed">0</div><div class="record-label">Î®πÏù¥Í∏∞ ÏÑ±Í≥µ</div></div>
              <div class="record-item"><div class="record-num" id="r-eat-best">0</div><div class="record-label">ÏµúÍ≥† Ïó∞ÏÜç</div></div>
              <div class="record-item"><div class="record-num" id="r-eat-score">0</div><div class="record-label">ÏµúÍ≥† Ï†êÏàò</div></div>
            </div>
          </div>
          <div class="record-card">
            <h3>üè¢ ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞</h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-elev-correct">0</div><div class="record-label">Ï†ïÎãµ</div></div>
              <div class="record-item"><div class="record-num" id="r-elev-floors">0</div><div class="record-label">Î∞©Î¨∏ Ï∏µ</div></div>
              <div class="record-item"><div class="record-num" id="r-elev-score">0</div><div class="record-label">ÏµúÍ≥† Ï†êÏàò</div></div>
            </div>
          </div>
          <div class="record-card">
            <h3>üí£ Ïó∞ÏÇ∞ Ìè≠Í≤©</h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-hero-score">0</div><div class="record-label">ÏµúÍ≥† Ï†êÏàò</div></div>
            </div>
          </div>
        </div>
        <!-- ÎßàÏä§ÏΩîÌä∏ ÏàòÎ¶¨ (Ìä∏Î°úÌîº) -->
        <div class="mascot-wrap" id="mascot-record">
          <svg class="mascot-svg" viewBox="0 0 100 135" width="80" height="108">
            <ellipse cx="50" cy="128" rx="22" ry="4" fill="rgba(0,0,0,.08)"/>
            <ellipse cx="35" cy="118" rx="12" ry="6" fill="#ea580c"><animate attributeName="cx" values="35;33;35;37;35" dur="1.8s" repeatCount="indefinite" begin=".2s"/></ellipse>
            <ellipse cx="65" cy="118" rx="12" ry="6" fill="#ea580c"><animate attributeName="cx" values="65;67;65;63;65" dur="1.8s" repeatCount="indefinite" begin=".7s"/></ellipse>
            <ellipse cx="50" cy="82" rx="38" ry="34" fill="#fb923c"/>
            <ellipse cx="50" cy="82" rx="38" ry="34" fill="url(#mascotGrad3)" opacity=".5"/>
            <defs><radialGradient id="mascotGrad3" cx="40%" cy="35%"><stop offset="0%" stop-color="#fde68a"/><stop offset="100%" stop-color="#fb923c"/></radialGradient></defs>
            <ellipse cx="38" cy="66" rx="5" ry="4" fill="#fff" opacity=".25"/>
            <ellipse cx="36" cy="74" rx="8" ry="9" fill="#fff"><animate attributeName="ry" values="9;1;9" dur="4s" repeatCount="indefinite" begin="2s"/></ellipse>
            <circle cx="38" cy="75" r="4.5" fill="#1e293b"><animate attributeName="r" values="4.5;.5;4.5" dur="4s" repeatCount="indefinite" begin="2s"/></circle>
            <circle cx="39.5" cy="73.5" r="1.5" fill="#fff"><animate attributeName="opacity" values="1;.4;1" dur="2.3s" repeatCount="indefinite"/></circle>
            <ellipse cx="64" cy="74" rx="8" ry="9" fill="#fff"><animate attributeName="ry" values="9;1;9" dur="4s" repeatCount="indefinite" begin="2s"/></ellipse>
            <circle cx="66" cy="75" r="4.5" fill="#1e293b"><animate attributeName="r" values="4.5;.5;4.5" dur="4s" repeatCount="indefinite" begin="2s"/></circle>
            <circle cx="67.5" cy="73.5" r="1.5" fill="#fff"><animate attributeName="opacity" values="1;.4;1" dur="2.3s" repeatCount="indefinite"/></circle>
            <path id="mascot-record-mouth" d="M38 92 Q50 104 62 92" stroke="#78350f" stroke-width="2.5" fill="none" stroke-linecap="round"/>
            <ellipse cx="26" cy="88" rx="6" ry="4" fill="#fca5a5" opacity=".35"/>
            <ellipse cx="74" cy="88" rx="6" ry="4" fill="#fca5a5" opacity=".35"/>
            <g transform="translate(28, 5) scale(0.6)">
              <path d="M25 20h50v15c0 20-10 35-25 40c-15-5-25-20-25-40z" fill="#fbbf24" stroke="#d97706" stroke-width="2"/>
              <rect x="35" y="75" width="30" height="6" rx="2" fill="#d97706"/>
              <rect x="30" y="81" width="40" height="8" rx="3" fill="#b45309"/>
              <path d="M25 20H10c0 18 10 30 20 32v-5c-8-3-14-12-14-27z" fill="#fde68a" stroke="#d97706" stroke-width="1.5"/>
              <path d="M75 20h15c0 18-10 30-20 32v-5c8-3 14-12 14-27z" fill="#fde68a" stroke="#d97706" stroke-width="1.5"/>
              <text x="50" y="52" text-anchor="middle" font-size="20" font-weight="900" fill="#92400e">‚òÖ</text>
            </g>
          </svg>
        </div>
      </div>
    </div>

    <!-- Ïò§Î•∏Ï™Ω Ìå®ÎÑê -->
    <div class="right-panel" id="right-panel">
      <button class="action-btn btn-cyan" id="act1" onclick="actionBtn(1)"><span class="icon">üí°</span>ÌûåÌä∏</button>
      <button class="action-btn btn-green" id="act2" onclick="actionBtn(2)"><span class="icon">‚è≠</span>Îã§Ïùå</button>
      <button class="action-btn btn-red" id="act3" onclick="actionBtn(3)"><span class="icon">üóë</span>ÏßÄÏö∞Í∏∞</button>
    </div>
  </div>

<!-- ÌûàÏñ¥Î°ú Í≤åÏûÑ (container ÎÇ¥Î∂Ä) -->
<div id="hero-game" class="hero-game hidden">
  <div class="hg-header">
    <div class="hg-stat">‚≠ê <span id="hg-score">0</span>Ï†ê</div>
    <div class="hg-stat">Î†àÎ≤® <span id="hg-level">1</span></div>
    <div class="hg-hearts" id="hg-hearts">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    <div class="hg-ctrls">
      <button class="hg-ctrl-btn" onclick="hgPause()">‚è∏</button>
      <button class="hg-ctrl-btn" onclick="hgExit()">‚úï</button>
    </div>
  </div>
  <div class="hg-arena" id="hg-arena">
    <div class="hg-ground"></div>
  </div>
  <div class="hg-numpad" id="hg-numpad"></div>
  <div id="hg-over" class="hg-overlay hidden">
    <div class="hg-overlay-box">
      <h2>Í≤åÏûÑ ÎÅù!</h2>
      <div class="score">‚≠ê <span id="hg-final-score">0</span>Ï†ê</div>
      <div class="msg" id="hg-over-msg">ÏûòÌñàÏñ¥Ïöî!</div>
      <button class="btn-retry" onclick="hgRestart()">üîÑ Îã§ÏãúÌïòÍ∏∞</button>
      <button class="btn-exit" onclick="hgExit()">üè† ÎèåÏïÑÍ∞ÄÍ∏∞</button>
    </div>
  </div>
  <div id="hg-pause" class="hg-overlay hidden">
    <div class="hg-overlay-box">
      <h2>‚è∏ ÏùºÏãúÏ†ïÏßÄ</h2>
      <button class="btn-retry" onclick="hgPause()">‚ñ∂ Í≥ÑÏÜçÌïòÍ∏∞</button>
      <button class="btn-exit" onclick="hgExit()">üè† ÎèåÏïÑÍ∞ÄÍ∏∞</button>
    </div>
  </div>
</div>
</div>

<!-- Í¥ÄÎ¶¨Ïûê Î™®Îã¨ -->
<div id="admin-modal" class="modal-overlay hidden">
  <div class="modal-box">
    <div class="modal-head"><h3>‚öô ÏÑ§Ï†ï</h3><button class="modal-close" onclick="hideAdmin()">√ó</button></div>
    <div class="modal-body">
      <div class="modal-section">
        <h4>üë§ ÌîÑÎ°úÌïÑ</h4>
        <input class="modal-input" id="adm-name" placeholder="Ïù¥Î¶Ñ ÏûÖÎ†•" maxlength="10">
        <button class="modal-btn" onclick="saveProfile()">Ï†ÄÏû•</button>
      </div>
      <div class="modal-section">
        <h4>üîÑ Ï¥àÍ∏∞Ìôî</h4>
        <button class="modal-btn" style="background:linear-gradient(145deg,#ef4444,#dc2626)" onclick="resetAll()">Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî</button>
      </div>
    </div>
  </div>
</div>

<!-- Ï∫êÎ¶≠ÌÑ∞ Î™®Îã¨ -->
<div id="char-modal" class="modal-overlay hidden">
  <div class="modal-box">
    <div class="modal-head"><h3>üé≠ Ï∫êÎ¶≠ÌÑ∞ ÏÑ†ÌÉù</h3><button class="modal-close" onclick="hideCharModal()">√ó</button></div>
    <div class="modal-body">
      <div class="char-grid" id="char-grid"></div>
    </div>
  </div>
</div>

<script>
// ===== Ï†ÑÏó≠ Î≥ÄÏàò =====
let currentTab = 'bomb';
let soundEnabled = true;
const LS = localStorage;

// ÌîÑÎ°úÌïÑ
let profile = {
  name: LS.getItem('mathName') || 'ÏàòÌïôÏôï',
  char: LS.getItem('mathChar') || 'üßí',
  totalCorrect: parseInt(LS.getItem('mathCorrect')) || 0,
  totalPlayed: parseInt(LS.getItem('mathPlayed')) || 0
};

// Ìè≠ÌÉÑ Í≤åÏûÑ ÏÉÅÌÉú
let bomb = {
  answer: 0, round: 1, score: 0, streak: 0, bestStreak: parseInt(LS.getItem('bombBest')) || 0,
  wrongCount: 0, timer: null, timeLeft: 15, defused: parseInt(LS.getItem('bombDefused')) || 0,
  bestScore: parseInt(LS.getItem('bombBestScore')) || 0,
  inputStr: '', started: false
};

// Î®πÎ∞© Í≤åÏûÑ ÏÉÅÌÉú
let eat = {
  target: 5, count: 0, score: 0, streak: 0, bestStreak: parseInt(LS.getItem('eatBest')) || 0,
  fed: parseInt(LS.getItem('eatFed')) || 0, bestScore: parseInt(LS.getItem('eatBestScore')) || 0,
  foods: [], confirmed: false
};

// ===== SVG ÎîïÏÖîÎÑàÎ¶¨ =====
const BOMB_SVG = {
  bomb: `<svg viewBox="0 0 80 80" width="100%" height="100%"><defs><radialGradient id="bombGr" cx="35%" cy="35%"><stop offset="0%" stop-color="#475569"/><stop offset="100%" stop-color="#1e293b"/></radialGradient></defs><rect x="34" y="8" width="12" height="12" rx="3" fill="#64748b"/><path d="M40 8 Q55 -5 60 6" stroke="#a16207" stroke-width="3" fill="none" stroke-linecap="round"/><circle cx="60" cy="6" r="7" fill="#fbbf24" opacity=".8"><animate attributeName="r" values="5;9;5" dur=".4s" repeatCount="indefinite"/><animate attributeName="opacity" values=".5;1;.5" dur=".4s" repeatCount="indefinite"/></circle><circle cx="60" cy="6" r="4" fill="#ef4444"><animate attributeName="r" values="2;5;2" dur=".3s" repeatCount="indefinite"/></circle><circle cx="40" cy="48" r="28" fill="url(#bombGr)" filter="drop-shadow(0 2px 4px rgba(0,0,0,.3))"/><ellipse cx="32" cy="40" rx="8" ry="6" fill="#fff" opacity=".15" transform="rotate(-20 32 40)"/></svg>`,
  balloon: `<svg viewBox="0 0 70 90" width="100%" height="100%"><defs><radialGradient id="ballGr" cx="35%" cy="30%"><stop offset="0%" stop-color="#fca5a5"/><stop offset="50%" stop-color="#ef4444"/><stop offset="100%" stop-color="#b91c1c"/></radialGradient></defs><ellipse cx="35" cy="36" rx="28" ry="34" fill="url(#ballGr)" filter="drop-shadow(0 3px 6px rgba(0,0,0,.2))"/><ellipse cx="26" cy="26" rx="8" ry="12" fill="#fff" opacity=".3" transform="rotate(-15 26 26)"/><polygon points="35,70 30,76 40,76" fill="#dc2626"/><line x1="35" y1="76" x2="35" y2="88" stroke="#a16207" stroke-width="2"/><circle cx="35" cy="88" r="2" fill="#a16207"/></svg>`,
  cake: `<svg viewBox="0 0 80 80" width="100%" height="100%"><rect x="12" y="40" width="56" height="32" rx="6" fill="#fbbf24" filter="drop-shadow(0 2px 4px rgba(0,0,0,.15))"/><rect x="8" y="36" width="64" height="12" rx="6" fill="#f472b6"/><path d="M8 42 Q20 34 30 42 Q40 34 50 42 Q60 34 72 42" stroke="#fff" stroke-width="3" fill="none" opacity=".7"/><rect x="12" y="62" width="56" height="10" rx="5" fill="#e879a0"/><line x1="28" y1="18" x2="28" y2="36" stroke="#a16207" stroke-width="2"/><ellipse cx="28" cy="14" rx="4" ry="6" fill="#fbbf24"><animate attributeName="ry" values="6;8;6" dur=".6s" repeatCount="indefinite"/></ellipse><circle cx="28" cy="12" r="2" fill="#ef4444" opacity=".8"/><line x1="40" y1="14" x2="40" y2="36" stroke="#a16207" stroke-width="2"/><ellipse cx="40" cy="10" rx="4" ry="6" fill="#fbbf24"><animate attributeName="ry" values="6;8;6" dur=".5s" repeatCount="indefinite"/></ellipse><circle cx="40" cy="8" r="2" fill="#ef4444" opacity=".8"/><line x1="52" y1="18" x2="52" y2="36" stroke="#a16207" stroke-width="2"/><ellipse cx="52" cy="14" rx="4" ry="6" fill="#fbbf24"><animate attributeName="ry" values="6;8;6" dur=".7s" repeatCount="indefinite"/></ellipse><circle cx="52" cy="12" r="2" fill="#ef4444" opacity=".8"/><circle cx="20" cy="50" r="3" fill="#fff" opacity=".5"/><circle cx="45" cy="55" r="2.5" fill="#fff" opacity=".4"/><circle cx="58" cy="48" r="2" fill="#fff" opacity=".45"/></svg>`
};

const FLOOR_SVG = {
  ocean: `<svg viewBox="0 0 60 60" width="36" height="36"><path d="M5 30 Q15 22 25 30 Q35 38 45 30 Q50 26 55 30" stroke="#3b82f6" stroke-width="4" fill="none" stroke-linecap="round"><animate attributeName="d" values="M5 30 Q15 22 25 30 Q35 38 45 30 Q50 26 55 30;M5 30 Q15 38 25 30 Q35 22 45 30 Q50 34 55 30;M5 30 Q15 22 25 30 Q35 38 45 30 Q50 26 55 30" dur="2s" repeatCount="indefinite"/></path><path d="M5 40 Q15 32 25 40 Q35 48 45 40 Q50 36 55 40" stroke="#60a5fa" stroke-width="3" fill="none" stroke-linecap="round" opacity=".6"><animate attributeName="d" values="M5 40 Q15 32 25 40 Q35 48 45 40 Q50 36 55 40;M5 40 Q15 48 25 40 Q35 32 45 40 Q50 44 55 40;M5 40 Q15 32 25 40 Q35 48 45 40 Q50 36 55 40" dur="2.5s" repeatCount="indefinite"/></path><circle cx="20" cy="48" r="3" fill="#93c5fd" opacity=".4"/><circle cx="42" cy="45" r="2" fill="#93c5fd" opacity=".3"/></svg>`,
  forest: `<svg viewBox="0 0 60 60" width="36" height="36"><polygon points="30,6 10,48 50,48" fill="#22c55e" filter="drop-shadow(0 1px 2px rgba(0,0,0,.15))"/><polygon points="30,16 15,44 45,44" fill="#16a34a"/><polygon points="30,26 20,44 40,44" fill="#15803d"/><rect x="27" y="44" width="6" height="10" rx="1" fill="#92400e"/></svg>`,
  house: `<svg viewBox="0 0 60 60" width="36" height="36"><polygon points="30,8 6,30 54,30" fill="#ef4444" filter="drop-shadow(0 1px 2px rgba(0,0,0,.15))"/><rect x="14" y="30" width="32" height="24" rx="2" fill="#fde68a"/><rect x="24" y="38" width="12" height="16" rx="1" fill="#92400e"/><circle cx="33" cy="48" r="1.5" fill="#fbbf24"/><rect x="17" y="34" width="8" height="8" rx="1" fill="#bae6fd" stroke="#93c5fd" stroke-width="1"/><line x1="21" y1="34" x2="21" y2="42" stroke="#93c5fd" stroke-width=".8"/><line x1="17" y1="38" x2="25" y2="38" stroke="#93c5fd" stroke-width=".8"/></svg>`,
  flower: `<svg viewBox="0 0 60 60" width="36" height="36"><g transform="translate(30,28)"><circle cx="0" cy="-12" r="8" fill="#f9a8d4"/><circle cx="11" cy="-4" r="8" fill="#fbcfe8"/><circle cx="7" cy="10" r="8" fill="#f9a8d4"/><circle cx="-7" cy="10" r="8" fill="#fbcfe8"/><circle cx="-11" cy="-4" r="8" fill="#f9a8d4"/><circle cx="0" cy="0" r="7" fill="#fbbf24"/></g><line x1="30" y1="40" x2="30" y2="56" stroke="#22c55e" stroke-width="3" stroke-linecap="round"/><ellipse cx="24" cy="50" rx="6" ry="3" fill="#86efac" transform="rotate(-30 24 50)"/></svg>`,
  cloud: `<svg viewBox="0 0 60 60" width="36" height="36"><ellipse cx="30" cy="32" rx="20" ry="12" fill="#f0f9ff" filter="drop-shadow(0 2px 4px rgba(0,0,0,.08))"/><ellipse cx="20" cy="28" rx="12" ry="10" fill="#f8fafc"/><ellipse cx="38" cy="26" rx="14" ry="11" fill="#fff"/><ellipse cx="30" cy="24" rx="10" ry="8" fill="#fff"/></svg>`,
  moon: `<svg viewBox="0 0 60 60" width="36" height="36"><circle cx="30" cy="30" r="22" fill="#fbbf24" filter="drop-shadow(0 0 8px rgba(251,191,36,.4))"/><circle cx="40" cy="24" r="18" fill="#1e1b4b" opacity=".9"/><circle cx="18" cy="20" r="2" fill="#fde68a" opacity=".6"/><circle cx="24" cy="38" r="1.5" fill="#fde68a" opacity=".5"/><circle cx="14" cy="30" r="1" fill="#fde68a" opacity=".4"/></svg>`,
  star: `<svg viewBox="0 0 60 60" width="36" height="36"><polygon points="30,4 36,22 56,22 40,34 46,52 30,42 14,52 20,34 4,22 24,22" fill="#fbbf24" filter="drop-shadow(0 0 6px rgba(251,191,36,.5))"/><polygon points="30,12 34,24 46,24 36,32 40,44 30,36 20,44 24,32 14,24 26,24" fill="#fde68a" opacity=".5"/></svg>`,
  rocket: `<svg viewBox="0 0 60 60" width="36" height="36"><ellipse cx="30" cy="28" rx="10" ry="22" fill="#e2e8f0" filter="drop-shadow(0 2px 3px rgba(0,0,0,.15))"/><ellipse cx="30" cy="20" rx="8" ry="12" fill="#f1f5f9"/><circle cx="30" cy="26" r="5" fill="#3b82f6"/><circle cx="30" cy="26" r="3" fill="#93c5fd"/><path d="M20 36 Q15 42 18 48 L22 40Z" fill="#ef4444"/><path d="M40 36 Q45 42 42 48 L38 40Z" fill="#ef4444"/><ellipse cx="30" cy="50" rx="4" ry="3" fill="#f97316" opacity=".8"><animate attributeName="ry" values="3;6;3" dur=".4s" repeatCount="indefinite"/></ellipse><ellipse cx="30" cy="52" rx="3" ry="2" fill="#fbbf24" opacity=".6"><animate attributeName="ry" values="2;5;2" dur=".3s" repeatCount="indefinite"/></ellipse></svg>`,
  rainbow: `<svg viewBox="0 0 60 60" width="36" height="36"><path d="M6 50 A24 24 0 0 1 54 50" stroke="#ef4444" stroke-width="4" fill="none"/><path d="M10 50 A20 20 0 0 1 50 50" stroke="#f97316" stroke-width="4" fill="none"/><path d="M14 50 A16 16 0 0 1 46 50" stroke="#fbbf24" stroke-width="4" fill="none"/><path d="M18 50 A12 12 0 0 1 42 50" stroke="#22c55e" stroke-width="4" fill="none"/><path d="M22 50 A8 8 0 0 1 38 50" stroke="#3b82f6" stroke-width="4" fill="none"/><path d="M26 50 A4 4 0 0 1 34 50" stroke="#8b5cf6" stroke-width="4" fill="none"/></svg>`,
  crown: `<svg viewBox="0 0 60 60" width="36" height="36"><polygon points="8,44 12,18 22,30 30,10 38,30 48,18 52,44" fill="#fbbf24" filter="drop-shadow(0 2px 4px rgba(0,0,0,.15))"/><rect x="8" y="42" width="44" height="8" rx="2" fill="#f59e0b"/><circle cx="12" cy="20" r="3" fill="#ef4444"/><circle cx="30" cy="12" r="3" fill="#3b82f6"/><circle cx="48" cy="20" r="3" fill="#22c55e"/><circle cx="18" cy="46" r="2" fill="#fde68a" opacity=".6"/><circle cx="30" cy="46" r="2" fill="#fde68a" opacity=".6"/><circle cx="42" cy="46" r="2" fill="#fde68a" opacity=".6"/></svg>`
};

const DECO_SVG = {
  warning: `<svg viewBox="0 0 40 40"><polygon points="20,4 36,34 4,34" fill="#fbbf24" stroke="#f59e0b" stroke-width="2" stroke-linejoin="round"/><text x="20" y="29" text-anchor="middle" font-size="16" font-weight="900" fill="#92400e">!</text></svg>`,
  wrench: `<svg viewBox="0 0 40 40"><path d="M28 8 C24 6 19 7 17 11 C15 15 16 19 19 22 L10 31 C9 32 9 34 10 35 C11 36 13 36 14 35 L23 26 C26 28 30 27 32 24 C34 20 33 16 30 13 L26 17 L22 13 Z" fill="#94a3b8" stroke="#64748b" stroke-width="1.5"/></svg>`,
  lightning: `<svg viewBox="0 0 40 40"><polygon points="22,2 12,20 18,20 14,38 30,16 23,16 28,2" fill="#fbbf24" stroke="#f59e0b" stroke-width="1" filter="drop-shadow(0 0 4px rgba(251,191,36,.5))"/></svg>`,
  bolt: `<svg viewBox="0 0 40 40"><circle cx="20" cy="20" r="8" fill="#94a3b8" stroke="#64748b" stroke-width="1.5"/><circle cx="20" cy="20" r="3.5" fill="#64748b"/><rect x="18.5" y="4" width="3" height="8" rx="1.5" fill="#94a3b8"/><rect x="18.5" y="28" width="3" height="8" rx="1.5" fill="#94a3b8"/><rect x="4" y="18.5" width="8" height="3" rx="1.5" fill="#94a3b8"/><rect x="28" y="18.5" width="8" height="3" rx="1.5" fill="#94a3b8"/></svg>`,
  bulb: `<svg viewBox="0 0 40 40"><circle cx="20" cy="16" r="11" fill="#fbbf24" filter="drop-shadow(0 0 6px rgba(251,191,36,.4))"/><circle cx="20" cy="16" r="7" fill="#fde68a" opacity=".6"/><rect x="16" y="26" width="8" height="4" rx="1" fill="#d4d4d8"/><rect x="17" y="29" width="6" height="3" rx="1" fill="#a1a1aa"/><line x1="20" y1="32" x2="20" y2="35" stroke="#a1a1aa" stroke-width="2" stroke-linecap="round"/></svg>`,
  gear: `<svg viewBox="0 0 40 40"><path d="M20 6 L22 10 L26 8 L26 13 L30 14 L28 18 L32 20 L28 22 L30 26 L26 27 L26 32 L22 30 L20 34 L18 30 L14 32 L14 27 L10 26 L12 22 L8 20 L12 18 L10 14 L14 13 L14 8 L18 10 Z" fill="#94a3b8" stroke="#64748b" stroke-width="1"/><circle cx="20" cy="20" r="6" fill="#64748b"/><circle cx="20" cy="20" r="3" fill="#94a3b8"/></svg>`
};
const DECO_KEYS = ['warning','wrench','lightning','bolt','bulb','gear'];

// ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ ÏÉÅÌÉú
let elev = {
  startFloor: 1, delta: 0, answer: 0, currentFloor: 1, score: 0, qNum: 1,
  visited: new Set(), correctCount: parseInt(LS.getItem('elevCorrect')) || 0,
  bestScore: parseInt(LS.getItem('elevBestScore')) || 0
};

// ÌûàÏñ¥Î°ú Í≤åÏûÑ ÏÉÅÌÉú
let hg = {
  score: 0, lives: 5, level: 1, running: false, paused: false,
  bombs: [], spawnTimer: null, animId: null, combo: 0, maxCombo: 0,
  bestScore: parseInt(LS.getItem('hgBestScore')) || 0
};

// ===== TTS =====
let audioQueue = [];
let isSpeaking = false;
function speak(text) {
  if (!soundEnabled) return;
  speechSynthesis.cancel();
  audioQueue = [];
  isSpeaking = false;
  audioQueue.push(text);
  processQueue();
}
function processQueue() {
  if (isSpeaking || !audioQueue.length) return;
  isSpeaking = true;
  const u = new SpeechSynthesisUtterance(audioQueue.shift());
  u.lang = 'ko-KR'; u.rate = 1.0; u.pitch = 1.1;
  u.onend = () => { isSpeaking = false; processQueue(); };
  u.onerror = () => { isSpeaking = false; processQueue(); };
  speechSynthesis.speak(u);
}
function toggleSound() {
  soundEnabled = !soundEnabled;
  document.getElementById('sb-sound').textContent = soundEnabled ? 'üîä' : 'üîá';
  if (!soundEnabled) speechSynthesis.cancel();
}

// ===== SFX (Web Audio) =====
const SFX = {
  _ctx: null,
  _getCtx() {
    if (!this._ctx) try { this._ctx = new (window.AudioContext || window.webkitAudioContext)(); } catch(e) {}
    return this._ctx;
  },
  _play(fn) {
    if (!soundEnabled) return;
    const ctx = this._getCtx();
    if (!ctx) return;
    if (ctx.state === 'suspended') ctx.resume();
    try { fn(ctx); } catch(e) {}
  },
  // Î≤ÑÌäº/ÎÑòÌå®Îìú ÌÅ¥Î¶≠
  pop() {
    this._play(ctx => {
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination);
      o.frequency.setValueAtTime(400, ctx.currentTime);
      o.frequency.exponentialRampToValueAtTime(200, ctx.currentTime + 0.06);
      g.gain.setValueAtTime(0.12, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.06);
      o.start(ctx.currentTime); o.stop(ctx.currentTime + 0.06);
    });
  },
  // Ï†ïÎãµ Ï∞®ÏûÑ
  ding() {
    this._play(ctx => {
      [523, 659, 784].forEach((f, i) => {
        const o = ctx.createOscillator(), g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);
        o.type = 'sine';
        o.frequency.setValueAtTime(f, ctx.currentTime + i * 0.1);
        g.gain.setValueAtTime(0.15, ctx.currentTime + i * 0.1);
        g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + i * 0.1 + 0.3);
        o.start(ctx.currentTime + i * 0.1); o.stop(ctx.currentTime + i * 0.1 + 0.3);
      });
    });
  },
  // Ïò§Îãµ Î≤ÑÏ¶à
  buzz() {
    this._play(ctx => {
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination);
      o.type = 'square';
      o.frequency.setValueAtTime(200, ctx.currentTime);
      o.frequency.exponentialRampToValueAtTime(120, ctx.currentTime + 0.25);
      g.gain.setValueAtTime(0.08, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.25);
      o.start(ctx.currentTime); o.stop(ctx.currentTime + 0.25);
    });
  },
  // Ìè≠Î∞ú
  boom() {
    this._play(ctx => {
      // Ï†ÄÏ£ºÌåå ÎüºÎ∏î
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination);
      o.frequency.setValueAtTime(100, ctx.currentTime);
      o.frequency.exponentialRampToValueAtTime(30, ctx.currentTime + 0.5);
      g.gain.setValueAtTime(0.2, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);
      o.start(ctx.currentTime); o.stop(ctx.currentTime + 0.5);
      // ÎÖ∏Ïù¥Ï¶à burst
      const buf = ctx.createBuffer(1, ctx.sampleRate * 0.3, ctx.sampleRate);
      const data = buf.getChannelData(0);
      for (let i = 0; i < data.length; i++) data[i] = (Math.random() * 2 - 1) * Math.max(0, 1 - i / data.length);
      const ns = ctx.createBufferSource(), ng = ctx.createGain();
      ns.buffer = buf; ns.connect(ng); ng.connect(ctx.destination);
      ng.gain.setValueAtTime(0.15, ctx.currentTime);
      ng.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.3);
      ns.start(ctx.currentTime);
    });
  },
  // ÏùåÏãù Î®πÍ∏∞
  chomp() {
    this._play(ctx => {
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination);
      o.frequency.setValueAtTime(300, ctx.currentTime);
      o.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.08);
      g.gain.setValueAtTime(0.12, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.08);
      o.start(ctx.currentTime); o.stop(ctx.currentTime + 0.08);
    });
  },
  // ÏÑ±Í≥µ Ìå°ÌååÎ†à (ÎèÑÎØ∏ÏÜîÎèÑ)
  fanfare() {
    this._play(ctx => {
      [523, 659, 784, 1047].forEach((f, i) => {
        const o = ctx.createOscillator(), g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);
        o.frequency.setValueAtTime(f, ctx.currentTime + i * 0.12);
        g.gain.setValueAtTime(0.13, ctx.currentTime + i * 0.12);
        g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + i * 0.12 + 0.35);
        o.start(ctx.currentTime + i * 0.12); o.stop(ctx.currentTime + i * 0.12 + 0.35);
      });
    });
  },
  // Î†àÎ≤®ÏóÖ
  levelup() {
    this._play(ctx => {
      [523, 587, 659, 698, 784, 880, 988, 1047].forEach((f, i) => {
        const o = ctx.createOscillator(), g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);
        o.frequency.setValueAtTime(f, ctx.currentTime + i * 0.06);
        g.gain.setValueAtTime(0.1, ctx.currentTime + i * 0.06);
        g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + i * 0.06 + 0.2);
        o.start(ctx.currentTime + i * 0.06); o.stop(ctx.currentTime + i * 0.06 + 0.2);
      });
    });
  },
  // ÌÉÄÏù¥Î®∏ Ìã±
  tick() {
    this._play(ctx => {
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination);
      o.frequency.setValueAtTime(800, ctx.currentTime);
      g.gain.setValueAtTime(0.06, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.04);
      o.start(ctx.currentTime); o.stop(ctx.currentTime + 0.04);
    });
  },
  // ÌååÏõåÏóÖ
  powerup() {
    this._play(ctx => {
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination);
      o.frequency.setValueAtTime(600, ctx.currentTime);
      o.frequency.exponentialRampToValueAtTime(1400, ctx.currentTime + 0.25);
      g.gain.setValueAtTime(0.12, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.3);
      o.start(ctx.currentTime); o.stop(ctx.currentTime + 0.3);
    });
  },
  // ÏΩ§Î≥¥ (ÏΩ§Î≥¥ ÏàòÏóê Îî∞Îùº ÎÜíÏïÑÏßÄÎäî Ïùå)
  combo(n) {
    this._play(ctx => {
      const base = 523 + Math.min(n, 10) * 50;
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination);
      o.frequency.setValueAtTime(base, ctx.currentTime);
      o.frequency.exponentialRampToValueAtTime(base * 1.5, ctx.currentTime + 0.15);
      g.gain.setValueAtTime(0.12, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.2);
      o.start(ctx.currentTime); o.stop(ctx.currentTime + 0.2);
    });
  },
  // ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ Îî©Îèô
  elevDing() {
    this._play(ctx => {
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination);
      o.frequency.setValueAtTime(830, ctx.currentTime);
      o.frequency.setValueAtTime(1050, ctx.currentTime + 0.15);
      g.gain.setValueAtTime(0.15, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);
      o.start(ctx.currentTime); o.stop(ctx.currentTime + 0.5);
    });
  },
  // ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ ÏÇê
  elevBuzz() {
    this._play(ctx => {
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination);
      o.type = 'square';
      o.frequency.setValueAtTime(200, ctx.currentTime);
      g.gain.setValueAtTime(0.08, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.3);
      o.start(ctx.currentTime); o.stop(ctx.currentTime + 0.3);
    });
  },
  // Í≤åÏûÑ ÏãúÏûë
  gameStart() {
    this._play(ctx => {
      [392, 523, 659, 784].forEach((f, i) => {
        const o = ctx.createOscillator(), g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);
        o.frequency.setValueAtTime(f, ctx.currentTime + i * 0.08);
        g.gain.setValueAtTime(0.1, ctx.currentTime + i * 0.08);
        g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + i * 0.08 + 0.2);
        o.start(ctx.currentTime + i * 0.08); o.stop(ctx.currentTime + i * 0.08 + 0.2);
      });
    });
  },
  // Í≤åÏûÑÏò§Î≤Ñ
  gameOver() {
    this._play(ctx => {
      [400, 350, 300, 200].forEach((f, i) => {
        const o = ctx.createOscillator(), g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);
        o.type = 'sawtooth';
        o.frequency.setValueAtTime(f, ctx.currentTime + i * 0.15);
        g.gain.setValueAtTime(0.06, ctx.currentTime + i * 0.15);
        g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + i * 0.15 + 0.3);
        o.start(ctx.currentTime + i * 0.15); o.stop(ctx.currentTime + i * 0.15 + 0.3);
      });
    });
  }
};

// ===== ÌîÑÎ°úÌïÑ =====
let _prevLevel = 1;
function updateProfile() {
  document.getElementById('pf-name').textContent = profile.name;
  document.getElementById('pf-char').textContent = profile.char;
  const lv = Math.floor(profile.totalCorrect / 10) + 1;
  if (lv > _prevLevel && _prevLevel > 0) showLevelUp(lv);
  _prevLevel = lv;
  document.getElementById('pf-level').textContent = lv;
  const prog = (profile.totalCorrect % 10);
  document.getElementById('pf-done').textContent = prog;
  document.getElementById('pf-total').textContent = 10;
  document.getElementById('pf-bar').style.width = (prog * 10) + '%';
}
function changeName() {
  const n = prompt('Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:', profile.name);
  if (n && n.trim()) { profile.name = n.trim(); LS.setItem('mathName', profile.name); updateProfile(); }
}
function showCharModal() {
  document.getElementById('char-modal').classList.remove('hidden');
  const chars = ['üßí','üë¶','üëß','ü¶∏‚Äç‚ôÇÔ∏è','ü¶∏‚Äç‚ôÄÔ∏è','üßô‚Äç‚ôÇÔ∏è','üê±','üê∂','ü¶ä','üêª','üê∞','üê∏','ü¶Å','üêØ','üêº'];
  const g = document.getElementById('char-grid');
  g.innerHTML = chars.map(c => `<div class="char-item${c===profile.char?' selected':''}" onclick="pickChar('${c}')">${c}</div>`).join('');
}
function hideCharModal() { document.getElementById('char-modal').classList.add('hidden'); }
function pickChar(c) { profile.char = c; LS.setItem('mathChar', c); updateProfile(); hideCharModal(); }
function showAdmin() { document.getElementById('admin-modal').classList.remove('hidden'); document.getElementById('adm-name').value = profile.name; }
function hideAdmin() { document.getElementById('admin-modal').classList.add('hidden'); }
function saveProfile() {
  const n = document.getElementById('adm-name').value.trim();
  if (n) { profile.name = n; LS.setItem('mathName', n); updateProfile(); }
  hideAdmin();
}
function resetAll() {
  if (!confirm('Î™®Îì† Í∏∞Î°ùÏù¥ ÏÇ¨ÎùºÏßëÎãàÎã§. Ï†ïÎßê Ï¥àÍ∏∞ÌôîÌï†ÍπåÏöî?')) return;
  ['mathName','mathChar','mathCorrect','mathPlayed','bombBest','bombDefused','bombBestScore','eatBest','eatFed','eatBestScore','elevCorrect','elevBestScore','hgBestScore'].forEach(k => LS.removeItem(k));
  location.reload();
}
function saveStats() {
  LS.setItem('mathCorrect', profile.totalCorrect);
  LS.setItem('mathPlayed', profile.totalPlayed);
  LS.setItem('bombBest', bomb.bestStreak);
  LS.setItem('bombDefused', bomb.defused);
  LS.setItem('bombBestScore', bomb.bestScore);
  LS.setItem('eatBest', eat.bestStreak);
  LS.setItem('eatFed', eat.fed);
  LS.setItem('eatBestScore', eat.bestScore);
  LS.setItem('elevCorrect', elev.correctCount);
  LS.setItem('elevBestScore', elev.bestScore);
  LS.setItem('hgBestScore', hg.bestScore);
}

// ===== ÌÉ≠ Ï†ÑÌôò =====
function switchTab(tab) {
  // Ìè≠ÌÉÑ ÌÉÄÏù¥Î®∏ Ï†ïÏßÄ (Îã§Î•∏ ÌÉ≠ Ïù¥Îèô Ïãú)
  if (currentTab === 'bomb' && tab !== 'bomb') {
    clearInterval(bomb.timer);
    bomb.timer = null;
  }
  // TTS Ï†ïÎ¶¨ (ÌÉ≠ Ï†ÑÌôò Ïãú Ïù¥Ï†Ñ ÏÜåÎ¶¨ Ï§ëÎã®)
  speechSynthesis.cancel();
  audioQueue = [];
  isSpeaking = false;
  currentTab = tab;
  document.querySelectorAll('.tab-btn').forEach((b, i) => {
    b.classList.toggle('active', ['bomb','eat','elev','record'][i] === tab);
  });
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelector('.' + tab + '-side').classList.add('active');
  document.querySelectorAll('.game-view').forEach(v => v.classList.remove('active'));
  document.querySelector('.' + tab + '-view').classList.add('active');
  updateActionButtons();
  if (tab === 'record') updateRecords();
}

function updateActionButtons() {
  const a1 = document.getElementById('act1');
  const a2 = document.getElementById('act2');
  const a3 = document.getElementById('act3');
  if (currentTab === 'bomb') {
    a1.innerHTML = '<span class="icon">üí°</span>ÌûåÌä∏'; a1.className = 'action-btn btn-cyan'; a1.disabled = false;
    a2.innerHTML = '<span class="icon">‚è≠</span>Îã§Ïùå'; a2.className = 'action-btn btn-green'; a2.disabled = false;
    a3.innerHTML = '<span class="icon">üóë</span>ÏßÄÏö∞Í∏∞'; a3.className = 'action-btn btn-red'; a3.disabled = false;
  } else if (currentTab === 'eat') {
    a1.innerHTML = '<span class="icon">‚úÖ</span>ÌôïÏù∏!'; a1.className = 'action-btn btn-green'; a1.disabled = false;
    a2.innerHTML = '<span class="icon">üîÑ</span>Îã§Ïãú'; a2.className = 'action-btn btn-cyan'; a2.disabled = false;
    a3.innerHTML = '<span class="icon">‚è≠</span>Îã§Ïùå'; a3.className = 'action-btn btn-orange'; a3.disabled = false;
  } else if (currentTab === 'elev') {
    a1.innerHTML = '<span class="icon">üí°</span>ÌûåÌä∏'; a1.className = 'action-btn btn-cyan'; a1.disabled = false;
    a2.innerHTML = '<span class="icon">üîÑ</span>Îã§Ïãú'; a2.className = 'action-btn btn-orange'; a2.disabled = false;
    a3.innerHTML = '<span class="icon">‚è≠</span>Îã§Ïùå'; a3.className = 'action-btn btn-green'; a3.disabled = false;
  } else {
    a1.innerHTML = '<span class="icon">üìä</span>Í∏∞Î°ù'; a1.className = 'action-btn btn-cyan'; a1.disabled = true;
    a2.innerHTML = '<span class="icon">‚Äî</span>‚Äî'; a2.className = 'action-btn btn-green'; a2.disabled = true;
    a3.innerHTML = '<span class="icon">‚Äî</span>‚Äî'; a3.className = 'action-btn btn-red'; a3.disabled = true;
  }
}

function actionBtn(n) {
  if (currentTab === 'bomb') {
    if (n === 1) bombHint();
    else if (n === 2) newBombRound();
    else bombClearInput();
  } else if (currentTab === 'eat') {
    if (n === 1) eatConfirm();
    else if (n === 2) eatRetry();
    else eatNext();
  } else if (currentTab === 'elev') {
    if (n === 1) elevHint();
    else if (n === 2) elevRetry();
    else newElevQuestion();
  }
}

// ===== Ìè≠ÌÉÑ Ìï¥Ï≤¥Î∞ò =====
const bombTypes = [
  {type:'bomb', name:'ÏãúÌïúÌè≠ÌÉÑ', svg: BOMB_SVG.bomb},
  {type:'balloon', name:'ÌíçÏÑ†Ìè≠ÌÉÑ', svg: BOMB_SVG.balloon},
  {type:'cake', name:'ÏºÄÏù¥ÌÅ¨Ìè≠ÌÉÑ', svg: BOMB_SVG.cake}
];

function bombStart() {
  bomb.started = true;
  bomb.round = 1;
  bomb.score = 0;
  bomb.streak = 0;
  SFX.gameStart();
  // 3-2-1 Ïπ¥Ïö¥Ìä∏Îã§Ïö¥
  const view = document.getElementById('bomb-view');
  const cd = document.createElement('div');
  cd.className = 'bomb-countdown';
  view.appendChild(cd);
  let count = 3;
  const tick = () => {
    const label = count > 0 ? count : 'ÏãúÏûë!';
    cd.innerHTML = `<div class="bomb-cd-num">${label}</div>`;
    if (count <= 0) {
      setTimeout(() => {
        cd.remove();
        document.getElementById('bomb-start-screen').style.display = 'none';
        document.getElementById('bomb-game-screen').style.display = 'flex';
        updateBombUI();
        newBombRound();
      }, 600);
      return;
    }
    SFX.pop();
    count--;
    setTimeout(tick, 750);
  };
  tick();
}

function newBombRound() {
  bomb.wrongCount = 0;
  bomb.inputStr = '';
  updateBombInput();

  // ÏàòÏãù ÏÉùÏÑ± (ÎùºÏö¥ÎìúÍ∞Ä Ïò¨ÎùºÍ∞ÄÎ©¥ Î≤îÏúÑ ÌôïÎåÄ)
  const ops = ['+', '-'];
  const op = ops[Math.floor(Math.random() * ops.length)];
  let a, b, c;
  const maxNum = Math.min(5 + bomb.round * 2, 20);
  if (op === '+') {
    a = Math.floor(Math.random() * maxNum) + 1;
    b = Math.floor(Math.random() * maxNum) + 1;
    c = a + b;
  } else {
    a = Math.floor(Math.random() * maxNum) + 2;
    b = Math.floor(Math.random() * (a - 1)) + 1;
    c = a - b;
  }
  // ÎûúÎç§ÏúºÎ°ú ÎπàÏπ∏ ÏúÑÏπò Í≤∞Ï†ï
  const pos = Math.floor(Math.random() * 3);
  let eq, ans;
  if (pos === 0) { eq = `?${op}${b}=${c}`; ans = a; }
  else if (pos === 1) { eq = `${a}${op}?=${c}`; ans = b; }
  else { eq = `${a}${op}${b}=?`; ans = c; }

  bomb.answer = ans;
  document.getElementById('bomb-eq').textContent = eq;
  const bt = bombTypes[(bomb.round - 1) % 3];
  document.getElementById('bomb-info').innerHTML = `<span style="display:inline-flex;align-items:center;gap:8px;vertical-align:middle"><span style="display:inline-block;width:32px;height:32px;vertical-align:middle">${bt.svg}</span> ÎùºÏö¥Îìú ${bomb.round} ‚Äî ${bt.name}</span>`;
  document.getElementById('bomb-round').textContent = bomb.round;

  // ÌÉÄÏù¥Î®∏ Î¶¨ÏÖã
  bomb.timeLeft = 15;
  clearInterval(bomb.timer);
  const ring = document.getElementById('bomb-timer-ring');
  ring.style.strokeDashoffset = '0';

  // SVG Ïï†ÎãàÎ©îÏù¥ÏÖò Î¶¨ÏÖã
  const anim = document.getElementById('bomb-timer-anim');
  anim.setAttribute('dur', '15s');
  anim.beginElement();

  bomb.timer = setInterval(() => {
    bomb.timeLeft--;
    if (bomb.timeLeft <= 5 && bomb.timeLeft > 0) SFX.tick();
    if (bomb.timeLeft <= 0) {
      clearInterval(bomb.timer);
      bombExplode();
    }
  }, 1000);
}

function bombInput(n) {
  if (!bomb.started) return;
  if (bomb.inputStr.length >= 3) return; // ÏµúÎåÄ 3ÏûêÎ¶¨
  SFX.pop();
  bomb.inputStr += n.toString();
  updateBombInput();
}

function bombConfirm() {
  if (!bomb.started || bomb.inputStr === '') return;
  const val = parseInt(bomb.inputStr);
  if (val === bomb.answer) {
    clearInterval(bomb.timer);
    bomb.score += (10 + bomb.streak * 2);
    bomb.streak++;
    bomb.defused++;
    if (bomb.streak > bomb.bestStreak) bomb.bestStreak = bomb.streak;
    if (bomb.score > bomb.bestScore) bomb.bestScore = bomb.score;
    profile.totalCorrect++;
    profile.totalPlayed++;

    bombDefuseAnimation();
    SFX.fanfare();
    speak('Ï†ïÎãµ! Ìè≠ÌÉÑ Ìï¥Ï≤¥ ÏÑ±Í≥µ!');
    setMascotEmotion('bomb','happy');
    showScorePopup('bomb-area', 10 + bomb.streak * 2);
    document.getElementById('bomb-input').style.color = '#22c55e';

    updateBombUI();
    updateProfile();
    saveStats();

    setTimeout(() => { bomb.round++; newBombRound(); }, 1500);
  } else {
    bomb.wrongCount++;
    profile.totalPlayed++;
    SFX.buzz();
    document.getElementById('bomb-input').style.color = '#ef4444';
    document.getElementById('bomb-area').classList.add('bomb-shaking');
    setTimeout(() => {
      document.getElementById('bomb-area').classList.remove('bomb-shaking');
      document.getElementById('bomb-input').style.color = '#f97316';
    }, 900);

    if (bomb.wrongCount >= 3) {
      clearInterval(bomb.timer);
      bombExplode();
    } else {
      speak('ÌãÄÎ†∏Ïñ¥Ïöî! Îã§Ïãú Ìï¥Î≥¥ÏÑ∏Ïöî');
      bomb.inputStr = '';
      updateBombInput();
    }
    saveStats();
  }
}

function bombClear() {
  bomb.inputStr = '';
  updateBombInput();
}

function updateBombInput() {
  const el = document.getElementById('bomb-input');
  if (bomb.inputStr === '') {
    el.textContent = 'Ï†ïÎãµÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî';
    el.classList.add('empty');
    el.style.color = '';
  } else {
    el.textContent = bomb.inputStr;
    el.classList.remove('empty');
    el.style.color = '#f97316';
  }
}

function bombExplode() {
  bomb.streak = 0;
  SFX.boom();
  setMascotEmotion('bomb','worried');
  speak(`Ìéë! Ï†ïÎãµÏùÄ ${bomb.answer}Ïù¥ÏóàÏñ¥Ïöî`);
  updateBombUI();
  bombExplodeAnimation();
  // ÏãúÏûë ÌôîÎ©¥ÏúºÎ°ú ÎèåÏïÑÍ∞ê (Í≤åÏûÑ ÎÅù)
  setTimeout(() => {
    clearInterval(bomb.timer);
    bomb.started = false;
    document.getElementById('bomb-game-screen').style.display = 'none';
    document.getElementById('bomb-start-screen').style.display = 'flex';
    document.getElementById('bomb-start-screen').querySelector('.bomb-start-title').textContent = `üí• ${bomb.round}ÎùºÏö¥ÎìúÏóêÏÑú Ìè≠Î∞ú!`;
    document.getElementById('bomb-start-screen').querySelector('div[style]').textContent = `Ï†êÏàò: ${bomb.score}Ï†ê | ÏµúÍ≥† Ïó∞ÏÜç: ${bomb.bestStreak}Ìöå`;
    const bestEl = document.getElementById('bomb-best-display');
    if (bestEl && bomb.bestScore > 0) bestEl.innerHTML = `üèÜ ÏµúÍ≥† Í∏∞Î°ù: <span>${bomb.bestScore}</span>Ï†ê`;
  }, 2500);
}

function bombExplodeAnimation() {
  const area = document.getElementById('bomb-area');
  const container = document.getElementById('bomb-container');
  const areaRect = area.getBoundingClientRect();
  const contRect = container.getBoundingClientRect();
  const cx = contRect.left - areaRect.left + contRect.width / 2;
  const cy = contRect.top - areaRect.top + contRect.height / 2;

  // Ïò§Î≤ÑÎ†àÏù¥
  const overlay = document.createElement('div');
  overlay.className = 'bomb-explode-overlay';
  area.appendChild(overlay);

  // ÌôîÎ©¥ ÌùîÎì§Î¶º
  area.classList.add('bomb-shake-hard');
  setTimeout(() => area.classList.remove('bomb-shake-hard'), 500);

  // 1Îã®Í≥Ñ: Ìù∞ÏÉâ ÌîåÎûòÏãú (ÏÑ¨Í¥ë)
  const wFlash = document.createElement('div');
  wFlash.className = 'bomb-flash-white';
  overlay.appendChild(wFlash);
  setTimeout(() => wFlash.remove(), 300);

  // 2Îã®Í≥Ñ: Îπ®Í∞Ñ ÌîåÎûòÏãú
  setTimeout(() => {
    const rFlash = document.createElement('div');
    rFlash.className = 'bomb-flash-red';
    overlay.appendChild(rFlash);
    setTimeout(() => rFlash.remove(), 600);
  }, 100);

  // 3Îã®Í≥Ñ: Ï∂©Í≤©Ìåå ÎßÅ 2Í∞ú
  for (let i = 0; i < 2; i++) {
    setTimeout(() => {
      const ring = document.createElement('div');
      ring.className = 'bomb-ring';
      const size = 250 + i * 100;
      ring.style.cssText = `left:${cx}px;top:${cy}px;width:${size}px;height:${size}px`;
      overlay.appendChild(ring);
      setTimeout(() => ring.remove(), 800);
    }, i * 150);
  }

  // 4Îã®Í≥Ñ: Î∂àÍΩÉ ÌååÌã∞ÌÅ¥ (20Í∞ú)
  const fireColors = ['#ef4444','#f97316','#fbbf24','#fde68a','#ff6b6b','#ff922b','#ffd43b'];
  for (let i = 0; i < 20; i++) {
    const p = document.createElement('div');
    p.className = 'bomb-particle';
    const size = 10 + Math.random() * 22;
    const angle = (Math.PI * 2 / 20) * i + (Math.random() - 0.5) * 0.4;
    const dist = 100 + Math.random() * 180;
    const dur = 0.6 + Math.random() * 0.5;
    const color = fireColors[Math.floor(Math.random() * fireColors.length)];
    p.style.cssText = `left:${cx}px;top:${cy}px;width:${size}px;height:${size}px;background:${color};--tx:${Math.cos(angle)*dist}px;--ty:${Math.sin(angle)*dist}px;--dur:${dur}s;box-shadow:0 0 ${size}px ${color}`;
    overlay.appendChild(p);
    setTimeout(() => p.remove(), dur * 1000);
  }

  // 5Îã®Í≥Ñ: Ïä§ÌååÌÅ¨ (ÎπõÏ§ÑÍ∏∞ 12Í∞ú)
  for (let i = 0; i < 12; i++) {
    const s = document.createElement('div');
    s.className = 'bomb-spark';
    const angle = (Math.PI * 2 / 12) * i;
    const dist = 120 + Math.random() * 140;
    const dur = 0.4 + Math.random() * 0.3;
    const h = 12 + Math.random() * 18;
    const color = Math.random() > 0.5 ? '#fbbf24' : '#fff';
    s.style.cssText = `left:${cx}px;top:${cy}px;height:${h}px;background:${color};--tx:${Math.cos(angle)*dist}px;--ty:${Math.sin(angle)*dist}px;--rot:${angle*180/Math.PI+90}deg;--dur:${dur}s;box-shadow:0 0 6px ${color}`;
    overlay.appendChild(s);
    setTimeout(() => s.remove(), dur * 1000);
  }

  // 6Îã®Í≥Ñ: Ïó∞Í∏∞ (8Í∞ú)
  for (let i = 0; i < 8; i++) {
    setTimeout(() => {
      const sm = document.createElement('div');
      sm.className = 'bomb-smoke';
      const size = 40 + Math.random() * 50;
      const angle = Math.random() * Math.PI * 2;
      const dist = 30 + Math.random() * 80;
      sm.style.cssText = `left:${cx}px;top:${cy}px;width:${size}px;height:${size}px;--tx:${Math.cos(angle)*dist}px;--ty:${Math.sin(angle)*dist-60}px`;
      overlay.appendChild(sm);
      setTimeout(() => sm.remove(), 1200);
    }, 100 + i * 50);
  }

  // 7Îã®Í≥Ñ: Ï†ïÎãµ ÌÖçÏä§Ìä∏
  setTimeout(() => {
    const txt = document.createElement('div');
    txt.className = 'bomb-text-pop';
    txt.textContent = `üí• Ìéë! Ï†ïÎãµ: ${bomb.answer}`;
    txt.style.cssText = `left:${cx}px;top:${cy}px`;
    overlay.appendChild(txt);
    setTimeout(() => txt.remove(), 2000);
  }, 300);

  // Ìè≠ÌÉÑ SVG Ïà®Í∏∞Í∏∞
  container.style.opacity = '0';
  container.style.transition = 'opacity .3s';
  document.getElementById('bomb-eq').style.opacity = '0';

  // Ï†ÑÏ≤¥ Ï†ïÎ¶¨
  setTimeout(() => {
    overlay.remove();
    container.style.opacity = '1';
    container.style.transition = '';
    document.getElementById('bomb-eq').style.opacity = '1';
  }, 2500);
}

function bombDefuseAnimation() {
  const area = document.getElementById('bomb-area');
  const container = document.getElementById('bomb-container');
  const areaRect = area.getBoundingClientRect();
  const contRect = container.getBoundingClientRect();
  const cx = contRect.left - areaRect.left + contRect.width / 2;
  const cy = contRect.top - areaRect.top + contRect.height / 2;

  const overlay = document.createElement('div');
  overlay.className = 'bomb-defuse-overlay';
  area.appendChild(overlay);

  // Ï¥àÎ°ù ÌîåÎûòÏãú
  const flash = document.createElement('div');
  flash.className = 'bomb-defuse-flash';
  overlay.appendChild(flash);

  // Ï≤¥ÌÅ¨ÎßàÌÅ¨
  const check = document.createElement('div');
  check.className = 'bomb-check';
  check.textContent = '‚úÖ';
  check.style.cssText = `left:${cx}px;top:${cy}px`;
  overlay.appendChild(check);

  // Î≥Ñ/Ïä§ÌååÌÅ¥ 12Í∞ú
  const emojis = ['‚≠ê','‚ú®','üåü','üí´','üéâ','üéä'];
  for (let i = 0; i < 12; i++) {
    const s = document.createElement('div');
    s.className = 'bomb-star';
    const angle = (Math.PI * 2 / 12) * i;
    const dist = 80 + Math.random() * 100;
    const dur = 0.6 + Math.random() * 0.4;
    s.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    s.style.cssText = `left:${cx}px;top:${cy}px;font-size:${20+Math.random()*16}px;--tx:${Math.cos(angle)*dist}px;--ty:${Math.sin(angle)*dist}px;--dur:${dur}s`;
    overlay.appendChild(s);
  }

  setTimeout(() => overlay.remove(), 1200);
}

function showBombResult(emoji) {
  const r = document.createElement('div');
  r.className = 'bomb-result';
  r.textContent = emoji;
  document.getElementById('bomb-area').appendChild(r);
  setTimeout(() => r.remove(), 800);
}

function bombHint() {
  if (!bomb.started) return;
  const hint = bomb.answer <= 9 ? (bomb.answer <= 5 ? 'ÏûëÏùÄ ÏàòÏòàÏöî (1~5)' : 'ÌÅ∞ ÏàòÏòàÏöî (6~9)') : `Îëê ÏûêÎ¶¨ ÏàòÏòàÏöî`;
  speak(`ÌûåÌä∏! ${hint}`);
  document.getElementById('bomb-eq').innerHTML += `<br><span style="font-size:18px;color:#fde68a">${hint}</span>`;
}

function bombClearInput() {
  bombClear();
}

function updateBombUI() {
  document.getElementById('bomb-score').textContent = bomb.score;
  document.getElementById('bomb-streak').textContent = bomb.streak;
  document.getElementById('bomb-best').textContent = bomb.bestStreak;
}

// ===== Ïà´Ïûê Î®πÎ∞© =====
const FOOD_NAMES = ['ÏÇ¨Í≥º','Ïò§Î†åÏßÄ','Î†àÎ™¨','Ìè¨ÎèÑ','Îî∏Í∏∞','Î∞îÎÇòÎÇò','Î≥µÏà≠ÏïÑ','Ï≤¥Î¶¨','ÌÇ§ÏúÑ','ÌååÏù∏Ïï†Ìîå'];
function getFoodSVG(idx) {
  const svgs = [
    `<svg viewBox="0 0 80 80" width="64" height="64"><circle cx="40" cy="44" r="28" fill="#ef4444"/><circle cx="40" cy="44" r="25" fill="#f87171"/><ellipse cx="33" cy="36" rx="8" ry="5" fill="#fca5a5" opacity=".5"/><path d="M40 16Q44 8 50 14" fill="none" stroke="#16a34a" stroke-width="2.5" stroke-linecap="round"/><ellipse cx="46" cy="14" rx="6" ry="4" fill="#22c55e"/></svg>`,
    `<svg viewBox="0 0 80 80" width="64" height="64"><circle cx="40" cy="42" r="27" fill="#ea580c"/><circle cx="40" cy="42" r="24" fill="#f97316"/><circle cx="33" cy="36" r="2" fill="#fb923c" opacity=".5"/><circle cx="45" cy="50" r="1.5" fill="#fb923c" opacity=".5"/><circle cx="50" cy="38" r="1.8" fill="#fb923c" opacity=".4"/><circle cx="36" cy="52" r="1.5" fill="#fb923c" opacity=".4"/><ellipse cx="35" cy="35" rx="6" ry="4" fill="#fdba74" opacity=".4"/><circle cx="40" cy="17" r="4" fill="#22c55e"/></svg>`,
    `<svg viewBox="0 0 80 80" width="64" height="64"><ellipse cx="40" cy="42" rx="22" ry="26" fill="#eab308"/><ellipse cx="40" cy="42" rx="19" ry="23" fill="#facc15"/><ellipse cx="34" cy="36" rx="6" ry="4" fill="#fde68a" opacity=".5"/><circle cx="40" cy="18" r="3" fill="#65a30d"/><path d="M40 18Q44 12 48 16" fill="none" stroke="#16a34a" stroke-width="2" stroke-linecap="round"/></svg>`,
    `<svg viewBox="0 0 80 80" width="64" height="64"><circle cx="32" cy="38" r="10" fill="#7c3aed"/><circle cx="48" cy="38" r="10" fill="#8b5cf6"/><circle cx="28" cy="52" r="10" fill="#8b5cf6"/><circle cx="44" cy="52" r="10" fill="#7c3aed"/><circle cx="52" cy="52" r="10" fill="#8b5cf6"/><circle cx="36" cy="62" r="9" fill="#7c3aed"/><circle cx="32" cy="38" r="3" fill="#a78bfa" opacity=".4"/><circle cx="48" cy="38" r="3" fill="#a78bfa" opacity=".4"/><path d="M38 24Q42 10 46 20" fill="none" stroke="#16a34a" stroke-width="2.5" stroke-linecap="round"/><ellipse cx="48" cy="16" rx="5" ry="3.5" fill="#22c55e"/></svg>`,
    `<svg viewBox="0 0 80 80" width="64" height="64"><path d="M40 18Q20 35 22 55Q30 72 40 72Q50 72 58 55Q60 35 40 18Z" fill="#ef4444"/><path d="M40 22Q24 37 26 54Q32 68 40 68Q48 68 54 54Q56 37 40 22Z" fill="#f87171"/><circle cx="32" cy="42" r="2" fill="#fbbf24" opacity=".6"/><circle cx="44" cy="50" r="1.5" fill="#fbbf24" opacity=".5"/><circle cx="38" cy="56" r="1.8" fill="#fbbf24" opacity=".5"/><circle cx="48" cy="40" r="1.5" fill="#fbbf24" opacity=".4"/><circle cx="35" cy="48" r="1.3" fill="#fbbf24" opacity=".4"/><ellipse cx="34" cy="35" rx="5" ry="3.5" fill="#fca5a5" opacity=".4"/><path d="M38 18Q36 10 32 14" fill="none" stroke="#16a34a" stroke-width="2" stroke-linecap="round"/><ellipse cx="31" cy="13" rx="5" ry="3" fill="#22c55e"/></svg>`,
    `<svg viewBox="0 0 80 80" width="64" height="64"><path d="M22 58Q18 42 28 28Q40 20 52 30Q58 42 54 58" fill="#eab308" stroke="#ca8a04" stroke-width="1.5"/><path d="M25 56Q21 42 30 30Q40 23 50 32Q55 42 52 56" fill="#facc15"/><ellipse cx="36" cy="36" rx="4" ry="8" fill="#fde68a" opacity=".4"/><path d="M22 58Q38 62 54 58" fill="none" stroke="#ca8a04" stroke-width="1.5"/><circle cx="20" cy="60" r="3" fill="#92400e" opacity=".5"/><circle cx="56" cy="58" r="2.5" fill="#92400e" opacity=".4"/></svg>`,
    `<svg viewBox="0 0 80 80" width="64" height="64"><circle cx="40" cy="44" r="26" fill="#f9a8d4"/><circle cx="40" cy="44" r="23" fill="#fbcfe8"/><path d="M40 20Q40 40 40 68" fill="none" stroke="#f472b6" stroke-width="1.5" opacity=".3"/><ellipse cx="34" cy="36" rx="7" ry="4" fill="#fff" opacity=".35"/><path d="M40 18Q44 10 50 16" fill="none" stroke="#16a34a" stroke-width="2.5" stroke-linecap="round"/><ellipse cx="48" cy="14" rx="6" ry="3.5" fill="#22c55e"/></svg>`,
    `<svg viewBox="0 0 80 80" width="64" height="64"><path d="M35 24Q30 12 38 8Q42 12 40 24" fill="none" stroke="#16a34a" stroke-width="2.5" stroke-linecap="round"/><path d="M45 24Q50 12 42 8" fill="none" stroke="#16a34a" stroke-width="2" stroke-linecap="round"/><circle cx="30" cy="44" r="14" fill="#ef4444"/><circle cx="30" cy="44" r="11.5" fill="#f87171"/><ellipse cx="26" cy="40" rx="4" ry="3" fill="#fca5a5" opacity=".5"/><circle cx="50" cy="44" r="14" fill="#ef4444"/><circle cx="50" cy="44" r="11.5" fill="#f87171"/><ellipse cx="46" cy="40" rx="4" ry="3" fill="#fca5a5" opacity=".5"/></svg>`,
    `<svg viewBox="0 0 80 80" width="64" height="64"><circle cx="40" cy="44" r="26" fill="#92400e"/><circle cx="40" cy="44" r="23" fill="#a16207"/><circle cx="40" cy="44" r="20" fill="#65a30d"/><circle cx="40" cy="44" r="17" fill="#84cc16"/><circle cx="40" cy="44" r="5" fill="#fef9c3"/><line x1="40" y1="27" x2="40" y2="61" stroke="#365314" stroke-width=".8" opacity=".3"/><line x1="23" y1="44" x2="57" y2="44" stroke="#365314" stroke-width=".8" opacity=".3"/><circle cx="35" cy="38" r="2" fill="#1a2e05" opacity=".2"/><circle cx="46" cy="40" r="1.5" fill="#1a2e05" opacity=".2"/><circle cx="38" cy="50" r="1.8" fill="#1a2e05" opacity=".2"/><circle cx="44" cy="48" r="1.5" fill="#1a2e05" opacity=".15"/></svg>`,
    `<svg viewBox="0 0 80 80" width="64" height="64"><rect x="26" y="28" width="28" height="40" rx="6" fill="#ca8a04"/><rect x="29" y="31" width="22" height="34" rx="4" fill="#eab308"/><line x1="33" y1="31" x2="33" y2="65" stroke="#ca8a04" stroke-width="1" opacity=".4"/><line x1="40" y1="31" x2="40" y2="65" stroke="#ca8a04" stroke-width="1" opacity=".4"/><line x1="47" y1="31" x2="47" y2="65" stroke="#ca8a04" stroke-width="1" opacity=".4"/><line x1="29" y1="40" x2="51" y2="40" stroke="#ca8a04" stroke-width="1" opacity=".3"/><line x1="29" y1="50" x2="51" y2="50" stroke="#ca8a04" stroke-width="1" opacity=".3"/><path d="M34 28Q30 16 36 10L40 8L44 10Q50 16 46 28" fill="#22c55e"/><path d="M37 26Q34 16 38 12L40 10L42 12Q46 16 43 26" fill="#16a34a"/></svg>`
  ];
  return svgs[idx] || svgs[0];
}

function initEatGame() {
  eat.targetFruit = Math.floor(Math.random() * FOOD_NAMES.length);
  eat.target = Math.floor(Math.random() * 5) + 1;
  eat.count = 0;
  eat.confirmed = false;
  const fname = FOOD_NAMES[eat.targetFruit];
  document.getElementById('eat-target').textContent = eat.target;
  document.getElementById('eat-target-side').textContent = eat.target;
  document.getElementById('eat-count').textContent = 0;
  document.getElementById('eat-count-side').textContent = 0;
  document.getElementById('eat-speech').textContent = `${fname}Î•º ${eat.target}Í∞ú Î®πÏó¨Ï§ò!`;
  setMouth('smile');

  // ÏùåÏãù Í∑∏Î¶¨Îìú ÏÉùÏÑ± ‚Äî ÌäπÏ†ï Í≥ºÏùº + ÎûúÎç§ ÌòºÌï©
  const grid = document.getElementById('food-grid');
  eat.foods = [];
  const extra = Math.floor(Math.random() * 4) + 2;
  const total = Math.min(eat.target + extra, 10);
  // Î™©Ìëú Í≥ºÏùº Î®ºÏ†Ä
  for (let i = 0; i < eat.target; i++) eat.foods.push(eat.targetFruit);
  // ÎÇòÎ®∏ÏßÄÎäî Îã§Î•∏ Í≥ºÏùº (Î™©Ìëú Í≥ºÏùº Ï†úÏô∏)
  for (let i = eat.target; i < total; i++) {
    let fi;
    do { fi = Math.floor(Math.random() * FOOD_NAMES.length); } while (fi === eat.targetFruit);
    eat.foods.push(fi);
  }
  // ÏÖîÌîå
  for (let i = eat.foods.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [eat.foods[i], eat.foods[j]] = [eat.foods[j], eat.foods[i]];
  }
  let html = '';
  for (let i = 0; i < eat.foods.length; i++) {
    const fi = eat.foods[i];
    html += `<div class="food-item" onclick="eatFood(this,${i})">${getFoodSVG(fi)}<div class="food-label">${FOOD_NAMES[fi]}</div></div>`;
  }
  grid.innerHTML = html;
}

function eatFood(el, idx) {
  if (eat.confirmed) return;
  if (el.classList.contains('eaten')) return;
  const fi = eat.foods[idx];
  if (fi !== eat.targetFruit) {
    // ÌãÄÎ¶∞ Í≥ºÏùº ‚Äî ÌùîÎì§Î¶º + Í≤ΩÍ≥†
    SFX.buzz();
    el.classList.add('wrong-eat');
    setTimeout(() => el.classList.remove('wrong-eat'), 300);
    setMouth('worried');
    document.getElementById('eat-speech').textContent = `Ïù¥Í±¥ ${FOOD_NAMES[fi]}Ïïº! ${FOOD_NAMES[eat.targetFruit]}Î•º Ï∞æÏïÑÏ§ò!`;
    setTimeout(() => { if (!eat.confirmed) { setMouth('smile'); document.getElementById('eat-speech').textContent = `${FOOD_NAMES[eat.targetFruit]}Î•º ${eat.target}Í∞ú Î®πÏó¨Ï§ò!`; } }, 1200);
    return;
  }
  SFX.chomp();
  el.classList.add('eaten');
  eat.count++;
  document.getElementById('eat-count').textContent = eat.count;
  document.getElementById('eat-count-side').textContent = eat.count;
  setMouth('eating');
  eatSpawnParticles(el);
  setTimeout(() => { if (!eat.confirmed) setMouth('smile'); }, 500);
}

function eatSpawnParticles(el) {
  const area = document.querySelector('.eating-area');
  const rect = el.getBoundingClientRect();
  const aRect = area.getBoundingClientRect();
  const cx = rect.left - aRect.left + rect.width/2;
  const cy = rect.top - aRect.top + rect.height/2;
  const sparks = ['‚≠ê','‚ú®','üíõ','üß°'];
  for (let i = 0; i < 5; i++) {
    const p = document.createElement('div');
    p.className = 'eat-particle';
    p.textContent = sparks[Math.floor(Math.random()*sparks.length)];
    const angle = (Math.PI*2/5)*i;
    const dist = 30+Math.random()*40;
    p.style.cssText = `left:${cx}px;top:${cy}px;font-size:${16+Math.random()*12}px;--tx:${Math.cos(angle)*dist}px;--ty:${Math.sin(angle)*dist-20}px;--dur:${.4+Math.random()*.3}s`;
    area.appendChild(p);
    setTimeout(() => p.remove(), 700);
  }
  // ÎÉ† ÌÖçÏä§Ìä∏
  if (eat.count <= eat.target) {
    const yum = document.createElement('div');
    yum.className = 'eat-yum';
    yum.textContent = eat.count === eat.target ? 'Îî± ÎßûÏïÑ!' : `${eat.count}!`;
    yum.style.cssText = `left:${cx}px;top:${cy-10}px;color:${eat.count===eat.target?'#22c55e':'#f97316'}`;
    area.appendChild(yum);
    setTimeout(() => yum.remove(), 800);
  } else {
    const yum = document.createElement('div');
    yum.className = 'eat-yum';
    yum.textContent = 'ÎÑàÎ¨¥ ÎßéÏïÑ!';
    yum.style.cssText = `left:${cx}px;top:${cy-10}px;color:#ef4444`;
    area.appendChild(yum);
    setTimeout(() => yum.remove(), 800);
  }
}

function eatConfirm() {
  if (eat.confirmed) return;
  eat.confirmed = true;
  profile.totalPlayed++;

  if (eat.count === eat.target) {
    eat.score += 10 + eat.streak * 3;
    eat.streak++;
    eat.fed++;
    if (eat.streak > eat.bestStreak) eat.bestStreak = eat.streak;
    if (eat.score > eat.bestScore) eat.bestScore = eat.score;
    profile.totalCorrect++;
    setMouth('happy');
    SFX.fanfare();
    showScorePopup(document.querySelector('.eating-area'), 10 + eat.streak * 3);
    document.getElementById('eat-speech').textContent = 'ÎßõÏûàÎã§! Îî± ÎßûÏïÑ!';
    speak('Ï†ïÎãµ! ÎßõÏûàÍ≤å Î®πÏóàÏñ¥Ïöî!');
    eatSuccessEffect();
    setMascotEmotion('eat','happy');
  } else if (eat.count < eat.target) {
    eat.streak = 0;
    SFX.buzz();
    setMouth('sad');
    document.getElementById('eat-speech').textContent = 'ÏïÑÏßÅ Î∞∞Í≥†ÌååÏöî...';
    speak(`${eat.target - eat.count}Í∞ú Î∂ÄÏ°±Ìï¥Ïöî`);
    setMascotEmotion('eat','worried');
  } else {
    eat.streak = 0;
    SFX.buzz();
    setMouth('sick');
    document.getElementById('eat-speech').textContent = 'Î∞∞ ÌÑ∞Ï†∏Ïöî~!';
    speak(`${eat.count - eat.target}Í∞ú ÎÑàÎ¨¥ ÎßéÏïÑÏöî`);
  }

  updateEatUI();
  updateProfile();
  saveStats();
}

function eatRetry() {
  eat.count = 0;
  eat.confirmed = false;
  document.getElementById('eat-count').textContent = 0;
  document.getElementById('eat-count-side').textContent = 0;
  document.getElementById('eat-speech').textContent = `${FOOD_NAMES[eat.targetFruit]}Î•º ${eat.target}Í∞ú Î®πÏó¨Ï§ò!`;
  setMouth('smile');
  document.querySelectorAll('.food-item').forEach(f => f.classList.remove('eaten'));
}

function eatNext() { initEatGame(); }

function eatSuccessEffect() {
  const area = document.querySelector('.eating-area');
  const overlay = document.createElement('div');
  overlay.className = 'eat-success-overlay';
  area.appendChild(overlay);
  const colors = ['#ef4444','#f97316','#fbbf24','#22c55e','#3b82f6','#8b5cf6','#ec4899'];
  for (let i = 0; i < 30; i++) {
    const c = document.createElement('div');
    c.className = 'eat-confetti';
    c.style.cssText = `left:${Math.random()*100}%;top:-10px;background:${colors[Math.floor(Math.random()*colors.length)]};--tx:${(Math.random()-.5)*200}px;--ty:${200+Math.random()*300}px;--dur:${.8+Math.random()*.6}s;animation-delay:${Math.random()*.3}s;width:${6+Math.random()*8}px;height:${6+Math.random()*8}px;border-radius:${Math.random()>.5?'50%':'2px'}`;
    overlay.appendChild(c);
  }
  setTimeout(() => overlay.remove(), 1500);
}

function setMouth(state) {
  const m = document.getElementById('char-mouth');
  if (!m) return;
  switch(state) {
    case 'smile': m.setAttribute('d', 'M65 120 Q90 140 115 120'); break;
    case 'eating': m.setAttribute('d', 'M75 118 Q90 135 105 118'); break;
    case 'happy': m.setAttribute('d', 'M60 115 Q90 150 120 115'); break;
    case 'sad': m.setAttribute('d', 'M70 130 Q90 118 110 130'); break;
    case 'sick': m.setAttribute('d', 'M70 125 Q90 138 110 125 Q100 115 70 125'); m.setAttribute('fill', '#86efac'); break;
  }
  if (state !== 'sick') m.setAttribute('fill', 'none');
}

function updateEatUI() {
  document.getElementById('eat-score').textContent = eat.score;
  document.getElementById('eat-streak').textContent = eat.streak;
}

// ===== Ï∏µÏàò ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ =====
const FLOOR_THEMES = ['','üåä Î∞îÎã§','üå≤ Ïà≤','üè† ÎßàÏùÑ','üå∏ ÍΩÉÎ∞≠','‚òÅÔ∏è Íµ¨Î¶Ñ','üåô Îã¨','‚≠ê Î≥Ñ','üöÄ Ïö∞Ï£º','üåà Î¨¥ÏßÄÍ∞ú','üëë ÏôïÍ∂Å'];
const FLOOR_SVG_KEYS = ['','ocean','forest','house','flower','cloud','moon','star','rocket','rainbow','crown'];
const FLOOR_EMOJIS = FLOOR_SVG_KEYS.map(k => k ? FLOOR_SVG[k] : '');
const FLOOR_NAMES = ['','Î∞îÎã§','Ïà≤','ÎßàÏùÑ','ÍΩÉÎ∞≠','Íµ¨Î¶Ñ','Îã¨','Î≥Ñ','Ïö∞Ï£º','Î¨¥ÏßÄÍ∞ú','ÏôïÍ∂Å'];
const FLOOR_COLORS = [
  '',
  'linear-gradient(90deg,#a5f3fc,#67e8f9,#a5f3fc)',  // 1 Î∞îÎã§ ‚Äî soft cyan
  'linear-gradient(90deg,#bbf7d0,#86efac,#bbf7d0)',  // 2 Ïà≤ ‚Äî soft green
  'linear-gradient(90deg,#fed7aa,#fdba74,#fed7aa)',  // 3 ÎßàÏùÑ ‚Äî soft orange
  'linear-gradient(90deg,#fbcfe8,#f9a8d4,#fbcfe8)',  // 4 ÍΩÉÎ∞≠ ‚Äî soft pink
  'linear-gradient(90deg,#e0f2fe,#bae6fd,#e0f2fe)',  // 5 Íµ¨Î¶Ñ ‚Äî soft sky
  'linear-gradient(90deg,#bfdbfe,#93c5fd,#bfdbfe)',  // 6 Îã¨ ‚Äî soft blue
  'linear-gradient(90deg,#ddd6fe,#c4b5fd,#ddd6fe)',  // 7 Î≥Ñ ‚Äî soft purple
  'linear-gradient(90deg,#334155,#475569,#334155)',  // 8 Ïö∞Ï£º ‚Äî muted dark
  'linear-gradient(90deg,#fecaca,#fde68a,#bbf7d0,#bfdbfe,#ddd6fe)', // 9 Î¨¥ÏßÄÍ∞ú ‚Äî pastel rainbow
  'linear-gradient(90deg,#fef3c7,#fde68a,#fef3c7)'   // 10 ÏôïÍ∂Å ‚Äî soft gold
];
const FLOOR_GLOW = ['','#67e8f9','#86efac','#fdba74','#f9a8d4','#bae6fd','#93c5fd','#c4b5fd','#64748b','#fde68a','#fde68a'];

function initElevator() {
  const shaft = document.getElementById('building-shaft');
  const car = document.getElementById('elevator-car');
  // Ï∏µÎ≥Ñ ÏÉâÏÉÅ Î∞∞Í≤ΩÏù¥ ÏûàÎäî Í±¥Î¨º Î†åÎçî
  for (let i = 10; i >= 1; i--) {
    const top = (10 - i) * 10;
    const fl = document.createElement('div');
    fl.className = 'shaft-floor';
    fl.id = 'sf-' + i;
    fl.style.top = top + '%';
    fl.innerHTML = `<div class="sf-num">${i}</div><div class="sf-content"><span class="sf-emoji">${FLOOR_EMOJIS[i]}</span><span>${FLOOR_NAMES[i]}</span></div>`;
    shaft.insertBefore(fl, car);
  }

  // Î≤ÑÌäº Ìå®ÎÑê
  const btns = document.getElementById('floor-btns');
  let btnHtml = '';
  for (let i = 10; i >= 1; i--) {
    btnHtml += `<div class="elev-btn" onclick="selectFloor(${i})" id="fb-${i}">${i}</div>`;
  }
  btns.innerHTML = btnHtml;

  newElevQuestion();
}

function newElevQuestion() {
  const maxFloor = 10;
  const isUp = Math.random() > 0.3;
  if (isUp) {
    elev.startFloor = Math.floor(Math.random() * 7) + 1;
    elev.delta = Math.floor(Math.random() * (maxFloor - elev.startFloor)) + 1;
    elev.answer = elev.startFloor + elev.delta;
    document.getElementById('elev-q').textContent = `${elev.startFloor}Ï∏µÏóêÏÑú ${elev.delta}Ïπ∏ Ïò¨ÎùºÍ∞ÄÎ©¥?`;
  } else {
    elev.startFloor = Math.floor(Math.random() * 7) + 4;
    elev.delta = Math.floor(Math.random() * (elev.startFloor - 1)) + 1;
    elev.answer = elev.startFloor - elev.delta;
    document.getElementById('elev-q').textContent = `${elev.startFloor}Ï∏µÏóêÏÑú ${elev.delta}Ïπ∏ ÎÇ¥Î†§Í∞ÄÎ©¥?`;
  }

  elev.currentFloor = elev.startFloor;
  moveElevator(elev.startFloor, false);

  // Î≤ÑÌäº Î¶¨ÏÖã
  document.querySelectorAll('.elev-btn').forEach(b => b.classList.remove('current','correct-floor'));
  const curBtn = document.getElementById('fb-' + elev.startFloor);
  if (curBtn) curBtn.classList.add('current');

  // Î∞©Ìñ• ÌëúÏãú
  const isGoingUp = elev.answer > elev.startFloor;
  document.getElementById('elev-arrow-up').classList.toggle('active', isGoingUp);
  document.getElementById('elev-arrow-down').classList.toggle('active', !isGoingUp);

  document.getElementById('elev-result').textContent = '';
  document.getElementById('elev-result').style.background = '';
  document.getElementById('elev-result').style.color = '';
  document.getElementById('elev-qnum').textContent = elev.qNum;
}

function moveElevator(floor, animate) {
  const car = document.getElementById('elevator-car');
  const bottom = (floor - 1) * 10;
  car.style.transition = animate ? 'bottom .8s cubic-bezier(.34,1.56,.64,1)' : 'none';
  car.style.bottom = bottom + '%';
  // LED ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
  document.getElementById('elev-led').textContent = floor;
  // Ïπ¥ ÌëúÏãúÎì± ÏÉâÏÉÅ
  const light = document.getElementById('elev-car-light');
  if (light) { light.style.background = '#22c55e'; light.style.boxShadow = '0 0 12px #22c55e,0 0 24px rgba(34,197,94,.3)'; }
}

function selectFloor(floor) {
  SFX.pop();
  moveElevator(floor, true);
  elev.currentFloor = floor;
  profile.totalPlayed++;

  setTimeout(() => {
    if (floor === elev.answer) {
      elev.score += 10;
      elev.correctCount++;
      elev.visited.add(floor);
      if (elev.score > elev.bestScore) elev.bestScore = elev.score;
      profile.totalCorrect++;

      const btn = document.getElementById('fb-' + floor);
      if (btn) btn.classList.add('correct-floor');
      // Ïπ¥ ÌëúÏãúÎì± Ï¥àÎ°ù
      const light = document.getElementById('elev-car-light');
      if (light) { light.style.background = '#22c55e'; light.style.boxShadow = '0 0 16px #22c55e,0 0 30px rgba(34,197,94,.5)'; }

      showScorePopup(document.querySelector('.elevator-area'), 10);
      // ÎèÑÏ∞© Ï∂ïÌïò Ïù¥ÌéôÌä∏!
      elevArriveEffect(floor);

      // Ï∏µ ÌïòÏù¥ÎùºÏù¥Ìä∏
      const sf = document.getElementById('sf-' + floor);
      if (sf) { sf.classList.add('floor-highlight'); setTimeout(() => sf.classList.remove('floor-highlight'), 1500); }

      document.getElementById('elev-result').innerHTML = `<span style="display:inline-flex;align-items:center;gap:6px">üéâ Ï†ïÎãµ! ${floor}Ï∏µ ‚Äî <span style="display:inline-block;width:28px;height:28px;vertical-align:middle">${FLOOR_EMOJIS[floor]}</span>${FLOOR_NAMES[floor]}</span>`;
      document.getElementById('elev-result').style.background = '#f0fdf4';
      document.getElementById('elev-result').style.color = '#16a34a';
      speak(`Îî©Îèô! ${floor}Ï∏µ!`);
      SFX.elevDing();

      updateElevUI();
      updateProfile();
      saveStats();
      setTimeout(() => { elev.qNum++; newElevQuestion(); }, 2000);
    } else {
      // Ïπ¥ ÌëúÏãúÎì± Îπ®Í∞ï
      const light = document.getElementById('elev-car-light');
      if (light) { light.style.background = '#ef4444'; light.style.boxShadow = '0 0 12px #ef4444,0 0 24px rgba(239,68,68,.3)'; }

      // Ïò§Îãµ ÌùîÎì§Î¶º
      const shaft = document.getElementById('building-shaft');
      shaft.classList.add('elev-wrong-shake');
      setTimeout(() => shaft.classList.remove('elev-wrong-shake'), 400);

      SFX.elevBuzz();

      document.getElementById('elev-result').textContent = `‚ùå ${floor}Ï∏µÏù¥ ÏïÑÎãàÏóêÏöî! Îã§Ïãú Í∞ÄÎ≥ºÍπå?`;
      document.getElementById('elev-result').style.background = '#fef2f2';
      document.getElementById('elev-result').style.color = '#dc2626';
      speak('Îã§Ïãú ÏÉùÍ∞ÅÌï¥ Î≥ºÍπåÏöî?');
      setTimeout(() => {
        moveElevator(elev.startFloor, true);
        setTimeout(() => {
          const l = document.getElementById('elev-car-light');
          if (l) { l.style.background = '#22c55e'; l.style.boxShadow = '0 0 12px #22c55e,0 0 24px rgba(34,197,94,.3)'; }
        }, 800);
      }, 800);
      saveStats();
    }
  }, 900);
}

function elevArriveEffect(floor) {
  const shaft = document.getElementById('building-shaft');
  const car = document.getElementById('elevator-car');
  const shaftRect = shaft.getBoundingClientRect();
  const carRect = car.getBoundingClientRect();
  const cx = (carRect.left - shaftRect.left) + carRect.width / 2;
  const cy = (carRect.top - shaftRect.top) + carRect.height / 2;

  // Ïπ¥ ÎèÑÏ∞© ÌéÑÏä§
  car.classList.add('arriving');
  setTimeout(() => car.classList.remove('arriving'), 600);

  // Îî©Îèô Ïù¥Î™®ÏßÄ
  const ding = document.createElement('div');
  ding.className = 'elev-ding';
  ding.textContent = 'üîî';
  shaft.appendChild(ding);
  setTimeout(() => ding.remove(), 1000);

  // ÌÖåÎßà SVG ÌååÌã∞ÌÅ¥ Ìè≠Î∞ú
  const floorSvg = FLOOR_EMOJIS[floor];
  const sparkleSvg = `<svg viewBox="0 0 30 30" width="100%" height="100%"><polygon points="15,2 17,12 27,15 17,18 15,28 13,18 3,15 13,12" fill="#fbbf24" filter="drop-shadow(0 0 3px rgba(251,191,36,.6))"/></svg>`;
  const glowColor = FLOOR_GLOW[floor] || '#f97316';
  for (let i = 0; i < 10; i++) {
    const p = document.createElement('div');
    p.className = 'elev-arrive-particle';
    const angle = (Math.PI * 2 / 10) * i;
    const dist = 40 + Math.random() * 70;
    const dur = 0.5 + Math.random() * 0.3;
    const sz = 18 + Math.random() * 16;
    p.innerHTML = i % 2 === 0 ? `<span style="display:inline-block;width:${sz}px;height:${sz}px">${floorSvg}</span>` : `<span style="display:inline-block;width:${sz}px;height:${sz}px">${sparkleSvg}</span>`;
    p.style.cssText = `left:${cx}px;top:${cy}px;--tx:${Math.cos(angle)*dist}px;--ty:${Math.sin(angle)*dist}px;--dur:${dur}s`;
    shaft.appendChild(p);
    setTimeout(() => p.remove(), dur * 1000 + 100);
  }

  // ÌÖåÎßà ÏÉâÏÉÅ ÎßÅ
  for (let i = 0; i < 2; i++) {
    setTimeout(() => {
      const ring = document.createElement('div');
      ring.className = 'elev-arrive-ring';
      const size = 120 + i * 80;
      ring.style.cssText = `left:${cx}px;top:${cy}px;width:${size}px;height:${size}px;border:4px solid ${glowColor};box-shadow:0 0 20px ${glowColor}`;
      shaft.appendChild(ring);
      setTimeout(() => ring.remove(), 700);
    }, i * 120);
  }
}

function elevHint() {
  const dir = elev.answer > elev.startFloor ? 'ÏúÑ' : 'ÏïÑÎûò';
  speak(`Ï†ïÎãµÏùÄ ${dir}Ïóê ÏûàÏñ¥Ïöî`);
}

function elevRetry() {
  moveElevator(elev.startFloor, true);
  document.getElementById('elev-result').textContent = '';
  document.getElementById('elev-result').style.background = '';
}

function updateElevUI() {
  document.getElementById('elev-score').textContent = elev.score;
  document.getElementById('elev-visited').textContent = elev.visited.size;
}

// ===== ÎÇ¥ Í∏∞Î°ù =====
function updateRecords() {
  document.getElementById('r-total').textContent = profile.totalPlayed;
  document.getElementById('r-correct').textContent = profile.totalCorrect;
  document.getElementById('r-rate').textContent = profile.totalPlayed ? Math.round(profile.totalCorrect / profile.totalPlayed * 100) + '%' : '0%';
  document.getElementById('rec-total').textContent = profile.totalPlayed;
  document.getElementById('rec-rate').textContent = profile.totalPlayed ? Math.round(profile.totalCorrect / profile.totalPlayed * 100) + '%' : '0%';
  document.getElementById('r-bomb-defused').textContent = bomb.defused;
  document.getElementById('r-bomb-best').textContent = bomb.bestStreak;
  document.getElementById('r-bomb-score').textContent = bomb.bestScore;
  document.getElementById('r-eat-fed').textContent = eat.fed;
  document.getElementById('r-eat-best').textContent = eat.bestStreak;
  document.getElementById('r-eat-score').textContent = eat.bestScore;
  document.getElementById('r-elev-correct').textContent = elev.correctCount;
  document.getElementById('r-elev-floors').textContent = elev.visited.size;
  document.getElementById('r-elev-score').textContent = elev.bestScore;
  document.getElementById('r-hero-score').textContent = hg.bestScore;
}

// ===== ÌûàÏñ¥Î°ú: Ïó∞ÏÇ∞ Ìè≠Í≤© =====
function startHeroGame() {
  try{document.documentElement.requestFullscreen?.()}catch(e){}
  SFX.gameStart();
  document.getElementById('hero-game').classList.remove('hidden');
  hg.score = 0; hg.lives = 5; hg.level = 1; hg.running = true; hg.paused = false;
  hg.bombs = []; hg.combo = 0; hg.maxCombo = 0;
  updateHgUI();
  addHgDecorations();
  hgLoop();
}

function addHgDecorations() {
  const arena = document.getElementById('hg-arena');
  arena.querySelectorAll('.hg-cloud,.hg-deco,.hg-bg-sparkle').forEach(c => c.remove());
  // SVG Íµ¨Î¶Ñ 5Í∞ú
  for (let i = 0; i < 5; i++) {
    const c = document.createElement('div');
    c.className = 'hg-cloud';
    c.innerHTML = '<svg width="80" height="48" viewBox="0 0 80 48"><ellipse cx="40" cy="30" rx="36" ry="16" fill="#fff" opacity=".7"/><ellipse cx="28" cy="22" rx="20" ry="14" fill="#fff" opacity=".8"/><ellipse cx="52" cy="20" rx="22" ry="15" fill="#fff" opacity=".75"/><ellipse cx="40" cy="18" rx="18" ry="12" fill="#fff" opacity=".85"/></svg>';
    c.style.top = (Math.random() * 35) + '%';
    c.style.animationDelay = -(Math.random() * 20) + 's';
    arena.appendChild(c);
  }
  // ÏàòÌïô SVG Ïû•Ïãù 10Í∞ú
  const mathSVGs = [
    '<svg width="50" height="50" viewBox="0 0 50 50"><text x="25" y="35" text-anchor="middle" font-size="36" font-weight="900" fill="#f97316">+</text></svg>',
    '<svg width="50" height="50" viewBox="0 0 50 50"><text x="25" y="35" text-anchor="middle" font-size="36" font-weight="900" fill="#3b82f6">\u2212</text></svg>',
    '<svg width="50" height="50" viewBox="0 0 50 50"><text x="25" y="35" text-anchor="middle" font-size="36" font-weight="900" fill="#22c55e">\u00d7</text></svg>',
    '<svg width="50" height="50" viewBox="0 0 50 50"><text x="25" y="35" text-anchor="middle" font-size="36" font-weight="900" fill="#a855f7">\u00f7</text></svg>',
    '<svg width="50" height="50" viewBox="0 0 50 50"><text x="25" y="35" text-anchor="middle" font-size="36" font-weight="900" fill="#ef4444">=</text></svg>',
    '<svg width="55" height="55" viewBox="0 0 55 55"><circle cx="27" cy="27" r="24" fill="none" stroke="#f97316" stroke-width="3"/><text x="27" y="34" text-anchor="middle" font-size="24" font-weight="900" fill="#f97316">7</text></svg>',
    '<svg width="55" height="55" viewBox="0 0 55 55"><circle cx="27" cy="27" r="24" fill="none" stroke="#3b82f6" stroke-width="3"/><text x="27" y="34" text-anchor="middle" font-size="24" font-weight="900" fill="#3b82f6">3</text></svg>',
    '<svg width="55" height="55" viewBox="0 0 55 55"><rect x="4" y="4" width="47" height="47" rx="8" fill="none" stroke="#22c55e" stroke-width="3"/><text x="27" y="34" text-anchor="middle" font-size="22" font-weight="900" fill="#22c55e">42</text></svg>',
    '<svg width="60" height="50" viewBox="0 0 60 50"><polygon points="30,2 38,18 56,20 42,33 46,50 30,42 14,50 18,33 4,20 22,18" fill="none" stroke="#eab308" stroke-width="2.5"/></svg>',
    '<svg width="55" height="55" viewBox="0 0 55 55"><rect x="6" y="6" width="43" height="43" rx="6" fill="none" stroke="#6366f1" stroke-width="2.5"/><line x1="6" y1="20" x2="49" y2="20" stroke="#6366f1" stroke-width="1.5"/><line x1="6" y1="34" x2="49" y2="34" stroke="#6366f1" stroke-width="1.5"/><line x1="20" y1="6" x2="20" y2="49" stroke="#6366f1" stroke-width="1.5"/><line x1="35" y1="6" x2="35" y2="49" stroke="#6366f1" stroke-width="1.5"/></svg>'
  ];
  for (let i = 0; i < 10; i++) {
    const d = document.createElement('div');
    d.className = 'hg-deco';
    d.innerHTML = mathSVGs[i];
    d.style.left = (i * 180 + Math.random() * 100) + 'px';
    d.style.top = (80 + Math.random() * 500) + 'px';
    d.style.setProperty('--dur', (5 + Math.random() * 4) + 's');
    d.style.animationDelay = -(i * 0.6) + 's';
    arena.appendChild(d);
  }
  // Î∞òÏßùÏù¥ 12Í∞ú
  const sparkColors = ['#f97316','#fb923c','#fdba74','#fbbf24','#f59e0b','#eab308'];
  for (let i = 0; i < 12; i++) {
    const s = document.createElement('div');
    s.className = 'hg-bg-sparkle';
    const sz = 4 + Math.random() * 6;
    s.style.cssText = 'width:'+sz+'px;height:'+sz+'px;border-radius:50%;background:'+sparkColors[i%sparkColors.length]+';left:'+(Math.random()*95)+'%;top:'+(Math.random()*80)+'%';
    s.style.setProperty('--dur', (2 + Math.random() * 2) + 's');
    s.style.animationDelay = -(Math.random() * 3) + 's';
    arena.appendChild(s);
  }
}

function hgLoop() {
  const interval = Math.max(1500, 3500 - hg.level * 300);
  if (hg.spawnTimer) clearInterval(hg.spawnTimer);
  hg.spawnTimer = setInterval(() => {
    if (!hg.paused && hg.running) hgSpawn();
  }, interval);
  function tick() {
    if (!hg.running) return;
    if (!hg.paused) hgMove();
    hg.animId = requestAnimationFrame(tick);
  }
  hg.animId = requestAnimationFrame(tick);
}

let _obId = 0;
function getObstacleType() {
  const lv = hg.level;
  const pool = ['bomb'];
  if (lv >= 3) pool.push('missile');
  if (lv >= 4) pool.push('meteor');
  if (lv >= 5) pool.push('robot', 'ghost');
  return pool[Math.floor(Math.random() * pool.length)];
}

function generateMath(type) {
  let a, b, ans, text;
  switch(type) {
    case 'bomb': // ÎçßÏÖà
      a = Math.floor(Math.random() * 5) + 1;
      b = Math.floor(Math.random() * (9 - a)) + 1;
      ans = a + b; text = `${a}+${b}=?`; break;
    case 'missile': // Î∫ÑÏÖà
      a = Math.floor(Math.random() * 8) + 2;
      b = Math.floor(Math.random() * (a - 1)) + 1;
      ans = a - b; text = `${a}-${b}=?`; break;
    case 'meteor': // Í≥±ÏÖà
      a = Math.floor(Math.random() * 3) + 2;
      b = Math.floor(Math.random() * Math.floor(9 / a)) + 1;
      ans = a * b; text = `${a}√ó${b}=?`; break;
    case 'robot': // ÌÅ∞Ïàò Î∫ÑÏÖà
      ans = Math.floor(Math.random() * 9) + 1;
      b = Math.floor(Math.random() * 9) + 1;
      a = ans + b; text = `${a}-${b}=?`; break;
    case 'ghost': // ÎπàÏπ∏
      a = Math.floor(Math.random() * 8) + 1;
      b = Math.floor(Math.random() * 8) + 1;
      ans = a; text = `?+${b}=${a + b}`; break;
    default:
      a = 1; b = 1; ans = 2; text = '1+1=?';
  }
  return { ans, text };
}

function getObstacleHTML(type, text) {
  const id = ++_obId;
  switch(type) {
    case 'bomb':
      return `<div class="fb-fuse"></div><div class="fb-body"><div class="fb-text">${text}</div></div>`;
    case 'missile':
      return `<svg viewBox="0 0 80 110" width="80" height="110">
<defs><linearGradient id="mg${id}" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#fee2e2"/><stop offset="40%" stop-color="#ef4444"/><stop offset="100%" stop-color="#991b1b"/></linearGradient></defs>
<path d="M40,4 C28,4 20,20 20,38 L20,68 C20,73 25,76 30,76 L50,76 C55,76 60,73 60,68 L60,38 C60,20 52,4 40,4Z" fill="url(#mg${id})" stroke="#b91c1c" stroke-width="1.5"/>
<polygon points="12,68 22,52 22,74" fill="#7f1d1d"/><polygon points="68,68 58,52 58,74" fill="#7f1d1d"/>
<rect x="24" y="28" width="32" height="22" rx="3" fill="rgba(0,0,0,.35)"/>
<text x="40" y="42" text-anchor="middle" dominant-baseline="middle" fill="#fff" font-size="13" font-weight="900">${text}</text>
<ellipse cx="40" cy="88" rx="14" ry="10" fill="#fbbf24" opacity=".85"><animate attributeName="ry" values="10;16;10" dur=".3s" repeatCount="indefinite"/></ellipse>
<ellipse cx="40" cy="95" rx="8" ry="8" fill="#f97316" opacity=".6"><animate attributeName="ry" values="8;14;8" dur=".25s" repeatCount="indefinite"/></ellipse>
<ellipse cx="40" cy="100" rx="4" ry="5" fill="#fef3c7" opacity=".5"><animate attributeName="ry" values="5;9;5" dur=".2s" repeatCount="indefinite"/></ellipse>
</svg>`;
    case 'meteor':
      return `<svg viewBox="0 0 90 90" width="90" height="90">
<defs><radialGradient id="mtg${id}" cx="40%" cy="35%"><stop offset="0%" stop-color="#d97706"/><stop offset="50%" stop-color="#78350f"/><stop offset="100%" stop-color="#451a03"/></radialGradient></defs>
<path d="M45,6 C62,6 80,18 84,36 C88,54 78,70 64,80 C50,90 32,90 20,80 C8,70 2,54 8,36 C14,18 28,6 45,6Z" fill="url(#mtg${id})" stroke="#92400e" stroke-width="1.5"/>
<circle cx="28" cy="30" r="7" fill="#451a03" opacity=".35"/><circle cx="58" cy="55" r="5" fill="#451a03" opacity=".3"/><circle cx="65" cy="28" r="4" fill="#451a03" opacity=".25"/>
<ellipse cx="35" cy="22" rx="10" ry="5" fill="rgba(255,255,255,.12)" transform="rotate(-20,35,22)"/>
<rect x="18" y="33" width="54" height="22" rx="4" fill="rgba(0,0,0,.35)"/>
<text x="45" y="47" text-anchor="middle" dominant-baseline="middle" fill="#fef3c7" font-size="14" font-weight="900">${text}</text>
<circle cx="20" cy="10" r="4" fill="#f97316" opacity=".7"><animate attributeName="r" values="4;7;4" dur=".4s" repeatCount="indefinite"/></circle>
<circle cx="70" cy="8" r="3" fill="#fbbf24" opacity=".6"><animate attributeName="r" values="3;5;3" dur=".35s" repeatCount="indefinite"/></circle>
</svg>`;
    case 'robot':
      return `<svg viewBox="0 0 80 100" width="80" height="100">
<defs><linearGradient id="rbg${id}" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#e2e8f0"/><stop offset="50%" stop-color="#94a3b8"/><stop offset="100%" stop-color="#64748b"/></linearGradient></defs>
<line x1="40" y1="0" x2="40" y2="12" stroke="#94a3b8" stroke-width="3"/>
<circle cx="40" cy="4" r="5" fill="#ef4444"><animate attributeName="fill" values="#ef4444;#22c55e;#3b82f6;#ef4444" dur="2s" repeatCount="indefinite"/></circle>
<rect x="12" y="14" width="56" height="52" rx="8" fill="url(#rbg${id})" stroke="#475569" stroke-width="1.5"/>
<rect x="2" y="32" width="10" height="14" rx="3" fill="#94a3b8"/><rect x="68" y="32" width="10" height="14" rx="3" fill="#94a3b8"/>
<circle cx="28" cy="30" r="7" fill="#1e293b"/><circle cx="28" cy="30" r="5" fill="#22c55e"><animate attributeName="fill" values="#22c55e;#86efac;#22c55e" dur="1.5s" repeatCount="indefinite"/></circle>
<circle cx="52" cy="30" r="7" fill="#1e293b"/><circle cx="52" cy="30" r="5" fill="#22c55e"><animate attributeName="fill" values="#22c55e;#86efac;#22c55e" dur="1.5s" repeatCount="indefinite" begin=".3s"/></circle>
<rect x="18" y="44" width="44" height="16" rx="3" fill="#0f172a"/>
<text x="40" y="55" text-anchor="middle" dominant-baseline="middle" fill="#4ade80" font-size="13" font-weight="900" font-family="monospace">${text}</text>
<rect x="20" y="70" width="14" height="22" rx="4" fill="#94a3b8" stroke="#475569" stroke-width="1"/>
<rect x="46" y="70" width="14" height="22" rx="4" fill="#94a3b8" stroke="#475569" stroke-width="1"/>
</svg>`;
    case 'ghost':
      return `<svg viewBox="0 0 80 100" width="80" height="100" style="opacity:.85">
<defs><linearGradient id="gg${id}" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="rgba(243,232,255,.9)"/><stop offset="100%" stop-color="rgba(192,132,252,.65)"/></linearGradient></defs>
<path d="M40,6 C18,6 6,24 6,44 L6,80 Q10,76 14,80 Q18,84 22,80 Q26,76 30,80 Q34,84 38,80 Q42,76 46,80 Q50,84 54,80 Q58,76 62,80 Q66,84 70,80 Q74,76 74,80 L74,44 C74,24 62,6 40,6Z" fill="url(#gg${id})" stroke="rgba(147,51,234,.35)" stroke-width="1.5">
<animate attributeName="d" dur="2s" repeatCount="indefinite" values="M40,6 C18,6 6,24 6,44 L6,80 Q10,76 14,80 Q18,84 22,80 Q26,76 30,80 Q34,84 38,80 Q42,76 46,80 Q50,84 54,80 Q58,76 62,80 Q66,84 70,80 Q74,76 74,80 L74,44 C74,24 62,6 40,6Z;M40,6 C18,6 6,24 6,44 L6,82 Q10,78 14,82 Q18,78 22,82 Q26,78 30,82 Q34,78 38,82 Q42,78 46,82 Q50,78 54,82 Q58,78 62,82 Q66,78 70,82 Q74,78 74,82 L74,44 C74,24 62,6 40,6Z;M40,6 C18,6 6,24 6,44 L6,80 Q10,76 14,80 Q18,84 22,80 Q26,76 30,80 Q34,84 38,80 Q42,76 46,80 Q50,84 54,80 Q58,76 62,80 Q66,84 70,80 Q74,76 74,80 L74,44 C74,24 62,6 40,6Z"/>
</path>
<ellipse cx="28" cy="36" rx="10" ry="12" fill="#1e1b4b" opacity=".65"/>
<circle cx="30" cy="36" r="4" fill="#fff" opacity=".8"><animate attributeName="cx" values="30;26;30" dur="3s" repeatCount="indefinite"/></circle>
<ellipse cx="52" cy="36" rx="10" ry="12" fill="#1e1b4b" opacity=".65"/>
<circle cx="54" cy="36" r="4" fill="#fff" opacity=".8"><animate attributeName="cx" values="54;50;54" dur="3s" repeatCount="indefinite" begin=".5s"/></circle>
<rect x="16" y="54" width="48" height="18" rx="4" fill="rgba(30,27,75,.4)"/>
<text x="40" y="66" text-anchor="middle" dominant-baseline="middle" fill="#e9d5ff" font-size="13" font-weight="900">${text}</text>
</svg>`;
  }
  return '';
}

function getPowerupHTML(fx) {
  switch(fx) {
    case 'life':
      return `<svg viewBox="0 0 56 56" width="56" height="56"><path d="M28,48 C12,36 4,26 4,17 C4,8 10,3 17,3 C21,3 25,5 28,10 C31,5 35,3 39,3 C46,3 52,8 52,17 C52,26 44,36 28,48Z" fill="#ef4444" stroke="#dc2626" stroke-width="1.5"><animate attributeName="d" dur=".8s" repeatCount="indefinite" values="M28,48 C12,36 4,26 4,17 C4,8 10,3 17,3 C21,3 25,5 28,10 C31,5 35,3 39,3 C46,3 52,8 52,17 C52,26 44,36 28,48Z;M28,46 C14,35 6,26 6,18 C6,10 11,5 17,5 C21,5 25,7 28,12 C31,7 35,5 39,5 C45,5 50,10 50,18 C50,26 42,35 28,46Z;M28,48 C12,36 4,26 4,17 C4,8 10,3 17,3 C21,3 25,5 28,10 C31,5 35,3 39,3 C46,3 52,8 52,17 C52,26 44,36 28,48Z"/></path><ellipse cx="17" cy="17" rx="6" ry="4" fill="#fff" opacity=".35" transform="rotate(-30,17,17)"/></svg>`;
    case 'slow':
      return `<svg viewBox="0 0 56 56" width="56" height="56"><circle cx="28" cy="28" r="24" fill="#0891b2" stroke="#06b6d4" stroke-width="2"/><circle cx="28" cy="28" r="20" fill="#ecfeff"/><circle cx="28" cy="28" r="2.5" fill="#0e7490"/><line x1="28" y1="28" x2="28" y2="14" stroke="#0e7490" stroke-width="2.5" stroke-linecap="round"><animateTransform attributeName="transform" type="rotate" from="0 28 28" to="360 28 28" dur="4s" repeatCount="indefinite"/></line><line x1="28" y1="28" x2="38" y2="28" stroke="#0891b2" stroke-width="2" stroke-linecap="round"><animateTransform attributeName="transform" type="rotate" from="0 28 28" to="360 28 28" dur="12s" repeatCount="indefinite"/></line></svg>`;
    case 'points':
      return `<svg viewBox="0 0 56 56" width="56" height="56"><polygon points="28,4 34,20 52,20 38,30 42,48 28,38 14,48 18,30 4,20 22,20" fill="#818cf8" stroke="#6366f1" stroke-width="1.5"/><polygon points="28,4 22,20 28,20 34,20" fill="#c7d2fe" opacity=".5"/><polygon points="28,4 34,20 28,38" fill="#a5b4fc" opacity=".4"/><circle cx="20" cy="16" r="3" fill="#fff" opacity=".5"><animate attributeName="opacity" values=".3;.7;.3" dur="1.2s" repeatCount="indefinite"/></circle></svg>`;
  }
  return '';
}

function hgSpawn() {
  if (Math.random() < 0.06) { hgSpawnPower(); return; }
  const arena = document.getElementById('hg-arena');
  const w = arena.offsetWidth;
  const type = getObstacleType();
  const { ans, text } = generateMath(type);

  const el = document.createElement('div');
  el.className = `falling-bomb ob-${type}`;
  el.innerHTML = getObstacleHTML(type, text);
  el.style.left = (Math.random() * (w - 90) + 10) + 'px';
  el.style.top = '-110px';
  arena.appendChild(el);

  const baseSpeed = type === 'missile' ? 0.4 : type === 'ghost' ? 0.2 : 0.3;
  const speed = baseSpeed + hg.level * 0.07 + Math.random() * 0.12;
  const sway = type === 'ghost' ? (Math.random() - 0.5) * 2.5 : (Math.random() - 0.5) * 1.5;
  hg.bombs.push({ el, y: -110, x: parseFloat(el.style.left), speed, sway, ans, text, type });
}

function hgSpawnPower() {
  const types = [{fx:'life'},{fx:'slow'},{fx:'points'}];
  const t = types[Math.floor(Math.random() * types.length)];
  const arena = document.getElementById('hg-arena');
  const w = arena.offsetWidth;
  const el = document.createElement('div');
  el.className = 'falling-bomb ob-power';
  el.innerHTML = getPowerupHTML(t.fx);
  el.style.left = (Math.random() * (w - 60) + 10) + 'px';
  el.style.top = '-70px';
  el.onclick = () => hgPowerUp(t.fx, el);
  arena.appendChild(el);
  hg.bombs.push({ el, y: -70, x: parseFloat(el.style.left), speed: 0.22, sway: 0, ans: -999, isPower: true, fx: t.fx });
}

function hgPowerUp(fx, el) {
  SFX.powerup();
  if (fx === 'life') hg.lives = Math.min(hg.lives + 1, 7);
  else if (fx === 'slow') { hg.bombs.forEach(b => b.speed *= 0.5); setTimeout(() => hg.bombs.forEach(b => b.speed *= 2), 3000); }
  else if (fx === 'points') hg.score += 5;
  hg.bombs = hg.bombs.filter(b => b.el !== el);
  el.remove();
  updateHgUI();
}

function hgMove() {
  const arena = document.getElementById('hg-arena');
  const groundY = arena.offsetHeight * 0.88;
  const arenaW = arena.offsetWidth;
  hg.bombs = hg.bombs.filter(item => {
    item.y += item.speed;
    if (item.sway) {
      item.x += Math.sin(item.y / 80) * item.sway * 0.3;
      item.x = Math.max(5, Math.min(arenaW - 85, item.x));
      item.el.style.left = item.x + 'px';
    }
    item.el.style.top = item.y + 'px';
    if (item.y >= groundY) {
      if (item.isPower) { item.el.remove(); return false; }
      hgMissEffect(item.el, item.type || 'bomb');
      item.el.remove();
      hg.lives--; hg.combo = 0;
      SFX.boom();
      speak('Ìéë!');
      updateHgUI();
      if (hg.lives <= 0) hgEnd();
      return false;
    }
    return true;
  });
}

const MISS_FX = { bomb:'üí•', missile:'üî•', meteor:'üí´', robot:'‚ö°', ghost:'üëª' };
const MATCH_FX = { bomb:['‚≠ê','‚ú®','üåü'], missile:['üî•','üí®','‚ú®'], meteor:['üíé','ü™®','‚ú®'], robot:['‚ö°','üîß','üí´'], ghost:['üåÄ','‚ú®','üëª'] };

function hgMissEffect(el, type) {
  const a = document.getElementById('hg-arena');
  const emoji = MISS_FX[type] || 'üí•';
  const e = document.createElement('div');
  e.className = 'char-explode'; e.textContent = emoji;
  e.style.left = el.style.left; e.style.top = el.style.top;
  a.appendChild(e);
  setTimeout(() => e.remove(), 800);
  // ÌÉÄÏûÖÎ≥Ñ Ï∂îÍ∞Ä ÌååÌã∞ÌÅ¥
  const particles = type === 'missile' ? ['üî•','üí®','üî•'] : type === 'meteor' ? ['ü™®','üí´','ü™®'] : type === 'robot' ? ['‚ö°','üí•','‚ö°'] : type === 'ghost' ? ['üëª','üåÄ','üíú'] : ['üí•','üí¢','üí•'];
  particles.forEach((p) => {
    const b = document.createElement('div');
    b.className = 'star-burst'; b.textContent = p;
    b.style.left = (parseFloat(el.style.left) + (Math.random()-0.5)*80) + 'px';
    b.style.top = (parseFloat(el.style.top) + (Math.random()-0.5)*40) + 'px';
    a.appendChild(b);
    setTimeout(() => b.remove(), 600);
  });
  const mf = document.createElement('div');
  mf.className = 'hg-miss-flash';
  a.appendChild(mf);
  setTimeout(() => mf.remove(), 400);
  a.classList.add('hg-arena-shake');
  setTimeout(() => a.classList.remove('hg-arena-shake'), 400);
}

function hgMatchEffect(el, type) {
  const a = document.getElementById('hg-arena');
  const fx = MATCH_FX[type] || MATCH_FX.bomb;
  const e = document.createElement('div');
  e.className = 'char-explode'; e.textContent = fx[0];
  e.style.left = el.style.left; e.style.top = el.style.top;
  a.appendChild(e);
  fx.forEach((s) => {
    const b = document.createElement('div');
    b.className = 'star-burst'; b.textContent = s;
    b.style.left = (parseFloat(el.style.left) + (Math.random()-0.5)*60) + 'px';
    b.style.top = el.style.top;
    a.appendChild(b);
    setTimeout(() => b.remove(), 600);
  });
  setTimeout(() => e.remove(), 800);
}

function hgAnswer(n) {
  if (!hg.running || hg.paused) return;
  SFX.pop();
  // nÏù¥ ÌïúÏûêÎ¶¨ ‚Üí ÏßÅÏ†ë Îß§Ïπ≠. ÎëêÏûêÎ¶¨Î©¥ ÏûÖÎ†• Î™®Îìú ÌïÑÏöîÌïòÏßÄÎßå ÏùºÎã® ÌïúÏûêÎ¶¨ Í∏∞Ï§Ä
  let matched = null;
  for (const b of hg.bombs) {
    if (!b.isPower && b.ans === n) { matched = b; break; }
  }
  if (matched) {
    hg.combo++;
    if (hg.combo > hg.maxCombo) hg.maxCombo = hg.combo;
    const bonus = Math.min(hg.combo - 1, 5);
    hg.score += 1 + bonus;
    if (hg.combo >= 3) {
      SFX.combo(hg.combo);
      const a = document.getElementById('hg-arena');
      const ce = document.createElement('div');
      ce.textContent = `${hg.combo} COMBO!`;
      ce.style.cssText = 'position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:60px;font-weight:900;color:#f59e0b;text-shadow:0 4px 8px rgba(0,0,0,.3);z-index:50;pointer-events:none;animation:comboPop 1s ease-out forwards';
      a.appendChild(ce);
      setTimeout(() => ce.remove(), 1000);
    } else {
      SFX.ding();
    }
    // ÏàòÏãù Îãµ ÌëúÏãú
    const eqLabel = document.createElement('div');
    eqLabel.textContent = (matched.text||'').replace('=?',`=${n}`);
    eqLabel.style.cssText = `position:absolute;left:${matched.el.style.left};top:${matched.el.style.top};font-size:18px;font-weight:900;color:#fff;background:rgba(34,197,94,.85);padding:3px 10px;border-radius:8px;pointer-events:none;z-index:55;white-space:nowrap;animation:scorePop .8s ease-out forwards;`;
    document.getElementById('hg-arena').appendChild(eqLabel);
    setTimeout(() => eqLabel.remove(), 900);

    hgMatchEffect(matched.el, matched.type || 'bomb');
    showScorePopup('hg-arena', 1 + bonus, matched.el.style.left, matched.el.style.top);
    speak('Ï†ïÎãµ!');
    // Ï†ïÎãµ ÌîåÎûòÏãú
    const flash = document.createElement('div');
    flash.className = 'hg-flash';
    document.getElementById('hg-arena').appendChild(flash);
    setTimeout(() => flash.remove(), 300);

    matched.el.remove();
    hg.bombs = hg.bombs.filter(b => b !== matched);
    const nl = Math.floor(hg.score / 10) + 1;
    if (nl > hg.level) { hg.level = nl; showLevelUp(nl); hgUpdateBg(); }
    updateHgUI();
  } else {
    // ÏóÜÎäî Ïà´Ïûê ÎàÑÎ¶Ñ - Î¨¥Ïãú (Î≤åÏπô ÏóÜÏùå)
  }
}

function hgUpdateBg() {
  const bgs = [
    'linear-gradient(180deg,#dbeafe 0%,#93c5fd 25%,#a7f3d0 75%,#6ee7b7 100%)',
    'linear-gradient(180deg,#fef3c7 0%,#fde68a 25%,#fed7aa 75%,#fdba74 100%)',
    'linear-gradient(180deg,#1e293b 0%,#334155 25%,#475569 75%,#64748b 100%)',
    'linear-gradient(180deg,#0f172a 0%,#1e1b4b 25%,#312e81 75%,#4338ca 100%)'
  ];
  document.getElementById('hero-game').style.background = bgs[(hg.level - 1) % bgs.length];
}

let _prevLives = 5;
function updateHgUI() {
  document.getElementById('hg-score').textContent = hg.score;
  document.getElementById('hg-level').textContent = hg.level;
  const hEl = document.getElementById('hg-hearts');
  if (hg.lives < _prevLives) {
    // ÌïòÌä∏ ÏûÉÍ∏∞ Ïï†ÎãàÎ©îÏù¥ÏÖò
    let html = '';
    for (let i = 0; i < 5; i++) {
      if (i < hg.lives) html += '‚ù§Ô∏è';
      else if (i === hg.lives) html += `<span class="hg-heart-lost">‚ù§Ô∏è</span>`;
      else html += 'üñ§';
    }
    hEl.innerHTML = html;
  } else {
    hEl.textContent = '‚ù§Ô∏è'.repeat(hg.lives) + 'üñ§'.repeat(Math.max(0, 5 - hg.lives));
  }
  _prevLives = hg.lives;
}

function hgEnd() {
  hg.running = false;
  if (hg.spawnTimer) clearInterval(hg.spawnTimer);
  if (hg.animId) cancelAnimationFrame(hg.animId);
  hg.bombs.forEach(b => b.el.remove());
  hg.bombs = [];
  SFX.gameOver();
  if (hg.score > hg.bestScore) hg.bestScore = hg.score;
  saveStats();
  document.getElementById('hg-final-score').textContent = hg.score;
  let msg = 'ÏûòÌñàÏñ¥Ïöî!';
  if (hg.score >= 30) msg = 'ÎåÄÎã®Ìï¥Ïöî! ÏàòÌïô Ï≤úÏû¨!';
  else if (hg.score >= 20) msg = 'ÏôÄ! Ï†ïÎßê ÏûòÌñàÏñ¥Ïöî!';
  else if (hg.score >= 10) msg = 'Î©ãÏ†∏Ïöî! Í≥ÑÏÜç Ïó∞Ïäµ!';
  document.getElementById('hg-over-msg').textContent = msg;
  document.getElementById('hg-over').classList.remove('hidden');
  speak(msg);
}

function hgRestart() {
  document.getElementById('hg-over').classList.add('hidden');
  document.getElementById('hg-arena').querySelectorAll('.falling-bomb,.char-explode,.star-burst').forEach(e => e.remove());
  hg.score = 0; hg.lives = 5; hg.level = 1; hg.running = true; hg.paused = false;
  hg.bombs = []; hg.combo = 0; hg.maxCombo = 0; _prevLives = 5;
  updateHgUI(); hgUpdateBg(); hgLoop();
}

function hgPause() {
  hg.paused = !hg.paused;
  document.getElementById('hg-pause').classList.toggle('hidden', !hg.paused);
}

function hgExit() {
  hg.running = false;
  if (hg.spawnTimer) clearInterval(hg.spawnTimer);
  if (hg.animId) cancelAnimationFrame(hg.animId);
  hg.bombs.forEach(b => b.el.remove());
  hg.bombs = [];
  document.getElementById('hg-over').classList.add('hidden');
  document.getElementById('hg-pause').classList.add('hidden');
  document.getElementById('hero-game').classList.add('hidden');
  if(document.fullscreenElement)document.exitFullscreen?.();
}

// ===== ÎßàÏä§ÏΩîÌä∏ Í∞êÏ†ï =====
function setMascotEmotion(viewId, emotion) {
  const svg = document.querySelector(`#mascot-${viewId} .mascot-svg`);
  if (!svg) return;
  svg.classList.remove('happy','worried');
  if (emotion !== 'idle') svg.classList.add(emotion);
  // ÏûÖ Î≥ÄÍ≤Ω (Î™®Îì† ÎßàÏä§ÏΩîÌä∏)
  const mouthIds = { bomb: 'mascot-mouth', eat: 'mascot-eat-mouth', elev: 'mascot-elev-mouth', record: 'mascot-record-mouth' };
  const mouth = document.getElementById(mouthIds[viewId]);
  const mouthY = viewId === 'record' ? {d:'M38 92 Q50 104 62 92',h:'M38 92 Q50 108 62 92',w:'M40 98 Q50 90 60 98'} : {d:'M38 82 Q50 94 62 82',h:'M38 82 Q50 98 62 82',w:'M40 88 Q50 80 60 88'};
  if (mouth) {
    switch(emotion) {
      case 'happy': mouth.setAttribute('d', mouthY.h); break;
      case 'worried': mouth.setAttribute('d', mouthY.w); break;
      default: mouth.setAttribute('d', mouthY.d);
    }
  }
  // happy Ïä§ÌååÌÅ¥
  if (emotion === 'happy') {
    const wrap = document.getElementById('mascot-' + viewId);
    if (wrap) { const sp = ['\u2728','\u2B50','\uD83D\uDCAB','\uD83C\uDF1F']; for (let i=0;i<4;i++){const s=document.createElement('div');s.style.cssText='position:absolute;font-size:14px;pointer-events:none;z-index:10;animation:sparkleFloat 1s ease-out forwards;animation-delay:'+(i*.1)+'s;left:'+(Math.random()*60+10)+'px;top:'+(Math.random()*40)+'px';s.textContent=sp[Math.floor(Math.random()*sp.length)];wrap.appendChild(s);setTimeout(()=>s.remove(),1200);} }
  }
  // ÎßêÌíçÏÑ†
  const speech = document.getElementById(`mascot-${viewId}-speech`);
  if (speech) {
    const happyMsgs = ['ÏûòÌñàÏñ¥!','Î©ãÏ†∏!','ÎåÄÎã®Ìï¥!','ÏµúÍ≥†!','ÏôÄ!'];
    const worriedMsgs = ['Ïïó!','Îã§Ïãú!','ÌûòÎÇ¥!'];
    switch(emotion) {
      case 'happy': speech.textContent = happyMsgs[Math.floor(Math.random()*happyMsgs.length)]; break;
      case 'worried': speech.textContent = worriedMsgs[Math.floor(Math.random()*worriedMsgs.length)]; break;
      default: speech.style.display = 'none'; return;
    }
    speech.style.display = 'block';
    clearTimeout(speech._timer);
    speech._timer = setTimeout(() => speech.style.display = 'none', 2000);
  }
  if (emotion !== 'idle') setTimeout(() => setMascotEmotion(viewId, 'idle'), 2500);
}

// ===== Ï†êÏàò ÌåùÏóÖ =====
function showScorePopup(container, points, x, y) {
  const el = document.createElement('div');
  el.className = 'score-popup';
  el.textContent = `+${points}`;
  el.style.cssText = `left:${x||'50%'};top:${y||'40%'};color:${points>=10?'#fbbf24':'#22c55e'};transform:translate(-50%,-50%)`;
  const parent = typeof container === 'string' ? document.getElementById(container) : container;
  if (!parent) return;
  parent.style.position = 'relative';
  parent.appendChild(el);
  setTimeout(() => el.remove(), 800);
}

// ===== Î†àÎ≤®ÏóÖ Ïó∞Ï∂ú =====
function showLevelUp(level) {
  const ov = document.createElement('div');
  ov.className = 'levelup-overlay';
  ov.innerHTML = `<div class="levelup-text">LEVEL ${level}!</div>`;
  document.body.appendChild(ov);
  SFX.levelup();
  setTimeout(() => ov.remove(), 900);
}

// ===== Ï¥àÍ∏∞Ìôî =====
document.addEventListener('DOMContentLoaded', function() {
  // fitScale
  function fitScale() {
    const c = document.querySelector('.container');
    if (!c || getComputedStyle(c).display === 'none') return;
    const M = 0.03;
    const vp = window.visualViewport || {width: window.innerWidth, height: window.innerHeight};
    const aW = vp.width * (1 - M * 2);
    const aH = vp.height * (1 - M * 2);
    const s = Math.min(aW / 1920, aH / 1080);
    c.style.transform = `scale(${s})`;
    c.style.left = ((vp.width - 1920 * s) / 2) + 'px';
    c.style.top = ((vp.height - 1080 * s) / 2) + 'px';
  }
  fitScale();
  window.addEventListener('resize', fitScale);
  if (window.visualViewport) window.visualViewport.addEventListener('resize', fitScale);

  // ÎÑòÌå®Îìú ÏÉùÏÑ± (0~9 + ÌôïÏù∏ + ÏßÄÏö∞Í∏∞)
  const bp = document.getElementById('bomb-numpad');
  let bh = '';
  for (let i = 0; i <= 9; i++) bh += `<div class="numpad-btn" onclick="bombInput(${i})">${i}</div>`;
  bh += `<div class="numpad-btn numpad-clear" onclick="bombClear()">‚úï</div>`;
  bh += `<div class="numpad-btn numpad-confirm" onclick="bombConfirm()">‚úî</div>`;
  bp.innerHTML = bh;

  // ÌûàÏñ¥Î°ú ÎÑòÌå®Îìú
  const hp = document.getElementById('hg-numpad');
  let hph = '';
  for (let i = 0; i <= 9; i++) hph += `<div class="hg-num-btn" onclick="hgAnswer(${i})">${i}</div>`;
  hp.innerHTML = hph;

  // ÌîÑÎ°úÌïÑ (Ï¥àÍ∏∞ Î°úÎìú Ïãú Î†àÎ≤®ÏóÖ Ïó∞Ï∂ú Î∞©ÏßÄ)
  _prevLevel = Math.floor(profile.totalCorrect / 10) + 1;
  updateProfile();
  updateActionButtons();

  // Ìè≠ÌÉÑ ÏòÅÏó≠ Î∂ÄÏú† Ïû•Ïãù
  (function addBombDecorations() {
    const view = document.getElementById('bomb-view');
    if (!view) return;
    for (let i = 0; i < 8; i++) {
      const d = document.createElement('div');
      d.className = 'bomb-deco';
      const sz = 28 + Math.random() * 18;
      d.innerHTML = `<span style="display:inline-block;width:${sz}px;height:${sz}px">${DECO_SVG[DECO_KEYS[i % DECO_KEYS.length]]}</span>`;
      d.style.cssText = `opacity:.12;left:${5+Math.random()*85}%;top:${10+Math.random()*70}%;--dur:${5+Math.random()*4}s;animation-delay:${Math.random()*3}s`;
      view.appendChild(d);
    }
  })();

  // Ìè≠ÌÉÑ ÏãúÏûëÌôîÎ©¥ ÏµúÍ≥†Í∏∞Î°ù ÌëúÏãú
  (function showBombBest() {
    const el = document.getElementById('bomb-best-display');
    if (el && bomb.bestScore > 0) el.innerHTML = `üèÜ ÏµúÍ≥† Í∏∞Î°ù: <span>${bomb.bestScore}</span>Ï†ê`;
  })();

  // Ìè≠ÌÉÑ ÏãúÏûëÌôîÎ©¥ ÌùòÎü¨Í∞ÄÎäî ÏàòÏãù
  (function addFloatingFormulas() {
    const view = document.getElementById('bomb-view');
    if (!view) return;
    const formulas = ['3+5=8','9-4=5','7+2=9','6-1=5','4+3=7','8-6=2','5+4=9','10-3=7'];
    formulas.forEach((f, i) => {
      const el = document.createElement('div');
      el.className = 'bomb-float-eq';
      el.textContent = f;
      el.style.cssText = `top:${12 + (i % 4) * 20}%;--dur:${10 + Math.random() * 6}s;animation-delay:${-i * 2.2}s;font-size:${16 + Math.random() * 8}px`;
      view.appendChild(el);
    });
  })();

  // Í≤åÏûÑ Ï¥àÍ∏∞Ìôî (Ìè≠ÌÉÑÏùÄ ÏãúÏûë Î≤ÑÌäºÏúºÎ°ú ÏãúÏûë)
  initEatGame();
  initElevator();
});

// ÎçîÎ∏îÌÉ≠ Î∞©ÏßÄ
let lastTouchEnd = 0;
document.addEventListener('touchend', function(e) {
  const now = Date.now();
  if (now - lastTouchEnd <= 300) e.preventDefault();
  lastTouchEnd = now;
}, false);
// ÏûêÎèô ÏùºÏãúÏ†ïÏßÄ: ÌÉ≠Ï†ÑÌôò/ÏµúÏÜåÌôî/Ïï±Ï†ÑÌôò/ÌôîÎ©¥Ïû†Í∏à
document.addEventListener('visibilitychange', () => {
  if (document.hidden) {
    speechSynthesis.cancel(); audioQueue = []; isSpeaking = false;
    if (hg.running && !hg.paused) hgPause();
  }
});
window.matchMedia('(orientation: portrait)').addEventListener('change', e => {
  if (e.matches) {
    speechSynthesis.cancel(); audioQueue = []; isSpeaking = false;
    if (hg.running && !hg.paused) hgPause();
  }
});
</script>
</body>
</html>
