<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>ë¯¸ìˆ  ë†€ì´í„° ğŸ¨</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;-webkit-user-select:none;user-select:none}
body{font-family:'Noto Sans KR',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:linear-gradient(135deg,#ec4899 0%,#f472b6 50%,#db2777 100%);margin:0;padding:0;width:100vw;height:100vh;height:100dvh;overflow:hidden;touch-action:manipulation}
.rotate-notice{display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:linear-gradient(135deg,#ec4899,#db2777);z-index:9999;flex-direction:column;align-items:center;justify-content:center;color:#fff;font-size:24px;font-weight:700;text-align:center;gap:20px}
.rotate-notice .rotate-icon{font-size:80px;animation:rotateH 2s ease-in-out infinite}
@keyframes rotateH{0%,100%{transform:rotate(0)}50%{transform:rotate(90deg)}}
@media(orientation:portrait){.rotate-notice{display:flex}.container{display:none!important}}
.container{width:1920px;height:1080px;background:#fff;border-radius:25px;box-shadow:0 25px 50px rgba(0,0,0,.12);display:flex;flex-direction:column;overflow:hidden;transform-origin:0 0;position:absolute}

/* ê³¼ëª©ë°” */
.subject-bar{background:linear-gradient(135deg,#1e3a8a,#3b82f6);display:flex;align-items:center;padding:0 20px;height:56px;flex-shrink:0;gap:4px;position:relative}
.subject-bar::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:linear-gradient(90deg,#f9a8d4,#ec4899,#f9a8d4)}
.sb-tab{padding:8px 30px;border:none;border-radius:12px 12px 0 0;background:0;font-size:18px;font-weight:800;color:rgba(255,255,255,.5);cursor:pointer;font-family:inherit;transition:.2s;display:flex;align-items:center;gap:8px;text-decoration:none}
.sb-tab.active{background:#fff;color:#1e3a8a}
.sb-tab.locked{cursor:default}
.sb-tab .lock{font-size:12px;opacity:.5}
.sb-spacer{flex:1}
.sb-btns{display:flex;gap:8px}
.sb-btn{background:rgba(255,255,255,.15);border:2px solid rgba(255,255,255,.2);border-radius:10px;padding:6px 14px;font-size:18px;color:#fff;cursor:pointer;transition:.15s}
.sb-btn:active{background:rgba(255,255,255,.3)}

/* ë©”ì¸ */
.main-layout{display:grid;grid-template-columns:300px 1fr 300px;gap:14px;padding:14px;flex:1;overflow:hidden}

/* ì™¼ìª½ */
.left-panel{display:flex;flex-direction:column;gap:10px;overflow:hidden}
.profile-section{background:linear-gradient(145deg,#ec4899,#f472b6 50%,#f9a8d4);border-radius:20px;padding:20px;border:3px solid #fbcfe8;box-shadow:0 6px 20px rgba(236,72,153,.3);flex-shrink:0;position:relative;overflow:hidden}
.profile-section::before{content:'';position:absolute;inset:0;background:url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='15' cy='15' r='1.5' fill='white' opacity='.3'><animate attributeName='opacity' values='.3;.1;.3' dur='2s' repeatCount='indefinite'/></circle><circle cx='85' cy='25' r='1' fill='white' opacity='.25'><animate attributeName='opacity' values='.25;.08;.25' dur='1.5s' repeatCount='indefinite'/></circle><circle cx='25' cy='75' r='1.2' fill='white' opacity='.3'><animate attributeName='opacity' values='.3;.1;.3' dur='1.8s' repeatCount='indefinite'/></circle></svg>") repeat;pointer-events:none}
.profile-content{position:relative;z-index:1;display:flex;align-items:center;gap:15px}
.profile-avatar{width:90px;height:90px;background:linear-gradient(145deg,#f9a8d4,#f472b6);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:50px;border:3px solid #fff;box-shadow:0 4px 15px rgba(244,114,182,.4);animation:avGlow 3s ease-in-out infinite;flex-shrink:0;cursor:pointer}
@keyframes avGlow{0%,100%{box-shadow:0 4px 15px rgba(244,114,182,.4);transform:scale(1)}50%{box-shadow:0 8px 25px rgba(244,114,182,.6);transform:scale(1.05)}}
.profile-info{flex:1;color:#fff}
.profile-name{font-size:28px;font-weight:800;text-shadow:2px 2px 4px rgba(0,0,0,.3);margin-bottom:8px;cursor:pointer}
.profile-level-container{background:rgba(255,255,255,.2);border-radius:12px;padding:8px 12px}
.profile-level{font-size:22px;font-weight:700;color:#fce7f3;display:flex;align-items:center;gap:8px}
.level-badge{background:linear-gradient(145deg,#f9a8d4,#f472b6);color:#831843;padding:4px 12px;border-radius:8px;font-size:22px;font-weight:800;border:1px solid #fff}
.progress-bar{width:100%;height:6px;background:rgba(255,255,255,.3);border-radius:3px;margin-top:5px;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,#f9a8d4,#ec4899,#f9a8d4);background-size:200% 100%;border-radius:3px;transition:width .5s;animation:pShine 2s linear infinite}
@keyframes pShine{0%{background-position:-200% 0}100%{background-position:200% 0}}

/* íƒ­ */
.tab-headers{display:grid;grid-template-columns:1fr 1fr;gap:8px;flex-shrink:0}
.tab-btn{background:linear-gradient(145deg,#e2e8f0,#cbd5e1);border:2px solid #94a3b8;border-radius:12px;padding:8px;font-size:20px;font-weight:700;cursor:pointer;transition:.2s;color:#475569;display:flex;align-items:center;justify-content:center;height:62px;white-space:nowrap;font-family:inherit}
.tab-btn.active{background:linear-gradient(145deg,#ec4899,#db2777);color:#fff;border-color:#ec4899}
.tab-btn:active{transform:scale(.97)}
.tab-content{display:none;flex:1;overflow:hidden}
.tab-content.active{display:flex;flex-direction:column}

/* ì‚¬ì´ë“œ ì •ë³´ */
.side-info{background:linear-gradient(145deg,#fdf2f8,#fce7f3);border-radius:16px;padding:18px;border:2px solid #ec4899;display:flex;flex-direction:column;gap:12px;height:100%;overflow:hidden}
.side-title{font-size:28px;font-weight:700;color:#9d174d;text-align:center;flex-shrink:0}
.side-stat{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;background:#fff;border-radius:8px;font-size:22px;font-weight:600;color:#1e293b}
.side-val{font-size:36px;font-weight:800;color:#ec4899}

/* ê²Œì„ ëŸ°ì¹˜ */
.game-launch-btn{flex-shrink:0;background:linear-gradient(145deg,#f9a8d4,#f472b6);color:#831843;border:3px solid #fff;border-radius:16px;padding:14px;font-size:24px;font-weight:800;cursor:pointer;text-align:center;box-shadow:0 4px 15px rgba(244,114,182,.4);font-family:inherit;animation:gPulse 2s ease-in-out infinite;white-space:nowrap}
@keyframes gPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.02)}}
.game-launch-btn:active{transform:scale(.97)}

/* ì¤‘ì•™ */
.center-panel{display:flex;flex-direction:column;overflow:hidden;position:relative}
.game-view{display:none;flex-direction:column;flex:1;overflow:hidden}
.game-view.active{display:flex}

/* ===== ì–¼êµ´ ê¾¸ë¯¸ê¸° ===== */
.face-area{flex:1;display:flex;flex-direction:column;overflow:hidden}
.face-workspace{flex:1;display:flex;gap:12px;padding:12px;overflow:hidden}
.face-canvas-wrap{flex:1;background:linear-gradient(145deg,#fdf2f8,#fff);border:3px solid #f9a8d4;border-radius:20px;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center}
.face-svg-container{width:400px;height:450px;position:relative;transform:scale(1.9);transform-origin:center}
.face-parts-panel{width:300px;display:flex;flex-direction:column;gap:10px;overflow-y:auto;overflow-x:hidden;padding:8px;background:linear-gradient(145deg,#fdf2f8,#fff);border-radius:16px;border:2px solid #f9a8d4;position:relative;z-index:2}
.parts-category{background:linear-gradient(145deg,#fce7f3,#fbcfe8);border-radius:12px;padding:10px;border:2px solid #f9a8d4}
.parts-cat-title{font-size:22px;font-weight:700;color:#9d174d;margin-bottom:8px;text-align:center}
.parts-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.face-part-item{width:auto;height:auto;min-height:76px;background:#fff;border:2px solid #e2e8f0;border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:grab;transition:.15s;padding:4px 2px}
.face-part-item:active{transform:scale(.9);border-color:#ec4899}
.face-part-item.selected{border-color:#ec4899;background:linear-gradient(145deg,#fce7f3,#fdf2f8);box-shadow:0 0 8px rgba(236,72,153,.3)}
.placed-part{position:absolute;cursor:move;filter:drop-shadow(0 2px 4px rgba(0,0,0,.2));transition:transform .1s;z-index:5}
.placed-part:active{transform:scale(1.15)}
.face-name-input{width:100%;padding:12px 18px;border:3px solid #f9a8d4;border-radius:12px;font-size:28px;font-weight:700;text-align:center;outline:none;font-family:inherit;background:#fdf2f8;color:#831843}
.face-name-input:focus{border-color:#ec4899}
.face-bottom{display:flex;gap:10px;padding:8px 12px;align-items:center;flex-shrink:0}
.face-action-btn{padding:12px 28px;border:none;border-radius:12px;font-size:26px;font-weight:700;cursor:pointer;font-family:inherit;transition:.15s}
.face-action-btn:active{transform:scale(.95)}
.face-action-btn.pink{background:linear-gradient(145deg,#ec4899,#db2777);color:#fff}
.face-action-btn.gray{background:linear-gradient(145deg,#e2e8f0,#cbd5e1);color:#475569}

/* ===== í­ë°œ ë¬¼ê° ===== */
.paint-area{flex:1;display:flex;flex-direction:column;overflow:hidden}
.paint-toolbar{display:flex;align-items:center;gap:10px;padding:8px 12px;flex-shrink:0;background:linear-gradient(145deg,#fdf2f8,#fce7f3);border-bottom:2px solid #f9a8d4}
.paint-color-btn{width:64px;height:64px;border-radius:50%;border:3px solid #fff;cursor:pointer;transition:.15s;box-shadow:0 2px 8px rgba(0,0,0,.15)}
.paint-color-btn.active{border-color:#1e293b;transform:scale(1.15);box-shadow:0 0 12px rgba(0,0,0,.3)}
.paint-color-btn:active{transform:scale(.9)}
.paint-size-label{font-size:17px;font-weight:700;color:#9d174d;margin-left:12px}
.paint-size-slider{width:100px;accent-color:#ec4899}
.paint-clear-btn{margin-left:auto;padding:10px 24px;background:linear-gradient(145deg,#f87171,#ef4444);color:#fff;border:none;border-radius:10px;font-size:17px;font-weight:700;cursor:pointer;font-family:inherit}
.paint-canvas{flex:1;position:relative;overflow:hidden;cursor:crosshair;background:linear-gradient(145deg,#fffbeb,#fff)}
.paint-splat{position:absolute;pointer-events:none}
.paint-particle{position:absolute;border-radius:50%;pointer-events:none;animation:paintSplash var(--dur,.6s) cubic-bezier(.25,.46,.45,.94) forwards}
@keyframes paintSplash{0%{transform:translate(0,0) scale(1);opacity:.9}100%{transform:translate(var(--tx,0),var(--ty,0)) scale(var(--es,0));opacity:0}}
.paint-drop{position:absolute;border-radius:50%;pointer-events:none;animation:paintDrop .4s ease-out forwards}
@keyframes paintDrop{0%{transform:scale(0);opacity:0}50%{transform:scale(1.2);opacity:.8}100%{transform:scale(1);opacity:.6}}

/* ===== ê·¸ë¦¼ì ê·¹ì¥ ===== */
.theater-area{flex:1;display:flex;flex-direction:column;overflow:hidden}
.stage-wrap{flex:1;position:relative;overflow:hidden;background:#1a1a2e;border-radius:16px;margin:8px 12px}
.stage-curtain-left,.stage-curtain-right{position:absolute;top:0;bottom:0;width:60px;z-index:10}
.stage-curtain-left{left:0;background:linear-gradient(90deg,#7f1d1d,#991b1b,transparent)}
.stage-curtain-right{right:0;background:linear-gradient(270deg,#7f1d1d,#991b1b,transparent)}
.stage-top{position:absolute;top:0;left:0;right:0;height:55px;background:linear-gradient(180deg,#7f1d1d 0%,#991b1b 60%,transparent 100%);z-index:11;display:flex;align-items:center;justify-content:center}
.stage-top-text{color:#fde68a;font-size:28px;font-weight:700;text-shadow:0 2px 4px rgba(0,0,0,.5)}
.stage-floor{position:absolute;bottom:0;left:0;right:0;height:70px;background:linear-gradient(180deg,#4a2810,#3a1f0b);z-index:5}
.stage-bg{position:absolute;inset:0;background:linear-gradient(180deg,#0f172a 0%,#1e293b 40%,#334155 100%);z-index:1}
.stage-stars{position:absolute;inset:0;z-index:2;pointer-events:none}
.stage-sticker{position:absolute;z-index:6;cursor:move;font-size:130px;filter:brightness(0) invert(0);opacity:.85;transition:transform .2s}
.stage-sticker:active{transform:scale(1.1)}
.stage-sticker.playing{animation:stickerEnter .8s ease-out forwards}
@keyframes stickerEnter{0%{transform:scale(0) rotate(-20deg);opacity:0}60%{transform:scale(1.15) rotate(5deg);opacity:1}100%{transform:scale(1) rotate(0deg);opacity:.85}}
.theater-controls{display:flex;gap:8px;padding:8px 12px;flex-shrink:0;align-items:center}
.sticker-palette{display:flex;gap:8px;flex:1;overflow-x:auto;padding:4px}
.sticker-item{width:90px;height:90px;background:linear-gradient(145deg,#fdf2f8,#fce7f3);border:2px solid #f9a8d4;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:72px;cursor:grab;flex-shrink:0;transition:.15s}
.sticker-item:active{transform:scale(.9);border-color:#ec4899}
.sticker-item.selected{border-color:#ec4899;background:#fbcfe8;box-shadow:0 0 8px rgba(236,72,153,.3)}
.theater-btn{padding:12px 24px;border:none;border-radius:12px;font-size:26px;font-weight:700;cursor:pointer;font-family:inherit;transition:.15s}
.theater-btn:active{transform:scale(.95)}
.theater-btn.play{background:linear-gradient(145deg,#22c55e,#16a34a);color:#fff}
.theater-btn.clear{background:linear-gradient(145deg,#f87171,#ef4444);color:#fff}
.audience-bar{position:absolute;bottom:55px;left:70px;right:70px;z-index:8;display:flex;justify-content:space-around;font-size:42px;pointer-events:none;opacity:0;transition:opacity .5s}
.audience-bar.visible{opacity:1}
.audience-member{animation:audienceBob 1s ease-in-out infinite}
@keyframes audienceBob{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}

/* ===== ë‚´ ê¸°ë¡ ===== */
.records-area{flex:1;display:flex;flex-direction:column;gap:20px;padding:20px;overflow-y:auto}
.record-card{background:linear-gradient(145deg,#fff,#f8fafc);border:2px solid #e2e8f0;border-radius:16px;padding:18px;box-shadow:0 4px 12px rgba(0,0,0,.06)}
.record-card h3{font-size:24px;font-weight:800;color:#1e293b;margin-bottom:10px}
.record-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.record-item{text-align:center;padding:16px;background:linear-gradient(145deg,#fdf2f8,#fce7f3);border-radius:12px;border:2px solid #fbcfe8}
.record-num{font-size:42px;font-weight:900;color:#ec4899}
.record-label{font-size:17px;font-weight:600;color:#9d174d;margin-top:4px}

/* ì˜¤ë¥¸ìª½ */
.right-panel{display:flex;flex-direction:column;gap:12px;overflow:hidden}
.action-btn{border:none;border-radius:20px;font-size:36px;font-weight:800;cursor:pointer;transition:.1s;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;flex:1;min-height:60px;font-family:inherit;color:#fff}
.action-btn .icon{font-size:62px;opacity:.9}
.action-btn:active{transform:scale(.95)}
.action-btn.btn-pink{background:linear-gradient(145deg,#ec4899,#db2777);box-shadow:0 2px 8px rgba(236,72,153,.3)}
.action-btn.btn-cyan{background:linear-gradient(145deg,#06b6d4,#0891b2);box-shadow:0 2px 8px rgba(6,182,212,.2)}
.action-btn.btn-red{background:linear-gradient(145deg,#f87171,#ef4444);box-shadow:0 2px 8px rgba(248,113,113,.2)}
.action-btn.btn-green{background:linear-gradient(145deg,#10b981,#059669);box-shadow:0 2px 8px rgba(16,185,129,.2)}
.action-btn.btn-orange{background:linear-gradient(145deg,#f97316,#ea580c);box-shadow:0 2px 8px rgba(249,115,22,.2)}
.action-btn:disabled{background:linear-gradient(145deg,#e5e7eb,#d1d5db)!important;color:#9ca3af;cursor:not-allowed;box-shadow:none}

/* ===== íˆì–´ë¡œ: íŒ”ë ˆíŠ¸ ë””íœìŠ¤ ===== */
.hero-game{position:absolute;top:0;left:0;width:1920px;height:1080px;z-index:5000;display:flex;flex-direction:column;background:linear-gradient(180deg,#fdf2f8 0%,#fce7f3 25%,#fbcfe8 75%,#f9a8d4 100%);overflow:hidden}
.hero-game.hidden{display:none}
.hg-header{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:rgba(255,255,255,.35);backdrop-filter:blur(12px);flex-shrink:0;z-index:10;border-bottom:2px solid rgba(255,255,255,.4)}
.hg-stat{font-size:38px;font-weight:800;color:#831843}
.hg-hearts{font-size:38px;letter-spacing:3px}
.hg-ctrls{display:flex;gap:8px}
.hg-ctrl-btn{background:rgba(255,255,255,.6);border:2px solid rgba(255,255,255,.8);border-radius:50%;width:44px;height:44px;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#475569}
.hg-ctrl-btn:active{transform:scale(.9)}
.hg-arena{flex:1;position:relative;overflow:hidden}
.hg-target-color{position:absolute;top:16px;left:50%;transform:translateX(-50%);z-index:20;background:rgba(255,255,255,.9);backdrop-filter:blur(8px);border-radius:16px;padding:16px 36px;font-size:28px;font-weight:800;color:#1e293b;display:flex;align-items:center;gap:10px;box-shadow:0 4px 16px rgba(0,0,0,.1)}
.hg-target-swatch{width:52px;height:52px;border-radius:50%;border:3px solid #fff;box-shadow:0 2px 8px rgba(0,0,0,.2)}
.hg-picture-area{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:5;filter:drop-shadow(0 0 20px rgba(236,72,153,.3))}
.hg-combo{position:absolute;top:80px;left:50%;transform:translateX(-50%);z-index:20;font-size:100px;font-weight:900;color:#ec4899;text-shadow:0 2px 8px rgba(0,0,0,.2);opacity:0;transition:opacity .3s}
.hg-combo.visible{opacity:1}
.hg-stain{position:absolute;border-radius:50%;pointer-events:none;z-index:4;opacity:.5}
.flying-ball{position:absolute;z-index:15;pointer-events:auto;cursor:pointer;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(0,0,0,.2);transition:transform .1s}
.flying-ball:active{transform:scale(.85)}
.flying-ball-inner{width:100%;height:100%;border-radius:50%;position:relative;overflow:hidden}
.flying-ball-shine{position:absolute;top:15%;left:20%;width:35%;height:25%;background:rgba(255,255,255,.5);border-radius:50%;transform:rotate(-30deg)}
.hg-flash{position:absolute;inset:0;pointer-events:none;z-index:30;animation:hgFlash .3s ease-out forwards}
@keyframes hgFlash{0%{background:rgba(34,197,94,.25)}100%{background:transparent}}
.hg-miss-flash{position:absolute;inset:0;pointer-events:none;z-index:30;animation:hgMissFlash .4s ease-out forwards}
@keyframes hgMissFlash{0%{background:rgba(239,68,68,.25)}50%{background:rgba(239,68,68,.12)}100%{background:transparent}}
.hg-arena-shake{animation:arenaShake .4s ease-out}
@keyframes arenaShake{0%,100%{transform:translateX(0)}20%{transform:translateX(-8px)}40%{transform:translateX(8px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}
.hg-paint-burst{position:absolute;border-radius:50%;pointer-events:none;z-index:25;animation:paintBurst var(--dur,.6s) ease-out forwards}
@keyframes paintBurst{0%{transform:translate(0,0) scale(1);opacity:.8}100%{transform:translate(var(--tx,0),var(--ty,0)) scale(0);opacity:0}}
.hg-star-pop{position:absolute;pointer-events:none;z-index:25;animation:starPop .7s ease-out forwards}
@keyframes starPop{0%{transform:translate(0,0) scale(0);opacity:0}30%{transform:translate(calc(var(--tx)*.3),calc(var(--ty)*.3)) scale(1.2);opacity:1}100%{transform:translate(var(--tx),var(--ty)) scale(0);opacity:0}}
.hg-powerup{position:absolute;z-index:18;pointer-events:auto;cursor:pointer;width:75px;height:75px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:42px;background:linear-gradient(145deg,#fbbf24,#f59e0b);border:3px solid #fde68a;box-shadow:0 0 16px rgba(251,191,36,.5);animation:puFloat 2s ease-in-out infinite}
@keyframes puFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.hg-overlay{position:absolute;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:100;backdrop-filter:blur(5px)}
.hg-overlay.hidden{display:none}
.hg-overlay-box{background:#fff;border-radius:24px;padding:40px;text-align:center;box-shadow:0 25px 50px rgba(0,0,0,.3);min-width:320px}
.hg-overlay-box h2{font-size:42px;font-weight:900;color:#1e293b;margin-bottom:12px}
.hg-overlay-box .score{font-size:34px;font-weight:700;color:#ec4899;margin-bottom:8px}
.hg-overlay-box .msg{font-size:24px;color:#64748b;margin-bottom:20px}
.hg-overlay-box button{display:block;width:100%;padding:14px;border:none;border-radius:14px;font-size:24px;font-weight:800;cursor:pointer;margin-bottom:8px;font-family:inherit}
.hg-overlay-box .btn-retry{background:linear-gradient(145deg,#ec4899,#db2777);color:#fff}
.hg-overlay-box .btn-exit{background:linear-gradient(145deg,#e2e8f0,#cbd5e1);color:#475569}
.hg-cloud{position:absolute;font-size:50px;opacity:.15;pointer-events:none;animation:cFloat 25s linear infinite;z-index:1}
@keyframes cFloat{0%{transform:translateX(-100px)}100%{transform:translateX(calc(1920px + 100px))}}
.hg-ground{position:absolute;bottom:0;left:0;right:0;height:140px;z-index:3;pointer-events:none;overflow:hidden}
.hg-ground-item{position:absolute;bottom:0;pointer-events:none}
.hg-deco{animation:decoFloat 6s ease-in-out infinite}
@keyframes decoFloat{0%,100%{transform:translateY(0) rotate(0deg)}25%{transform:translateY(-10px) rotate(3deg)}75%{transform:translateY(10px) rotate(-3deg)}}
.hg-bg-sparkle{position:absolute;pointer-events:none;z-index:2;animation:bgSparkle 3s ease-in-out infinite}
@keyframes bgSparkle{0%,100%{opacity:.08;transform:scale(.8)}50%{opacity:.2;transform:scale(1.2)}}
.hg-drip{position:absolute;top:0;z-index:2;pointer-events:none;animation:dripDown 4s ease-in infinite}
@keyframes dripDown{0%{transform:translateY(-20px);opacity:.3}50%{transform:translateY(60px);opacity:.15}100%{transform:translateY(120px);opacity:0}}

/* ëª¨ë‹¬ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:6000;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(10px)}
.modal-overlay.hidden{display:none}
.modal-box{background:#fff;border-radius:20px;width:90%;max-width:500px;max-height:80vh;overflow-y:auto;box-shadow:0 25px 50px rgba(0,0,0,.3)}
.modal-head{background:linear-gradient(145deg,#ec4899,#db2777);color:#fff;padding:16px 20px;border-radius:20px 20px 0 0;display:flex;justify-content:space-between;align-items:center}
.modal-head h3{margin:0;font-size:18px}
.modal-close{background:0;border:0;color:#fff;font-size:24px;cursor:pointer}
.modal-body{padding:20px}
.modal-section{margin-bottom:16px;padding:14px;border-radius:10px;background:#f8fafc}
.modal-section h4{margin:0 0 10px;font-weight:700;color:#374151;font-size:15px}
.modal-input{width:100%;padding:10px;border:2px solid #e5e7eb;border-radius:8px;font-size:14px;box-sizing:border-box;margin-bottom:8px}
.modal-input:focus{outline:none;border-color:#ec4899}
.modal-btn{padding:10px 16px;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;width:100%;background:linear-gradient(145deg,#ec4899,#db2777);color:#fff;margin-top:6px}
.char-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(70px,1fr));gap:12px}
.char-item{background:linear-gradient(145deg,#f8fafc,#e2e8f0);border:2px solid #cbd5e1;border-radius:14px;padding:12px;text-align:center;cursor:pointer;font-size:32px;height:70px;display:flex;align-items:center;justify-content:center;transition:.2s}
.char-item.selected{background:linear-gradient(145deg,#f9a8d4,#f472b6);border-color:#ec4899}

/* íˆì–´ë¡œ ê·¸ë¦¼ ì˜ì—­ (SVG ê¸°ë°˜ ê·¸ë¦¼) */
.hg-picture-svg{border:4px solid #e2e8f0;border-radius:16px;background:#fff;box-shadow:0 8px 24px rgba(0,0,0,.1)}
.hg-section{stroke:#94a3b8;stroke-width:2;fill:#f1f5f9;transition:fill .5s}
.hg-section.filled{stroke:#475569;stroke-width:2.5}

/* ===== ë¹„ì£¼ì–¼ ì—…ê·¸ë ˆì´ë“œ ===== */

/* ë°°ê²½ ì”¬: ì–¼êµ´ê¾¸ë¯¸ê¸° â€” ì•„í‹€ë¦¬ì—(í™”ì‹¤) */
.face-view::before{content:'';position:absolute;inset:0;pointer-events:none;z-index:0;background:
  url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1300 900'><defs><linearGradient id='ab' x1='0' y1='0' x2='0' y2='1'><stop offset='0%' stop-color='%23fdf2f8'/><stop offset='100%' stop-color='%23fce7f3'/></linearGradient></defs><rect fill='url(%23ab)' width='1300' height='900'/><rect x='30' y='80' width='120' height='160' rx='6' fill='%23fff' stroke='%23d4a574' stroke-width='3'/><rect x='40' y='90' width='100' height='120' fill='%23fef3c7'/><circle cx='90' cy='130' r='20' fill='%23fca5a5' opacity='.5'/><circle cx='70' cy='150' r='12' fill='%2393c5fd' opacity='.4'/><rect x='1160' y='750' width='100' height='80' rx='8' fill='%23f9a8d4' opacity='.2'/><circle cx='1210' cy='770' r='10' fill='%23ec4899' opacity='.3'/><circle cx='1190' cy='790' r='8' fill='%23a855f7' opacity='.25'/><circle cx='1220' cy='800' r='7' fill='%233b82f6' opacity='.2'/><line x1='50' y1='260' x2='50' y2='700' stroke='%23d4a574' stroke-width='4' opacity='.15'/><line x1='60' y1='700' x2='30' y2='720' stroke='%23d4a574' stroke-width='3' opacity='.15'/><line x1='60' y1='700' x2='70' y2='720' stroke='%23d4a574' stroke-width='3' opacity='.15'/></svg>") center/cover no-repeat;opacity:.6}
.face-view{position:relative}

/* ë°°ê²½ ì”¬: í­ë°œë¬¼ê° â€” ì¶”ìƒí™” ê°¤ëŸ¬ë¦¬ */
.paint-view::before{content:'';position:absolute;inset:0;pointer-events:none;z-index:0;background:
  url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1300 900'><rect fill='%23fdf2f8' width='1300' height='900'/><circle cx='100' cy='100' r='60' fill='%23fca5a5' opacity='.08'><animate attributeName='r' values='55;65;55' dur='4s' repeatCount='indefinite'/></circle><circle cx='1200' cy='150' r='50' fill='%2393c5fd' opacity='.08'><animate attributeName='r' values='45;55;45' dur='3.5s' repeatCount='indefinite'/></circle><circle cx='200' cy='800' r='40' fill='%23a5b4fc' opacity='.07'/><circle cx='1100' cy='780' r='55' fill='%2386efac' opacity='.06'/><circle cx='650' cy='50' r='35' fill='%23fcd34d' opacity='.06'/></svg>") center/cover no-repeat;opacity:.7}
.paint-view{position:relative}

/* ë°°ê²½ ì”¬: ê·¸ë¦¼ìê·¹ì¥ â€” ê·¹ì¥ ë¶„ìœ„ê¸° ë³´ê°• (ì´ë¯¸ ë¹„ì£¼ì–¼ ìˆìœ¼ë¯€ë¡œ ê°€ë²¼ìš´ ì¥ì‹ë§Œ) */
.theater-view{position:relative}

/* ë°°ê²½ ì”¬: ë‚´ê¸°ë¡ â€” ë¯¸ìˆ ê´€/ê°¤ëŸ¬ë¦¬ */
.record-view::before{content:'';position:absolute;inset:0;pointer-events:none;z-index:0;background:
  url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1300 900'><defs><linearGradient id='gb' x1='0' y1='0' x2='0' y2='1'><stop offset='0%' stop-color='%23fdf2f8'/><stop offset='100%' stop-color='%23fce7f3'/></linearGradient></defs><rect fill='url(%23gb)' width='1300' height='900'/><rect x='40' y='150' width='150' height='120' rx='4' fill='none' stroke='%23d4a574' stroke-width='4' opacity='.2'/><rect x='1110' y='120' width='140' height='110' rx='4' fill='none' stroke='%23d4a574' stroke-width='4' opacity='.2'/><rect x='500' y='50' width='180' height='140' rx='4' fill='none' stroke='%23d4a574' stroke-width='4' opacity='.15'/><circle cx='100' cy='800' r='4' fill='%23ec4899' opacity='.15'><animate attributeName='opacity' values='.1;.25;.1' dur='3s' repeatCount='indefinite'/></circle><circle cx='650' cy='820' r='3' fill='%23f472b6' opacity='.12'><animate attributeName='opacity' values='.08;.2;.08' dur='2.5s' repeatCount='indefinite'/></circle><circle cx='1200' cy='810' r='3.5' fill='%23ec4899' opacity='.15'><animate attributeName='opacity' values='.1;.22;.1' dur='2.8s' repeatCount='indefinite'/></circle></svg>") center/cover no-repeat;opacity:.5}
.record-view{position:relative}

/* 3D ì•„ì¼€ì´ë“œ ë²„íŠ¼ */
.tab-btn{border-bottom:5px solid #7c8ba5;transition:.15s}
.tab-btn:active{transform:translateY(3px) scaleX(1.02) scaleY(.95)!important;border-bottom-width:2px}
.tab-btn.active{border-color:#be185d;border-bottom:5px solid #be185d}
.tab-btn.active:active{border-bottom-width:2px}

.action-btn{border-bottom:6px solid rgba(0,0,0,.25);transition:.1s}
.action-btn:active:not(:disabled){transform:translateY(4px) scaleX(1.03) scaleY(.94)!important;border-bottom-width:2px}
.action-btn.btn-pink{border-bottom-color:#9d174d}
.action-btn.btn-cyan{border-bottom-color:#0e7490}
.action-btn.btn-red{border-bottom-color:#b91c1c}
.action-btn.btn-green{border-bottom-color:#047857}
.action-btn.btn-orange{border-bottom-color:#c2410c}

.face-action-btn{border-bottom:4px solid rgba(0,0,0,.2);transition:.15s}
.face-action-btn:active{transform:translateY(3px) scaleX(1.02) scaleY(.95)!important;border-bottom-width:1px}
.face-action-btn.pink{border-bottom-color:#9d174d}
.face-action-btn.gray{border-bottom-color:#6b7280}

.theater-btn{border-bottom:4px solid rgba(0,0,0,.2)}
.theater-btn:active{transform:translateY(3px) scaleX(1.02) scaleY(.95)!important;border-bottom-width:1px}
.theater-btn.play{border-bottom-color:#047857}
.theater-btn.clear{border-bottom-color:#b91c1c}

.game-launch-btn{border-bottom:6px solid #9d174d;position:relative;overflow:hidden}
.game-launch-btn:active{transform:translateY(4px) scaleX(1.02) scaleY(.95)!important;border-bottom-width:2px;animation:none}
.game-launch-btn::after{content:'';position:absolute;top:0;left:-100%;width:60%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.35),transparent);animation:btnSweep 3s ease-in-out infinite}
@keyframes btnSweep{0%,100%{left:-100%}50%{left:120%}}

.face-part-item{border-bottom:3px solid #c7d1dc;transition:.15s}
.face-part-item:active{transform:translateY(2px) scale(.9)!important;border-bottom-width:1px}
.sticker-item{border-bottom:3px solid #e58bb0;transition:.15s}
.sticker-item:active{transform:translateY(2px) scale(.9)!important;border-bottom-width:1px}

/* íŒ¨ë„ ë³´ê°• */
.right-panel{background:linear-gradient(180deg,rgba(252,231,243,.3),rgba(249,168,212,.15));border-radius:20px;padding:10px}
.side-info{background:linear-gradient(145deg,#fdf2f8,#fce7f3);position:relative;overflow:hidden}
.side-info::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,#ec4899,#f472b6,#ec4899);border-radius:4px 4px 0 0}
.side-val{text-shadow:0 0 12px rgba(236,72,153,.35)}
.side-stat{transition:transform .2s}
.side-stat:hover{transform:translateX(3px)}

/* ë””ìì¸ í¬ë®¬ëŸ¬: text-stroke */
.hg-stat,.hg-combo,.game-launch-btn,.side-title{-webkit-text-stroke:.5px rgba(0,0,0,.1);paint-order:stroke fill}

/* ë””ìì¸ í¬ë®¬ëŸ¬: ìŠ¤ì½”ì–´ íŒì—… */
.score-popup{position:absolute;pointer-events:none;z-index:50;font-size:40px;font-weight:900;color:#ec4899;text-shadow:0 2px 8px rgba(0,0,0,.2);animation:scorePop .9s ease-out forwards}
@keyframes scorePop{0%{opacity:1;transform:translateY(0) scale(.5)}40%{transform:translateY(-30px) scale(1.2)}100%{opacity:0;transform:translateY(-70px) scale(.8)}}

/* ë””ìì¸ í¬ë®¬ëŸ¬: ë·° ì „í™˜ */
.game-view.active{animation:viewFadeIn .35s ease-out}
@keyframes viewFadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

/* ë””ìì¸ í¬ë®¬ëŸ¬: ë ˆë²¨ì—… ì˜¤ë²„ë ˆì´ */
.levelup-overlay{position:fixed;inset:0;z-index:8000;display:flex;align-items:center;justify-content:center;background:rgba(236,72,153,.15);pointer-events:none;animation:lvFlash .8s ease-out forwards}
@keyframes lvFlash{0%{background:rgba(236,72,153,.25)}100%{background:transparent}}
.levelup-box{font-size:52px;font-weight:900;color:#ec4899;text-shadow:0 4px 20px rgba(236,72,153,.5);animation:lvPop .8s cubic-bezier(.175,.885,.32,1.275) forwards}
@keyframes lvPop{0%{opacity:0;transform:scale(0) rotate(-10deg)}50%{opacity:1;transform:scale(1.3) rotate(3deg)}100%{opacity:0;transform:scale(1) rotate(0)}}

/* ë””ìì¸ í¬ë®¬ëŸ¬: í•˜íŠ¸ ìƒê¸° */
@keyframes heartLost{0%{transform:scale(1)}25%{transform:scale(1.4);filter:brightness(2)}50%{transform:scale(.8)}100%{transform:scale(1)}}

/* ë§ˆìŠ¤ì½”íŠ¸ ìŠ¤íƒ€ì¼ */
.mascot{position:absolute;z-index:5;pointer-events:none;animation:mascotBob 3s ease-in-out infinite}
@keyframes mascotBob{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
.mascot-bubble{position:absolute;background:#fff;border-radius:16px;padding:6px 14px;font-size:13px;font-weight:700;color:#831843;box-shadow:0 3px 12px rgba(0,0,0,.12);white-space:nowrap;opacity:0;transition:opacity .3s;top:-40px;left:50%;transform:translateX(-50%)}
.mascot-bubble::after{content:'';position:absolute;bottom:-6px;left:50%;transform:translateX(-50%);border-left:6px solid transparent;border-right:6px solid transparent;border-top:6px solid #fff}
.mascot-bubble.show{opacity:1}
</style>
</head>
<body>
<div class="rotate-notice"><div class="rotate-icon">ğŸ“±</div>í™”ë©´ì„ ê°€ë¡œë¡œ ëŒë ¤ì£¼ì„¸ìš”!</div>

<div class="container">
  <div class="subject-bar">
    <button class="sb-tab active">ğŸ¨ ë¯¸ìˆ </button>
    <div class="sb-spacer"></div>
    <div class="sb-btns">
      <button class="sb-btn" id="sb-sound" onclick="toggleSound()">ğŸ”Š</button>
      <button class="sb-btn" onclick="showAdmin()">âš™ï¸</button>
    </div>
  </div>

  <div class="main-layout">
    <!-- ì™¼ìª½ íŒ¨ë„ -->
    <div class="left-panel">
      <div class="profile-section">
        <div class="profile-content">
          <div class="profile-avatar" onclick="showCharModal()"><span id="pf-char">ğŸ§’</span></div>
          <div class="profile-info">
            <div class="profile-name" onclick="changeName()"><span id="pf-name">í™”ê°€</span></div>
            <div class="profile-level-container">
              <div class="profile-level">
                <span class="level-badge">LV.<span id="pf-level">1</span></span>
                <span id="pf-done">0</span>/<span id="pf-total">10</span>
              </div>
              <div class="progress-bar"><div class="progress-fill" id="pf-bar" style="width:0%"></div></div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-headers">
        <button class="tab-btn active" onclick="switchTab('face')">ğŸ¨ ì–¼êµ´ê¾¸ë¯¸ê¸°</button>
        <button class="tab-btn" onclick="switchTab('paint')">ğŸ’¥ í­ë°œë¬¼ê°</button>
        <button class="tab-btn" onclick="switchTab('theater')">ğŸ­ ê·¸ë¦¼ìê·¹ì¥</button>
        <button class="tab-btn" onclick="switchTab('record')">ğŸ“Š ë‚´ ê¸°ë¡</button>
      </div>

      <!-- ì–¼êµ´ ì‚¬ì´ë“œ -->
      <div class="tab-content face-side active">
        <div class="side-info">
          <div class="side-title">ğŸ¨ ì–¼êµ´ ê¾¸ë¯¸ê¸°</div>
          <div class="side-stat"><span>ë§Œë“  ì–¼êµ´</span><span class="side-val" id="face-count">0</span></div>
          <div class="side-stat"><span>íŒŒì¸  ì‚¬ìš©</span><span class="side-val" id="face-parts-used">0</span></div>
        </div>
      </div>

      <!-- ë¬¼ê° ì‚¬ì´ë“œ -->
      <div class="tab-content paint-side">
        <div class="side-info">
          <div class="side-title">ğŸ’¥ í­ë°œ ë¬¼ê°</div>
          <div class="side-stat"><span>í„°ì¹˜ ìˆ˜</span><span class="side-val" id="paint-touches">0</span></div>
          <div class="side-stat"><span>ì‚¬ìš© ìƒ‰ìƒ</span><span class="side-val" id="paint-colors-used">0</span></div>
          <div class="side-stat"><span>ì‘í’ˆ ìˆ˜</span><span class="side-val" id="paint-works">0</span></div>
        </div>
      </div>

      <!-- ê·¹ì¥ ì‚¬ì´ë“œ -->
      <div class="tab-content theater-side">
        <div class="side-info">
          <div class="side-title">ğŸ­ ê·¸ë¦¼ì ê·¹ì¥</div>
          <div class="side-stat"><span>ê³µì—° íšŸìˆ˜</span><span class="side-val" id="theater-shows">0</span></div>
          <div class="side-stat"><span>ë°°ì¹˜ ìŠ¤í‹°ì»¤</span><span class="side-val" id="theater-stickers">0</span></div>
        </div>
      </div>

      <!-- ê¸°ë¡ ì‚¬ì´ë“œ -->
      <div class="tab-content record-side">
        <div class="side-info">
          <div class="side-title">ğŸ“Š ì¢…í•© ê¸°ë¡</div>
          <div class="side-stat"><span>ì´ í™œë™</span><span class="side-val" id="rec-total">0</span></div>
          <div class="side-stat"><span>íˆì–´ë¡œ ìµœê³ </span><span class="side-val" id="rec-hero-best">0</span></div>
        </div>
      </div>

      <div class="game-launch-btn" onclick="startHeroGame()">ğŸ¨ íŒ”ë ˆíŠ¸ ë””íœìŠ¤ ì‹œì‘!</div>
    </div>

    <!-- ì¤‘ì•™ íŒ¨ë„ -->
    <div class="center-panel">
      <!-- ì–¼êµ´ ê¾¸ë¯¸ê¸° -->
      <div class="game-view face-view active" id="face-view">
        <!-- ë§ˆìŠ¤ì½”íŠ¸ "ë¶“ì´" (ì–¼êµ´ê¾¸ë¯¸ê¸°) -->
        <div class="mascot" id="mascot-face" style="top:12px;right:220px">
          <svg width="100" height="140" viewBox="0 0 100 140">
            <defs><linearGradient id="brushBody1" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ec4899"/><stop offset="100%" stop-color="#f9a8d4"/></linearGradient></defs>
            <!-- ë¶“ ë¨¸ë¦¬ (brush tip) -->
            <rect x="35" y="0" width="30" height="22" rx="6" fill="#ec4899"/>
            <rect x="39" y="14" width="22" height="8" rx="3" fill="#f472b6"/>
            <!-- ëª¸í†µ -->
            <ellipse cx="50" cy="58" rx="28" ry="30" fill="url(#brushBody1)"/>
            <ellipse cx="50" cy="58" rx="22" ry="24" fill="#fce7f3"/>
            <!-- ëˆˆ (blink) -->
            <circle cx="40" cy="52" r="5" fill="#1e293b"><animate attributeName="ry" values="5;0.5;5" dur="4s" repeatCount="indefinite" begin="1s"/></circle>
            <circle cx="60" cy="52" r="5" fill="#1e293b"><animate attributeName="ry" values="5;0.5;5" dur="4s" repeatCount="indefinite" begin="1s"/></circle>
            <!-- ì… -->
            <path id="mascot-face-mouth" d="M42,66 Q50,74 58,66" fill="none" stroke="#ec4899" stroke-width="2.5" stroke-linecap="round"/>
            <!-- ë³¼ -->
            <circle cx="30" cy="60" r="6" fill="#fca5a5" opacity=".35"/>
            <circle cx="70" cy="60" r="6" fill="#fca5a5" opacity=".35"/>
            <!-- ë‹¤ë¦¬ (wobble) -->
            <rect x="36" y="86" width="10" height="18" rx="4" fill="#f9a8d4"><animateTransform attributeName="transform" type="rotate" values="-5,41,86;5,41,86;-5,41,86" dur="2s" repeatCount="indefinite"/></rect>
            <rect x="54" y="86" width="10" height="18" rx="4" fill="#f9a8d4"><animateTransform attributeName="transform" type="rotate" values="5,59,86;-5,59,86;5,59,86" dur="2s" repeatCount="indefinite" begin="0.5s"/></rect>
            <!-- ë°œ -->
            <ellipse cx="41" cy="105" rx="8" ry="4" fill="#ec4899"><animateTransform attributeName="transform" type="rotate" values="-5,41,105;5,41,105;-5,41,105" dur="2s" repeatCount="indefinite"/></ellipse>
            <ellipse cx="59" cy="105" rx="8" ry="4" fill="#ec4899"><animateTransform attributeName="transform" type="rotate" values="5,59,105;-5,59,105;5,59,105" dur="2s" repeatCount="indefinite" begin="0.5s"/></ellipse>
            <!-- íŒ”ë ˆíŠ¸ ì•…ì„¸ì„œë¦¬ -->
            <ellipse cx="82" cy="50" rx="14" ry="10" fill="#fde68a" stroke="#d97706" stroke-width="1.5" transform="rotate(-15,82,50)"/>
            <circle cx="76" cy="46" r="3" fill="#ef4444"/><circle cx="82" cy="44" r="2.5" fill="#3b82f6"/><circle cx="88" cy="47" r="2.5" fill="#22c55e"/><circle cx="84" cy="52" r="2" fill="#fbbf24"/>
          </svg>
          <div class="mascot-bubble" id="bubble-face">ì˜ˆì˜ê²Œ ê¾¸ë©°ë´!</div>
        </div>
        <div class="face-area">
          <div class="face-workspace">
            <div class="face-canvas-wrap" id="face-canvas-wrap">
              <div class="face-svg-container" id="face-svg-container">
                <svg viewBox="0 0 400 450" width="400" height="450" id="face-svg">
                  <defs>
                    <radialGradient id="faceGrad" cx="50%" cy="40%">
                      <stop offset="0%" stop-color="#fef3c7"/>
                      <stop offset="100%" stop-color="#fde68a"/>
                    </radialGradient>
                  </defs>
                  <!-- ì–¼êµ´ ìœ¤ê³½ -->
                  <ellipse cx="200" cy="220" rx="150" ry="170" fill="url(#faceGrad)" stroke="#d97706" stroke-width="3"/>
                  <!-- ê°€ì´ë“œë¼ì¸ (ë°˜íˆ¬ëª…) -->
                  <line x1="200" y1="120" x2="200" y2="380" stroke="#e5e7eb" stroke-width="1" stroke-dasharray="5,5" opacity=".4"/>
                  <line x1="80" y1="200" x2="320" y2="200" stroke="#e5e7eb" stroke-width="1" stroke-dasharray="5,5" opacity=".4"/>
                  <!-- ëˆˆ ê°€ì´ë“œ -->
                  <circle cx="145" cy="195" r="22" fill="none" stroke="#e5e7eb" stroke-width="1" stroke-dasharray="3,3" opacity=".3"/>
                  <circle cx="255" cy="195" r="22" fill="none" stroke="#e5e7eb" stroke-width="1" stroke-dasharray="3,3" opacity=".3"/>
                  <!-- ì½” ê°€ì´ë“œ -->
                  <circle cx="200" cy="250" r="15" fill="none" stroke="#e5e7eb" stroke-width="1" stroke-dasharray="3,3" opacity=".3"/>
                  <!-- ì… ê°€ì´ë“œ -->
                  <ellipse cx="200" cy="310" rx="40" ry="15" fill="none" stroke="#e5e7eb" stroke-width="1" stroke-dasharray="3,3" opacity=".3"/>
                </svg>
                <!-- ë“œë˜ê·¸ë¡œ ë†“ì¸ íŒŒì¸ ë“¤ì´ ì—¬ê¸°ì— absoluteë¡œ ë°°ì¹˜ë¨ -->
              </div>
            </div>
            <div class="face-parts-panel" id="face-parts-panel">
              <div class="parts-category">
                <div class="parts-cat-title">ğŸ‘€ ëˆˆ</div>
                <div class="parts-grid" id="eye-parts"></div>
              </div>
              <div class="parts-category">
                <div class="parts-cat-title">ğŸ‘ƒ ì½”</div>
                <div class="parts-grid" id="nose-parts"></div>
              </div>
              <div class="parts-category">
                <div class="parts-cat-title">ğŸ‘„ ì…</div>
                <div class="parts-grid" id="mouth-parts"></div>
              </div>
              <div class="parts-category">
                <div class="parts-cat-title">ğŸ’‡ ë¨¸ë¦¬</div>
                <div class="parts-grid" id="hair-parts"></div>
              </div>
              <div class="parts-category">
                <div class="parts-cat-title">âœ¨ ê¾¸ë¯¸ê¸°</div>
                <div class="parts-grid" id="deco-parts"></div>
              </div>
            </div>
          </div>
          <div class="face-bottom">
            <input class="face-name-input" id="face-name" placeholder="ì´ë¦„ì„ ì§€ì–´ì£¼ì„¸ìš”!" maxlength="10">
            <button class="face-action-btn pink" onclick="faceDone()">ğŸ¤ ì™„ì„±!</button>
            <button class="face-action-btn gray" onclick="faceClear()">ğŸ—‘ ì§€ìš°ê¸°</button>
          </div>
        </div>
      </div>

      <!-- í­ë°œ ë¬¼ê° -->
      <div class="game-view paint-view" id="paint-view">
        <!-- ë§ˆìŠ¤ì½”íŠ¸ "ë¶“ì´" (í­ë°œë¬¼ê°) -->
        <div class="mascot" id="mascot-paint" style="top:12px;right:20px">
          <svg width="100" height="140" viewBox="0 0 100 140">
            <defs><linearGradient id="brushBody2" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ec4899"/><stop offset="100%" stop-color="#f9a8d4"/></linearGradient></defs>
            <rect x="35" y="0" width="30" height="22" rx="6" fill="#ec4899"/>
            <rect x="39" y="14" width="22" height="8" rx="3" fill="#f472b6"/>
            <ellipse cx="50" cy="58" rx="28" ry="30" fill="url(#brushBody2)"/>
            <ellipse cx="50" cy="58" rx="22" ry="24" fill="#fce7f3"/>
            <circle cx="40" cy="52" r="5" fill="#1e293b"><animate attributeName="ry" values="5;0.5;5" dur="4s" repeatCount="indefinite" begin="0.5s"/></circle>
            <circle cx="60" cy="52" r="5" fill="#1e293b"><animate attributeName="ry" values="5;0.5;5" dur="4s" repeatCount="indefinite" begin="0.5s"/></circle>
            <path id="mascot-paint-mouth" d="M42,66 Q50,74 58,66" fill="none" stroke="#ec4899" stroke-width="2.5" stroke-linecap="round"/>
            <circle cx="30" cy="60" r="6" fill="#fca5a5" opacity=".35"/>
            <circle cx="70" cy="60" r="6" fill="#fca5a5" opacity=".35"/>
            <rect x="36" y="86" width="10" height="18" rx="4" fill="#f9a8d4"><animateTransform attributeName="transform" type="rotate" values="-5,41,86;5,41,86;-5,41,86" dur="2s" repeatCount="indefinite"/></rect>
            <rect x="54" y="86" width="10" height="18" rx="4" fill="#f9a8d4"><animateTransform attributeName="transform" type="rotate" values="5,59,86;-5,59,86;5,59,86" dur="2s" repeatCount="indefinite" begin="0.5s"/></rect>
            <ellipse cx="41" cy="105" rx="8" ry="4" fill="#ec4899"><animateTransform attributeName="transform" type="rotate" values="-5,41,105;5,41,105;-5,41,105" dur="2s" repeatCount="indefinite"/></ellipse>
            <ellipse cx="59" cy="105" rx="8" ry="4" fill="#ec4899"><animateTransform attributeName="transform" type="rotate" values="5,59,105;-5,59,105;5,59,105" dur="2s" repeatCount="indefinite" begin="0.5s"/></ellipse>
            <!-- ë¬¼ê°í†µ ì•…ì„¸ì„œë¦¬ -->
            <rect x="74" y="42" width="18" height="22" rx="3" fill="#3b82f6" stroke="#1e40af" stroke-width="1.5"/>
            <rect x="72" y="40" width="22" height="6" rx="2" fill="#60a5fa"/>
            <path d="M82,42 Q80,36 76,34" stroke="#ef4444" stroke-width="3" fill="none" stroke-linecap="round"/>
          </svg>
          <div class="mascot-bubble" id="bubble-paint">ë¬¼ê° íŠ€ê²¨!</div>
        </div>
        <div class="paint-area">
          <div class="paint-toolbar" id="paint-toolbar"></div>
          <div class="paint-canvas" id="paint-canvas">
            <svg width="100%" height="100%" id="paint-svg" style="position:absolute;inset:0;pointer-events:none;z-index:2"></svg>
          </div>
        </div>
      </div>

      <!-- ê·¸ë¦¼ì ê·¹ì¥ -->
      <div class="game-view theater-view" id="theater-view">
        <!-- ë§ˆìŠ¤ì½”íŠ¸ "ë¶“ì´" (ê·¸ë¦¼ìê·¹ì¥) -->
        <div class="mascot" id="mascot-theater" style="top:12px;right:20px">
          <svg width="100" height="140" viewBox="0 0 100 140">
            <defs><linearGradient id="brushBody3" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ec4899"/><stop offset="100%" stop-color="#f9a8d4"/></linearGradient></defs>
            <rect x="35" y="0" width="30" height="22" rx="6" fill="#ec4899"/>
            <rect x="39" y="14" width="22" height="8" rx="3" fill="#f472b6"/>
            <ellipse cx="50" cy="58" rx="28" ry="30" fill="url(#brushBody3)"/>
            <ellipse cx="50" cy="58" rx="22" ry="24" fill="#fce7f3"/>
            <circle cx="40" cy="52" r="5" fill="#1e293b"><animate attributeName="ry" values="5;0.5;5" dur="4s" repeatCount="indefinite" begin="1.5s"/></circle>
            <circle cx="60" cy="52" r="5" fill="#1e293b"><animate attributeName="ry" values="5;0.5;5" dur="4s" repeatCount="indefinite" begin="1.5s"/></circle>
            <path id="mascot-theater-mouth" d="M42,66 Q50,74 58,66" fill="none" stroke="#ec4899" stroke-width="2.5" stroke-linecap="round"/>
            <circle cx="30" cy="60" r="6" fill="#fca5a5" opacity=".35"/>
            <circle cx="70" cy="60" r="6" fill="#fca5a5" opacity=".35"/>
            <rect x="36" y="86" width="10" height="18" rx="4" fill="#f9a8d4"><animateTransform attributeName="transform" type="rotate" values="-5,41,86;5,41,86;-5,41,86" dur="2s" repeatCount="indefinite"/></rect>
            <rect x="54" y="86" width="10" height="18" rx="4" fill="#f9a8d4"><animateTransform attributeName="transform" type="rotate" values="5,59,86;-5,59,86;5,59,86" dur="2s" repeatCount="indefinite" begin="0.5s"/></rect>
            <ellipse cx="41" cy="105" rx="8" ry="4" fill="#ec4899"><animateTransform attributeName="transform" type="rotate" values="-5,41,105;5,41,105;-5,41,105" dur="2s" repeatCount="indefinite"/></ellipse>
            <ellipse cx="59" cy="105" rx="8" ry="4" fill="#ec4899"><animateTransform attributeName="transform" type="rotate" values="5,59,105;-5,59,105;5,59,105" dur="2s" repeatCount="indefinite" begin="0.5s"/></ellipse>
            <!-- ë§ˆìŠ¤í¬ ì•…ì„¸ì„œë¦¬ -->
            <circle cx="82" cy="48" r="12" fill="#fbbf24" stroke="#d97706" stroke-width="1.5"/>
            <circle cx="78" cy="45" r="2.5" fill="#1e293b"/><circle cx="86" cy="45" r="2.5" fill="#1e293b"/>
            <path d="M77,52 Q82,57 87,52" fill="none" stroke="#1e293b" stroke-width="1.5" stroke-linecap="round"/>
            <rect x="80" y="36" width="4" height="8" rx="1" fill="#d97706"/>
          </svg>
          <div class="mascot-bubble" id="bubble-theater">ê³µì—°í•˜ì!</div>
        </div>
        <div class="theater-area">
          <div class="stage-wrap" id="stage-wrap">
            <div class="stage-bg"></div>
            <div class="stage-stars" id="stage-stars"></div>
            <div class="stage-curtain-left"></div>
            <div class="stage-curtain-right"></div>
            <div class="stage-top"><span class="stage-top-text">ğŸ­ ê·¸ë¦¼ì ê·¹ì¥</span></div>
            <div class="stage-floor"></div>
            <div class="audience-bar" id="audience-bar">
              <span class="audience-member" style="animation-delay:0s">ğŸ‘¨</span>
              <span class="audience-member" style="animation-delay:.2s">ğŸ‘©</span>
              <span class="audience-member" style="animation-delay:.4s">ğŸ§’</span>
              <span class="audience-member" style="animation-delay:.1s">ğŸ‘´</span>
              <span class="audience-member" style="animation-delay:.3s">ğŸ‘§</span>
              <span class="audience-member" style="animation-delay:.15s">ğŸ‘¦</span>
              <span class="audience-member" style="animation-delay:.35s">ğŸ‘µ</span>
            </div>
          </div>
          <div class="theater-controls">
            <div class="sticker-palette" id="sticker-palette"></div>
            <button class="theater-btn play" onclick="theaterPlay()">â–¶ ê³µì—°!</button>
            <button class="theater-btn clear" onclick="theaterClear()">ğŸ—‘ ë¦¬ì…‹</button>
          </div>
        </div>
      </div>

      <!-- ë‚´ ê¸°ë¡ -->
      <div class="game-view record-view" id="record-view">
        <!-- ë§ˆìŠ¤ì½”íŠ¸ "ë¶“ì´" (ê¸°ë¡ë·°) -->
        <div class="mascot" id="mascot-record" style="bottom:20px;right:20px">
          <svg width="100" height="140" viewBox="0 0 100 140">
            <defs><linearGradient id="brushBody4" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ec4899"/><stop offset="100%" stop-color="#f9a8d4"/></linearGradient></defs>
            <rect x="35" y="0" width="30" height="22" rx="6" fill="#ec4899"/>
            <rect x="39" y="14" width="22" height="8" rx="3" fill="#f472b6"/>
            <ellipse cx="50" cy="58" rx="28" ry="30" fill="url(#brushBody4)"/>
            <ellipse cx="50" cy="58" rx="22" ry="24" fill="#fce7f3"/>
            <circle cx="40" cy="52" r="5" fill="#1e293b"><animate attributeName="ry" values="5;0.5;5" dur="4s" repeatCount="indefinite" begin="2s"/></circle>
            <circle cx="60" cy="52" r="5" fill="#1e293b"><animate attributeName="ry" values="5;0.5;5" dur="4s" repeatCount="indefinite" begin="2s"/></circle>
            <path id="mascot-record-mouth" d="M42,66 Q50,74 58,66" fill="none" stroke="#ec4899" stroke-width="2.5" stroke-linecap="round"/>
            <circle cx="30" cy="60" r="6" fill="#fca5a5" opacity=".35"/>
            <circle cx="70" cy="60" r="6" fill="#fca5a5" opacity=".35"/>
            <rect x="36" y="86" width="10" height="18" rx="4" fill="#f9a8d4"><animateTransform attributeName="transform" type="rotate" values="-5,41,86;5,41,86;-5,41,86" dur="2s" repeatCount="indefinite"/></rect>
            <rect x="54" y="86" width="10" height="18" rx="4" fill="#f9a8d4"><animateTransform attributeName="transform" type="rotate" values="5,59,86;-5,59,86;5,59,86" dur="2s" repeatCount="indefinite" begin="0.5s"/></rect>
            <ellipse cx="41" cy="105" rx="8" ry="4" fill="#ec4899"><animateTransform attributeName="transform" type="rotate" values="-5,41,105;5,41,105;-5,41,105" dur="2s" repeatCount="indefinite"/></ellipse>
            <ellipse cx="59" cy="105" rx="8" ry="4" fill="#ec4899"><animateTransform attributeName="transform" type="rotate" values="5,59,105;-5,59,105;5,59,105" dur="2s" repeatCount="indefinite" begin="0.5s"/></ellipse>
            <!-- íŠ¸ë¡œí”¼ ì•…ì„¸ì„œë¦¬ -->
            <rect x="76" y="48" width="16" height="14" rx="2" fill="#fbbf24" stroke="#d97706" stroke-width="1.5"/>
            <rect x="80" y="62" width="8" height="6" rx="1" fill="#d97706"/>
            <rect x="77" y="67" width="14" height="4" rx="1" fill="#fbbf24" stroke="#d97706" stroke-width="1"/>
            <path d="M76,52 Q72,44 76,40" stroke="#fbbf24" stroke-width="2" fill="none"/>
            <path d="M92,52 Q96,44 92,40" stroke="#fbbf24" stroke-width="2" fill="none"/>
            <polygon points="84,42 82,48 86,48" fill="#fbbf24"/>
          </svg>
          <div class="mascot-bubble" id="bubble-record">ë‚´ ì‘í’ˆë“¤!</div>
        </div>
        <div class="records-area">
          <div class="record-card">
            <h3>ğŸ† ì¢…í•© ì„±ì </h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-total">0</div><div class="record-label">ì´ í™œë™</div></div>
              <div class="record-item"><div class="record-num" id="r-faces">0</div><div class="record-label">ë§Œë“  ì–¼êµ´</div></div>
              <div class="record-item"><div class="record-num" id="r-paintings">0</div><div class="record-label">ê·¸ë¦° ì‘í’ˆ</div></div>
            </div>
          </div>
          <div class="record-card">
            <h3>ğŸ’¥ í­ë°œ ë¬¼ê°</h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-paint-touches">0</div><div class="record-label">í„°ì¹˜ ìˆ˜</div></div>
              <div class="record-item"><div class="record-num" id="r-paint-colors">0</div><div class="record-label">ì‚¬ìš© ìƒ‰ìƒ</div></div>
              <div class="record-item"><div class="record-num" id="r-paint-works">0</div><div class="record-label">ì‘í’ˆ ìˆ˜</div></div>
            </div>
          </div>
          <div class="record-card">
            <h3>ğŸ­ ê·¸ë¦¼ì ê·¹ì¥</h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-shows">0</div><div class="record-label">ê³µì—° íšŸìˆ˜</div></div>
              <div class="record-item"><div class="record-num" id="r-stickers">0</div><div class="record-label">ë°°ì¹˜ ìŠ¤í‹°ì»¤</div></div>
              <div class="record-item"><div class="record-num" id="r-hero-best">0</div><div class="record-label">íˆì–´ë¡œ ìµœê³ </div></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ íŒ¨ë„ -->
    <div class="right-panel" id="right-panel">
      <button class="action-btn btn-cyan" id="act1" onclick="actionBtn(1)"><span class="icon">ğŸ’¡</span>íŒíŠ¸</button>
      <button class="action-btn btn-green" id="act2" onclick="actionBtn(2)"><span class="icon">â­</span>ë‹¤ìŒ</button>
      <button class="action-btn btn-red" id="act3" onclick="actionBtn(3)"><span class="icon">ğŸ—‘</span>ì§€ìš°ê¸°</button>
    </div>
  </div>

<!-- íˆì–´ë¡œ ê²Œì„: íŒ”ë ˆíŠ¸ ë””íœìŠ¤ -->
<div id="hero-game" class="hero-game hidden">
  <div class="hg-header">
    <div class="hg-stat">â­ <span id="hg-score">0</span>ì </div>
    <div class="hg-stat">ë ˆë²¨ <span id="hg-level">1</span></div>
    <div class="hg-stat">ğŸ¨ <span id="hg-filled">0</span>/<span id="hg-total-sections">6</span></div>
    <div class="hg-hearts" id="hg-hearts">â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸</div>
    <div class="hg-ctrls">
      <button class="hg-ctrl-btn" onclick="hgPause()">â¸</button>
      <button class="hg-ctrl-btn" onclick="hgExit()">âœ•</button>
    </div>
  </div>
  <div class="hg-arena" id="hg-arena">
    <div class="hg-target-color" id="hg-target-info">
      í•„ìš”í•œ ìƒ‰: <div class="hg-target-swatch" id="hg-target-swatch"></div>
      <span id="hg-target-name">ë¹¨ê°•</span>
    </div>
    <div class="hg-combo" id="hg-combo">ğŸ”¥ 3 COMBO!</div>
    <div class="hg-picture-area" id="hg-picture-area">
      <svg viewBox="0 0 300 240" width="500" height="400" class="hg-picture-svg" id="hg-picture-svg">
        <!-- ì§‘ ê·¸ë¦¼: 6 ì˜ì—­ -->
        <rect x="60" y="100" width="180" height="130" class="hg-section" id="hg-s0" data-color=""/>
        <polygon points="150,20 40,100 260,100" class="hg-section" id="hg-s1" data-color=""/>
        <rect x="120" y="170" width="60" height="60" class="hg-section" id="hg-s2" data-color=""/>
        <rect x="80" y="120" width="40" height="40" class="hg-section" id="hg-s3" data-color=""/>
        <rect x="180" y="120" width="40" height="40" class="hg-section" id="hg-s4" data-color=""/>
        <circle cx="150" cy="60" r="25" class="hg-section" id="hg-s5" data-color=""/>
      </svg>
    </div>
  </div>
  <div id="hg-over" class="hg-overlay hidden">
    <div class="hg-overlay-box">
      <h2>ê²Œì„ ë!</h2>
      <div class="score">â­ <span id="hg-final-score">0</span>ì </div>
      <div class="msg" id="hg-over-msg">ë©‹ì§„ ê·¸ë¦¼ì´ì—ìš”!</div>
      <button class="btn-retry" onclick="hgRestart()">ğŸ”„ ë‹¤ì‹œí•˜ê¸°</button>
      <button class="btn-exit" onclick="hgExit()">ğŸ  ëŒì•„ê°€ê¸°</button>
    </div>
  </div>
  <div id="hg-pause" class="hg-overlay hidden">
    <div class="hg-overlay-box">
      <h2>â¸ ì¼ì‹œì •ì§€</h2>
      <button class="btn-retry" onclick="hgPause()">â–¶ ê³„ì†í•˜ê¸°</button>
      <button class="btn-exit" onclick="hgExit()">ğŸ  ëŒì•„ê°€ê¸°</button>
    </div>
  </div>
</div>
</div>

<!-- ê´€ë¦¬ì ëª¨ë‹¬ -->
<div id="admin-modal" class="modal-overlay hidden">
  <div class="modal-box">
    <div class="modal-head"><h3>âš™ ì„¤ì •</h3><button class="modal-close" onclick="hideAdmin()">Ã—</button></div>
    <div class="modal-body">
      <div class="modal-section">
        <h4>ğŸ‘¤ í”„ë¡œí•„</h4>
        <input class="modal-input" id="adm-name" placeholder="ì´ë¦„ ì…ë ¥" maxlength="10">
        <button class="modal-btn" onclick="saveProfile()">ì €ì¥</button>
      </div>
      <div class="modal-section">
        <h4>ğŸ”„ ì´ˆê¸°í™”</h4>
        <button class="modal-btn" style="background:linear-gradient(145deg,#ef4444,#dc2626)" onclick="resetAll()">ì „ì²´ ì´ˆê¸°í™”</button>
      </div>
    </div>
  </div>
</div>

<!-- ìºë¦­í„° ëª¨ë‹¬ -->
<div id="char-modal" class="modal-overlay hidden">
  <div class="modal-box">
    <div class="modal-head"><h3>ğŸ­ ìºë¦­í„° ì„ íƒ</h3><button class="modal-close" onclick="hideCharModal()">Ã—</button></div>
    <div class="modal-body">
      <div class="char-grid" id="char-grid"></div>
    </div>
  </div>
</div>

<script>
// ===== ì „ì—­ ë³€ìˆ˜ =====
let currentTab = 'face';
let soundEnabled = true;
const LS = localStorage;

// í”„ë¡œí•„
let profile = {
  name: LS.getItem('artName') || 'í™”ê°€',
  char: LS.getItem('artChar') || 'ğŸ§’',
  totalActivity: parseInt(LS.getItem('artActivity')) || 0
};

// ì–¼êµ´ ê¾¸ë¯¸ê¸° ìƒíƒœ
let face = {
  placedParts: [],
  count: parseInt(LS.getItem('faceCount')) || 0,
  partsUsed: parseInt(LS.getItem('facePartsUsed')) || 0,
  selectedPart: null,
  dragging: null,
  dragOffX: 0, dragOffY: 0
};

// í­ë°œ ë¬¼ê° ìƒíƒœ
let paint = {
  currentColor: '#ef4444',
  brushSize: 30,
  touches: parseInt(LS.getItem('paintTouches')) || 0,
  colorsUsed: new Set(JSON.parse(LS.getItem('paintColorsSet') || '[]')),
  works: parseInt(LS.getItem('paintWorks')) || 0
};

// ê·¸ë¦¼ì ê·¹ì¥ ìƒíƒœ
let theater = {
  stickers: [],
  selectedSticker: null,
  shows: parseInt(LS.getItem('theaterShows')) || 0,
  stickerCount: parseInt(LS.getItem('theaterStickers')) || 0,
  playing: false,
  dragging: null,
  dragOffX: 0, dragOffY: 0
};

// íˆì–´ë¡œ ê²Œì„ ìƒíƒœ
let hg = {
  score: 0, lives: 5, level: 1, running: false, paused: false,
  combo: 0, maxCombo: 0, bestScore: parseInt(LS.getItem('artHeroBest')) || 0,
  balls: [], spawnTimer: null, animId: null,
  sections: [], currentSection: 0,
  colors: ['#ef4444','#3b82f6','#fbbf24','#22c55e','#8b5cf6','#f97316'],
  colorNames: ['ë¹¨ê°•','íŒŒë‘','ë…¸ë‘','ì´ˆë¡','ë³´ë¼','ì£¼í™©'],
  targetColor: '', targetIdx: 0,
  filledCount: 0, totalSections: 6,
  pictures: [
    // ì§‘
    {name:'ì§‘',sections:6,svg:`<rect x="60" y="100" width="180" height="130" class="hg-section" id="hg-s0"/><polygon points="150,20 40,100 260,100" class="hg-section" id="hg-s1"/><rect x="120" y="170" width="60" height="60" class="hg-section" id="hg-s2"/><rect x="80" y="120" width="40" height="40" class="hg-section" id="hg-s3"/><rect x="180" y="120" width="40" height="40" class="hg-section" id="hg-s4"/><circle cx="150" cy="60" r="25" class="hg-section" id="hg-s5"/>`},
    // ê½ƒ
    {name:'ê½ƒ',sections:6,svg:`<circle cx="150" cy="80" r="35" class="hg-section" id="hg-s0"/><circle cx="110" cy="110" r="30" class="hg-section" id="hg-s1"/><circle cx="190" cy="110" r="30" class="hg-section" id="hg-s2"/><circle cx="150" cy="140" r="25" class="hg-section" id="hg-s3"/><rect x="140" y="155" width="20" height="80" rx="8" class="hg-section" id="hg-s4"/><ellipse cx="120" cy="200" rx="30" ry="15" class="hg-section" id="hg-s5"/>`},
    // ìë™ì°¨
    {name:'ìë™ì°¨',sections:6,svg:`<rect x="50" y="110" width="200" height="70" rx="10" class="hg-section" id="hg-s0"/><rect x="80" y="70" width="140" height="50" rx="15" class="hg-section" id="hg-s1"/><circle cx="100" cy="190" r="22" class="hg-section" id="hg-s2"/><circle cx="200" cy="190" r="22" class="hg-section" id="hg-s3"/><rect x="90" y="80" width="50" height="30" rx="5" class="hg-section" id="hg-s4"/><rect x="160" y="80" width="50" height="30" rx="5" class="hg-section" id="hg-s5"/>`},
    // ë³„
    {name:'ë³„',sections:6,svg:`<polygon points="150,30 170,90 240,90 185,130 205,190 150,155 95,190 115,130 60,90 130,90" class="hg-section" id="hg-s0"/><circle cx="150" cy="115" r="20" class="hg-section" id="hg-s1"/><circle cx="80" cy="50" r="12" class="hg-section" id="hg-s2"/><circle cx="230" cy="60" r="10" class="hg-section" id="hg-s3"/><circle cx="60" cy="170" r="14" class="hg-section" id="hg-s4"/><circle cx="240" cy="180" r="11" class="hg-section" id="hg-s5"/>`},
    // ë‚˜ë¹„
    {name:'ë‚˜ë¹„',sections:6,svg:`<path d="M150,120 Q100,60 60,80 Q30,100 80,130 Q110,145 150,120Z" class="hg-section" id="hg-s0"/><path d="M150,120 Q200,60 240,80 Q270,100 220,130 Q190,145 150,120Z" class="hg-section" id="hg-s1"/><path d="M150,120 Q110,160 80,180 Q60,200 100,185 Q130,170 150,120Z" class="hg-section" id="hg-s2"/><path d="M150,120 Q190,160 220,180 Q240,200 200,185 Q170,170 150,120Z" class="hg-section" id="hg-s3"/><ellipse cx="150" cy="130" rx="8" ry="25" class="hg-section" id="hg-s4"/><circle cx="150" cy="90" r="15" class="hg-section" id="hg-s5"/>`},
    // ë¬¼ê³ ê¸°
    {name:'ë¬¼ê³ ê¸°',sections:6,svg:`<ellipse cx="150" cy="120" rx="90" ry="50" class="hg-section" id="hg-s0"/><polygon points="240,120 290,80 290,160" class="hg-section" id="hg-s1"/><circle cx="110" cy="108" r="15" class="hg-section" id="hg-s2"/><ellipse cx="170" cy="100" rx="25" ry="12" class="hg-section" id="hg-s3"/><ellipse cx="170" cy="140" rx="25" ry="12" class="hg-section" id="hg-s4"/><path d="M60,120 Q80,100 100,120 Q80,140 60,120Z" class="hg-section" id="hg-s5"/>`},
    // ë‚˜ë¬´
    {name:'ë‚˜ë¬´',sections:6,svg:`<rect x="130" y="140" width="40" height="80" rx="5" class="hg-section" id="hg-s0"/><circle cx="150" cy="100" r="50" class="hg-section" id="hg-s1"/><circle cx="110" cy="120" r="35" class="hg-section" id="hg-s2"/><circle cx="190" cy="120" r="35" class="hg-section" id="hg-s3"/><circle cx="130" cy="70" r="30" class="hg-section" id="hg-s4"/><circle cx="170" cy="75" r="28" class="hg-section" id="hg-s5"/>`},
    // í•´
    {name:'í•´',sections:6,svg:`<circle cx="150" cy="120" r="45" class="hg-section" id="hg-s0"/><polygon points="150,40 145,65 155,65" class="hg-section" id="hg-s1"/><polygon points="150,200 145,175 155,175" class="hg-section" id="hg-s2"/><polygon points="60,120 85,115 85,125" class="hg-section" id="hg-s3"/><polygon points="240,120 215,115 215,125" class="hg-section" id="hg-s4"/><polygon points="90,60 105,78 95,85" class="hg-section" id="hg-s5"/>`}
  ]
};

// ===== SFX (Web Audio) =====
const SFX = {
  _ctx: null,
  _getCtx() { if (!this._ctx) this._ctx = new (window.AudioContext || window.webkitAudioContext)(); return this._ctx; },
  _play(fn) { try { if (!soundEnabled) return; fn(this._getCtx()); } catch(e) {} },
  // ë¶“ì§ˆ ì†Œë¦¬ (ë¶€ë“œëŸ¬ìš´ ë…¸ì´ì¦ˆ)
  brush() { this._play(ctx => { const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='triangle';o.frequency.setValueAtTime(800,ctx.currentTime);o.frequency.exponentialRampToValueAtTime(200,ctx.currentTime+.15);g.gain.setValueAtTime(.06,ctx.currentTime);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.15);o.start();o.stop(ctx.currentTime+.15); }); },
  // í†¡ ì†Œë¦¬ (íŒŒì¸  ë°°ì¹˜)
  pop() { this._play(ctx => { const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='sine';o.frequency.setValueAtTime(600,ctx.currentTime);o.frequency.exponentialRampToValueAtTime(300,ctx.currentTime+.08);g.gain.setValueAtTime(.1,ctx.currentTime);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.1);o.start();o.stop(ctx.currentTime+.1); }); },
  // ë°˜ì§ (ìŠ¤íŒŒí´)
  sparkle() { this._play(ctx => { [880,1100,1320].forEach((f,i) => { const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='sine';o.frequency.value=f;g.gain.setValueAtTime(.04,ctx.currentTime+i*.06);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+i*.06+.12);o.start(ctx.currentTime+i*.06);o.stop(ctx.currentTime+i*.06+.12); }); }); },
  // ë¬¼ê° íŠ€ê¹€
  splat() { this._play(ctx => { const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='sawtooth';o.frequency.setValueAtTime(150,ctx.currentTime);o.frequency.exponentialRampToValueAtTime(80,ctx.currentTime+.1);g.gain.setValueAtTime(.05,ctx.currentTime);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.12);o.start();o.stop(ctx.currentTime+.12); }); },
  // í™˜í˜¸ (ì™„ì„±)
  cheer() { this._play(ctx => { [523,659,784,1047].forEach((f,i) => { const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='sine';o.frequency.value=f;g.gain.setValueAtTime(.06,ctx.currentTime+i*.1);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+i*.1+.2);o.start(ctx.currentTime+i*.1);o.stop(ctx.currentTime+i*.1+.2); }); }); },
  // íŒ¡íŒŒë ˆ
  fanfare() { this._play(ctx => { [523,659,784,1047].forEach((f,i) => { const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='square';o.frequency.value=f;g.gain.setValueAtTime(.04,ctx.currentTime+i*.12);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+i*.12+.25);o.start(ctx.currentTime+i*.12);o.stop(ctx.currentTime+i*.12+.25); }); }); },
  // ë ˆë²¨ì—…
  levelup() { this._play(ctx => { for(let i=0;i<8;i++){const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='sine';o.frequency.value=523*(1+i*.15);g.gain.setValueAtTime(.05,ctx.currentTime+i*.06);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+i*.06+.15);o.start(ctx.currentTime+i*.06);o.stop(ctx.currentTime+i*.06+.15);} }); },
  // ì½¤ë³´
  combo(n) { this._play(ctx => { const f=523+Math.min(n,10)*50;const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='sine';o.frequency.setValueAtTime(f,ctx.currentTime);o.frequency.exponentialRampToValueAtTime(f*1.5,ctx.currentTime+.1);g.gain.setValueAtTime(.07,ctx.currentTime);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.15);o.start();o.stop(ctx.currentTime+.15); }); },
  // ê²Œì„ ì‹œì‘
  gameStart() { this._play(ctx => { [392,523,659,784].forEach((f,i) => { const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='triangle';o.frequency.value=f;g.gain.setValueAtTime(.06,ctx.currentTime+i*.1);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+i*.1+.2);o.start(ctx.currentTime+i*.1);o.stop(ctx.currentTime+i*.1+.2); }); }); },
  // ê²Œì„ ì˜¤ë²„
  gameOver() { this._play(ctx => { [523,440,349,262].forEach((f,i) => { const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='triangle';o.frequency.value=f;g.gain.setValueAtTime(.06,ctx.currentTime+i*.15);g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+i*.15+.3);o.start(ctx.currentTime+i*.15);o.stop(ctx.currentTime+i*.15+.3); }); }); }
};

// ìœ í‹¸: ìŠ¤ì½”ì–´ íŒì—…
function showScorePopup(container, points, x, y) {
  const el = document.createElement('div');
  el.className = 'score-popup';
  el.textContent = '+' + points;
  el.style.left = x + 'px'; el.style.top = y + 'px';
  container.appendChild(el);
  setTimeout(() => el.remove(), 900);
}

// ìœ í‹¸: ë ˆë²¨ì—… ì˜¤ë²„ë ˆì´
function showLevelUp(lv) {
  SFX.levelup();
  const ov = document.createElement('div');
  ov.className = 'levelup-overlay';
  ov.innerHTML = `<div class="levelup-box">ğŸ¨ ë ˆë²¨ ${lv} ë‹¬ì„±!</div>`;
  document.body.appendChild(ov);
  setTimeout(() => ov.remove(), 800);
}

// ìœ í‹¸: ë§ˆìŠ¤ì½”íŠ¸ ê°ì •
function setMascotEmotion(viewId, emotion) {
  const mouthIds = ['mascot-face-mouth','mascot-paint-mouth','mascot-theater-mouth','mascot-record-mouth'];
  const bubbleIds = ['bubble-face','bubble-paint','bubble-theater','bubble-record'];
  mouthIds.forEach((mid, i) => {
    const mouth = document.getElementById(mid);
    const bubble = document.getElementById(bubbleIds[i]);
    if (!mouth) return;
    if (emotion === 'happy') {
      mouth.setAttribute('d', 'M40,64 Q50,76 60,64');
      if (bubble) { bubble.textContent = ['ë©‹ì ¸!','ìµœê³ !','ì˜ˆì˜ë‹¤!','ì™€!'][Math.floor(Math.random()*4)]; bubble.classList.add('show'); setTimeout(() => bubble.classList.remove('show'), 2000); }
    } else if (emotion === 'worried') {
      mouth.setAttribute('d', 'M42,70 Q50,64 58,70');
      if (bubble) { bubble.textContent = 'ì•—!'; bubble.classList.add('show'); setTimeout(() => bubble.classList.remove('show'), 1500); }
    } else {
      mouth.setAttribute('d', 'M42,66 Q50,74 58,66');
    }
    setTimeout(() => { if (mouth) mouth.setAttribute('d', 'M42,66 Q50,74 58,66'); }, 2500);
  });
}

// ===== TTS =====
let audioQueue = [];
let isSpeaking = false;
function speak(text) {
  if (!soundEnabled) return;
  speechSynthesis.cancel();
  audioQueue = [];
  isSpeaking = false;
  audioQueue.push(text);
  processQueue();
}
function processQueue() {
  if (isSpeaking || !audioQueue.length) return;
  isSpeaking = true;
  const u = new SpeechSynthesisUtterance(audioQueue.shift());
  u.lang = 'ko-KR'; u.rate = 1.0; u.pitch = 1.1;
  u.onend = () => { isSpeaking = false; processQueue(); };
  u.onerror = () => { isSpeaking = false; processQueue(); };
  speechSynthesis.speak(u);
}
function toggleSound() {
  soundEnabled = !soundEnabled;
  document.getElementById('sb-sound').textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
  if (!soundEnabled) speechSynthesis.cancel();
}

// ===== í”„ë¡œí•„ =====
let _prevMainLevel = 1;
function updateProfile() {
  document.getElementById('pf-name').textContent = profile.name;
  document.getElementById('pf-char').textContent = profile.char;
  const lv = Math.floor(profile.totalActivity / 10) + 1;
  if (lv > _prevMainLevel && _prevMainLevel > 0) showLevelUp(lv);
  _prevMainLevel = lv;
  document.getElementById('pf-level').textContent = lv;
  const prog = (profile.totalActivity % 10);
  document.getElementById('pf-done').textContent = prog;
  document.getElementById('pf-total').textContent = 10;
  document.getElementById('pf-bar').style.width = (prog * 10) + '%';
}
function changeName() {
  const n = prompt('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', profile.name);
  if (n && n.trim()) { profile.name = n.trim(); LS.setItem('artName', profile.name); updateProfile(); }
}
function showCharModal() {
  document.getElementById('char-modal').classList.remove('hidden');
  const chars = ['ğŸ§’','ğŸ‘¦','ğŸ‘§','ğŸ¦¸â€â™‚ï¸','ğŸ¦¸â€â™€ï¸','ğŸ§™â€â™‚ï¸','ğŸ±','ğŸ¶','ğŸ¦Š','ğŸ»','ğŸ°','ğŸ¸','ğŸ¦','ğŸ¯','ğŸ¼'];
  const g = document.getElementById('char-grid');
  g.innerHTML = chars.map(c => `<div class="char-item${c===profile.char?' selected':''}" onclick="pickChar('${c}')">${c}</div>`).join('');
}
function hideCharModal() { document.getElementById('char-modal').classList.add('hidden'); }
function pickChar(c) { profile.char = c; LS.setItem('artChar', c); updateProfile(); hideCharModal(); }
function showAdmin() { document.getElementById('admin-modal').classList.remove('hidden'); document.getElementById('adm-name').value = profile.name; }
function hideAdmin() { document.getElementById('admin-modal').classList.add('hidden'); }
function saveProfile() {
  const n = document.getElementById('adm-name').value.trim();
  if (n) { profile.name = n; LS.setItem('artName', n); updateProfile(); }
  hideAdmin();
}
function resetAll() {
  if (!confirm('ëª¨ë“  ê¸°ë¡ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤. ì •ë§ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
  ['artName','artChar','artActivity','faceCount','facePartsUsed','paintTouches','paintColorsSet','paintWorks','theaterShows','theaterStickers','artHeroBest'].forEach(k => LS.removeItem(k));
  location.reload();
}
function saveStats() {
  LS.setItem('artActivity', profile.totalActivity);
  LS.setItem('faceCount', face.count);
  LS.setItem('facePartsUsed', face.partsUsed);
  LS.setItem('paintTouches', paint.touches);
  LS.setItem('paintColorsSet', JSON.stringify([...paint.colorsUsed]));
  LS.setItem('paintWorks', paint.works);
  LS.setItem('theaterShows', theater.shows);
  LS.setItem('theaterStickers', theater.stickerCount);
  LS.setItem('artHeroBest', hg.bestScore);
}

// ===== íƒ­ ì „í™˜ =====
function switchTab(tab) {
  speechSynthesis.cancel();
  audioQueue = [];
  isSpeaking = false;
  currentTab = tab;
  document.querySelectorAll('.tab-btn').forEach((b, i) => {
    b.classList.toggle('active', ['face','paint','theater','record'][i] === tab);
  });
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelector('.' + tab + '-side').classList.add('active');
  document.querySelectorAll('.game-view').forEach(v => v.classList.remove('active'));
  document.querySelector('.' + tab + '-view').classList.add('active');
  updateActionButtons();
  if (tab === 'record') updateRecords();
}

function updateActionButtons() {
  const a1 = document.getElementById('act1');
  const a2 = document.getElementById('act2');
  const a3 = document.getElementById('act3');
  if (currentTab === 'face') {
    a1.innerHTML = '<span class="icon">ğŸ¤</span>ì™„ì„±!'; a1.className = 'action-btn btn-pink'; a1.disabled = false;
    a2.innerHTML = '<span class="icon">ğŸ”€</span>ëœë¤'; a2.className = 'action-btn btn-cyan'; a2.disabled = false;
    a3.innerHTML = '<span class="icon">ğŸ—‘</span>ì§€ìš°ê¸°'; a3.className = 'action-btn btn-red'; a3.disabled = false;
  } else if (currentTab === 'paint') {
    a1.innerHTML = '<span class="icon">ğŸ’¾</span>ì €ì¥'; a1.className = 'action-btn btn-green'; a1.disabled = false;
    a2.innerHTML = '<span class="icon">ğŸŒˆ</span>ëœë¤ìƒ‰'; a2.className = 'action-btn btn-cyan'; a2.disabled = false;
    a3.innerHTML = '<span class="icon">ğŸ—‘</span>ì§€ìš°ê¸°'; a3.className = 'action-btn btn-red'; a3.disabled = false;
  } else if (currentTab === 'theater') {
    a1.innerHTML = '<span class="icon">â–¶</span>ê³µì—°!'; a1.className = 'action-btn btn-green'; a1.disabled = false;
    a2.innerHTML = '<span class="icon">ğŸ²</span>ëœë¤ë°°ì¹˜'; a2.className = 'action-btn btn-cyan'; a2.disabled = false;
    a3.innerHTML = '<span class="icon">ğŸ—‘</span>ë¦¬ì…‹'; a3.className = 'action-btn btn-red'; a3.disabled = false;
  } else {
    a1.innerHTML = '<span class="icon">ğŸ“Š</span>ê¸°ë¡'; a1.className = 'action-btn btn-cyan'; a1.disabled = true;
    a2.innerHTML = '<span class="icon">â€”</span>â€”'; a2.className = 'action-btn btn-green'; a2.disabled = true;
    a3.innerHTML = '<span class="icon">â€”</span>â€”'; a3.className = 'action-btn btn-red'; a3.disabled = true;
  }
}

function actionBtn(n) {
  if (currentTab === 'face') {
    if (n === 1) faceDone();
    else if (n === 2) faceRandom();
    else faceClear();
  } else if (currentTab === 'paint') {
    if (n === 1) paintSave();
    else if (n === 2) paintRandomColor();
    else paintClearCanvas();
  } else if (currentTab === 'theater') {
    if (n === 1) theaterPlay();
    else if (n === 2) theaterRandomPlace();
    else theaterClear();
  }
}

// ===== ì–¼êµ´ ê¾¸ë¯¸ê¸° =====
const FACE_SVG = {
  eyes: [
    {id:'e1',name:'ë™ê¸€ëˆˆ',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><ellipse cx="15" cy="30" rx="10" ry="12" fill="#fff" stroke="#1e293b" stroke-width="2"/><ellipse cx="45" cy="30" rx="10" ry="12" fill="#fff" stroke="#1e293b" stroke-width="2"/><circle cx="17" cy="29" r="5" fill="#1e293b"/><circle cx="47" cy="29" r="5" fill="#1e293b"/><circle cx="19" cy="26" r="2" fill="#fff"/><circle cx="49" cy="26" r="2" fill="#fff"/></svg>'},
    {id:'e2',name:'ë³„ëˆˆ',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><polygon points="15,18 17,26 25,26 19,31 21,39 15,34 9,39 11,31 5,26 13,26" fill="#fbbf24" stroke="#d97706" stroke-width="1"/><polygon points="45,18 47,26 55,26 49,31 51,39 45,34 39,39 41,31 35,26 43,26" fill="#fbbf24" stroke="#d97706" stroke-width="1"/><circle cx="15" cy="29" r="3" fill="#1e293b"/><circle cx="45" cy="29" r="3" fill="#1e293b"/></svg>'},
    {id:'e3',name:'í•˜íŠ¸ëˆˆ',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><path d="M10,28 C10,22 15,18 18,22 C21,18 26,22 26,28 C26,34 18,40 18,40 C18,40 10,34 10,28Z" fill="#ef4444"/><path d="M38,28 C38,22 43,18 46,22 C49,18 54,22 54,28 C54,34 46,40 46,40 C46,40 38,34 38,28Z" fill="#ef4444"/><circle cx="14" cy="26" r="2" fill="#fff" opacity=".5"/><circle cx="42" cy="26" r="2" fill="#fff" opacity=".5"/></svg>'},
    {id:'e4',name:'ì¡¸ë¦°ëˆˆ',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><ellipse cx="15" cy="32" rx="10" ry="6" fill="#fff" stroke="#1e293b" stroke-width="2"/><ellipse cx="45" cy="32" rx="10" ry="6" fill="#fff" stroke="#1e293b" stroke-width="2"/><line x1="5" y1="28" x2="25" y2="28" stroke="#1e293b" stroke-width="2" stroke-linecap="round"/><line x1="35" y1="28" x2="55" y2="28" stroke="#1e293b" stroke-width="2" stroke-linecap="round"/><circle cx="15" cy="33" r="4" fill="#1e293b"/><circle cx="45" cy="33" r="4" fill="#1e293b"/></svg>'},
    {id:'e5',name:'ìœ™í¬',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><ellipse cx="15" cy="30" rx="10" ry="12" fill="#fff" stroke="#1e293b" stroke-width="2"/><circle cx="17" cy="29" r="5" fill="#1e293b"/><circle cx="19" cy="26" r="2" fill="#fff"/><path d="M36,30 Q45,24 54,30" fill="none" stroke="#1e293b" stroke-width="2.5" stroke-linecap="round"/><line x1="50" y1="26" x2="54" y2="22" stroke="#1e293b" stroke-width="1.5" stroke-linecap="round"/><line x1="50" y1="26" x2="56" y2="27" stroke="#1e293b" stroke-width="1.5" stroke-linecap="round"/></svg>'},
    {id:'e6',name:'í°ëˆˆ',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><ellipse cx="15" cy="30" rx="12" ry="15" fill="#fff" stroke="#1e293b" stroke-width="2"/><ellipse cx="45" cy="30" rx="12" ry="15" fill="#fff" stroke="#1e293b" stroke-width="2"/><circle cx="17" cy="30" r="7" fill="#6366f1"/><circle cx="47" cy="30" r="7" fill="#6366f1"/><circle cx="17" cy="30" r="4" fill="#1e293b"/><circle cx="47" cy="30" r="4" fill="#1e293b"/><circle cx="20" cy="25" r="3" fill="#fff"/><circle cx="50" cy="25" r="3" fill="#fff"/><circle cx="14" cy="28" r="1.5" fill="#fff" opacity=".6"/><circle cx="44" cy="28" r="1.5" fill="#fff" opacity=".6"/></svg>'}
  ],
  nose: [
    {id:'n1',name:'ë™ê¸€ì½”',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><circle cx="30" cy="32" r="8" fill="#f4a574" stroke="#d97706" stroke-width="1.5"/><circle cx="28" cy="30" r="2" fill="#fff" opacity=".4"/></svg>'},
    {id:'n2',name:'ì„¸ëª¨ì½”',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><polygon points="30,20 22,40 38,40" fill="#f4a574" stroke="#d97706" stroke-width="1.5" stroke-linejoin="round"/></svg>'},
    {id:'n3',name:'ë¼ì§€ì½”',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><ellipse cx="30" cy="32" rx="14" ry="10" fill="#f9a8d4" stroke="#ec4899" stroke-width="1.5"/><circle cx="24" cy="33" r="4" fill="#ec4899"/><circle cx="36" cy="33" r="4" fill="#ec4899"/></svg>'},
    {id:'n4',name:'í•˜íŠ¸ì½”',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><path d="M25,30 C25,24 30,22 33,26 C36,22 41,24 41,30 C41,36 33,42 33,42 C33,42 25,36 25,30Z" fill="#fca5a5" stroke="#ef4444" stroke-width="1"/></svg>'},
    {id:'n5',name:'ë‚©ì‘ì½”',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><ellipse cx="30" cy="34" rx="16" ry="6" fill="#f4a574" stroke="#d97706" stroke-width="1.5"/><circle cx="24" cy="35" r="3" fill="#d97706" opacity=".4"/><circle cx="36" cy="35" r="3" fill="#d97706" opacity=".4"/></svg>'}
  ],
  mouth: [
    {id:'m1',name:'ì›ƒëŠ”ì…',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><path d="M15,28 Q30,45 45,28" fill="none" stroke="#ef4444" stroke-width="3" stroke-linecap="round"/></svg>'},
    {id:'m2',name:'í°ì›ƒìŒ',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><path d="M12,26 Q30,50 48,26" fill="#fff" stroke="#ef4444" stroke-width="2.5"/><line x1="18" y1="26" x2="42" y2="26" stroke="#ef4444" stroke-width="2"/><rect x="20" y="24" width="5" height="6" rx="1" fill="#fff" stroke="#e5e7eb" stroke-width=".5"/><rect x="26" y="24" width="5" height="6" rx="1" fill="#fff" stroke="#e5e7eb" stroke-width=".5"/><rect x="32" y="24" width="5" height="6" rx="1" fill="#fff" stroke="#e5e7eb" stroke-width=".5"/></svg>'},
    {id:'m3',name:'ì‚ì£½',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><path d="M18,32 Q24,28 30,34 Q36,28 42,32" fill="#f472b6" stroke="#ec4899" stroke-width="2" stroke-linecap="round"/></svg>'},
    {id:'m4',name:'ë†€ë€ì…',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><ellipse cx="30" cy="34" rx="10" ry="13" fill="#1e293b" stroke="#0f172a" stroke-width="1.5"/><ellipse cx="30" cy="32" rx="6" ry="6" fill="#ef4444" opacity=".3"/></svg>'},
    {id:'m5',name:'í˜€',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><path d="M15,28 Q30,42 45,28" fill="none" stroke="#ef4444" stroke-width="3" stroke-linecap="round"/><ellipse cx="30" cy="38" rx="8" ry="10" fill="#f472b6"/><ellipse cx="30" cy="36" rx="6" ry="6" fill="#f9a8d4"/></svg>'},
    {id:'m6',name:'ì…ìˆ ',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><path d="M14,32 Q22,24 30,30 Q38,24 46,32 Q38,42 30,40 Q22,42 14,32Z" fill="#f472b6" stroke="#ec4899" stroke-width="1.5"/><path d="M18,32 Q24,28 30,30 Q36,28 42,32" fill="none" stroke="#ec4899" stroke-width="1" opacity=".5"/><ellipse cx="22" cy="30" rx="3" ry="2" fill="#fff" opacity=".3"/></svg>'}
  ],
  hair: [
    {id:'h1',name:'ì™•ê´€',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><polygon points="8,45 12,15 20,30 30,8 40,30 48,15 52,45" fill="#fbbf24" stroke="#d97706" stroke-width="1.5"/><rect x="8" y="42" width="44" height="8" rx="2" fill="#fbbf24" stroke="#d97706" stroke-width="1"/><circle cx="20" cy="46" r="3" fill="#ef4444"/><circle cx="30" cy="46" r="3" fill="#3b82f6"/><circle cx="40" cy="46" r="3" fill="#22c55e"/></svg>'},
    {id:'h2',name:'ë¦¬ë³¸',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><path d="M30,30 Q15,10 5,25 Q15,35 30,30Z" fill="#f472b6" stroke="#ec4899" stroke-width="1.5"/><path d="M30,30 Q45,10 55,25 Q45,35 30,30Z" fill="#f472b6" stroke="#ec4899" stroke-width="1.5"/><circle cx="30" cy="30" r="5" fill="#ec4899"/><path d="M26,35 Q28,50 30,48 Q32,50 34,35" fill="#ec4899" stroke="#db2777" stroke-width="1"/></svg>'},
    {id:'h3',name:'ëª¨ì',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><polygon points="30,5 15,40 45,40" fill="#8b5cf6" stroke="#7c3aed" stroke-width="1.5"/><ellipse cx="30" cy="40" rx="22" ry="5" fill="#8b5cf6" stroke="#7c3aed" stroke-width="1.5"/><circle cx="30" cy="8" r="4" fill="#fbbf24"/><rect x="22" y="30" width="16" height="4" rx="1" fill="#fbbf24"/></svg>'},
    {id:'h4',name:'ê³±ìŠ¬',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><circle cx="12" cy="18" r="8" fill="#8B4513" opacity=".8"/><circle cx="25" cy="12" r="9" fill="#8B4513" opacity=".8"/><circle cx="38" cy="12" r="9" fill="#8B4513" opacity=".8"/><circle cx="48" cy="18" r="8" fill="#8B4513" opacity=".8"/><circle cx="8" cy="30" r="7" fill="#8B4513" opacity=".7"/><circle cx="52" cy="30" r="7" fill="#8B4513" opacity=".7"/><circle cx="10" cy="42" r="6" fill="#8B4513" opacity=".6"/><circle cx="50" cy="42" r="6" fill="#8B4513" opacity=".6"/></svg>'},
    {id:'h5',name:'ìƒë¨¸ë¦¬',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><path d="M8,15 Q8,5 20,5 L40,5 Q52,5 52,15 L52,55 Q52,58 50,58 L48,58 Q46,58 46,55 L46,18 Q46,12 30,12 Q14,12 14,18 L14,55 Q14,58 12,58 L10,58 Q8,58 8,55Z" fill="#1e293b" opacity=".85"/><path d="M14,14 Q14,10 20,8" stroke="#374151" stroke-width="1" fill="none" opacity=".4"/><path d="M46,14 Q46,10 40,8" stroke="#374151" stroke-width="1" fill="none" opacity=".4"/></svg>'},
    {id:'h6',name:'ê½ƒê´€',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><ellipse cx="30" cy="38" rx="26" ry="4" fill="#22c55e" opacity=".5"/><circle cx="10" cy="30" r="7" fill="#f472b6"/><circle cx="10" cy="30" r="3" fill="#fbbf24"/><circle cx="22" cy="25" r="6" fill="#fbbf24"/><circle cx="22" cy="25" r="2.5" fill="#f97316"/><circle cx="34" cy="23" r="7" fill="#ef4444"/><circle cx="34" cy="23" r="3" fill="#fbbf24"/><circle cx="46" cy="26" r="6" fill="#a855f7"/><circle cx="46" cy="26" r="2.5" fill="#fbbf24"/><circle cx="54" cy="32" r="5" fill="#3b82f6"/><circle cx="54" cy="32" r="2" fill="#fbbf24"/></svg>'}
  ],
  deco: [
    {id:'d1',name:'ë³„',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><polygon points="30,5 35,22 53,22 39,33 44,50 30,40 16,50 21,33 7,22 25,22" fill="#fbbf24" stroke="#d97706" stroke-width="1"/><polygon points="30,14 33,24 43,24 35,30 38,40 30,34 22,40 25,30 17,24 27,24" fill="#fde68a"/></svg>'},
    {id:'d2',name:'ê½ƒ',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><circle cx="30" cy="20" r="8" fill="#f472b6"/><circle cx="20" cy="28" r="8" fill="#f472b6"/><circle cx="40" cy="28" r="8" fill="#f472b6"/><circle cx="22" cy="38" r="8" fill="#f472b6"/><circle cx="38" cy="38" r="8" fill="#f472b6"/><circle cx="30" cy="30" r="6" fill="#fbbf24"/></svg>'},
    {id:'d3',name:'ë‚˜ë¹„',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><path d="M30,30 Q15,10 8,20 Q2,30 15,35 Q20,37 30,30Z" fill="#a855f7" opacity=".8"/><path d="M30,30 Q45,10 52,20 Q58,30 45,35 Q40,37 30,30Z" fill="#a855f7" opacity=".8"/><path d="M30,30 Q18,40 12,45 Q10,52 22,45 Q26,42 30,30Z" fill="#c084fc" opacity=".7"/><path d="M30,30 Q42,40 48,45 Q50,52 38,45 Q34,42 30,30Z" fill="#c084fc" opacity=".7"/><ellipse cx="30" cy="32" rx="2" ry="8" fill="#1e293b"/><line x1="28" y1="24" x2="22" y2="16" stroke="#1e293b" stroke-width="1.5"/><line x1="32" y1="24" x2="38" y2="16" stroke="#1e293b" stroke-width="1.5"/><circle cx="22" cy="15" r="2" fill="#1e293b"/><circle cx="38" cy="15" r="2" fill="#1e293b"/></svg>'},
    {id:'d4',name:'í•˜íŠ¸',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><path d="M30,50 C10,35 5,20 15,15 C22,11 28,16 30,22 C32,16 38,11 45,15 C55,20 50,35 30,50Z" fill="#ef4444"/><path d="M22,20 C24,17 28,18 30,22" fill="none" stroke="#fff" stroke-width="2" opacity=".4" stroke-linecap="round"/></svg>'},
    {id:'d5',name:'ë¬´ì§€ê°œ',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><path d="M5,50 A25,25 0 0,1 55,50" fill="none" stroke="#ef4444" stroke-width="4"/><path d="M9,50 A21,21 0 0,1 51,50" fill="none" stroke="#f97316" stroke-width="4"/><path d="M13,50 A17,17 0 0,1 47,50" fill="none" stroke="#fbbf24" stroke-width="4"/><path d="M17,50 A13,13 0 0,1 43,50" fill="none" stroke="#22c55e" stroke-width="4"/><path d="M21,50 A9,9 0 0,1 39,50" fill="none" stroke="#3b82f6" stroke-width="4"/><path d="M25,50 A5,5 0 0,1 35,50" fill="none" stroke="#8b5cf6" stroke-width="4"/></svg>'},
    {id:'d6',name:'ë°˜ì§',svg:'<svg viewBox="0 0 60 60" width="100%" height="100%"><path d="M30,5 L33,22 L50,18 L36,28 L48,42 L32,34 L30,55 L28,34 L12,42 L24,28 L10,18 L27,22Z" fill="#fbbf24"/><circle cx="30" cy="30" r="5" fill="#fff" opacity=".6"/><circle cx="15" cy="12" r="2" fill="#fbbf24" opacity=".6"/><circle cx="48" cy="10" r="1.5" fill="#fbbf24" opacity=".5"/><circle cx="12" cy="48" r="1.5" fill="#fbbf24" opacity=".5"/><circle cx="50" cy="48" r="2" fill="#fbbf24" opacity=".6"/></svg>'}
  ]
};

function initFaceParts() {
  const sections = [
    {id:'eye-parts', parts: FACE_SVG.eyes, cat:'eyes'},
    {id:'nose-parts', parts: FACE_SVG.nose, cat:'nose'},
    {id:'mouth-parts', parts: FACE_SVG.mouth, cat:'mouth'},
    {id:'hair-parts', parts: FACE_SVG.hair, cat:'hair'},
    {id:'deco-parts', parts: FACE_SVG.deco, cat:'deco'}
  ];
  sections.forEach(s => {
    const grid = document.getElementById(s.id);
    grid.innerHTML = s.parts.map(p =>
      `<div class="face-part-item" data-part-id="${p.id}" data-cat="${s.cat}" onclick="selectFacePart(this)"><div style="width:58px;height:58px">${p.svg}</div><div style="font-size:14px;font-weight:600;color:#9d174d;margin-top:2px;line-height:1">${p.name}</div></div>`
    ).join('');
  });
}

function selectFacePart(el) {
  document.querySelectorAll('.face-part-item').forEach(e => e.classList.remove('selected'));
  el.classList.add('selected');
  face.selectedPart = el.dataset.partId;
}

function getFaceSvgById(id) {
  const all = [...FACE_SVG.eyes,...FACE_SVG.nose,...FACE_SVG.mouth,...FACE_SVG.hair,...FACE_SVG.deco];
  return all.find(p => p.id === id);
}

function initFaceDrag() {
  const container = document.getElementById('face-svg-container');
  container.addEventListener('mousedown', faceCanvasDown);
  container.addEventListener('mousemove', faceCanvasMove);
  container.addEventListener('mouseup', faceCanvasUp);
  container.addEventListener('touchstart', e => { e.preventDefault(); faceCanvasDown(e.touches[0]); }, {passive:false});
  container.addEventListener('touchmove', e => { e.preventDefault(); faceCanvasMove(e.touches[0]); }, {passive:false});
  container.addEventListener('touchend', e => { faceCanvasUp(e); }, {passive:false});
}

function faceCanvasDown(e) {
  const container = document.getElementById('face-svg-container');
  const rect = container.getBoundingClientRect();
  const vx = e.clientX - rect.left;
  const vy = e.clientY - rect.top;
  const scaleX = 400 / rect.width;
  const scaleY = 450 / rect.height;
  const sx = vx * scaleX;
  const sy = vy * scaleY;

  // ì´ë¯¸ ë†“ì¸ íŒŒì¸ ë¥¼ í´ë¦­í–ˆëŠ”ì§€ í™•ì¸
  const placed = container.querySelectorAll('.placed-part');
  for (let i = placed.length - 1; i >= 0; i--) {
    const p = placed[i];
    const px = parseFloat(p.style.left);
    const py = parseFloat(p.style.top);
    const pw = parseFloat(p.style.width) || 130;
    if (sx >= px - 10 && sx <= px + pw + 10 && sy >= py - 10 && sy <= py + pw + 10) {
      // ë”ë¸”íƒ­ â†’ ì‚­ì œ
      const now = Date.now();
      if (p._lastTap && now - p._lastTap < 500) {
        p.style.transition = 'transform .25s, opacity .25s';
        p.style.transform = 'scale(0) rotate(30deg)';
        p.style.opacity = '0';
        setTimeout(() => p.remove(), 250);
        SFX.pop();
        speak('ì‚­ì œ!');
        return;
      }
      p._lastTap = now;
      face.dragging = p;
      face.dragOffX = sx - px;
      face.dragOffY = sy - py;
      p.style.zIndex = 10;
      return;
    }
  }

  // ì„ íƒëœ íŒŒì¸ ê°€ ìˆìœ¼ë©´ ìƒˆë¡œ ë°°ì¹˜
  if (face.selectedPart) {
    const partData = getFaceSvgById(face.selectedPart);
    if (!partData) return;
    const part = document.createElement('div');
    part.className = 'placed-part';
    part.style.width = '130px';
    part.style.height = '130px';
    part.innerHTML = partData.svg;
    part.style.left = (sx - 65) + 'px';
    part.style.top = (sy - 65) + 'px';
    part.dataset.partId = face.selectedPart;
    container.appendChild(part);
    face.placedParts.push({partId: face.selectedPart, x: sx - 65, y: sy - 65});
    face.partsUsed++;
    document.getElementById('face-parts-used').textContent = face.partsUsed;
    SFX.pop();
    faceSpawnEffect(vx, vy, rect);
  }
}

function faceCanvasMove(e) {
  if (!face.dragging) return;
  const container = document.getElementById('face-svg-container');
  const rect = container.getBoundingClientRect();
  const vx = e.clientX - rect.left;
  const vy = e.clientY - rect.top;
  const sx = vx * (400 / rect.width);
  const sy = vy * (450 / rect.height);
  face.dragging.style.left = (sx - face.dragOffX) + 'px';
  face.dragging.style.top = (sy - face.dragOffY) + 'px';
}

function faceCanvasUp(e) {
  if (face.dragging) {
    face.dragging.style.zIndex = 5;
    face.dragging = null;
  }
}

function faceSpawnEffect(x, y, containerRect) {
  const container = document.getElementById('face-canvas-wrap');
  const wRect = container.getBoundingClientRect();
  const svgRect = document.getElementById('face-svg-container').getBoundingClientRect();
  const cx = svgRect.left - wRect.left + x;
  const cy = svgRect.top - wRect.top + y;
  const sparks = ['âœ¨','ğŸ’–','â­','ğŸŒŸ'];
  for (let i = 0; i < 6; i++) {
    const p = document.createElement('div');
    p.style.cssText = `position:absolute;left:${cx}px;top:${cy}px;font-size:${20+Math.random()*14}px;pointer-events:none;z-index:20;animation:starPop .6s ease-out forwards;--tx:${(Math.random()-.5)*80}px;--ty:${(Math.random()-.5)*80}px`;
    p.textContent = sparks[Math.floor(Math.random()*sparks.length)];
    container.appendChild(p);
    setTimeout(() => p.remove(), 600);
  }
}

function faceDone() {
  if (face.placedParts.length === 0) {
    speak('ì–¼êµ´ì— ë­”ê°€ ë¶™ì—¬ì£¼ì„¸ìš”!');
    return;
  }
  const name = document.getElementById('face-name').value.trim() || 'ì´ë¦„ì—†ëŠ” ì¹œêµ¬';
  face.count++;
  profile.totalActivity++;
  document.getElementById('face-count').textContent = face.count;
  SFX.cheer();
  setMascotEmotion('face', 'happy');
  speak(`ì•ˆë…•! ë‚˜ëŠ” ${name}ì´ì•¼!`);
  updateProfile();
  saveStats();

  // ì™„ì„± ì¶•í•˜ ì´í™íŠ¸
  const container = document.getElementById('face-canvas-wrap');
  const rect = container.getBoundingClientRect();
  for (let i = 0; i < 20; i++) {
    const c = document.createElement('div');
    c.style.cssText = `position:absolute;left:${Math.random()*100}%;top:${Math.random()*100}%;width:${6+Math.random()*8}px;height:${6+Math.random()*8}px;border-radius:${Math.random()>.5?'50%':'3px'};background:${['#ec4899','#f472b6','#f9a8d4','#fbbf24','#22c55e','#3b82f6','#8b5cf6'][Math.floor(Math.random()*7)]};pointer-events:none;z-index:30;animation:paintSplash .8s ease-out forwards;--tx:${(Math.random()-.5)*120}px;--ty:${(Math.random()-.5)*120}px;--es:0;--dur:.8s`;
    container.appendChild(c);
    setTimeout(() => c.remove(), 800);
  }
}

function faceClear() {
  const container = document.getElementById('face-svg-container');
  container.querySelectorAll('.placed-part').forEach(p => p.remove());
  face.placedParts = [];
  document.getElementById('face-name').value = '';
}

function faceRandom() {
  faceClear();
  const container = document.getElementById('face-svg-container');
  const rp = (arr) => arr[Math.floor(Math.random()*arr.length)];
  const randomParts = [
    {part: rp(FACE_SVG.eyes), x: 80, y: 130},
    {part: rp(FACE_SVG.eyes), x: 190, y: 130},
    {part: rp(FACE_SVG.nose), x: 135, y: 185},
    {part: rp(FACE_SVG.mouth), x: 135, y: 250},
    {part: rp(FACE_SVG.hair), x: 135, y: -10},
    {part: rp(FACE_SVG.deco), x: 255, y: 60}
  ];
  randomParts.forEach(p => {
    const el = document.createElement('div');
    el.className = 'placed-part';
    el.style.width = '130px';
    el.style.height = '130px';
    el.innerHTML = p.part.svg;
    el.style.left = p.x + 'px';
    el.style.top = p.y + 'px';
    el.dataset.partId = p.part.id;
    container.appendChild(el);
    face.placedParts.push({partId: p.part.id, x: p.x, y: p.y});
    face.partsUsed++;
  });
  document.getElementById('face-parts-used').textContent = face.partsUsed;
  const names = ['ë½€ë¡œë¡œ','ê¾¸ëŸ¬ê¸°','ë§ë‘ì´','ë²ˆê°œë§¨','êµ¬ë¦„ì´','ë°˜ì§ì´','ë‘ë¦¬','í•˜ëŠ˜ì´'];
  document.getElementById('face-name').value = names[Math.floor(Math.random()*names.length)];
  SFX.sparkle();
  speak('ëœë¤ ì–¼êµ´ ì™„ì„±!');
}

// ===== í­ë°œ ë¬¼ê° =====
const PAINT_COLORS = [
  {color:'#ef4444',name:'ë¹¨ê°•'},{color:'#f97316',name:'ì£¼í™©'},{color:'#fbbf24',name:'ë…¸ë‘'},
  {color:'#22c55e',name:'ì´ˆë¡'},{color:'#3b82f6',name:'íŒŒë‘'},{color:'#8b5cf6',name:'ë³´ë¼'},
  {color:'#ec4899',name:'ë¶„í™'},{color:'#1e293b',name:'ê²€ì •'},{color:'#f1f5f9',name:'í°ìƒ‰'}
];

function initPaintToolbar() {
  const tb = document.getElementById('paint-toolbar');
  let html = '';
  PAINT_COLORS.forEach((c, i) => {
    html += `<div class="paint-color-btn${i===0?' active':''}" style="background:${c.color}" data-color="${c.color}" data-name="${c.name}" onclick="selectPaintColor(this)"></div>`;
  });
  html += `<span class="paint-size-label">í¬ê¸°:</span>`;
  html += `<input type="range" class="paint-size-slider" min="10" max="80" value="30" oninput="paint.brushSize=parseInt(this.value)">`;
  html += `<button class="paint-clear-btn" onclick="paintClearCanvas()">ğŸ—‘ ì§€ìš°ê¸°</button>`;
  tb.innerHTML = html;
}

function selectPaintColor(el) {
  document.querySelectorAll('.paint-color-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  paint.currentColor = el.dataset.color;
  paint.colorsUsed.add(el.dataset.color);
  document.getElementById('paint-colors-used').textContent = paint.colorsUsed.size;
}

function initPaintCanvas() {
  const canvas = document.getElementById('paint-canvas');
  canvas.addEventListener('mousedown', paintSplat);
  canvas.addEventListener('mousemove', e => { if (e.buttons) paintSplat(e); });
  canvas.addEventListener('touchstart', e => { e.preventDefault(); paintSplat(e.touches[0]); }, {passive:false});
  canvas.addEventListener('touchmove', e => { e.preventDefault(); paintSplat(e.touches[0]); }, {passive:false});
  // ì´ˆê¸° ì•ˆë‚´ SVG
  addPaintGuide();
}
function addPaintGuide() {
  const canvas = document.getElementById('paint-canvas');
  if (canvas.querySelector('.paint-guide')) return;
  const guide = document.createElement('div');
  guide.className = 'paint-guide';
  guide.style.cssText = 'position:absolute;inset:0;display:flex;align-items:center;justify-content:center;z-index:5;pointer-events:none';
  guide.innerHTML = '<svg width="320" height="280" viewBox="0 0 320 280">' +
    '<defs><linearGradient id="pgGrad" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#ec4899" stop-opacity=".15"/><stop offset="100%" stop-color="#f472b6" stop-opacity=".08"/></linearGradient></defs>' +
    '<circle cx="160" cy="120" r="100" fill="url(#pgGrad)" stroke="#f9a8d4" stroke-width="2" stroke-dasharray="8 6" opacity=".6"><animate attributeName="r" values="95;105;95" dur="3s" repeatCount="indefinite"/></circle>' +
    /* ì†ê°€ë½ ì•„ì´ì½˜ */
    '<text x="160" y="135" text-anchor="middle" font-size="72" opacity=".5">ğŸ‘†</text>' +
    /* ë¬¼ê° ë°©ìš¸ ì¥ì‹ */
    '<circle cx="80" cy="60" r="12" fill="#ec4899" opacity=".18"><animate attributeName="opacity" values=".1;.25;.1" dur="2s" repeatCount="indefinite"/></circle>' +
    '<circle cx="240" cy="70" r="10" fill="#8b5cf6" opacity=".15"><animate attributeName="opacity" values=".1;.22;.1" dur="2.3s" repeatCount="indefinite"/></circle>' +
    '<circle cx="60" cy="170" r="8" fill="#3b82f6" opacity=".15"><animate attributeName="opacity" values=".08;.2;.08" dur="2.6s" repeatCount="indefinite"/></circle>' +
    '<circle cx="260" cy="160" r="11" fill="#22c55e" opacity=".15"><animate attributeName="opacity" values=".1;.22;.1" dur="1.8s" repeatCount="indefinite"/></circle>' +
    '<circle cx="120" cy="190" r="9" fill="#f97316" opacity=".15"><animate attributeName="opacity" values=".08;.2;.08" dur="2.1s" repeatCount="indefinite"/></circle>' +
    /* ì•ˆë‚´ í…ìŠ¤íŠ¸ */
    '<text x="160" y="250" text-anchor="middle" font-size="22" font-weight="800" fill="#ec4899" opacity=".5">ì—¬ê¸°ë¥¼ í„°ì¹˜í•´ì„œ ê·¸ë ¤ë³´ì„¸ìš”!</text>' +
    '</svg>';
  canvas.appendChild(guide);
}

function paintSplat(e) {
  const canvas = document.getElementById('paint-canvas');
  const guide = canvas.querySelector('.paint-guide');
  if (guide) guide.remove();
  const svg = document.getElementById('paint-svg');
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  const scaleX = canvas.offsetWidth / rect.width;
  const scaleY = canvas.offsetHeight / rect.height;
  const cx = x * scaleX;
  const cy = y * scaleY;

  paint.touches++;
  document.getElementById('paint-touches').textContent = paint.touches;
  paint.colorsUsed.add(paint.currentColor);
  document.getElementById('paint-colors-used').textContent = paint.colorsUsed.size;

  // ë©”ì¸ ë¬¼ê° ë°©ìš¸ (SVG)
  const mainR = paint.brushSize * (0.5 + Math.random() * 0.5);
  const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
  circle.setAttribute('cx', cx);
  circle.setAttribute('cy', cy);
  circle.setAttribute('r', mainR);
  circle.setAttribute('fill', paint.currentColor);
  circle.setAttribute('opacity', 0.5 + Math.random() * 0.3);
  svg.appendChild(circle);

  // íŒŒí‹°í´ íŠ€ê¹€ (8~15ê°œ)
  const count = 8 + Math.floor(Math.random() * 8);
  for (let i = 0; i < count; i++) {
    const p = document.createElement('div');
    p.className = 'paint-particle';
    const size = 4 + Math.random() * (paint.brushSize * 0.5);
    const angle = (Math.PI * 2 / count) * i + (Math.random() - 0.5) * 0.8;
    const dist = paint.brushSize + Math.random() * paint.brushSize * 2;
    const dur = 0.3 + Math.random() * 0.4;
    p.style.cssText = `left:${cx}px;top:${cy}px;width:${size}px;height:${size}px;background:${paint.currentColor};--tx:${Math.cos(angle)*dist}px;--ty:${Math.sin(angle)*dist}px;--es:${Math.random()*.3};--dur:${dur}s;opacity:${0.6+Math.random()*.3}`;
    canvas.appendChild(p);
    setTimeout(() => p.remove(), dur * 1000 + 50);

    // íŠ€ê¸´ í”ì ì„ SVGì— ë‚¨ê¹€
    const splash = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
    splash.setAttribute('cx', cx + Math.cos(angle) * dist * 0.7);
    splash.setAttribute('cy', cy + Math.sin(angle) * dist * 0.7);
    splash.setAttribute('r', size * 0.4);
    splash.setAttribute('fill', paint.currentColor);
    splash.setAttribute('opacity', 0.3 + Math.random() * 0.2);
    svg.appendChild(splash);
  }

  // ë©”ì¸ ë¬¼ê° ë²ˆì§ ì´í™íŠ¸
  const drop = document.createElement('div');
  drop.className = 'paint-drop';
  drop.style.cssText = `left:${cx - mainR}px;top:${cy - mainR}px;width:${mainR*2}px;height:${mainR*2}px;background:${paint.currentColor}`;
  canvas.appendChild(drop);
  setTimeout(() => drop.remove(), 400);

  // íš¨ê³¼ìŒ
  try {
    const actx = SFX._getCtx();
    const osc = actx.createOscillator();
    const gain = actx.createGain();
    osc.connect(gain); gain.connect(actx.destination);
    osc.type = 'sine';
    osc.frequency.setValueAtTime(200 + Math.random() * 600, actx.currentTime);
    gain.gain.setValueAtTime(0.05, actx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, actx.currentTime + 0.15);
    osc.start(actx.currentTime);
    osc.stop(actx.currentTime + 0.15);
  } catch(e) {}
}

function paintClearCanvas() {
  const svg = document.getElementById('paint-svg');
  while (svg.firstChild) svg.removeChild(svg.firstChild);
  const canvas = document.getElementById('paint-canvas');
  const oldGuide = canvas.querySelector('.paint-guide');
  if (!oldGuide) addPaintGuide();
  speak('ê¹¨ë—í•´ì¡Œì–´ìš”!');
}

function paintSave() {
  paint.works++;
  profile.totalActivity++;
  document.getElementById('paint-works').textContent = paint.works;
  SFX.fanfare();
  setMascotEmotion('face', 'happy');
  speak('ë©‹ì§„ ì‘í’ˆì´ì—ìš”! ì €ì¥í–ˆì–´ìš”!');
  updateProfile();
  saveStats();

  // ì €ì¥ ì¶•í•˜ ì´í™íŠ¸
  const canvas = document.getElementById('paint-canvas');
  for (let i = 0; i < 25; i++) {
    const c = document.createElement('div');
    const color = PAINT_COLORS[Math.floor(Math.random()*PAINT_COLORS.length)].color;
    c.style.cssText = `position:absolute;left:${Math.random()*100}%;top:-10px;width:${6+Math.random()*8}px;height:${6+Math.random()*8}px;border-radius:${Math.random()>.5?'50%':'3px'};background:${color};pointer-events:none;z-index:30;animation:paintSplash ${.6+Math.random()*.4}s ease-out forwards;--tx:${(Math.random()-.5)*100}px;--ty:${150+Math.random()*200}px;--es:0;--dur:${.6+Math.random()*.4}s;animation-delay:${Math.random()*.3}s`;
    canvas.appendChild(c);
    setTimeout(() => c.remove(), 1200);
  }
}

function paintRandomColor() {
  const c = PAINT_COLORS[Math.floor(Math.random() * PAINT_COLORS.length)];
  paint.currentColor = c.color;
  document.querySelectorAll('.paint-color-btn').forEach(b => {
    b.classList.toggle('active', b.dataset.color === c.color);
  });
  speak(`${c.name}!`);
}

// ===== ê·¸ë¦¼ì ê·¹ì¥ =====
const THEATER_STICKERS = [
  {emoji:'ğŸ±',name:'ê³ ì–‘ì´'},{emoji:'ğŸ¶',name:'ê°•ì•„ì§€'},{emoji:'ğŸ»',name:'ê³°'},
  {emoji:'ğŸ¦Š',name:'ì—¬ìš°'},{emoji:'ğŸ°',name:'í† ë¼'},{emoji:'ğŸŒ²',name:'ë‚˜ë¬´'},
  {emoji:'ğŸ ',name:'ì§‘'},{emoji:'ğŸŒ™',name:'ë‹¬'},{emoji:'â­',name:'ë³„'},
  {emoji:'ğŸ‘¸',name:'ê³µì£¼'},{emoji:'ğŸ¤´',name:'ì™•ì'},{emoji:'ğŸ§™',name:'ë§ˆë²•ì‚¬'},
  {emoji:'ğŸ¦‹',name:'ë‚˜ë¹„'},{emoji:'ğŸŒ¸',name:'ê½ƒ'},{emoji:'ğŸ¦',name:'ìƒˆ'}
];

function initTheater() {
  const palette = document.getElementById('sticker-palette');
  palette.innerHTML = THEATER_STICKERS.map(s =>
    `<div class="sticker-item" data-emoji="${s.emoji}" data-name="${s.name}" onclick="selectSticker(this)">${s.emoji}</div>`
  ).join('');

  // ë¬´ëŒ€ ë³„ ìƒì„±
  const stars = document.getElementById('stage-stars');
  for (let i = 0; i < 30; i++) {
    const star = document.createElement('div');
    star.style.cssText = `position:absolute;left:${Math.random()*100}%;top:${Math.random()*60}%;width:${2+Math.random()*3}px;height:${2+Math.random()*3}px;background:#fff;border-radius:50%;opacity:${.2+Math.random()*.5};animation:starTwinkle ${1+Math.random()*3}s ease-in-out infinite;animation-delay:${Math.random()*2}s`;
    stars.appendChild(star);
  }

  // ë¬´ëŒ€ ë“œë˜ê·¸ ì´ë²¤íŠ¸
  const stage = document.getElementById('stage-wrap');
  stage.addEventListener('mousedown', theaterStageDown);
  stage.addEventListener('mousemove', theaterStageMove);
  stage.addEventListener('mouseup', theaterStageUp);
  stage.addEventListener('touchstart', e => { e.preventDefault(); theaterStageDown(e.touches[0]); }, {passive:false});
  stage.addEventListener('touchmove', e => { e.preventDefault(); theaterStageMove(e.touches[0]); }, {passive:false});
  stage.addEventListener('touchend', e => { theaterStageUp(e); }, {passive:false});
}

function selectSticker(el) {
  document.querySelectorAll('.sticker-item').forEach(s => s.classList.remove('selected'));
  el.classList.add('selected');
  theater.selectedSticker = el.dataset.emoji;
}

function theaterStageDown(e) {
  const stage = document.getElementById('stage-wrap');
  const rect = stage.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  // ê¸°ì¡´ ìŠ¤í‹°ì»¤ ë“œë˜ê·¸ í™•ì¸
  const stickers = stage.querySelectorAll('.stage-sticker');
  for (let i = stickers.length - 1; i >= 0; i--) {
    const s = stickers[i];
    const sx = parseFloat(s.style.left);
    const sy = parseFloat(s.style.top);
    const scaleX = stage.offsetWidth / rect.width;
    const ax = x * scaleX;
    const ay = y * (stage.offsetHeight / rect.height);
    if (ax >= sx - 30 && ax <= sx + 60 && ay >= sy - 30 && ay <= sy + 60) {
      theater.dragging = s;
      theater.dragOffX = ax - sx;
      theater.dragOffY = ay - sy;
      s.style.zIndex = 20;
      return;
    }
  }

  // ìƒˆ ìŠ¤í‹°ì»¤ ë°°ì¹˜
  if (theater.selectedSticker && !theater.playing) {
    const scaleX = stage.offsetWidth / rect.width;
    const scaleY = stage.offsetHeight / rect.height;
    const sticker = document.createElement('div');
    sticker.className = 'stage-sticker';
    sticker.textContent = theater.selectedSticker;
    sticker.style.left = (x * scaleX - 30) + 'px';
    sticker.style.top = (y * scaleY - 30) + 'px';
    sticker.dataset.emoji = theater.selectedSticker;
    sticker.dataset.order = theater.stickers.length;
    stage.appendChild(sticker);
    theater.stickers.push({emoji: theater.selectedSticker, x: x * scaleX - 30, y: y * scaleY - 30, el: sticker});
    theater.stickerCount++;
    document.getElementById('theater-stickers').textContent = theater.stickerCount;
  }
}

function theaterStageMove(e) {
  if (!theater.dragging) return;
  const stage = document.getElementById('stage-wrap');
  const rect = stage.getBoundingClientRect();
  const x = (e.clientX - rect.left) * (stage.offsetWidth / rect.width);
  const y = (e.clientY - rect.top) * (stage.offsetHeight / rect.height);
  theater.dragging.style.left = (x - theater.dragOffX) + 'px';
  theater.dragging.style.top = (y - theater.dragOffY) + 'px';
}

function theaterStageUp(e) {
  if (theater.dragging) {
    theater.dragging.style.zIndex = 6;
    theater.dragging = null;
  }
}

function theaterPlay() {
  if (theater.stickers.length === 0) {
    speak('ë¬´ëŒ€ì— ìŠ¤í‹°ì»¤ë¥¼ ë†“ì•„ì£¼ì„¸ìš”!');
    return;
  }
  if (theater.playing) return;
  theater.playing = true;
  theater.shows++;
  profile.totalActivity++;
  document.getElementById('theater-shows').textContent = theater.shows;
  saveStats();
  updateProfile();

  // ë¨¼ì € ëª¨ë“  ìŠ¤í‹°ì»¤ ìˆ¨ê¸°ê¸°
  const stage = document.getElementById('stage-wrap');
  const stickers = stage.querySelectorAll('.stage-sticker');
  stickers.forEach(s => { s.style.opacity = '0'; s.style.transform = 'scale(0)'; });

  // ê´€ê° ë“±ì¥
  document.getElementById('audience-bar').classList.add('visible');
  SFX.fanfare();
  speak('ê³µì—°ì´ ì‹œì‘ë©ë‹ˆë‹¤!');

  // ìˆœì„œëŒ€ë¡œ ë“±ì¥
  stickers.forEach((s, i) => {
    setTimeout(() => {
      s.style.opacity = '';
      s.style.transform = '';
      s.classList.remove('playing');
      void s.offsetWidth; // reflow
      s.classList.add('playing');
      // ë“±ì¥ íš¨ê³¼ìŒ
      try {
        const actx = SFX._getCtx();
        const osc = actx.createOscillator();
        const gain = actx.createGain();
        osc.connect(gain); gain.connect(actx.destination);
        osc.frequency.setValueAtTime(300 + i * 100, actx.currentTime);
        gain.gain.setValueAtTime(0.08, actx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, actx.currentTime + 0.3);
        osc.start(actx.currentTime);
        osc.stop(actx.currentTime + 0.3);
      } catch(e) {}
    }, 800 + i * 1000);
  });

  // ê³µì—° ë
  setTimeout(() => {
    // ê´€ê° ë°˜ì‘
    const reactions = ['ğŸ‘','ğŸ‘','ğŸ‘','ğŸ‰','ğŸ˜„','ğŸ¥°','â¤ï¸'];
    const audience = document.getElementById('audience-bar');
    audience.querySelectorAll('.audience-member').forEach(m => {
      m.textContent = reactions[Math.floor(Math.random()*reactions.length)];
    });
    speak('ë¸Œë¼ë³´! ë©‹ì§„ ê³µì—°ì´ì—ìš”!');

    // ë°•ìˆ˜ íŒŒí‹°í´
    for (let i = 0; i < 15; i++) {
      const p = document.createElement('div');
      p.style.cssText = `position:absolute;left:${20+Math.random()*60}%;bottom:60px;font-size:${16+Math.random()*12}px;pointer-events:none;z-index:30;animation:starPop .8s ease-out forwards;--tx:${(Math.random()-.5)*60}px;--ty:${-40-Math.random()*80}px;animation-delay:${Math.random()*.5}s`;
      p.textContent = ['ğŸ‘','â­','ğŸŒŸ','âœ¨','ğŸ‰'][Math.floor(Math.random()*5)];
      stage.appendChild(p);
      setTimeout(() => p.remove(), 1500);
    }

    setTimeout(() => {
      theater.playing = false;
      // ê´€ê° ë˜ëŒë¦¬ê¸°
      const faces = ['ğŸ‘¨','ğŸ‘©','ğŸ§’','ğŸ‘´','ğŸ‘§','ğŸ‘¦','ğŸ‘µ'];
      audience.querySelectorAll('.audience-member').forEach((m, i) => {
        m.textContent = faces[i];
      });
      audience.classList.remove('visible');
    }, 3000);
  }, 800 + theater.stickers.length * 1000 + 500);
}

function theaterClear() {
  const stage = document.getElementById('stage-wrap');
  stage.querySelectorAll('.stage-sticker').forEach(s => s.remove());
  theater.stickers = [];
  theater.playing = false;
  document.getElementById('audience-bar').classList.remove('visible');
}

function theaterRandomPlace() {
  theaterClear();
  const stage = document.getElementById('stage-wrap');
  const count = 3 + Math.floor(Math.random() * 4);
  for (let i = 0; i < count; i++) {
    const s = THEATER_STICKERS[Math.floor(Math.random()*THEATER_STICKERS.length)];
    const sticker = document.createElement('div');
    sticker.className = 'stage-sticker';
    sticker.textContent = s.emoji;
    const x = 80 + Math.random() * (stage.offsetWidth - 160);
    const y = 60 + Math.random() * (stage.offsetHeight - 160);
    sticker.style.left = x + 'px';
    sticker.style.top = y + 'px';
    sticker.dataset.emoji = s.emoji;
    stage.appendChild(sticker);
    theater.stickers.push({emoji: s.emoji, x, y, el: sticker});
    theater.stickerCount++;
  }
  document.getElementById('theater-stickers').textContent = theater.stickerCount;
  speak('ëœë¤ ë°°ì¹˜ ì™„ë£Œ!');
}

// ===== ë‚´ ê¸°ë¡ =====
function updateRecords() {
  document.getElementById('r-total').textContent = profile.totalActivity;
  document.getElementById('rec-total').textContent = profile.totalActivity;
  document.getElementById('r-faces').textContent = face.count;
  document.getElementById('r-paintings').textContent = paint.works;
  document.getElementById('r-paint-touches').textContent = paint.touches;
  document.getElementById('r-paint-colors').textContent = paint.colorsUsed.size;
  document.getElementById('r-paint-works').textContent = paint.works;
  document.getElementById('r-shows').textContent = theater.shows;
  document.getElementById('r-stickers').textContent = theater.stickerCount;
  document.getElementById('r-hero-best').textContent = hg.bestScore;
  document.getElementById('rec-hero-best').textContent = hg.bestScore;
}

// ===== íˆì–´ë¡œ: íŒ”ë ˆíŠ¸ ë””íœìŠ¤ =====
function startHeroGame() {
  try{document.documentElement.requestFullscreen?.()}catch(e){}
  const game = document.getElementById('hero-game');
  game.classList.remove('hidden');
  hg.score = 0; hg.lives = 5; hg.level = 1; hg.running = true; hg.paused = false;
  hg.balls = []; hg.combo = 0; hg.maxCombo = 0; hg.filledCount = 0;
  // ëœë¤ ê·¸ë¦¼ ì„ íƒ
  const pic = hg.pictures[Math.floor(Math.random() * hg.pictures.length)];
  hg.totalSections = pic.sections;
  hg.currentSection = 0;
  // SVG ê·¸ë¦¼ ì„¤ì •
  const svg = document.getElementById('hg-picture-svg');
  svg.innerHTML = pic.svg;
  document.getElementById('hg-total-sections').textContent = hg.totalSections;
  // ê° ì„¹ì…˜ì— í•„ìš”í•œ ìƒ‰ìƒ í• ë‹¹
  hg.sections = [];
  for (let i = 0; i < hg.totalSections; i++) {
    const colorIdx = Math.floor(Math.random() * hg.colors.length);
    hg.sections.push({filled: false, colorIdx});
    const el = document.getElementById('hg-s' + i);
    if (el) {
      el.style.fill = '#f1f5f9';
      el.style.stroke = '#94a3b8';
      el.classList.remove('filled');
      el.setAttribute('data-color', '');
    }
  }
  hgSetNextTarget();
  updateHgUI();
  addHgClouds(); addHgDecorations();
  SFX.gameStart();
  hgLoop();
}

function hgSetNextTarget() {
  // ë‹¤ìŒ ì±„ìš¸ ì„¹ì…˜ ì°¾ê¸°
  let found = false;
  for (let i = 0; i < hg.sections.length; i++) {
    if (!hg.sections[i].filled) {
      hg.currentSection = i;
      hg.targetIdx = hg.sections[i].colorIdx;
      hg.targetColor = hg.colors[hg.targetIdx];
      const swatch = document.getElementById('hg-target-swatch');
      swatch.style.background = hg.targetColor;
      document.getElementById('hg-target-name').textContent = hg.colorNames[hg.targetIdx];
      // í˜„ì¬ ì„¹ì…˜ í•˜ì´ë¼ì´íŠ¸
      for (let j = 0; j < hg.sections.length; j++) {
        const el = document.getElementById('hg-s' + j);
        if (el && !hg.sections[j].filled) {
          el.style.stroke = j === i ? '#ec4899' : '#94a3b8';
          el.style.strokeWidth = j === i ? '3' : '2';
          el.style.strokeDasharray = j === i ? '8,4' : 'none';
        }
      }
      found = true;
      break;
    }
  }
  if (!found) {
    // ëª¨ë“  ì„¹ì…˜ ì™„ë£Œ -> ìƒˆ ê·¸ë¦¼
    hg.level++;
    hg.score += 20; // ê·¸ë¦¼ ì™„ì„± ë³´ë„ˆìŠ¤
    speak('ê·¸ë¦¼ ì™„ì„±! ë³´ë„ˆìŠ¤ 20ì !');
    hgCompletionEffect();
    setTimeout(() => {
      const pic = hg.pictures[Math.floor(Math.random() * hg.pictures.length)];
      hg.totalSections = pic.sections;
      hg.filledCount = 0;
      document.getElementById('hg-total-sections').textContent = hg.totalSections;
      const svg = document.getElementById('hg-picture-svg');
      svg.innerHTML = pic.svg;
      hg.sections = [];
      for (let i = 0; i < hg.totalSections; i++) {
        const colorIdx = Math.floor(Math.random() * hg.colors.length);
        hg.sections.push({filled: false, colorIdx});
      }
      hgSetNextTarget();
      hgUpdateBg();
      updateHgUI();
    }, 1500);
  }
}

function hgCompletionEffect() {
  SFX.levelup();
  const arena = document.getElementById('hg-arena');
  for (let i = 0; i < 40; i++) {
    const p = document.createElement('div');
    p.className = 'hg-star-pop';
    p.textContent = ['ğŸ¨','ğŸ–Œï¸','âœ¨','ğŸŒŸ','ğŸ‰','â­'][Math.floor(Math.random()*6)];
    p.style.cssText = `left:${30+Math.random()*40}%;top:${20+Math.random()*40}%;font-size:${28+Math.random()*30}px;--tx:${(Math.random()-.5)*120}px;--ty:${(Math.random()-.5)*120}px`;
    arena.appendChild(p);
    setTimeout(() => p.remove(), 700);
  }
}

function addHgClouds() {
  const arena = document.getElementById('hg-arena');
  arena.querySelectorAll('.hg-cloud').forEach(c => c.remove());
  const clouds = ['â˜ï¸','ğŸŒ¤ï¸','ğŸŒ¥ï¸'];
  for (let i = 0; i < 4; i++) {
    const c = document.createElement('div');
    c.className = 'hg-cloud';
    c.textContent = clouds[Math.floor(Math.random()*clouds.length)];
    c.style.top = (Math.random() * 30 + 5) + '%';
    c.style.animationDelay = -(Math.random() * 25) + 's';
    c.style.fontSize = (42 + Math.random() * 30) + 'px';
    arena.appendChild(c);
  }
}

function addHgDecorations() {
  const arena = document.getElementById('hg-arena');
  arena.querySelectorAll('.hg-deco,.hg-ground,.hg-bg-sparkle,.hg-drip').forEach(d => d.remove());

  // === ë°”ë‹¥ ì¥ì‹ (í˜ì¸íŠ¸ ì–¼ë£© + ë¯¸ìˆ  ë„êµ¬) ===
  const ground = document.createElement('div');
  ground.className = 'hg-ground';
  ground.innerHTML = `
    <svg width="100%" height="140" viewBox="0 0 1920 140" preserveAspectRatio="none">
      <ellipse cx="200" cy="130" rx="80" ry="20" fill="#ec4899" opacity=".08"/>
      <ellipse cx="500" cy="125" rx="60" ry="15" fill="#3b82f6" opacity=".07"/>
      <ellipse cx="900" cy="128" rx="90" ry="18" fill="#fbbf24" opacity=".08"/>
      <ellipse cx="1300" cy="130" rx="70" ry="16" fill="#22c55e" opacity=".07"/>
      <ellipse cx="1650" cy="126" rx="85" ry="19" fill="#8b5cf6" opacity=".08"/>
      <rect x="120" y="60" width="12" height="80" rx="4" fill="#d4a574" opacity=".12"/>
      <ellipse cx="126" cy="55" rx="16" ry="22" fill="#ec4899" opacity=".1"/>
      <rect x="1700" y="50" width="10" height="90" rx="3" fill="#92400e" opacity=".1"/>
      <polygon points="1705,45 1695,25 1715,25" fill="#3b82f6" opacity=".08"/>
      <ellipse cx="800" cy="120" rx="25" ry="18" fill="#fde68a" opacity=".1" stroke="#d97706" stroke-width="1" opacity=".06"/>
      <circle cx="793" cy="116" r="4" fill="#ef4444" opacity=".08"/><circle cx="800" cy="112" r="3" fill="#3b82f6" opacity=".07"/><circle cx="808" cy="116" r="3.5" fill="#22c55e" opacity=".08"/>
      <rect x="1400" y="80" width="40" height="50" rx="5" fill="#3b82f6" opacity=".06"/>
      <rect x="1395" y="75" width="50" height="10" rx="3" fill="#60a5fa" opacity=".06"/>
    </svg>`;
  arena.appendChild(ground);

  // === ë– ë‹¤ë‹ˆëŠ” ë¯¸ìˆ  ë„êµ¬ ì¥ì‹ (í¬ê³  ì• ë‹ˆë©”ì´ì…˜ ìˆëŠ”) ===
  const decos = [
    {svg:'<svg viewBox="0 0 80 80" width="100" height="100"><ellipse cx="40" cy="40" rx="30" ry="22" fill="#fde68a" opacity=".15" stroke="#d97706" stroke-width="1.5" stroke-opacity=".1"/><circle cx="24" cy="34" r="5" fill="#ef4444" opacity=".15"/><circle cx="36" cy="30" r="4" fill="#3b82f6" opacity=".12"/><circle cx="48" cy="34" r="4.5" fill="#22c55e" opacity=".14"/><circle cx="40" cy="44" r="4" fill="#fbbf24" opacity=".12"/><circle cx="52" cy="42" r="3.5" fill="#8b5cf6" opacity=".12"/><ellipse cx="40" cy="22" rx="4" ry="2" fill="#d97706" opacity=".1"/></svg>', top:'12%',left:'4%',delay:'0s'},
    {svg:'<svg viewBox="0 0 50 140" width="60" height="160"><rect x="20" y="0" width="10" height="100" rx="4" fill="#d4a574" opacity=".12"/><ellipse cx="25" cy="105" rx="16" ry="24" fill="#ec4899" opacity=".1"/><ellipse cx="25" cy="100" rx="10" ry="14" fill="#f472b6" opacity=".06"/></svg>', top:'55%',right:'2%',delay:'1s'},
    {svg:'<svg viewBox="0 0 50 140" width="55" height="150"><rect x="21" y="0" width="8" height="95" rx="3" fill="#8B6914" opacity=".1"/><polygon points="25,95 10,130 40,130" fill="#3b82f6" opacity=".08"/><polygon points="25,98 15,125 35,125" fill="#60a5fa" opacity=".05"/></svg>', bottom:'18%',left:'6%',delay:'2s'},
    {svg:'<svg viewBox="0 0 100 80" width="120" height="90"><rect x="8" y="12" width="84" height="60" rx="5" fill="none" stroke="#d4a574" stroke-width="3" opacity=".1"/><rect x="14" y="18" width="72" height="44" fill="#fef3c7" opacity=".06"/><circle cx="50" cy="40" r="15" fill="#fca5a5" opacity=".05"/><circle cx="40" cy="35" r="8" fill="#93c5fd" opacity=".04"/></svg>', top:'18%',right:'6%',delay:'0.5s'},
    {svg:'<svg viewBox="0 0 80 80" width="90" height="90"><circle cx="40" cy="40" r="28" fill="#ec4899" opacity=".06"><animate attributeName="r" values="26;30;26" dur="4s" repeatCount="indefinite"/></circle><circle cx="40" cy="40" r="18" fill="#f472b6" opacity=".04"/><circle cx="40" cy="40" r="8" fill="#f9a8d4" opacity=".03"/></svg>', bottom:'30%',right:'12%',delay:'1.5s'},
    {svg:'<svg viewBox="0 0 80 80" width="85" height="85"><circle cx="40" cy="40" r="25" fill="#3b82f6" opacity=".06"><animate attributeName="r" values="23;27;23" dur="3.5s" repeatCount="indefinite"/></circle><circle cx="40" cy="40" r="15" fill="#60a5fa" opacity=".04"/></svg>', top:'42%',left:'2%',delay:'2.5s'},
    {svg:'<svg viewBox="0 0 80 80" width="80" height="80"><circle cx="40" cy="40" r="22" fill="#fbbf24" opacity=".06"><animate attributeName="r" values="20;24;20" dur="3s" repeatCount="indefinite"/></circle><circle cx="40" cy="40" r="12" fill="#fde68a" opacity=".04"/></svg>', top:'65%',right:'18%',delay:'3s'},
    {svg:'<svg viewBox="0 0 60 60" width="70" height="70"><polygon points="30,5 35,22 53,22 39,33 44,50 30,40 16,50 21,33 7,22 25,22" fill="#fbbf24" opacity=".08"/></svg>', top:'8%',left:'25%',delay:'0.8s'},
    {svg:'<svg viewBox="0 0 60 60" width="65" height="65"><polygon points="30,8 33,22 47,22 36,30 40,44 30,36 20,44 24,30 13,22 27,22" fill="#ec4899" opacity=".07"/></svg>', bottom:'12%',right:'30%',delay:'1.8s'},
    {svg:'<svg viewBox="0 0 50 140" width="50" height="130"><rect x="20" y="0" width="10" height="90" rx="4" fill="#d4a574" opacity=".1"/><ellipse cx="25" cy="95" rx="14" ry="20" fill="#22c55e" opacity=".08"/></svg>', top:'30%',left:'92%',delay:'3.5s'},
  ];
  decos.forEach(d => {
    const el = document.createElement('div');
    el.className = 'hg-deco';
    el.style.cssText = `position:absolute;pointer-events:none;z-index:2;${d.top?'top:'+d.top+';':''}${d.bottom?'bottom:'+d.bottom+';':''}${d.left?'left:'+d.left+';':''}${d.right?'right:'+d.right+';':''}animation-delay:${d.delay}`;
    el.innerHTML = d.svg;
    arena.appendChild(el);
  });

  // === ë°°ê²½ ë°˜ì§ì´ (scattered sparkles) ===
  for (let i = 0; i < 12; i++) {
    const sp = document.createElement('div');
    sp.className = 'hg-bg-sparkle';
    const size = 4 + Math.random() * 8;
    const colors = ['#ec4899','#f472b6','#fbbf24','#3b82f6','#22c55e','#8b5cf6','#f97316'];
    sp.style.cssText = `left:${5+Math.random()*90}%;top:${5+Math.random()*85}%;width:${size}px;height:${size}px;border-radius:50%;background:${colors[Math.floor(Math.random()*colors.length)]};animation-delay:${Math.random()*3}s;animation-duration:${2+Math.random()*3}s`;
    arena.appendChild(sp);
  }

  // === ìƒë‹¨ ë¬¼ê° ë“œë¦½ ì´í™íŠ¸ ===
  for (let i = 0; i < 6; i++) {
    const drip = document.createElement('div');
    drip.className = 'hg-drip';
    const colors = ['#ec4899','#3b82f6','#fbbf24','#22c55e','#8b5cf6','#f97316'];
    const w = 6 + Math.random() * 10;
    drip.style.cssText = `left:${8+Math.random()*84}%;width:${w}px;height:${30+Math.random()*40}px;border-radius:0 0 ${w/2}px ${w/2}px;background:${colors[i % colors.length]};opacity:.12;animation-delay:${Math.random()*4}s;animation-duration:${3+Math.random()*3}s`;
    arena.appendChild(drip);
  }
}

function hgLoop() {
  const interval = Math.max(1200, 3000 - hg.level * 200);
  if (hg.spawnTimer) clearInterval(hg.spawnTimer);
  hg.spawnTimer = setInterval(() => {
    if (!hg.paused && hg.running) hgSpawn();
  }, interval);
  function tick() {
    if (!hg.running) return;
    if (!hg.paused) hgMove();
    hg.animId = requestAnimationFrame(tick);
  }
  hg.animId = requestAnimationFrame(tick);
}

function hgSpawn() {
  // 8% íŒŒì›Œì—…
  if (Math.random() < 0.08) { hgSpawnPower(); return; }

  const arena = document.getElementById('hg-arena');
  const w = arena.offsetWidth;
  const h = arena.offsetHeight;

  const colorIdx = Math.floor(Math.random() * hg.colors.length);
  const color = hg.colors[colorIdx];
  const size = 110 + Math.random() * 40;

  const el = document.createElement('div');
  el.className = 'flying-ball';
  el.style.width = size + 'px';
  el.style.height = size + 'px';
  el.innerHTML = `<div class="flying-ball-inner" style="background:${color}"><div class="flying-ball-shine"></div></div>`;
  el.onclick = () => hgTapBall(ball);

  // ì‚¬ë°©ì—ì„œ ë‚ ì•„ì˜´
  const side = Math.floor(Math.random() * 4); // 0:ìœ„, 1:ì•„ë˜, 2:ì™¼, 3:ì˜¤
  let x, y, vx, vy;
  const speed = 0.4 + hg.level * 0.06 + Math.random() * 0.2;
  const targetX = w * 0.3 + Math.random() * w * 0.4;
  const targetY = h * 0.3 + Math.random() * h * 0.4;

  if (side === 0) { x = Math.random() * w; y = -60; }
  else if (side === 1) { x = Math.random() * w; y = h + 60; }
  else if (side === 2) { x = -60; y = Math.random() * h; }
  else { x = w + 60; y = Math.random() * h; }

  const angle = Math.atan2(targetY - y, targetX - x);
  vx = Math.cos(angle) * speed;
  vy = Math.sin(angle) * speed;

  el.style.left = x + 'px';
  el.style.top = y + 'px';
  arena.appendChild(el);

  // ìŠ¤í° ìŠ¤íŒŒí´
  for (let k = 0; k < 4; k++) {
    const sp = document.createElement('div');
    sp.className = 'hg-star-pop';
    sp.textContent = '\u2728';
    sp.style.cssText = `left:${x}px;top:${y}px;font-size:${14+Math.random()*10}px;--tx:${(Math.random()-.5)*50}px;--ty:${(Math.random()-.5)*50}px`;
    arena.appendChild(sp);
    setTimeout(() => sp.remove(), 700);
  }

  const ball = {el, x, y, vx, vy, colorIdx, color, size, age: 0};
  hg.balls.push(ball);
}

function hgSpawnPower() {
  const types = [{e:'ğŸ§¹',fx:'erase',name:'ì§€ìš°ê°œ'},{e:'ğŸŒˆ',fx:'rainbow',name:'ë¬´ì§€ê°œë¶“'},{e:'ğŸ–¼ï¸',fx:'frame',name:'ì•¡ì'}];
  const t = types[Math.floor(Math.random() * types.length)];
  const arena = document.getElementById('hg-arena');
  const w = arena.offsetWidth;
  const h = arena.offsetHeight;
  const el = document.createElement('div');
  el.className = 'hg-powerup';
  el.textContent = t.e;
  el.style.left = (80 + Math.random() * (w - 160)) + 'px';
  el.style.top = (80 + Math.random() * (h - 160)) + 'px';
  el.onclick = () => hgPowerUp(t, el);
  arena.appendChild(el);
  // ìë™ ì†Œë©¸
  setTimeout(() => { if (el.parentNode) el.remove(); }, 5000);
}

function hgPowerUp(t, el) {
  el.remove();
  if (t.fx === 'erase') {
    // ì§€ìš°ê°œ: ì–¼ë£© ì œê±°
    document.querySelectorAll('.hg-stain').forEach(s => s.remove());
    speak('ì–¼ë£© ì§€ìš°ê¸°!');
  } else if (t.fx === 'rainbow') {
    // ë¬´ì§€ê°œë¶“: í˜„ì¬ ì„¹ì…˜ ìë™ ìƒ‰ì¹ 
    hgFillSection(hg.currentSection, hg.targetColor);
    speak('ë¬´ì§€ê°œë¶“!');
  } else if (t.fx === 'frame') {
    // ì•¡ì: í•œ ì„¹ì…˜ ì¦‰ì‹œ ì™„ì„±
    hgFillSection(hg.currentSection, hg.targetColor);
    speak('ì•¡ì ì™„ì„±!');
  }
  hg.score += 3;
  updateHgUI();
  // ì´í™íŠ¸
  const arena = document.getElementById('hg-arena');
  for (let i = 0; i < 8; i++) {
    const p = document.createElement('div');
    p.className = 'hg-star-pop';
    p.textContent = ['â­','âœ¨','ğŸ’«'][Math.floor(Math.random()*3)];
    const cx = parseFloat(el.style.left) + 25;
    const cy = parseFloat(el.style.top) + 25;
    p.style.cssText = `left:${cx}px;top:${cy}px;font-size:${16+Math.random()*12}px;--tx:${(Math.random()-.5)*80}px;--ty:${(Math.random()-.5)*80}px`;
    arena.appendChild(p);
    setTimeout(() => p.remove(), 700);
  }
}

function hgTapBall(ball) {
  if (!hg.running || hg.paused) return;
  const arena = document.getElementById('hg-arena');

  if (ball.colorIdx === hg.targetIdx) {
    // ì •ë‹µ!
    hg.combo++;
    if (hg.combo > hg.maxCombo) hg.maxCombo = hg.combo;
    const bonus = Math.min(hg.combo, 5);
    hg.score += 2 + bonus;

    // ì½¤ë³´ í‘œì‹œ
    if (hg.combo >= 3) {
      const combo = document.getElementById('hg-combo');
      combo.textContent = `ğŸ”¥ ${hg.combo} COMBO!`;
      combo.classList.add('visible');
      setTimeout(() => combo.classList.remove('visible'), 1500);
    }

    // ì •ë‹µ í”Œë˜ì‹œ
    const flash = document.createElement('div');
    flash.className = 'hg-flash';
    arena.appendChild(flash);
    setTimeout(() => flash.remove(), 300);

    // ìƒ‰ì¹  ì´í™íŠ¸
    hgPaintBurst(ball.x + ball.size/2, ball.y + ball.size/2, ball.color);
    if (hg.combo >= 3) SFX.combo(hg.combo); else SFX.sparkle();
    showScorePopup(arena, 2 + bonus, ball.x, ball.y);
    speak('ì •ë‹µ!');

    // ì„¹ì…˜ ì±„ìš°ê¸°
    hgFillSection(hg.currentSection, ball.color);

    // ê³µ ì œê±°
    ball.el.remove();
    hg.balls = hg.balls.filter(b => b !== ball);
    updateHgUI();
  } else {
    // í‹€ë¦¼ -> ì–¼ë£©
    hg.combo = 0;
    hg.lives--;

    // ë¯¸ìŠ¤ í”Œë˜ì‹œ
    const mf = document.createElement('div');
    mf.className = 'hg-miss-flash';
    arena.appendChild(mf);
    setTimeout(() => mf.remove(), 400);
    arena.classList.add('hg-arena-shake');
    setTimeout(() => arena.classList.remove('hg-arena-shake'), 400);

    // ì–¼ë£© ìƒì„±
    const stain = document.createElement('div');
    stain.className = 'hg-stain';
    const stainSize = 20 + Math.random() * 30;
    stain.style.cssText = `left:${ball.x}px;top:${ball.y}px;width:${stainSize}px;height:${stainSize}px;background:${ball.color}`;
    arena.appendChild(stain);

    SFX.splat();
    speak('ì•—! í‹€ë¦° ìƒ‰ì´ì—ìš”');

    ball.el.remove();
    hg.balls = hg.balls.filter(b => b !== ball);
    updateHgUI();

    if (hg.lives <= 0) hgEnd();
  }
}

function hgFillSection(idx, color) {
  if (idx >= hg.sections.length || hg.sections[idx].filled) return;
  hg.sections[idx].filled = true;
  hg.filledCount++;
  document.getElementById('hg-filled').textContent = hg.filledCount;

  const el = document.getElementById('hg-s' + idx);
  if (el) {
    el.style.fill = color;
    el.style.stroke = '#475569';
    el.style.strokeDasharray = 'none';
    el.classList.add('filled');
  }
  hgSetNextTarget();
}

function hgPaintBurst(cx, cy, color) {
  const arena = document.getElementById('hg-arena');
  for (let i = 0; i < 12; i++) {
    const p = document.createElement('div');
    p.className = 'hg-paint-burst';
    const size = 14 + Math.random() * 24;
    const angle = (Math.PI * 2 / 12) * i + (Math.random() - 0.5) * 0.5;
    const dist = 60 + Math.random() * 120;
    const dur = 0.4 + Math.random() * 0.3;
    p.style.cssText = `left:${cx}px;top:${cy}px;width:${size}px;height:${size}px;background:${color};--tx:${Math.cos(angle)*dist}px;--ty:${Math.sin(angle)*dist}px;--dur:${dur}s;box-shadow:0 0 ${size*0.8}px ${color}`;
    arena.appendChild(p);
    setTimeout(() => p.remove(), dur * 1000 + 50);
  }
}

function hgMove() {
  const arena = document.getElementById('hg-arena');
  const w = arena.offsetWidth;
  const h = arena.offsetHeight;
  hg.balls = hg.balls.filter(ball => {
    ball.x += ball.vx;
    ball.y += ball.vy;
    ball.age++;
    ball.el.style.left = ball.x + 'px';
    ball.el.style.top = ball.y + 'px';

    // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì œê±° (ì¼ì • ì‹œê°„ í›„)
    if (ball.age > 500 || ball.x < -100 || ball.x > w + 100 || ball.y < -100 || ball.y > h + 100) {
      ball.el.remove();
      return false;
    }
    return true;
  });
}

function hgUpdateBg() {
  const bgs = [
    'linear-gradient(180deg,#fdf2f8 0%,#fce7f3 25%,#fbcfe8 75%,#f9a8d4 100%)',
    'linear-gradient(180deg,#fef3c7 0%,#fde68a 25%,#fed7aa 75%,#fdba74 100%)',
    'linear-gradient(180deg,#dcfce7 0%,#bbf7d0 25%,#86efac 75%,#4ade80 100%)',
    'linear-gradient(180deg,#dbeafe 0%,#bfdbfe 25%,#93c5fd 75%,#60a5fa 100%)',
    /* ë¯¸ìˆ ì‹¤ */ 'linear-gradient(180deg,#fef3c7 0%,#d4a574 40%,#92400e 100%)',
    /* ê°¤ëŸ¬ë¦¬ */ 'linear-gradient(180deg,#f8fafc 0%,#f1f5f9 30%,#e2e8f0 80%,#cbd5e1 100%)',
    /* ì•¼ì™¸ */ 'linear-gradient(180deg,#7dd3fc 0%,#bae6fd 30%,#e0f2fe 60%,#dcfce7 100%)',
    /* ìˆ˜ì±„í™” */ 'linear-gradient(180deg,#fce7f3 0%,#dbeafe 25%,#fef9c3 50%,#dcfce7 75%,#fae8ff 100%)',
    /* í¬ë ˆíŒŒìŠ¤ */ 'linear-gradient(180deg,#fca5a5 0%,#fdba74 14%,#fde68a 28%,#86efac 42%,#93c5fd 57%,#a5b4fc 71%,#d8b4fe 85%,#f9a8d4 100%)',
    /* ë™êµ´ë²½í™” */ 'linear-gradient(180deg,#44403c 0%,#57534e 30%,#78716c 60%,#292524 100%)',
    /* ë³„ë°¤ */ 'linear-gradient(180deg,#1e1b4b 0%,#312e81 25%,#3730a3 50%,#1e3a5f 75%,#0f172a 100%)',
    /* íŒì•„íŠ¸ */ 'linear-gradient(180deg,#fbbf24 0%,#f472b6 25%,#60a5fa 50%,#34d399 75%,#fb923c 100%)'
  ];
  const game = document.getElementById('hero-game');
  game.style.background = bgs[(hg.level - 1) % bgs.length];
  // ì–´ë‘ìš´ ë°°ê²½ì—ì„œ í…ìŠ¤íŠ¸ ë°ê²Œ
  const darkBgs = [9,10]; // ë™êµ´ë²½í™”, ë³„ë°¤
  const isDark = darkBgs.includes((hg.level - 1) % bgs.length);
  game.querySelectorAll('.hg-stat').forEach(s => s.style.color = isDark ? '#fce7f3' : '#831843');
  addHgDecorations();
}

let _prevHgLives = 5, _prevHgLevel = 1;
function updateHgUI() {
  document.getElementById('hg-score').textContent = hg.score;
  document.getElementById('hg-level').textContent = hg.level;
  document.getElementById('hg-filled').textContent = hg.filledCount;
  const heartsEl = document.getElementById('hg-hearts');
  heartsEl.textContent = 'â¤ï¸'.repeat(Math.max(0,hg.lives)) + 'ğŸ–¤'.repeat(Math.max(0, 5 - hg.lives));
  if (hg.lives < _prevHgLives) { heartsEl.style.animation = 'none'; heartsEl.offsetHeight; heartsEl.style.animation = 'heartLost .5s ease-out'; }
  _prevHgLives = hg.lives;
  if (hg.level > _prevHgLevel) { showLevelUp(hg.level); }
  _prevHgLevel = hg.level;
}

function hgEnd() {
  hg.running = false;
  if (hg.spawnTimer) clearInterval(hg.spawnTimer);
  if (hg.animId) cancelAnimationFrame(hg.animId);
  hg.balls.forEach(b => b.el.remove());
  hg.balls = [];
  if (hg.score > hg.bestScore) hg.bestScore = hg.score;
  profile.totalActivity++;
  saveStats();
  updateProfile();
  document.getElementById('hg-final-score').textContent = hg.score;
  let msg = 'ë©‹ì§„ ê·¸ë¦¼ì´ì—ìš”!';
  if (hg.score >= 50) msg = 'ëŒ€ë‹¨í•´ìš”! ë¯¸ìˆ  ì²œì¬!';
  else if (hg.score >= 30) msg = 'ì™€! ìƒ‰ì¹  ë§ˆìŠ¤í„°!';
  else if (hg.score >= 15) msg = 'ì˜í–ˆì–´ìš”! ê³„ì† ê·¸ë ¤ë´ìš”!';
  document.getElementById('hg-over-msg').textContent = msg;
  document.getElementById('hg-over').classList.remove('hidden');
  SFX.gameOver();
  speak(msg);
}

function hgRestart() {
  document.getElementById('hg-over').classList.add('hidden');
  const arena = document.getElementById('hg-arena');
  arena.querySelectorAll('.flying-ball,.hg-paint-burst,.hg-star-pop,.hg-stain,.hg-powerup,.hg-deco,.hg-ground,.hg-bg-sparkle,.hg-drip').forEach(e => e.remove());
  SFX.gameStart();
  startHeroGame();
}

function hgPause() {
  hg.paused = !hg.paused;
  document.getElementById('hg-pause').classList.toggle('hidden', !hg.paused);
}

function hgExit() {
  hg.running = false;
  if (hg.spawnTimer) clearInterval(hg.spawnTimer);
  if (hg.animId) cancelAnimationFrame(hg.animId);
  hg.balls.forEach(b => b.el.remove());
  hg.balls = [];
  document.getElementById('hg-over').classList.add('hidden');
  document.getElementById('hg-pause').classList.add('hidden');
  document.getElementById('hero-game').classList.add('hidden');
  if(document.fullscreenElement)document.exitFullscreen?.();
}

// ===== ì´ˆê¸°í™” =====
document.addEventListener('DOMContentLoaded', function() {
  // fitScale
  function fitScale() {
    const c = document.querySelector('.container');
    if (!c || getComputedStyle(c).display === 'none') return;
    const M = 0.03;
    const aW = window.innerWidth * (1 - M * 2);
    const aH = window.innerHeight * (1 - M * 2);
    const s = Math.min(aW / 1920, aH / 1080);
    c.style.transform = `scale(${s})`;
    c.style.left = ((window.innerWidth - 1920 * s) / 2) + 'px';
    c.style.top = ((window.innerHeight - 1080 * s) / 2) + 'px';
  }
  fitScale();
  window.addEventListener('resize', fitScale);
  if (window.visualViewport) window.visualViewport.addEventListener('resize', fitScale);

  // í”„ë¡œí•„
  _prevMainLevel = Math.floor(profile.totalActivity / 10) + 1;
  updateProfile();
  updateActionButtons();

  // ê²Œì„ ì´ˆê¸°í™”
  initFaceParts();
  initFaceDrag();
  initPaintToolbar();
  initPaintCanvas();
  initTheater();

  // ì‚¬ì´ë“œ ìƒíƒœ ë°˜ì˜
  document.getElementById('face-count').textContent = face.count;
  document.getElementById('face-parts-used').textContent = face.partsUsed;
  document.getElementById('paint-touches').textContent = paint.touches;
  document.getElementById('paint-colors-used').textContent = paint.colorsUsed.size;
  document.getElementById('paint-works').textContent = paint.works;
  document.getElementById('theater-shows').textContent = theater.shows;
  document.getElementById('theater-stickers').textContent = theater.stickerCount;
});

// ë³„ ê¹œë¹¡ì„ í‚¤í”„ë ˆì„ ì¶”ê°€
const styleSheet = document.createElement('style');
styleSheet.textContent = `@keyframes starTwinkle{0%,100%{opacity:.2;transform:scale(.8)}50%{opacity:.8;transform:scale(1.2)}}`;
document.head.appendChild(styleSheet);

// ë”ë¸”íƒ­ ë°©ì§€
let lastTouchEnd = 0;
document.addEventListener('touchend', function(e) {
  const now = Date.now();
  if (now - lastTouchEnd <= 300) e.preventDefault();
  lastTouchEnd = now;
}, false);
document.addEventListener('visibilitychange', () => {
  if (document.hidden) {
    speechSynthesis.cancel(); audioQueue = []; isSpeaking = false;
    if (hg.running && !hg.paused) hgPause();
  }
});
window.matchMedia('(orientation: portrait)').addEventListener('change', e => {
  if (e.matches) {
    speechSynthesis.cancel(); audioQueue = []; isSpeaking = false;
    if (hg.running && !hg.paused) hgPause();
  }
});
</script>
</body>
</html>
