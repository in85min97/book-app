<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>ÏòÅÏñ¥ ÎÜÄÏù¥ÌÑ∞ üî§</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;-webkit-user-select:none;user-select:none}
body{font-family:'Noto Sans KR',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:linear-gradient(135deg,#4f46e5 0%,#6366f1 50%,#4338ca 100%);margin:0;padding:0;width:100vw;height:100vh;height:100dvh;overflow:hidden;touch-action:manipulation}
.rotate-notice{display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:linear-gradient(135deg,#4f46e5,#6366f1);z-index:9999;flex-direction:column;align-items:center;justify-content:center;color:#fff;font-size:24px;font-weight:700;text-align:center;gap:20px}
.rotate-notice .rotate-icon{font-size:80px;animation:rotateH 2s ease-in-out infinite}
@keyframes rotateH{0%,100%{transform:rotate(0)}50%{transform:rotate(90deg)}}
@media(orientation:portrait){.rotate-notice{display:flex}.container{display:none!important}}
.container{width:1920px;height:1080px;background:#fff;border-radius:25px;box-shadow:0 25px 50px rgba(0,0,0,.12);display:flex;flex-direction:column;overflow:hidden;transform-origin:0 0;position:absolute}

.subject-bar{background:linear-gradient(135deg,#1e3a8a,#3b82f6);display:flex;align-items:center;padding:0 20px;height:56px;flex-shrink:0;gap:4px;position:relative}
.subject-bar::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:linear-gradient(90deg,#fbbf24,#f59e0b,#fbbf24)}
.sb-tab{padding:8px 30px;border:none;border-radius:12px 12px 0 0;background:0;font-size:18px;font-weight:800;color:rgba(255,255,255,.5);cursor:pointer;font-family:inherit;transition:.2s;display:flex;align-items:center;gap:8px;text-decoration:none}
.sb-tab.active{background:#fff;color:#4f46e5}
.sb-spacer{flex:1}
.sb-btns{display:flex;gap:8px}
.sb-btn{background:rgba(255,255,255,.15);border:2px solid rgba(255,255,255,.2);border-radius:10px;padding:6px 14px;font-size:18px;color:#fff;cursor:pointer;transition:.15s}
.sb-btn:active{background:rgba(255,255,255,.3)}

.main-layout{display:grid;grid-template-columns:300px 1fr 300px;gap:14px;padding:14px;flex:1;overflow:hidden}

.left-panel{display:flex;flex-direction:column;gap:10px;overflow:hidden}
.profile-section{background:linear-gradient(145deg,#4f46e5,#6366f1 50%,#818cf8);border-radius:20px;padding:20px;border:3px solid #c7d2fe;box-shadow:0 6px 20px rgba(79,70,229,.3);flex-shrink:0;position:relative;overflow:hidden}
.profile-section::before{content:'';position:absolute;inset:0;background:url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='15' cy='15' r='1.5' fill='white' opacity='.3'><animate attributeName='opacity' values='.3;.1;.3' dur='2s' repeatCount='indefinite'/></circle><circle cx='85' cy='25' r='1' fill='white' opacity='.25'><animate attributeName='opacity' values='.25;.08;.25' dur='1.5s' repeatCount='indefinite'/></circle><circle cx='25' cy='75' r='1.2' fill='white' opacity='.3'><animate attributeName='opacity' values='.3;.1;.3' dur='1.8s' repeatCount='indefinite'/></circle></svg>") repeat;pointer-events:none}
.profile-content{position:relative;z-index:1;display:flex;align-items:center;gap:15px}
.profile-avatar{width:90px;height:90px;background:linear-gradient(145deg,#a5b4fc,#818cf8);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:50px;border:3px solid #fff;box-shadow:0 4px 15px rgba(129,140,248,.4);animation:avGlow 3s ease-in-out infinite;flex-shrink:0;cursor:pointer}
@keyframes avGlow{0%,100%{box-shadow:0 4px 15px rgba(129,140,248,.4);transform:scale(1)}50%{box-shadow:0 8px 25px rgba(129,140,248,.6);transform:scale(1.05)}}
.profile-info{flex:1;color:#fff}
.profile-name{font-size:28px;font-weight:800;text-shadow:2px 2px 4px rgba(0,0,0,.3);margin-bottom:8px;cursor:pointer}
.profile-level-container{background:rgba(255,255,255,.2);border-radius:12px;padding:8px 12px}
.profile-level{font-size:18px;font-weight:700;color:#e0e7ff;display:flex;align-items:center;gap:8px}
.level-badge{background:linear-gradient(145deg,#a5b4fc,#818cf8);color:#312e81;padding:4px 12px;border-radius:8px;font-size:18px;font-weight:800;border:1px solid #fff}
.progress-bar{width:100%;height:6px;background:rgba(255,255,255,.3);border-radius:3px;margin-top:5px;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,#a5b4fc,#818cf8,#a5b4fc);background-size:200% 100%;border-radius:3px;transition:width .5s;animation:pShine 2s linear infinite}
@keyframes pShine{0%{background-position:-200% 0}100%{background-position:200% 0}}

.tab-headers{display:grid;grid-template-columns:1fr 1fr;gap:8px;flex-shrink:0}
.tab-btn{background:linear-gradient(145deg,#e2e8f0,#cbd5e1);border:2px solid #94a3b8;border-radius:12px;padding:8px;font-size:15px;font-weight:700;cursor:pointer;transition:.2s;color:#475569;display:flex;align-items:center;justify-content:center;height:48px;white-space:nowrap;font-family:inherit}
.tab-btn.active{background:linear-gradient(145deg,#6366f1,#4f46e5);color:#fff;border-color:#6366f1}
.tab-btn:active{transform:scale(.97)}
.tab-content{display:none;flex:1;overflow:hidden}
.tab-content.active{display:flex;flex-direction:column}

.side-info{background:linear-gradient(145deg,#eef2ff,#e0e7ff);border-radius:16px;padding:15px;border:2px solid #6366f1;display:flex;flex-direction:column;gap:8px;height:100%;overflow:hidden}
.side-title{font-size:17px;font-weight:700;color:#3730a3;text-align:center;flex-shrink:0}
.side-stat{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;background:#fff;border-radius:8px;font-size:15px;font-weight:600;color:#1e293b}
.side-val{font-size:20px;font-weight:800;color:#6366f1}

.game-launch-btn{flex-shrink:0;background:linear-gradient(145deg,#a5b4fc,#818cf8);color:#312e81;border:3px solid #fff;border-radius:16px;padding:14px;font-size:20px;font-weight:800;cursor:pointer;text-align:center;box-shadow:0 4px 15px rgba(129,140,248,.4);font-family:inherit;animation:gPulse 2s ease-in-out infinite}
@keyframes gPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.02)}}
.game-launch-btn:active{transform:scale(.97)}

.center-panel{display:flex;flex-direction:column;overflow:hidden;position:relative}
.game-view{display:none;flex-direction:column;flex:1;overflow:hidden}
.game-view.active{display:flex}

/* ABC ÏÇ¨ÎÉ•Íæº */
.hunt-area{flex:1;display:flex;flex-direction:column;overflow:hidden;position:relative}
.hunt-scene{flex:1;position:relative;border-radius:16px;overflow:hidden;background:linear-gradient(180deg,#065f46,#047857 40%,#059669 70%,#10b981 100%)}
.hunt-scene.sea{background:linear-gradient(180deg,#0c4a6e,#0369a1 40%,#0284c7 70%,#38bdf8 100%)}
.hunt-scene.space{background:linear-gradient(180deg,#0f172a,#1e1b4b 40%,#312e81 70%,#4c1d95 100%)}
.hunt-theme-label{position:absolute;top:14px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.4);color:#fff;padding:8px 24px;border-radius:20px;font-size:18px;font-weight:800;z-index:5;backdrop-filter:blur(4px)}
.hunt-spot{position:absolute;width:130px;height:130px;border-radius:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s;z-index:3;overflow:hidden}
.hunt-spot .spot-cover{position:absolute;inset:0;border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:64px;transition:all .5s;z-index:2}
.hunt-spot .spot-animal{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:0;transition:all .5s;z-index:1}
.hunt-spot.revealed .spot-cover{opacity:0;transform:scale(0) rotate(180deg)}
.hunt-spot.revealed .spot-animal{opacity:1;transform:scale(1)}
.hunt-spot .animal-emoji{font-size:80px;filter:drop-shadow(0 2px 8px rgba(0,0,0,.3))}
.hunt-spot .animal-letter{font-size:32px;font-weight:900;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.5)}
.hunt-spot .animal-word{font-size:14px;font-weight:700;color:rgba(255,255,255,.8)}
.hunt-score-bar{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;background:linear-gradient(145deg,#f0fdf4,#dcfce7);border-radius:12px;margin:8px;border:2px solid #22c55e}
.hunt-score-bar span{font-size:16px;font-weight:700;color:#166534}
.hunt-catch-effect{position:absolute;pointer-events:none;z-index:20;animation:catchPop .8s ease-out forwards}
@keyframes catchPop{0%{transform:translate(-50%,-50%) scale(0);opacity:0}30%{transform:translate(-50%,-50%) scale(1.3);opacity:1}100%{transform:translate(-50%,-60%) scale(.6);opacity:0}}
.hunt-particle{position:absolute;pointer-events:none;z-index:15;animation:huntPart var(--dur,.7s) ease-out forwards}
@keyframes huntPart{0%{transform:translate(0,0) scale(1);opacity:1}100%{transform:translate(var(--tx,0),var(--ty,-40px)) scale(0);opacity:0}}
.hunt-star-burst{position:absolute;pointer-events:none;z-index:18;border-radius:50%;animation:huntRing .6s ease-out forwards}
@keyframes huntRing{0%{transform:translate(-50%,-50%) scale(0);opacity:.8}100%{transform:translate(-50%,-50%) scale(1);opacity:0}}
/* Ï†ïÍ∏Ä Ïû•Ïãù */
.jungle-deco{position:absolute;pointer-events:none;z-index:1;font-size:40px;opacity:.6}
.jungle-svg-deco{position:absolute;pointer-events:none;z-index:1;opacity:.5}
.jungle-svg-deco.sway{animation:jungleSway 4s ease-in-out infinite}
@keyframes jungleSway{0%,100%{transform:rotate(var(--rot,0deg))}50%{transform:rotate(calc(var(--rot,0deg) + 6deg))}}
.sea-bubble{position:absolute;pointer-events:none;z-index:1;width:12px;height:12px;background:rgba(255,255,255,.3);border-radius:50%;animation:bubbleUp var(--dur,4s) ease-in infinite}
@keyframes bubbleUp{0%{transform:translateY(0);opacity:.3}100%{transform:translateY(-300px);opacity:0}}
.sea-svg-deco{position:absolute;pointer-events:none;z-index:1;opacity:.45}
.sea-svg-deco.swim{animation:seaSwim var(--dur,6s) ease-in-out infinite}
@keyframes seaSwim{0%{transform:translateX(0) scaleX(1)}25%{transform:translateX(30px) scaleX(1)}50%{transform:translateX(0) scaleX(1)}75%{transform:translateX(-30px) scaleX(-1)}100%{transform:translateX(0) scaleX(1)}}
.space-star{position:absolute;pointer-events:none;z-index:1;width:3px;height:3px;background:#fff;border-radius:50%;animation:twinkle var(--dur,2s) ease-in-out infinite}
@keyframes twinkle{0%,100%{opacity:.2}50%{opacity:1}}
.space-svg-deco{position:absolute;pointer-events:none;z-index:1;opacity:.5}
.space-svg-deco.orbit{animation:spaceOrbit var(--dur,12s) linear infinite}
@keyframes spaceOrbit{0%{transform:rotate(0deg) translateX(var(--orb,10px)) rotate(0deg)}100%{transform:rotate(360deg) translateX(var(--orb,10px)) rotate(-360deg)}}

/* Í∏ÄÏûê Îí§ÏßëÍ∏∞ */
.flip-area{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;padding:16px}
.flip-info{font-size:24px;font-weight:800;color:#1e293b;text-align:center}
.flip-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;max-width:650px;width:100%}
.flip-card{height:180px;perspective:800px;cursor:pointer}
.flip-card-inner{position:relative;width:100%;height:100%;transition:transform .6s;transform-style:preserve-3d}
.flip-card.flipped .flip-card-inner{transform:rotateY(180deg)}
.flip-card.matched .flip-card-inner{transform:rotateY(180deg)}
.flip-card-front,.flip-card-back{position:absolute;inset:0;backface-visibility:hidden;border-radius:20px;display:flex;flex-direction:column;align-items:center;justify-content:center;border:3px solid #c7d2fe;box-shadow:0 4px 16px rgba(0,0,0,.08)}
.flip-card-front{background:linear-gradient(145deg,#6366f1,#4f46e5);color:#fff;font-size:48px;font-weight:900;overflow:hidden}
.flip-card-front::after{content:'';position:absolute;inset:8px;border:2px dashed rgba(255,255,255,.2);border-radius:14px;z-index:2}
.flip-card-front .flip-front-svg{position:absolute;inset:0;z-index:1}
.flip-card-front .flip-front-q{position:relative;z-index:3;text-shadow:0 2px 8px rgba(0,0,0,.3)}
.flip-card-back{transform:rotateY(180deg);background:linear-gradient(145deg,#fff,#eef2ff);font-size:64px;font-weight:900;color:#4f46e5}
.flip-card-back .flip-label{font-size:14px;font-weight:700;color:#6366f1;margin-top:4px}
.flip-card.matched .flip-card-back{background:linear-gradient(145deg,#dcfce7,#bbf7d0);border-color:#22c55e}
.flip-card.matched .flip-card-back .flip-label{color:#16a34a}
.flip-match-effect{position:absolute;pointer-events:none;z-index:20;font-size:60px;animation:flipMatch .8s ease-out forwards}
@keyframes flipMatch{0%{transform:translate(-50%,-50%) scale(0);opacity:0}40%{transform:translate(-50%,-50%) scale(1.3);opacity:1}100%{transform:translate(-50%,-60%) scale(.5);opacity:0}}
.flip-confetti{position:absolute;pointer-events:none;z-index:15;border-radius:3px;animation:flipConf var(--dur,1s) ease-out forwards}
@keyframes flipConf{0%{transform:translate(0,0) rotate(0);opacity:1}100%{transform:translate(var(--tx,0),var(--ty,200px)) rotate(720deg);opacity:0}}
.flip-result{font-size:22px;font-weight:800;color:#16a34a;text-align:center;min-height:30px}

/* Ï£ºÎ¨∏ ÎßàÎ≤ïÏÇ¨ */
.spell-area{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;position:relative;padding:12px}
.spell-cauldron{position:relative;width:220px;height:200px}
.spell-slots{display:flex;gap:12px;justify-content:center}
.spell-slot{width:80px;height:90px;background:linear-gradient(145deg,#eef2ff,#e0e7ff);border:3px dashed #a5b4fc;border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:48px;font-weight:900;color:#4f46e5;transition:all .3s}
.spell-slot.filled{border-style:solid;border-color:#6366f1;background:linear-gradient(145deg,#c7d2fe,#a5b4fc);animation:slotPop .3s ease-out}
@keyframes slotPop{0%{transform:scale(1.2)}100%{transform:scale(1)}}
.spell-result-area{min-height:100px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px}
.spell-summon{font-size:80px;animation:summonPop 1s ease-out forwards}
@keyframes summonPop{0%{transform:scale(0) rotate(-20deg);opacity:0}50%{transform:scale(1.3) rotate(10deg);opacity:1}100%{transform:scale(1) rotate(0deg);opacity:1}}
.spell-word{font-size:28px;font-weight:900;color:#4f46e5}
.spell-fail{font-size:24px;font-weight:800;color:#ef4444;animation:failShake .5s ease-out}
@keyframes failShake{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}}
.spell-keyboard{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;max-width:700px;padding:8px}
.spell-key{width:58px;height:58px;background:linear-gradient(145deg,#fff,#f1f5f9);border:3px solid #c7d2fe;border-radius:14px;font-size:26px;font-weight:900;color:#4f46e5;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.15s;box-shadow:0 3px 8px rgba(0,0,0,.08);font-family:inherit}
.spell-key:active{transform:scale(.9);background:linear-gradient(145deg,#c7d2fe,#a5b4fc);border-color:#6366f1}
.spell-key.used{opacity:.3;pointer-events:none}
.spell-magic-particle{position:absolute;pointer-events:none;z-index:20;animation:magicFloat var(--dur,1.5s) ease-out forwards}
@keyframes magicFloat{0%{transform:translate(0,0) scale(1);opacity:1}100%{transform:translate(var(--tx,0),var(--ty,-80px)) scale(0);opacity:0}}
.spell-smoke{position:absolute;pointer-events:none;z-index:10;border-radius:50%;filter:blur(8px);animation:spellSmoke 1s ease-out forwards}
@keyframes spellSmoke{0%{transform:scale(.3);opacity:.6}100%{transform:scale(2);opacity:0}}

/* ÎÇ¥ Í∏∞Î°ù */
.records-area{flex:1;display:flex;flex-direction:column;gap:16px;padding:16px;overflow-y:auto}
.record-card{background:linear-gradient(145deg,#fff,#f8fafc);border:2px solid #e2e8f0;border-radius:16px;padding:18px;box-shadow:0 4px 12px rgba(0,0,0,.06)}
.record-card h3{font-size:18px;font-weight:800;color:#1e293b;margin-bottom:10px}
.record-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.record-item{text-align:center;padding:12px;background:linear-gradient(145deg,#eef2ff,#e0e7ff);border-radius:12px;border:2px solid #c7d2fe}
.record-num{font-size:32px;font-weight:900;color:#6366f1}
.record-label{font-size:13px;font-weight:600;color:#3730a3;margin-top:4px}
/* ÎèÑÍ∞ê */
.collection-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-top:8px}
.collection-item{text-align:center;padding:6px;background:#fff;border-radius:10px;border:2px solid #e2e8f0;font-size:13px;font-weight:700;color:#64748b}
.collection-item.collected{border-color:#6366f1;color:#4f46e5;background:linear-gradient(145deg,#eef2ff,#e0e7ff)}
.collection-item .coll-letter{font-size:22px;font-weight:900;display:block}

/* Ïò§Î•∏Ï™Ω */
.right-panel{display:flex;flex-direction:column;gap:12px;overflow:hidden}
.action-btn{border:none;border-radius:20px;font-size:32px;font-weight:800;cursor:pointer;transition:.1s;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;flex:1;min-height:60px;font-family:inherit;color:#fff}
.action-btn .icon{font-size:52px;opacity:.9;line-height:1}
.action-btn:active{transform:scale(.95)}
.action-btn.btn-indigo{background:linear-gradient(145deg,#6366f1,#4f46e5);box-shadow:0 2px 8px rgba(99,102,241,.3)}
.action-btn.btn-cyan{background:linear-gradient(145deg,#06b6d4,#0891b2);box-shadow:0 2px 8px rgba(6,182,212,.2)}
.action-btn.btn-red{background:linear-gradient(145deg,#f87171,#ef4444);box-shadow:0 2px 8px rgba(248,113,113,.2)}
.action-btn.btn-green{background:linear-gradient(145deg,#10b981,#059669);box-shadow:0 2px 8px rgba(16,185,129,.2)}
.action-btn.btn-orange{background:linear-gradient(145deg,#f97316,#ea580c);box-shadow:0 2px 8px rgba(249,115,22,.2)}
.action-btn:disabled{background:linear-gradient(145deg,#e5e7eb,#d1d5db)!important;color:#9ca3af;cursor:not-allowed;box-shadow:none}

/* ÌûàÏñ¥Î°ú: Îã®Ïñ¥ ÌíçÏÑ† */
.hero-game{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:5000;display:flex;flex-direction:column;background:linear-gradient(180deg,#c7d2fe 0%,#a5b4fc 25%,#ddd6fe 75%,#c4b5fd 100%);overflow:hidden}
.hero-game.hidden{display:none}
.hg-header{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:rgba(255,255,255,.35);backdrop-filter:blur(12px);flex-shrink:0;z-index:10;border-bottom:2px solid rgba(255,255,255,.4)}
.hg-stat{font-size:22px;font-weight:800;color:#312e81}
.hg-hearts{font-size:24px;letter-spacing:3px}
.hg-ctrls{display:flex;gap:8px}
.hg-ctrl-btn{background:rgba(255,255,255,.6);border:2px solid rgba(255,255,255,.8);border-radius:50%;width:44px;height:44px;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#475569}
.hg-ctrl-btn:active{transform:scale(.9)}
.hg-arena{flex:1;position:relative;overflow:hidden}
.hg-word-display{position:absolute;top:20px;left:50%;transform:translateX(-50%);display:flex;gap:10px;z-index:10}
.hg-word-letter{width:60px;height:70px;background:rgba(255,255,255,.85);border:3px solid #a5b4fc;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:40px;font-weight:900;color:#4f46e5;backdrop-filter:blur(4px)}
.hg-word-letter.blank{color:#c7d2fe;border-style:dashed;animation:blankPulse 1.5s ease-in-out infinite}
@keyframes blankPulse{0%,100%{border-color:#a5b4fc}50%{border-color:#6366f1}}
.hg-word-letter.filled{background:linear-gradient(145deg,#dcfce7,#bbf7d0);border-color:#22c55e;color:#166534;animation:letterFill .3s ease-out}
@keyframes letterFill{0%{transform:scale(1.3)}100%{transform:scale(1)}}
.hg-word-emoji{position:absolute;top:100px;left:50%;transform:translateX(-50%);font-size:60px;z-index:10;opacity:.3;transition:all .5s}
.hg-word-emoji.completed{opacity:1;animation:emojiComplete 1s ease-out forwards}
@keyframes emojiComplete{0%{transform:translateX(-50%) scale(1)}50%{transform:translateX(-50%) scale(1.5)}100%{transform:translateX(-50%) scale(1.2)}}
.balloon{position:absolute;z-index:5;cursor:pointer;pointer-events:auto;display:flex;flex-direction:column;align-items:center;animation:balloonSway 3s ease-in-out infinite}
@keyframes balloonSway{0%,100%{transform:translateX(0)}50%{transform:translateX(10px)}}
.balloon svg{filter:drop-shadow(0 4px 12px rgba(0,0,0,.2))}
.balloon .balloon-letter{position:absolute;top:28px;left:50%;transform:translateX(-50%);font-size:38px;font-weight:900;color:#fff;text-shadow:0 2px 6px rgba(0,0,0,.25);z-index:2;pointer-events:none}
.balloon:active{transform:scale(.95)}
.balloon-pop{position:absolute;pointer-events:none;z-index:25;animation:bPop .6s ease-out forwards}
@keyframes bPop{0%{transform:scale(1);opacity:1}50%{transform:scale(1.5);opacity:.5}100%{transform:scale(0);opacity:0}}
.balloon-pop-particle{position:absolute;pointer-events:none;z-index:20;border-radius:50%;animation:bPopPart var(--dur,.5s) ease-out forwards}
@keyframes bPopPart{0%{transform:translate(0,0) scale(1);opacity:1}100%{transform:translate(var(--tx,0),var(--ty,0)) scale(0);opacity:0}}
.hg-flash{position:absolute;inset:0;pointer-events:none;z-index:30;animation:screenFlash .3s ease-out forwards}
@keyframes screenFlash{0%{background:rgba(34,197,94,.3)}100%{background:transparent}}
.hg-miss-flash{position:absolute;inset:0;pointer-events:none;z-index:30;animation:missFlash .4s ease-out forwards}
@keyframes missFlash{0%{background:rgba(239,68,68,.3)}50%{background:rgba(239,68,68,.15)}100%{background:transparent}}
.hg-cloud{position:absolute;font-size:36px;opacity:.2;pointer-events:none;animation:cFloat 20s linear infinite;z-index:1}
@keyframes cFloat{0%{transform:translateX(-100px)}100%{transform:translateX(calc(100vw + 100px))}}
.hg-powerup{position:absolute;z-index:8;cursor:pointer;pointer-events:auto;font-size:40px;animation:puFloat 2s ease-in-out infinite;filter:drop-shadow(0 0 10px rgba(251,191,36,.6))}
@keyframes puFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
.hg-combo{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:60px;font-weight:900;color:#f59e0b;text-shadow:0 4px 8px rgba(0,0,0,.3);z-index:50;pointer-events:none;animation:comboPop 1s ease-out forwards}
@keyframes comboPop{0%{transform:translate(-50%,-50%) scale(0);opacity:0}30%{transform:translate(-50%,-50%) scale(1.2);opacity:1}100%{transform:translate(-50%,-50%) scale(.8);opacity:0}}
.hg-overlay{position:absolute;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:100;backdrop-filter:blur(5px)}
.hg-overlay.hidden{display:none}
.hg-overlay-box{background:#fff;border-radius:24px;padding:40px;text-align:center;box-shadow:0 25px 50px rgba(0,0,0,.3);min-width:320px}
.hg-overlay-box h2{font-size:36px;font-weight:900;color:#1e293b;margin-bottom:12px}
.hg-overlay-box .score{font-size:28px;font-weight:700;color:#6366f1;margin-bottom:8px}
.hg-overlay-box .msg{font-size:18px;color:#64748b;margin-bottom:20px}
.hg-overlay-box button{display:block;width:100%;padding:14px;border:none;border-radius:14px;font-size:18px;font-weight:800;cursor:pointer;margin-bottom:8px;font-family:inherit}
.hg-overlay-box .btn-retry{background:linear-gradient(145deg,#6366f1,#4f46e5);color:#fff}
.hg-overlay-box .btn-exit{background:linear-gradient(145deg,#e2e8f0,#cbd5e1);color:#475569}

/* Î™®Îã¨ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:6000;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(10px)}
.modal-overlay.hidden{display:none}
.modal-box{background:#fff;border-radius:20px;width:90%;max-width:500px;max-height:80vh;overflow-y:auto;box-shadow:0 25px 50px rgba(0,0,0,.3)}
.modal-head{background:linear-gradient(145deg,#6366f1,#4f46e5);color:#fff;padding:16px 20px;border-radius:20px 20px 0 0;display:flex;justify-content:space-between;align-items:center}
.modal-head h3{margin:0;font-size:18px}
.modal-close{background:0;border:0;color:#fff;font-size:24px;cursor:pointer}
.modal-body{padding:20px}
.modal-section{margin-bottom:16px;padding:14px;border-radius:10px;background:#f8fafc}
.modal-section h4{margin:0 0 10px;font-weight:700;color:#374151;font-size:15px}
.modal-input{width:100%;padding:10px;border:2px solid #e5e7eb;border-radius:8px;font-size:14px;box-sizing:border-box;margin-bottom:8px}
.modal-input:focus{outline:none;border-color:#6366f1}
.modal-btn{padding:10px 16px;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;width:100%;background:linear-gradient(145deg,#6366f1,#4f46e5);color:#fff;margin-top:6px}
.char-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(70px,1fr));gap:12px}
.char-item{background:linear-gradient(145deg,#f8fafc,#e2e8f0);border:2px solid #cbd5e1;border-radius:14px;padding:12px;text-align:center;cursor:pointer;font-size:32px;height:70px;display:flex;align-items:center;justify-content:center;transition:.2s}
.char-item.selected{background:linear-gradient(145deg,#a5b4fc,#818cf8);border-color:#6366f1}

/* ===== Î∞∞Í≤Ω Ïî¨ ===== */
/* Í∏ÄÏûê Îí§ÏßëÍ∏∞: ÎßàÎ≤ï ÎèÑÏÑúÍ¥Ä */
.flip-view{background:linear-gradient(180deg,#1e1b4b 0%,#312e81 40%,#3730a3 70%,#4338ca 100%);border-radius:16px;overflow:hidden;position:relative}
.flip-view::before{content:'';position:absolute;inset:0;z-index:0;pointer-events:none;background:url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1320 960'><defs><linearGradient id='sh1' x1='0' y1='0' x2='0' y2='1'><stop offset='0%25' stop-color='%23292524'/><stop offset='100%25' stop-color='%231c1917'/></linearGradient></defs><rect x='0' y='80' width='65' height='880' rx='4' fill='url(%23sh1)'/><rect x='5' y='100' width='55' height='22' rx='3' fill='%234338ca' opacity='.6'/><rect x='5' y='130' width='55' height='18' rx='3' fill='%236d28d9' opacity='.5'/><rect x='5' y='156' width='55' height='24' rx='3' fill='%233b82f6' opacity='.5'/><rect x='5' y='188' width='55' height='20' rx='3' fill='%237c3aed' opacity='.6'/><rect x='5' y='216' width='55' height='22' rx='3' fill='%234f46e5' opacity='.5'/><rect x='5' y='246' width='55' height='18' rx='3' fill='%23818cf8' opacity='.4'/><rect x='5' y='280' width='55' height='24' rx='3' fill='%236366f1' opacity='.5'/><rect x='5' y='320' width='55' height='20' rx='3' fill='%234338ca' opacity='.5'/><rect x='5' y='355' width='55' height='22' rx='3' fill='%237c3aed' opacity='.4'/><rect x='5' y='395' width='55' height='18' rx='3' fill='%233b82f6' opacity='.5'/><rect x='1255' y='80' width='65' height='880' rx='4' fill='url(%23sh1)'/><rect x='1260' y='100' width='55' height='22' rx='3' fill='%236d28d9' opacity='.5'/><rect x='1260' y='130' width='55' height='24' rx='3' fill='%234338ca' opacity='.6'/><rect x='1260' y='162' width='55' height='18' rx='3' fill='%23818cf8' opacity='.4'/><rect x='1260' y='188' width='55' height='20' rx='3' fill='%234f46e5' opacity='.5'/><rect x='1260' y='216' width='55' height='22' rx='3' fill='%237c3aed' opacity='.5'/><rect x='1260' y='246' width='55' height='24' rx='3' fill='%233b82f6' opacity='.5'/><rect x='1260' y='286' width='55' height='18' rx='3' fill='%236366f1' opacity='.4'/><rect x='1260' y='320' width='55' height='22' rx='3' fill='%234338ca' opacity='.5'/><path d='M200 0 Q660 -30 1120 0' fill='none' stroke='%23a5b4fc' stroke-width='2' opacity='.15'/><ellipse cx='660' cy='30' rx='180' ry='90' fill='none' stroke='%23818cf8' stroke-width='1.5' opacity='.12'/><circle cx='200' cy='50' r='4' fill='%23fbbf24' opacity='.5'><animate attributeName='opacity' values='.5;.15;.5' dur='3s' repeatCount='indefinite'/></circle><circle cx='400' cy='35' r='3' fill='%23fbbf24' opacity='.4'><animate attributeName='opacity' values='.4;.1;.4' dur='2.5s' repeatCount='indefinite'/></circle><circle cx='900' cy='40' r='3.5' fill='%23fbbf24' opacity='.45'><animate attributeName='opacity' values='.45;.12;.45' dur='2.8s' repeatCount='indefinite'/></circle><circle cx='1100' cy='55' r='3' fill='%23fbbf24' opacity='.35'><animate attributeName='opacity' values='.35;.1;.35' dur='3.2s' repeatCount='indefinite'/></circle><rect x='80' y='880' width='1160' height='80' rx='0' fill='%23312e81' opacity='.3'/><rect x='80' y='882' width='1160' height='3' fill='%23818cf8' opacity='.15'/></svg>") no-repeat center/cover}
.flip-view .flip-area{position:relative;z-index:1}
.flip-view .flip-info{color:#e0e7ff}
.flip-view .flip-result{color:#a5b4fc}

/* Ï£ºÎ¨∏ ÎßàÎ≤ïÏÇ¨: ÎßàÎ≤ïÏÇ¨Ïùò ÌÉë */
.spell-view{background:linear-gradient(180deg,#0f0a2e 0%,#1a1145 40%,#2e1065 70%,#4c1d95 100%);border-radius:16px;overflow:hidden;position:relative}
.spell-view::before{content:'';position:absolute;inset:0;z-index:0;pointer-events:none;background:url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1320 960'><circle cx='660' cy='850' r='200' fill='none' stroke='%23a78bfa' stroke-width='1.5' opacity='.12'/><circle cx='660' cy='850' r='150' fill='none' stroke='%23c4b5fd' stroke-width='1' opacity='.1'/><circle cx='660' cy='850' r='100' fill='none' stroke='%23ddd6fe' stroke-width='.8' opacity='.08'/><line x1='460' y1='850' x2='860' y2='850' stroke='%23a78bfa' stroke-width='1' opacity='.08'/><line x1='660' y1='650' x2='660' y2='960' stroke='%23a78bfa' stroke-width='1' opacity='.08'/><rect x='30' y='200' width='25' height='600' rx='4' fill='%231c1917' opacity='.5'/><ellipse cx='42' cy='180' rx='16' ry='22' fill='%23f97316' opacity='.4'><animate attributeName='ry' values='22;18;22' dur='1.5s' repeatCount='indefinite'/><animate attributeName='opacity' values='.4;.25;.4' dur='1.5s' repeatCount='indefinite'/></ellipse><circle cx='42' cy='170' r='6' fill='%23fbbf24' opacity='.3'><animate attributeName='r' values='6;4;6' dur='1.5s' repeatCount='indefinite'/></circle><rect x='1265' y='200' width='25' height='600' rx='4' fill='%231c1917' opacity='.5'/><ellipse cx='1277' cy='180' rx='16' ry='22' fill='%23f97316' opacity='.4'><animate attributeName='ry' values='22;18;22' dur='1.8s' repeatCount='indefinite'/><animate attributeName='opacity' values='.4;.25;.4' dur='1.8s' repeatCount='indefinite'/></ellipse><circle cx='1277' cy='170' r='6' fill='%23fbbf24' opacity='.3'><animate attributeName='r' values='6;4;6' dur='1.8s' repeatCount='indefinite'/></circle><circle cx='150' cy='100' r='2' fill='%23fff' opacity='.4'><animate attributeName='opacity' values='.4;.1;.4' dur='2s' repeatCount='indefinite'/></circle><circle cx='350' cy='60' r='1.5' fill='%23fff' opacity='.3'><animate attributeName='opacity' values='.3;.08;.3' dur='2.5s' repeatCount='indefinite'/></circle><circle cx='550' cy='120' r='2' fill='%23fff' opacity='.35'><animate attributeName='opacity' values='.35;.1;.35' dur='1.8s' repeatCount='indefinite'/></circle><circle cx='800' cy='80' r='1.8' fill='%23fff' opacity='.3'><animate attributeName='opacity' values='.3;.08;.3' dur='2.2s' repeatCount='indefinite'/></circle><circle cx='1050' cy='110' r='2.2' fill='%23fff' opacity='.4'><animate attributeName='opacity' values='.4;.1;.4' dur='2.8s' repeatCount='indefinite'/></circle><circle cx='1180' cy='70' r='1.5' fill='%23fff' opacity='.25'><animate attributeName='opacity' values='.25;.05;.25' dur='3s' repeatCount='indefinite'/></circle><path d='M100 800 Q300 780 500 800 Q700 820 900 800 Q1100 780 1220 800' fill='none' stroke='%234c1d95' stroke-width='40' opacity='.3'/></svg>") no-repeat center/cover}
.spell-view .spell-area{position:relative;z-index:1}
.spell-view .spell-area>div:first-child{color:#e0e7ff}

/* ÎÇ¥Í∏∞Î°ù: ÌÉêÌóòÍ∞ÄÏùò Î∞© */
.record-view{background:linear-gradient(180deg,#fef3c7 0%,#fde68a 15%,#e0e7ff 50%,#c7d2fe 100%);border-radius:16px;overflow:hidden;position:relative}
.record-view::before{content:'';position:absolute;inset:0;z-index:0;pointer-events:none;background:url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1320 960'><rect x='0' y='820' width='1320' height='140' fill='%23292524' opacity='.15' rx='0'/><rect x='0' y='818' width='1320' height='4' fill='%2378716c' opacity='.2'/><circle cx='100' cy='100' r='50' fill='none' stroke='%236366f1' stroke-width='2' opacity='.12'/><circle cx='100' cy='100' r='35' fill='none' stroke='%23818cf8' stroke-width='1.5' opacity='.1'/><line x1='100' y1='60' x2='100' y2='100' stroke='%236366f1' stroke-width='2' opacity='.15'/><line x1='100' y1='100' x2='125' y2='110' stroke='%23818cf8' stroke-width='1.5' opacity='.12'/><circle cx='1220' cy='110' r='45' fill='%236366f1' opacity='.06'/><ellipse cx='1220' cy='110' rx='45' ry='35' fill='none' stroke='%236366f1' stroke-width='1.5' opacity='.1'/><rect x='30' y='40' width='45' height='60' rx='4' fill='%234f46e5' opacity='.08'/><rect x='35' y='45' width='35' height='6' rx='2' fill='%236366f1' opacity='.1'/><rect x='35' y='55' width='30' height='4' rx='2' fill='%23818cf8' opacity='.08'/><rect x='35' y='63' width='32' height='4' rx='2' fill='%236366f1' opacity='.08'/><rect x='1245' y='40' width='45' height='60' rx='4' fill='%234f46e5' opacity='.08'/><rect x='1250' y='45' width='35' height='6' rx='2' fill='%236366f1' opacity='.1'/><rect x='1250' y='55' width='30' height='4' rx='2' fill='%23818cf8' opacity='.08'/><polygon points='660,20 667,38 687,38 671,49 677,68 660,57 643,68 649,49 633,38 653,38' fill='%23fbbf24' opacity='.12'><animate attributeName='opacity' values='.12;.05;.12' dur='3s' repeatCount='indefinite'/></polygon></svg>") no-repeat center/cover}
.record-view .records-area{position:relative;z-index:1}
.record-view .record-card{background:linear-gradient(145deg,rgba(255,255,255,.85),rgba(248,250,252,.9));backdrop-filter:blur(4px);border:2px solid rgba(99,102,241,.15)}

/* ===== 3D ÏïÑÏºÄÏù¥Îìú Î≤ÑÌäº ===== */
.tab-btn{border-bottom:5px solid #64748b;transition:.15s}
.tab-btn.active{border-bottom:5px solid #3730a3;box-shadow:0 2px 8px rgba(99,102,241,.3)}
.tab-btn:active{transform:translateY(3px) scaleX(1.06) scaleY(0.94)!important;border-bottom-width:2px}
.action-btn{border-bottom:6px solid rgba(0,0,0,.25)}
.action-btn.btn-indigo{border-bottom-color:#3730a3}
.action-btn.btn-cyan{border-bottom-color:#0e7490}
.action-btn.btn-red{border-bottom-color:#b91c1c}
.action-btn.btn-green{border-bottom-color:#047857}
.action-btn.btn-orange{border-bottom-color:#c2410c}
.action-btn:active{transform:translateY(4px) scaleX(1.06) scaleY(0.92)!important;border-bottom-width:2px}
.spell-key{border-bottom:5px solid #a5b4fc;transition:.1s}
.spell-key:active{transform:scale(.9) translateY(3px)!important;border-bottom-width:2px;background:linear-gradient(145deg,#c7d2fe,#a5b4fc)!important}
.game-launch-btn{border-bottom:6px solid #6366f1;position:relative;overflow:hidden}
.game-launch-btn::after{content:'';position:absolute;top:0;left:-100%;width:60%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.25),transparent);animation:btnSweep 3s ease-in-out infinite}
@keyframes btnSweep{0%{left:-100%}50%{left:150%}100%{left:150%}}
.game-launch-btn:active{transform:translateY(4px) scaleX(1.04) scaleY(0.94)!important;border-bottom-width:2px}
.flip-card:hover .flip-card-inner{transform:translateY(-3px)}
.flip-card.flipped:hover .flip-card-inner,.flip-card.matched:hover .flip-card-inner{transform:rotateY(180deg) translateY(-3px)}

/* ===== Ìå®ÎÑê Í∞ïÌôî ===== */
.right-panel{background:linear-gradient(180deg,rgba(99,102,241,.12),rgba(79,70,229,.18),rgba(67,56,202,.12));border:3px solid rgba(99,102,241,.25);border-radius:20px;padding:10px}
.side-info{background:linear-gradient(145deg,#e0e7ff,#c7d2fe,#ddd6fe)}
.side-val{font-size:26px;-webkit-text-stroke:1px #3730a3;paint-order:stroke fill}
.side-title{font-size:18px;-webkit-text-stroke:.5px #3730a3;paint-order:stroke fill}
.profile-section{border:3px solid rgba(199,210,254,.5)}

/* ===== ÎîîÏûêÏù∏ Í≥µÏãù ===== */
/* text-stroke */
.hunt-theme-label{-webkit-text-stroke:1px rgba(0,0,0,.3);paint-order:stroke fill}
.flip-info{-webkit-text-stroke:1px rgba(0,0,0,.2);paint-order:stroke fill;font-size:26px}
.record-num{-webkit-text-stroke:1px #3730a3;paint-order:stroke fill}
.game-launch-btn{-webkit-text-stroke:1px #312e81;paint-order:stroke fill;font-size:22px}
.hg-stat{font-size:26px;-webkit-text-stroke:1px #1e1b4b;paint-order:stroke fill}
.spell-word{-webkit-text-stroke:1.5px rgba(0,0,0,.3);paint-order:stroke fill}
.hunt-score-bar span{-webkit-text-stroke:.5px #14532d;paint-order:stroke fill}

/* Ï†êÏàò ÌåùÏóÖ */
.score-popup{position:absolute;pointer-events:none;z-index:30;font-size:36px;font-weight:900;-webkit-text-stroke:1.5px rgba(0,0,0,.3);paint-order:stroke fill;animation:scorePop .8s ease-out forwards}
@keyframes scorePop{0%{transform:translateY(0) scale(0);opacity:0}20%{transform:translateY(-10px) scale(1.3);opacity:1}50%{transform:translateY(-30px) scale(1);opacity:1}100%{transform:translateY(-60px) scale(.7);opacity:0}}

/* ÌÉ≠ Ï†ÑÌôò */
.game-view{animation:viewFadeIn .25s ease-out}
.tab-content{animation:viewFadeIn .25s ease-out}
@keyframes viewFadeIn{0%{opacity:0;transform:translateY(6px)}100%{opacity:1;transform:translateY(0)}}

/* Î†àÎ≤®ÏóÖ Ïò§Î≤ÑÎ†àÏù¥ */
.levelup-overlay{position:fixed;inset:0;z-index:200;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.4);animation:lvFade .8s ease-out forwards;pointer-events:none}
@keyframes lvFade{0%{opacity:0}15%{opacity:1}70%{opacity:1}100%{opacity:0}}
.levelup-text{font-size:80px;font-weight:900;color:#a5b4fc;-webkit-text-stroke:3px #1e1b4b;paint-order:stroke fill;text-shadow:0 4px 12px rgba(0,0,0,.4),0 0 40px rgba(165,180,252,.5);animation:lvPop .8s cubic-bezier(.34,1.56,.64,1) forwards}
@keyframes lvPop{0%{transform:scale(0) rotate(-10deg)}30%{transform:scale(1.3) rotate(5deg)}50%{transform:scale(1) rotate(0deg)}100%{transform:scale(.9) rotate(0deg)}}

/* ÌïòÌä∏ ÏûÉÍ∏∞ */
.hg-heart-lost{display:inline-block;animation:heartLost .5s ease-out forwards}
@keyframes heartLost{0%{transform:scale(1);opacity:1;filter:none}30%{transform:scale(1.4);filter:brightness(2)}100%{transform:scale(0) translateY(-20px);opacity:0;filter:grayscale(1)}}

/* ÎßàÏä§ÏΩîÌä∏ */
.mascot-wrap{position:absolute;z-index:5;pointer-events:none}
.mascot-svg{filter:drop-shadow(0 4px 8px rgba(0,0,0,.15));animation:mascotBob 3s ease-in-out infinite}
@keyframes mascotBob{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
.mascot-speech{background:#fff;color:#1e293b;padding:6px 14px;border-radius:14px;font-size:14px;font-weight:700;box-shadow:0 3px 10px rgba(0,0,0,.12);margin-bottom:6px;white-space:nowrap;position:relative;text-align:center}
.mascot-speech::after{content:'';position:absolute;bottom:-8px;left:50%;transform:translateX(-50%);border:6px solid transparent;border-top-color:#fff}
</style>
</head>
<body>
<div class="rotate-notice"><div class="rotate-icon">üì±</div>ÌôîÎ©¥ÏùÑ Í∞ÄÎ°úÎ°ú ÎèåÎ†§Ï£ºÏÑ∏Ïöî!</div>

<div class="container">
  <div class="subject-bar">
    <a class="sb-tab" href="hangul.html">üìù ÌïúÍ∏Ä</a>
    <a class="sb-tab" href="math.html">üî¢ Ïà´Ïûê</a>
    <button class="sb-tab active">üî§ ÏòÅÏñ¥</button>
    <div class="sb-spacer"></div>
    <div class="sb-btns">
      <button class="sb-btn" id="sb-sound" onclick="toggleSound()">üîä</button>
      <button class="sb-btn" onclick="showAdmin()">‚öôÔ∏è</button>
    </div>
  </div>

  <div class="main-layout">
    <!-- ÏôºÏ™Ω Ìå®ÎÑê -->
    <div class="left-panel">
      <div class="profile-section">
        <div class="profile-content">
          <div class="profile-avatar" onclick="showCharModal()"><span id="pf-char">üßí</span></div>
          <div class="profile-info">
            <div class="profile-name" onclick="changeName()"><span id="pf-name">ÏòÅÏñ¥Ïôï</span></div>
            <div class="profile-level-container">
              <div class="profile-level">
                <span class="level-badge">LV.<span id="pf-level">1</span></span>
                <span id="pf-done">0</span>/<span id="pf-total">10</span>
              </div>
              <div class="progress-bar"><div class="progress-fill" id="pf-bar" style="width:0%"></div></div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-headers">
        <button class="tab-btn active" onclick="switchTab('hunt')">üîç ABCÏÇ¨ÎÉ•</button>
        <button class="tab-btn" onclick="switchTab('flip')">üÉè Îí§ÏßëÍ∏∞</button>
        <button class="tab-btn" onclick="switchTab('spell')">üßô Ï£ºÎ¨∏ÎßàÎ≤ï</button>
        <button class="tab-btn" onclick="switchTab('record')">üìä ÎÇ¥ Í∏∞Î°ù</button>
      </div>

      <!-- ÏÇ¨ÎÉ•Íæº ÏÇ¨Ïù¥Îìú -->
      <div class="tab-content hunt-side active">
        <div class="side-info">
          <div class="side-title">üîç ABC ÏÇ¨ÎÉ•Íæº</div>
          <div class="side-stat"><span>Î∞úÍ≤¨</span><span class="side-val" id="hunt-found">0</span></div>
          <div class="side-stat"><span>Ï†êÏàò</span><span class="side-val" id="hunt-score-side">0</span></div>
          <div class="side-stat"><span>ÎèÑÍ∞ê</span><span class="side-val" id="hunt-collection">0/26</span></div>
          <div class="side-stat"><span>ÌÖåÎßà</span><span class="side-val" id="hunt-theme-side">Ï†ïÍ∏Ä</span></div>
        </div>
      </div>

      <!-- Îí§ÏßëÍ∏∞ ÏÇ¨Ïù¥Îìú -->
      <div class="tab-content flip-side">
        <div class="side-info">
          <div class="side-title">üÉè Í∏ÄÏûê Îí§ÏßëÍ∏∞</div>
          <div class="side-stat"><span>Îß§Ïπ≠</span><span class="side-val" id="flip-matched">0/3</span></div>
          <div class="side-stat"><span>ÏãúÎèÑ</span><span class="side-val" id="flip-tries">0</span></div>
          <div class="side-stat"><span>Ï†êÏàò</span><span class="side-val" id="flip-score-side">0</span></div>
          <div class="side-stat"><span>Ïó∞ÏÜç</span><span class="side-val" id="flip-streak">0</span></div>
        </div>
      </div>

      <!-- Ï£ºÎ¨∏ ÏÇ¨Ïù¥Îìú -->
      <div class="tab-content spell-side">
        <div class="side-info">
          <div class="side-title">üßô Ï£ºÎ¨∏ ÎßàÎ≤ïÏÇ¨</div>
          <div class="side-stat"><span>ÏÑ±Í≥µ</span><span class="side-val" id="spell-success">0</span></div>
          <div class="side-stat"><span>Ï†êÏàò</span><span class="side-val" id="spell-score-side">0</span></div>
          <div class="side-stat"><span>Îã®Ïñ¥</span><span class="side-val" id="spell-words">0/10</span></div>
        </div>
      </div>

      <!-- Í∏∞Î°ù ÏÇ¨Ïù¥Îìú -->
      <div class="tab-content record-side">
        <div class="side-info">
          <div class="side-title">üìä Ï¢ÖÌï© Í∏∞Î°ù</div>
          <div class="side-stat"><span>Ï¥ù Î¨∏Ï†ú</span><span class="side-val" id="rec-total">0</span></div>
          <div class="side-stat"><span>Ï†ïÎãµÎ•†</span><span class="side-val" id="rec-rate">0%</span></div>
        </div>
      </div>

      <div class="game-launch-btn" onclick="startHeroGame()">üéà Îã®Ïñ¥ ÌíçÏÑ† ÏãúÏûë!</div>
    </div>

    <!-- Ï§ëÏïô Ìå®ÎÑê -->
    <div class="center-panel">
      <!-- ABC ÏÇ¨ÎÉ•Íæº -->
      <div class="game-view hunt-view active" id="hunt-view">
        <div class="hunt-area">
          <div class="hunt-scene" id="hunt-scene">
            <div class="hunt-theme-label" id="hunt-theme-label">üåø Ï†ïÍ∏Ä ÌÉêÌóò</div>
          </div>
          <div class="hunt-score-bar">
            <span>üîç Î∞úÍ≤¨: <strong id="hunt-found-bar">0</strong>/6</span>
            <span>‚≠ê Ï†êÏàò: <strong id="hunt-score-bar">0</strong></span>
          </div>
        </div>
      </div>

      <!-- Í∏ÄÏûê Îí§ÏßëÍ∏∞ -->
      <div class="game-view flip-view" id="flip-view">
        <div class="mascot-wrap" id="mascot-flip" style="top:12px;left:12px">
          <div class="mascot-speech" id="mascot-flip-speech">ÏßùÏùÑ Ï∞æÏïÑÎ≥ºÍπå?</div>
          <svg class="mascot-svg" viewBox="0 0 100 120" width="80" height="96">
            <ellipse cx="50" cy="72" rx="34" ry="30" fill="#6366f1"/>
            <ellipse cx="50" cy="72" rx="30" ry="26" fill="#818cf8"/>
            <circle cx="37" cy="62" r="14" fill="#fff"/><circle cx="63" cy="62" r="14" fill="#fff"/>
            <circle cx="39" cy="63" r="7" fill="#1e1b4b"><animate attributeName="ry" values="7;1;7" dur=".15s" begin="3s;bkF.end+4s" id="bkF" fill="freeze"/></circle>
            <circle cx="61" cy="63" r="7" fill="#1e1b4b"><animate attributeName="ry" values="7;1;7" dur=".15s" begin="3s;bkF.end+4s" fill="freeze"/></circle>
            <circle cx="42" cy="60" r="2.5" fill="#fff" opacity=".8"/>
            <circle cx="64" cy="60" r="2.5" fill="#fff" opacity=".8"/>
            <ellipse cx="50" cy="78" rx="5" ry="3" fill="#fbbf24"/>
            <path d="M38 85 Q50 92 62 85" fill="none" stroke="#312e81" stroke-width="2" stroke-linecap="round" id="mascot-flip-mouth"/>
            <ellipse cx="28" cy="76" rx="5" ry="3" fill="#f9a8d4" opacity=".4"/>
            <ellipse cx="72" cy="76" rx="5" ry="3" fill="#f9a8d4" opacity=".4"/>
            <path d="M20 52 Q30 30 40 45" fill="#6366f1" stroke="#4f46e5" stroke-width="1"/>
            <path d="M80 52 Q70 30 60 45" fill="#6366f1" stroke="#4f46e5" stroke-width="1"/>
            <text x="50" y="38" text-anchor="middle" font-size="24" font-weight="900" fill="#312e81">üî§</text>
          </svg>
        </div>
        <div class="flip-area" id="flip-area">
          <div class="flip-info">ÎåÄÎ¨∏ÏûêÏôÄ ÏÜåÎ¨∏ÏûêÎ•º Ïßù ÏßÄÏñ¥Î≥¥ÏÑ∏Ïöî!</div>
          <div class="flip-grid" id="flip-grid"></div>
          <div class="flip-result" id="flip-result"></div>
        </div>
      </div>

      <!-- Ï£ºÎ¨∏ ÎßàÎ≤ïÏÇ¨ -->
      <div class="game-view spell-view" id="spell-view">
        <div class="mascot-wrap" id="mascot-spell" style="bottom:60px;right:16px">
          <div class="mascot-speech" id="mascot-spell-speech">Ï£ºÎ¨∏ÏùÑ Ïô∏Ïö∞Ïûê!</div>
          <svg class="mascot-svg" viewBox="0 0 100 120" width="70" height="84">
            <ellipse cx="50" cy="72" rx="34" ry="30" fill="#6366f1"/>
            <ellipse cx="50" cy="72" rx="30" ry="26" fill="#818cf8"/>
            <circle cx="37" cy="62" r="14" fill="#fff"/><circle cx="63" cy="62" r="14" fill="#fff"/>
            <circle cx="39" cy="63" r="7" fill="#1e1b4b"><animate attributeName="ry" values="7;1;7" dur=".15s" begin="2.5s;bkS.end+5s" id="bkS" fill="freeze"/></circle>
            <circle cx="61" cy="63" r="7" fill="#1e1b4b"><animate attributeName="ry" values="7;1;7" dur=".15s" begin="2.5s;bkS.end+5s" fill="freeze"/></circle>
            <circle cx="42" cy="60" r="2.5" fill="#fff" opacity=".8"/>
            <circle cx="64" cy="60" r="2.5" fill="#fff" opacity=".8"/>
            <ellipse cx="50" cy="78" rx="5" ry="3" fill="#fbbf24"/>
            <path d="M38 85 Q50 92 62 85" fill="none" stroke="#312e81" stroke-width="2" stroke-linecap="round" id="mascot-spell-mouth"/>
            <ellipse cx="28" cy="76" rx="5" ry="3" fill="#f9a8d4" opacity=".4"/>
            <ellipse cx="72" cy="76" rx="5" ry="3" fill="#f9a8d4" opacity=".4"/>
            <path d="M20 52 Q30 30 40 45" fill="#6366f1" stroke="#4f46e5" stroke-width="1"/>
            <path d="M80 52 Q70 30 60 45" fill="#6366f1" stroke="#4f46e5" stroke-width="1"/>
            <text x="50" y="38" text-anchor="middle" font-size="24" font-weight="900" fill="#312e81">üî§</text>
          </svg>
        </div>
        <div class="spell-area" id="spell-area">
          <div style="font-size:22px;font-weight:800;color:#e0e7ff">üßô ÏïåÌååÎ≤≥ÏùÑ 3Í∞ú Í≥®Îùº Îã®Ïñ¥Î•º ÎßåÎì§Ïñ¥Î≥¥ÏÑ∏Ïöî!</div>
          <div class="spell-cauldron">
            <svg viewBox="0 0 220 200" width="220" height="200">
              <defs>
                <radialGradient id="cauldronGrad" cx="50%" cy="40%"><stop offset="0%" stop-color="#475569"/><stop offset="100%" stop-color="#1e293b"/></radialGradient>
                <radialGradient id="potionGrad" cx="50%" cy="30%"><stop offset="0%" stop-color="#a78bfa"/><stop offset="100%" stop-color="#7c3aed"/></radialGradient>
              </defs>
              <ellipse cx="110" cy="160" rx="90" ry="25" fill="#1e293b" opacity=".15"/>
              <path d="M30 90 Q25 150 50 160 L170 160 Q195 150 190 90 Z" fill="url(#cauldronGrad)" stroke="#64748b" stroke-width="3"/>
              <ellipse cx="110" cy="90" rx="80" ry="22" fill="#334155" stroke="#64748b" stroke-width="3"/>
              <ellipse cx="110" cy="88" rx="68" ry="16" fill="url(#potionGrad)">
                <animate attributeName="ry" values="16;18;16" dur="2s" repeatCount="indefinite"/>
              </ellipse>
              <!-- Í±∞Ìíà -->
              <circle cx="85" cy="82" r="6" fill="#c4b5fd" opacity=".6"><animate attributeName="cy" values="82;76;82" dur="1.5s" repeatCount="indefinite"/><animate attributeName="opacity" values=".6;.2;.6" dur="1.5s" repeatCount="indefinite"/></circle>
              <circle cx="130" cy="80" r="8" fill="#ddd6fe" opacity=".5"><animate attributeName="cy" values="80;72;80" dur="2s" repeatCount="indefinite"/><animate attributeName="opacity" values=".5;.1;.5" dur="2s" repeatCount="indefinite"/></circle>
              <circle cx="105" cy="78" r="5" fill="#e9d5ff" opacity=".7"><animate attributeName="cy" values="78;70;78" dur="1.2s" repeatCount="indefinite"/></circle>
              <!-- ÏÜêÏû°Ïù¥ -->
              <path d="M30 100 Q10 100 15 120 Q20 140 35 135" fill="none" stroke="#64748b" stroke-width="5" stroke-linecap="round"/>
              <path d="M190 100 Q210 100 205 120 Q200 140 185 135" fill="none" stroke="#64748b" stroke-width="5" stroke-linecap="round"/>
              <!-- ÎßàÎ≤ï Î∞òÏßùÏûÑ -->
              <circle cx="90" cy="70" r="2" fill="#fbbf24"><animate attributeName="opacity" values="0;1;0" dur="1.8s" repeatCount="indefinite"/><animate attributeName="cy" values="70;55;70" dur="1.8s" repeatCount="indefinite"/></circle>
              <circle cx="125" cy="65" r="2.5" fill="#fbbf24"><animate attributeName="opacity" values="0;1;0" dur="2.2s" repeatCount="indefinite"/><animate attributeName="cy" values="65;48;65" dur="2.2s" repeatCount="indefinite"/></circle>
            </svg>
          </div>
          <div class="spell-slots" id="spell-slots">
            <div class="spell-slot" id="ss0">_</div>
            <div class="spell-slot" id="ss1">_</div>
            <div class="spell-slot" id="ss2">_</div>
          </div>
          <div class="spell-result-area" id="spell-result-area"></div>
          <div class="spell-keyboard" id="spell-keyboard"></div>
        </div>
      </div>

      <!-- ÎÇ¥ Í∏∞Î°ù -->
      <div class="game-view record-view" id="record-view">
        <div class="mascot-wrap" id="mascot-record" style="bottom:16px;right:16px">
          <div class="mascot-speech" id="mascot-record-speech">Ïûò ÌïòÍ≥† ÏûàÏñ¥!</div>
          <svg class="mascot-svg" viewBox="0 0 100 130" width="75" height="97">
            <ellipse cx="50" cy="75" rx="34" ry="30" fill="#6366f1"/>
            <ellipse cx="50" cy="75" rx="30" ry="26" fill="#818cf8"/>
            <circle cx="37" cy="65" r="14" fill="#fff"/><circle cx="63" cy="65" r="14" fill="#fff"/>
            <circle cx="39" cy="66" r="7" fill="#1e1b4b"><animate attributeName="ry" values="7;1;7" dur=".15s" begin="4s;bkR.end+5s" id="bkR" fill="freeze"/></circle>
            <circle cx="61" cy="66" r="7" fill="#1e1b4b"><animate attributeName="ry" values="7;1;7" dur=".15s" begin="4s;bkR.end+5s" fill="freeze"/></circle>
            <circle cx="42" cy="63" r="2.5" fill="#fff" opacity=".8"/>
            <circle cx="64" cy="63" r="2.5" fill="#fff" opacity=".8"/>
            <ellipse cx="50" cy="81" rx="5" ry="3" fill="#fbbf24"/>
            <path d="M38 88 Q50 95 62 88" fill="none" stroke="#312e81" stroke-width="2" stroke-linecap="round"/>
            <ellipse cx="28" cy="79" rx="5" ry="3" fill="#f9a8d4" opacity=".4"/>
            <ellipse cx="72" cy="79" rx="5" ry="3" fill="#f9a8d4" opacity=".4"/>
            <path d="M20 55 Q30 33 40 48" fill="#6366f1" stroke="#4f46e5" stroke-width="1"/>
            <path d="M80 55 Q70 33 60 48" fill="#6366f1" stroke="#4f46e5" stroke-width="1"/>
            <text x="50" y="41" text-anchor="middle" font-size="24" font-weight="900" fill="#312e81">üî§</text>
            <!-- Ï±Ö Îì§Í≥† ÏûàÎäî Î™®Ïäµ -->
            <rect x="22" y="95" width="22" height="28" rx="3" fill="#c7d2fe" stroke="#6366f1" stroke-width="1.5" transform="rotate(-10 33 109)"/>
            <line x1="27" y1="102" x2="40" y2="100" stroke="#6366f1" stroke-width="1" opacity=".5"/>
            <line x1="27" y1="107" x2="38" y2="105" stroke="#6366f1" stroke-width="1" opacity=".4"/>
          </svg>
        </div>
        <div class="records-area">
          <div class="record-card">
            <h3>üèÜ Ï¢ÖÌï© ÏÑ±Ï†Å</h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-total">0</div><div class="record-label">Ï¥ù Î¨∏Ï†ú</div></div>
              <div class="record-item"><div class="record-num" id="r-correct">0</div><div class="record-label">Ï†ïÎãµ</div></div>
              <div class="record-item"><div class="record-num" id="r-rate">0%</div><div class="record-label">Ï†ïÎãµÎ•†</div></div>
            </div>
          </div>
          <div class="record-card">
            <h3>üîç ABC ÏÇ¨ÎÉ•Íæº</h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-hunt-found">0</div><div class="record-label">Î∞úÍ≤¨</div></div>
              <div class="record-item"><div class="record-num" id="r-hunt-collection">0</div><div class="record-label">ÎèÑÍ∞ê</div></div>
              <div class="record-item"><div class="record-num" id="r-hunt-score">0</div><div class="record-label">ÏµúÍ≥† Ï†êÏàò</div></div>
            </div>
          </div>
          <div class="record-card">
            <h3>üÉè Í∏ÄÏûê Îí§ÏßëÍ∏∞</h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-flip-wins">0</div><div class="record-label">ÌÅ¥Î¶¨Ïñ¥</div></div>
              <div class="record-item"><div class="record-num" id="r-flip-best">0</div><div class="record-label">ÏµúÏÜå ÏãúÎèÑ</div></div>
              <div class="record-item"><div class="record-num" id="r-flip-score">0</div><div class="record-label">ÏµúÍ≥† Ï†êÏàò</div></div>
            </div>
          </div>
          <div class="record-card">
            <h3>üßô Ï£ºÎ¨∏ ÎßàÎ≤ïÏÇ¨</h3>
            <div class="record-grid">
              <div class="record-item"><div class="record-num" id="r-spell-success">0</div><div class="record-label">ÏÑ±Í≥µ</div></div>
              <div class="record-item"><div class="record-num" id="r-spell-words">0</div><div class="record-label">Îã®Ïñ¥ Ïàò</div></div>
              <div class="record-item"><div class="record-num" id="r-spell-score">0</div><div class="record-label">ÏµúÍ≥† Ï†êÏàò</div></div>
            </div>
          </div>
          <div class="record-card">
            <h3>üìö ÏïåÌååÎ≤≥ ÎèÑÍ∞ê</h3>
            <div class="collection-grid" id="collection-grid"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Ïò§Î•∏Ï™Ω Ìå®ÎÑê -->
    <div class="right-panel" id="right-panel">
      <button class="action-btn btn-cyan" id="act1" onclick="actionBtn(1)"><span class="icon">üí°</span>ÌûåÌä∏</button>
      <button class="action-btn btn-green" id="act2" onclick="actionBtn(2)"><span class="icon">‚è≠</span>Îã§Ïùå</button>
      <button class="action-btn btn-red" id="act3" onclick="actionBtn(3)"><span class="icon">üóë</span>ÏßÄÏö∞Í∏∞</button>
    </div>
  </div>
</div>

<!-- ÌûàÏñ¥Î°ú Í≤åÏûÑ -->
<div id="hero-game" class="hero-game hidden">
  <div class="hg-header">
    <div class="hg-stat">‚≠ê <span id="hg-score">0</span>Ï†ê</div>
    <div class="hg-stat">Î†àÎ≤® <span id="hg-level">1</span></div>
    <div class="hg-hearts" id="hg-hearts">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    <div class="hg-ctrls">
      <button class="hg-ctrl-btn" onclick="hgPause()">‚è∏</button>
      <button class="hg-ctrl-btn" onclick="hgExit()">‚úï</button>
    </div>
  </div>
  <div class="hg-arena" id="hg-arena">
    <div class="hg-word-display" id="hg-word-display"></div>
    <div class="hg-word-emoji" id="hg-word-emoji"></div>
  </div>
  <div id="hg-over" class="hg-overlay hidden">
    <div class="hg-overlay-box">
      <h2>Í≤åÏûÑ ÎÅù!</h2>
      <div class="score">‚≠ê <span id="hg-final-score">0</span>Ï†ê</div>
      <div class="msg" id="hg-over-msg">ÏûòÌñàÏñ¥Ïöî!</div>
      <button class="btn-retry" onclick="hgRestart()">üîÑ Îã§ÏãúÌïòÍ∏∞</button>
      <button class="btn-exit" onclick="hgExit()">üè† ÎèåÏïÑÍ∞ÄÍ∏∞</button>
    </div>
  </div>
  <div id="hg-pause" class="hg-overlay hidden">
    <div class="hg-overlay-box">
      <h2>‚è∏ ÏùºÏãúÏ†ïÏßÄ</h2>
      <button class="btn-retry" onclick="hgPause()">‚ñ∂ Í≥ÑÏÜçÌïòÍ∏∞</button>
      <button class="btn-exit" onclick="hgExit()">üè† ÎèåÏïÑÍ∞ÄÍ∏∞</button>
    </div>
  </div>
</div>

<!-- Í¥ÄÎ¶¨Ïûê Î™®Îã¨ -->
<div id="admin-modal" class="modal-overlay hidden">
  <div class="modal-box">
    <div class="modal-head"><h3>‚öô ÏÑ§Ï†ï</h3><button class="modal-close" onclick="hideAdmin()">√ó</button></div>
    <div class="modal-body">
      <div class="modal-section">
        <h4>üë§ ÌîÑÎ°úÌïÑ</h4>
        <input class="modal-input" id="adm-name" placeholder="Ïù¥Î¶Ñ ÏûÖÎ†•" maxlength="10">
        <button class="modal-btn" onclick="saveProfile()">Ï†ÄÏû•</button>
      </div>
      <div class="modal-section">
        <h4>üîÑ Ï¥àÍ∏∞Ìôî</h4>
        <button class="modal-btn" style="background:linear-gradient(145deg,#ef4444,#dc2626)" onclick="resetAll()">Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî</button>
      </div>
    </div>
  </div>
</div>

<!-- Ï∫êÎ¶≠ÌÑ∞ Î™®Îã¨ -->
<div id="char-modal" class="modal-overlay hidden">
  <div class="modal-box">
    <div class="modal-head"><h3>üé≠ Ï∫êÎ¶≠ÌÑ∞ ÏÑ†ÌÉù</h3><button class="modal-close" onclick="hideCharModal()">√ó</button></div>
    <div class="modal-body">
      <div class="char-grid" id="char-grid"></div>
    </div>
  </div>
</div>

<script>
// ===== Ï†ÑÏó≠ Î≥ÄÏàò =====
let currentTab = 'hunt';
let soundEnabled = true;
const LS = localStorage;

// ÌîÑÎ°úÌïÑ
let profile = {
  name: LS.getItem('engName') || 'ÏòÅÏñ¥Ïôï',
  char: LS.getItem('engChar') || 'üßí',
  totalCorrect: parseInt(LS.getItem('engCorrect')) || 0,
  totalPlayed: parseInt(LS.getItem('engPlayed')) || 0
};

// ÏïåÌååÎ≤≥ ÎèÑÍ∞ê
let collection = JSON.parse(LS.getItem('engCollection') || '{}');

// ÏïåÌååÎ≤≥ ÎèôÎ¨º Îç∞Ïù¥ÌÑ∞
const ABC_ANIMALS = {
  A:['üêä','Alligator','ÏïÖÏñ¥'], B:['üêª','Bear','Í≥∞'], C:['üê±','Cat','Í≥†ÏñëÏù¥'], D:['üê∂','Dog','Í∞ïÏïÑÏßÄ'],
  E:['ü¶Ö','Eagle','ÎèÖÏàòÎ¶¨'], F:['ü¶ä','Fox','Ïó¨Ïö∞'], G:['ü¶í','Giraffe','Í∏∞Î¶∞'], H:['ü¶î','Hedgehog','Í≥†Ïä¥ÎèÑÏπò'],
  I:['ü¶é','Iguana','Ïù¥Íµ¨ÏïÑÎÇò'], J:['üêÜ','Jaguar','Ïû¨Í∑úÏñ¥'], K:['üê®','Koala','ÏΩîÏïåÎùº'], L:['ü¶Å','Lion','ÏÇ¨Ïûê'],
  M:['üêí','Monkey','ÏõêÏà≠Ïù¥'], N:['ü¶é','Newt','ÎèÑÎ°±ÎáΩ'], O:['ü¶â','Owl','Ïò¨ÎπºÎØ∏'], P:['üêß','Penguin','Ìé≠Í∑Ñ'],
  Q:['ü¶î','Quokka','ÏøºÏπ¥'], R:['üê∞','Rabbit','ÌÜ†ÎÅº'], S:['üêç','Snake','Î±Ä'], T:['üêØ','Tiger','Ìò∏ÎûëÏù¥'],
  U:['ü¶Ñ','Unicorn','Ïú†ÎãàÏΩò'], V:['ü¶Ö','Vulture','ÎèÖÏàòÎ¶¨'], W:['üêã','Whale','Í≥†Îûò'], X:['üêü','X-ray fish','Ìà¨Î™ÖÎ¨ºÍ≥†Í∏∞'],
  Y:['üêÉ','Yak','ÏïºÌÅ¨'], Z:['ü¶ì','Zebra','ÏñºÎ£©Îßê']
};

// ABC ÏÇ¨ÎÉ• ÏÉÅÌÉú
let hunt = {
  found: 0, score: 0, totalFound: parseInt(LS.getItem('huntFound')) || 0,
  bestScore: parseInt(LS.getItem('huntBest')) || 0,
  theme: 0, spots: [], revealed: []
};
const HUNT_THEMES = [
  {name:'Ï†ïÍ∏Ä',label:'üåø Ï†ïÍ∏Ä ÌÉêÌóò',cls:'',covers:['üåø','üå≥','üçÉ','üå¥','ü™®','üå∫']},
  {name:'Î∞îÎã§',label:'üåä Î∞îÎã§ ÌÉêÌóò',cls:'sea',covers:['üêö','ü™∏','üåä','ü™®','ü´ß','üßä']},
  {name:'Ïö∞Ï£º',label:'üöÄ Ïö∞Ï£º ÌÉêÌóò',cls:'space',covers:['üåë','‚òÑÔ∏è','ü™ê','‚≠ê','üåå','üõ∏']}
];

// Îí§ÏßëÍ∏∞ ÏÉÅÌÉú
let flip = {
  cards:[], firstCard:null, secondCard:null, matchCount:0, tries:0, locked:false,
  score:0, streak:0, wins: parseInt(LS.getItem('flipWins')) || 0,
  bestTries: parseInt(LS.getItem('flipBestTries')) || 99,
  bestScore: parseInt(LS.getItem('flipBest')) || 0
};

// Ï£ºÎ¨∏ ÏÉÅÌÉú
let spell = {
  selected:[], score:0, successCount: parseInt(LS.getItem('spellSuccess')) || 0,
  wordsFound: JSON.parse(LS.getItem('spellWords') || '[]'),
  bestScore: parseInt(LS.getItem('spellBest')) || 0
};
const SPELL_DICT = {
  'CAT':['üê±','Í≥†ÏñëÏù¥'],'DOG':['üê∂','Í∞ïÏïÑÏßÄ'],'SUN':['‚òÄÔ∏è','ÌÉúÏñë'],'HAT':['üé©','Î™®Ïûê'],
  'CUP':['‚òï','Ïªµ'],'BIG':['üí™','ÌÅ¨Îã§'],'RED':['üî¥','Îπ®Í∞ï'],'BUS':['üöå','Î≤ÑÏä§'],
  'FOX':['ü¶ä','Ïó¨Ïö∞'],'PIG':['üê∑','ÎèºÏßÄ']
};

// ÌûàÏñ¥Î°ú ÏÉÅÌÉú
let hg = {
  score:0, lives:5, level:1, running:false, paused:false,
  balloons:[], spawnTimer:null, animId:null, combo:0, maxCombo:0,
  currentWord:null, blanks:[], wordIdx:0
};
const HG_WORDS = [
  {word:'CAT',emoji:'üê±',hint:'Í≥†ÏñëÏù¥'},{word:'DOG',emoji:'üê∂',hint:'Í∞ïÏïÑÏßÄ'},
  {word:'SUN',emoji:'‚òÄÔ∏è',hint:'ÌÉúÏñë'},{word:'HAT',emoji:'üé©',hint:'Î™®Ïûê'},
  {word:'CUP',emoji:'‚òï',hint:'Ïªµ'},{word:'BUS',emoji:'üöå',hint:'Î≤ÑÏä§'},
  {word:'FOX',emoji:'ü¶ä',hint:'Ïó¨Ïö∞'},{word:'PIG',emoji:'üê∑',hint:'ÎèºÏßÄ'},
  {word:'RED',emoji:'üî¥',hint:'Îπ®Í∞ï'},{word:'BIG',emoji:'üí™',hint:'ÌÅ¨Îã§'},
  {word:'BED',emoji:'üõèÔ∏è',hint:'Ïπ®ÎåÄ'},{word:'RUN',emoji:'üèÉ',hint:'Îã¨Î¶¨Îã§'},
  {word:'FAN',emoji:'üåÄ',hint:'ÏÑ†ÌíçÍ∏∞'},{word:'MAP',emoji:'üó∫Ô∏è',hint:'ÏßÄÎèÑ'},
  {word:'HEN',emoji:'üêî',hint:'ÏïîÌÉâ'}
];

// ===== SFX (ÎßàÎ≤ï/ÌÉêÌóò ÌÜ§) =====
const SFX = {
  _ctx: null,
  _getCtx() {
    if (!this._ctx) try { this._ctx = new (window.AudioContext || window.webkitAudioContext)(); } catch(e) {}
    return this._ctx;
  },
  _play(fn) {
    if (!soundEnabled) return;
    const ctx = this._getCtx();
    if (!ctx) return;
    if (ctx.state === 'suspended') ctx.resume();
    try { fn(ctx); } catch(e) {}
  },
  // Î∞òÏßùÏûÑ (Î∞úÍ≤¨/ÏÑ†ÌÉù) ‚Äî Í≥†Ïùå ÏÇ¨Ïù∏Ìåå 3Ï§ëÌôîÏùå
  sparkle() {
    this._play(ctx => {
      [659, 831, 988].forEach((f, i) => {
        const o = ctx.createOscillator(), g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);
        o.type = 'sine'; o.frequency.value = f;
        g.gain.setValueAtTime(0.08, ctx.currentTime + i * 0.06);
        g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + i * 0.06 + 0.2);
        o.start(ctx.currentTime + i * 0.06); o.stop(ctx.currentTime + i * 0.06 + 0.2);
      });
    });
  },
  // ÏÑ±Í≥µ Ï∞®ÏûÑ ‚Äî Ï¢ÖÏÜåÎ¶¨ ÌôîÏùå
  chime() {
    this._play(ctx => {
      [1047, 1319, 1568].forEach((f, i) => {
        const o = ctx.createOscillator(), g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);
        o.type = 'sine'; o.frequency.value = f;
        g.gain.setValueAtTime(0.07, ctx.currentTime + i * 0.1);
        g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + i * 0.1 + 0.35);
        o.start(ctx.currentTime + i * 0.1); o.stop(ctx.currentTime + i * 0.1 + 0.35);
      });
    });
  },
  // Ïã§Ìå®/Î∞îÎûå ‚Äî ÎÖ∏Ïù¥Ï¶à sweep
  whoosh() {
    this._play(ctx => {
      const buf = ctx.createBuffer(1, ctx.sampleRate * 0.2, ctx.sampleRate);
      const data = buf.getChannelData(0);
      for (let i = 0; i < data.length; i++) data[i] = (Math.random() * 2 - 1) * 0.3;
      const src = ctx.createBufferSource(), g = ctx.createGain(), filt = ctx.createBiquadFilter();
      src.buffer = buf; filt.type = 'bandpass'; filt.frequency.value = 800; filt.Q.value = 2;
      src.connect(filt); filt.connect(g); g.connect(ctx.destination);
      g.gain.setValueAtTime(0.12, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.2);
      src.start(); src.stop(ctx.currentTime + 0.2);
    });
  },
  // ÎßàÎ≤ï ÏÑ±Í≥µ ‚Äî Í∏ÄÎ¶¨ÏÇ∞ÎèÑ ÏÉÅÌñâ
  magic() {
    this._play(ctx => {
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination);
      o.type = 'sine';
      o.frequency.setValueAtTime(262, ctx.currentTime);
      o.frequency.exponentialRampToValueAtTime(1047, ctx.currentTime + 0.4);
      g.gain.setValueAtTime(0.1, ctx.currentTime);
      g.gain.setValueAtTime(0.1, ctx.currentTime + 0.3);
      g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);
      o.start(); o.stop(ctx.currentTime + 0.5);
    });
  },
  // Ïπ¥Îìú Îí§ÏßëÍ∏∞ ‚Äî ÏßßÏùÄ Ïì±
  flip() {
    this._play(ctx => {
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination);
      o.type = 'sine';
      o.frequency.setValueAtTime(600, ctx.currentTime);
      o.frequency.exponentialRampToValueAtTime(300, ctx.currentTime + 0.06);
      g.gain.setValueAtTime(0.08, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.08);
      o.start(); o.stop(ctx.currentTime + 0.08);
    });
  },
  // Ïπ¥Îìú Îß§Ïπ≠ ‚Äî 3ÎèÑ ÌôîÏùå
  match() {
    this._play(ctx => {
      [523, 659].forEach((f, i) => {
        const o = ctx.createOscillator(), g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);
        o.type = 'sine'; o.frequency.value = f;
        g.gain.setValueAtTime(0.09, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.3);
        o.start(); o.stop(ctx.currentTime + 0.3);
      });
    });
  },
  // Ï£ºÎ¨∏ ÏãúÏ†Ñ ‚Äî ÎßàÎ≤ïÏßÑ ÏõÖÏõÖ ‚Üí Ìå°
  spell() {
    this._play(ctx => {
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination);
      o.type = 'triangle';
      o.frequency.setValueAtTime(150, ctx.currentTime);
      o.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.3);
      g.gain.setValueAtTime(0.12, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.4);
      o.start(); o.stop(ctx.currentTime + 0.4);
      // Ìå° ÏÜåÎ¶¨
      const o2 = ctx.createOscillator(), g2 = ctx.createGain();
      o2.connect(g2); g2.connect(ctx.destination);
      o2.type = 'sine'; o2.frequency.value = 988;
      g2.gain.setValueAtTime(0, ctx.currentTime + 0.25);
      g2.gain.setValueAtTime(0.1, ctx.currentTime + 0.3);
      g2.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);
      o2.start(ctx.currentTime + 0.25); o2.stop(ctx.currentTime + 0.5);
    });
  },
  // Ìå°ÌååÎ†à ‚Äî Í∏àÍ¥Ä ÌôîÏùå
  fanfare() {
    this._play(ctx => {
      [523, 659, 784, 1047].forEach((f, i) => {
        const o = ctx.createOscillator(), g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);
        o.type = 'square';
        o.frequency.value = f;
        g.gain.setValueAtTime(0.04, ctx.currentTime + i * 0.12);
        g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + i * 0.12 + 0.3);
        o.start(ctx.currentTime + i * 0.12); o.stop(ctx.currentTime + i * 0.12 + 0.3);
      });
    });
  },
  // Î†àÎ≤®ÏóÖ ‚Äî ÌïòÌîÑ Í∏ÄÎ¶¨ÏÇ∞ÎèÑ
  levelup() {
    this._play(ctx => {
      const notes = [523, 587, 659, 698, 784, 880, 988, 1047];
      notes.forEach((f, i) => {
        const o = ctx.createOscillator(), g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);
        o.type = 'sine'; o.frequency.value = f;
        g.gain.setValueAtTime(0.07, ctx.currentTime + i * 0.05);
        g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + i * 0.05 + 0.15);
        o.start(ctx.currentTime + i * 0.05); o.stop(ctx.currentTime + i * 0.05 + 0.15);
      });
    });
  },
  // ÌíçÏÑ† Ìåù
  pop() {
    this._play(ctx => {
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination);
      o.type = 'sine';
      o.frequency.setValueAtTime(800, ctx.currentTime);
      o.frequency.exponentialRampToValueAtTime(200, ctx.currentTime + 0.1);
      g.gain.setValueAtTime(0.1, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
      o.start(); o.stop(ctx.currentTime + 0.15);
    });
  },
  // ÏΩ§Î≥¥ ‚Äî ÎÜíÏïÑÏßÄÎäî Ïùå
  combo(n) {
    this._play(ctx => {
      const f = 523 + Math.min(n, 10) * 80;
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination);
      o.type = 'sine'; o.frequency.value = f;
      g.gain.setValueAtTime(0.09, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
      o.start(); o.stop(ctx.currentTime + 0.15);
    });
  },
  // Í≤åÏûÑ ÏãúÏûë ‚Äî ÎßàÎ≤ï Ï∞®ÏûÑ ÏÉÅÌñâ
  gameStart() {
    this._play(ctx => {
      [392, 523, 659, 784].forEach((f, i) => {
        const o = ctx.createOscillator(), g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);
        o.type = 'sine'; o.frequency.value = f;
        g.gain.setValueAtTime(0.08, ctx.currentTime + i * 0.12);
        g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + i * 0.12 + 0.25);
        o.start(ctx.currentTime + i * 0.12); o.stop(ctx.currentTime + i * 0.12 + 0.25);
      });
    });
  },
  // Í≤åÏûÑ ÎÅù ‚Äî Î∂ÄÎìúÎü¨Ïö¥ ÌïòÌñâ
  gameOver() {
    this._play(ctx => {
      [523, 440, 349, 262].forEach((f, i) => {
        const o = ctx.createOscillator(), g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);
        o.type = 'sine'; o.frequency.value = f;
        g.gain.setValueAtTime(0.06, ctx.currentTime + i * 0.2);
        g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + i * 0.2 + 0.3);
        o.start(ctx.currentTime + i * 0.2); o.stop(ctx.currentTime + i * 0.2 + 0.3);
      });
    });
  }
};

// ===== TTS =====
let audioQueue = [];
let isSpeaking = false;
function speak(text, lang) {
  if (!soundEnabled) return;
  audioQueue.push({text, lang: lang||'ko-KR'});
  processQueue();
}
function processQueue() {
  if (isSpeaking || !audioQueue.length) return;
  isSpeaking = true;
  const item = audioQueue.shift();
  const u = new SpeechSynthesisUtterance(item.text);
  u.lang = item.lang; u.rate = 0.85; u.pitch = 1.1;
  u.onend = () => { isSpeaking = false; processQueue(); };
  u.onerror = () => { isSpeaking = false; processQueue(); };
  speechSynthesis.speak(u);
}
function speakEn(text) { speak(text, 'en-US'); }
function toggleSound() {
  soundEnabled = !soundEnabled;
  document.getElementById('sb-sound').textContent = soundEnabled ? 'üîä' : 'üîá';
  if (!soundEnabled) speechSynthesis.cancel();
}

// ===== ÌîÑÎ°úÌïÑ =====
let _prevMainLevel = 1;
function updateProfile() {
  document.getElementById('pf-name').textContent = profile.name;
  document.getElementById('pf-char').textContent = profile.char;
  const lv = Math.floor(profile.totalCorrect / 10) + 1;
  document.getElementById('pf-level').textContent = lv;
  const prog = (profile.totalCorrect % 10);
  document.getElementById('pf-done').textContent = prog;
  document.getElementById('pf-total').textContent = 10;
  document.getElementById('pf-bar').style.width = (prog * 10) + '%';
  if (lv > _prevMainLevel && _prevMainLevel > 0) showLevelUp(lv);
  _prevMainLevel = lv;
}
function changeName() {
  const n = prompt('Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:', profile.name);
  if (n && n.trim()) { profile.name = n.trim(); LS.setItem('engName', profile.name); updateProfile(); }
}
function showCharModal() {
  document.getElementById('char-modal').classList.remove('hidden');
  const chars = ['üßí','üë¶','üëß','ü¶∏‚Äç‚ôÇÔ∏è','ü¶∏‚Äç‚ôÄÔ∏è','üßô‚Äç‚ôÇÔ∏è','üê±','üê∂','ü¶ä','üêª','üê∞','üê∏','ü¶Å','üêØ','üêº'];
  const g = document.getElementById('char-grid');
  g.innerHTML = chars.map(c => `<div class="char-item${c===profile.char?' selected':''}" onclick="pickChar('${c}')">${c}</div>`).join('');
}
function hideCharModal() { document.getElementById('char-modal').classList.add('hidden'); }
function pickChar(c) { profile.char = c; LS.setItem('engChar', c); updateProfile(); hideCharModal(); }
function showAdmin() { document.getElementById('admin-modal').classList.remove('hidden'); document.getElementById('adm-name').value = profile.name; }
function hideAdmin() { document.getElementById('admin-modal').classList.add('hidden'); }
function saveProfileModal() {
  const n = document.getElementById('adm-name').value.trim();
  if (n) { profile.name = n; LS.setItem('engName', n); updateProfile(); }
  hideAdmin();
}
// ÏÑ§Ï†ï Î™®Îã¨ Ï†ÄÏû• Î≤ÑÌäº Ìò∏Ìôò
function saveProfile() { saveProfileModal(); }
function resetAll() {
  if (!confirm('Î™®Îì† Í∏∞Î°ùÏù¥ ÏÇ¨ÎùºÏßëÎãàÎã§. Ï†ïÎßê Ï¥àÍ∏∞ÌôîÌï†ÍπåÏöî?')) return;
  ['engName','engChar','engCorrect','engPlayed','engCollection','huntFound','huntBest','flipWins','flipBestTries','flipBest','spellSuccess','spellWords','spellBest'].forEach(k => LS.removeItem(k));
  location.reload();
}
function saveStats() {
  LS.setItem('engCorrect', profile.totalCorrect);
  LS.setItem('engPlayed', profile.totalPlayed);
  LS.setItem('engCollection', JSON.stringify(collection));
  LS.setItem('huntFound', hunt.totalFound);
  LS.setItem('huntBest', hunt.bestScore);
  LS.setItem('flipWins', flip.wins);
  LS.setItem('flipBestTries', flip.bestTries);
  LS.setItem('flipBest', flip.bestScore);
  LS.setItem('spellSuccess', spell.successCount);
  LS.setItem('spellWords', JSON.stringify(spell.wordsFound));
  LS.setItem('spellBest', spell.bestScore);
}

// ===== ÌÉ≠ Ï†ÑÌôò =====
function switchTab(tab) {
  speechSynthesis.cancel(); audioQueue = []; isSpeaking = false;
  currentTab = tab;
  document.querySelectorAll('.tab-btn').forEach((b, i) => {
    b.classList.toggle('active', ['hunt','flip','spell','record'][i] === tab);
  });
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelector('.' + tab + '-side').classList.add('active');
  document.querySelectorAll('.game-view').forEach(v => v.classList.remove('active'));
  document.querySelector('.' + tab + '-view').classList.add('active');
  updateActionButtons();
  if (tab === 'record') updateRecords();
}

function updateActionButtons() {
  const a1 = document.getElementById('act1');
  const a2 = document.getElementById('act2');
  const a3 = document.getElementById('act3');
  if (currentTab === 'hunt') {
    a1.innerHTML = '<span class="icon">üí°</span>ÌûåÌä∏'; a1.className = 'action-btn btn-cyan'; a1.disabled = false;
    a2.innerHTML = '<span class="icon">üîÑ</span>ÏÉà ÌÉêÌóò'; a2.className = 'action-btn btn-green'; a2.disabled = false;
    a3.innerHTML = '<span class="icon">üåç</span>ÌÖåÎßà'; a3.className = 'action-btn btn-indigo'; a3.disabled = false;
  } else if (currentTab === 'flip') {
    a1.innerHTML = '<span class="icon">üí°</span>ÌûåÌä∏'; a1.className = 'action-btn btn-cyan'; a1.disabled = false;
    a2.innerHTML = '<span class="icon">üîÑ</span>ÏÉà Í≤åÏûÑ'; a2.className = 'action-btn btn-green'; a2.disabled = false;
    a3.innerHTML = '<span class="icon">‚è≠</span>Îã§Ïùå'; a3.className = 'action-btn btn-orange'; a3.disabled = false;
  } else if (currentTab === 'spell') {
    a1.innerHTML = '<span class="icon">üí°</span>ÌûåÌä∏'; a1.className = 'action-btn btn-cyan'; a1.disabled = false;
    a2.innerHTML = '<span class="icon">üîÑ</span>ÏßÄÏö∞Í∏∞'; a2.className = 'action-btn btn-red'; a2.disabled = false;
    a3.innerHTML = '<span class="icon">‚ú®</span>ÏãúÏ†Ñ!'; a3.className = 'action-btn btn-indigo'; a3.disabled = false;
  } else {
    a1.innerHTML = '<span class="icon">üìä</span>Í∏∞Î°ù'; a1.className = 'action-btn btn-cyan'; a1.disabled = true;
    a2.innerHTML = '<span class="icon">‚Äî</span>‚Äî'; a2.className = 'action-btn btn-green'; a2.disabled = true;
    a3.innerHTML = '<span class="icon">‚Äî</span>‚Äî'; a3.className = 'action-btn btn-red'; a3.disabled = true;
  }
}

function actionBtn(n) {
  if (currentTab === 'hunt') {
    if (n === 1) huntHint();
    else if (n === 2) initHuntGame();
    else huntChangeTheme();
  } else if (currentTab === 'flip') {
    if (n === 1) flipHint();
    else if (n === 2) initFlipGame();
    else initFlipGame();
  } else if (currentTab === 'spell') {
    if (n === 1) spellHint();
    else if (n === 2) spellClear();
    else spellCast();
  }
}

// ===== ABC ÏÇ¨ÎÉ•Íæº =====
function initHuntGame() {
  hunt.found = 0;
  hunt.revealed = [];
  const scene = document.getElementById('hunt-scene');
  const theme = HUNT_THEMES[hunt.theme];

  // ÌÖåÎßà Ï†ÅÏö©
  scene.className = 'hunt-scene ' + theme.cls;
  document.getElementById('hunt-theme-label').textContent = theme.label;
  document.getElementById('hunt-theme-side').textContent = theme.name;

  // Í∏∞Ï°¥ ÏöîÏÜå Ï†ïÎ¶¨
  scene.querySelectorAll('.hunt-spot,.jungle-deco,.jungle-svg-deco,.sea-bubble,.sea-svg-deco,.space-star,.space-svg-deco').forEach(e => e.remove());

  // Î∞∞Í≤Ω Ïû•Ïãù (SVG)
  if (hunt.theme === 0) {
    // Ï†ïÍ∏Ä: SVG ÎÇòÎ¨¥, Îç©Íµ¥, ÏûéÏÇ¨Í∑Ä
    const jungleSVGs = [
      // ÎÇòÎ¨¥
      {svg:`<svg viewBox="0 0 80 120" width="80" height="120"><rect x="32" y="50" width="16" height="70" rx="4" fill="#8B5E3C"/><ellipse cx="40" cy="40" rx="35" ry="32" fill="#22c55e" opacity=".85"/><ellipse cx="30" cy="30" rx="20" ry="18" fill="#16a34a" opacity=".7"/><circle cx="55" cy="35" r="5" fill="#fbbf24" opacity=".6"/></svg>`,w:80,h:120},
      // Îç©Íµ¥
      {svg:`<svg viewBox="0 0 50 140" width="40" height="110"><path d="M25 0 Q10 30 25 50 Q40 70 25 90 Q10 110 25 140" fill="none" stroke="#16a34a" stroke-width="4" stroke-linecap="round"/><circle cx="20" cy="30" r="7" fill="#22c55e"/><circle cx="30" cy="60" r="6" fill="#15803d"/><circle cx="18" cy="95" r="8" fill="#22c55e"/><circle cx="32" cy="120" r="5" fill="#86efac"/></svg>`,w:40,h:110},
      // ÌÅ∞ ÏûéÏÇ¨Í∑Ä
      {svg:`<svg viewBox="0 0 70 50" width="70" height="50"><path d="M5 40 Q35 -10 65 40" fill="#22c55e" opacity=".8"/><path d="M5 40 Q35 5 65 40" fill="none" stroke="#16a34a" stroke-width="2"/><line x1="35" y1="8" x2="35" y2="42" stroke="#16a34a" stroke-width="1.5"/></svg>`,w:70,h:50},
      // ÍΩÉ
      {svg:`<svg viewBox="0 0 50 50" width="45" height="45"><circle cx="25" cy="25" r="8" fill="#fbbf24"/><circle cx="25" cy="12" r="8" fill="#ec4899" opacity=".8"/><circle cx="36" cy="18" r="8" fill="#f472b6" opacity=".8"/><circle cx="36" cy="32" r="8" fill="#ec4899" opacity=".8"/><circle cx="25" cy="38" r="8" fill="#f472b6" opacity=".8"/><circle cx="14" cy="32" r="8" fill="#ec4899" opacity=".8"/><circle cx="14" cy="18" r="8" fill="#f472b6" opacity=".8"/><circle cx="25" cy="25" r="6" fill="#fbbf24"/></svg>`,w:45,h:45},
      // Î≤ÑÏÑØ
      {svg:`<svg viewBox="0 0 50 50" width="42" height="42"><rect x="20" y="28" width="10" height="18" rx="3" fill="#fde68a"/><ellipse cx="25" cy="28" rx="22" ry="14" fill="#ef4444"/><circle cx="18" cy="22" r="4" fill="#fff" opacity=".5"/><circle cx="32" cy="25" r="3" fill="#fff" opacity=".4"/><circle cx="24" cy="18" r="2.5" fill="#fff" opacity=".4"/></svg>`,w:42,h:42}
    ];
    for (let i = 0; i < 10; i++) {
      const item = jungleSVGs[Math.floor(Math.random()*jungleSVGs.length)];
      const d = document.createElement('div');
      d.className = 'jungle-svg-deco' + (Math.random()>.5?' sway':'');
      const rot = Math.random()*20-10;
      d.style.cssText = `left:${Math.random()*88}%;top:${Math.random()*80}%;--rot:${rot}deg;opacity:${.35+Math.random()*.3}`;
      d.innerHTML = item.svg;
      scene.appendChild(d);
    }
    // Î∞òÎîßÎ∂à ÌååÌã∞ÌÅ¥ Ï∂îÍ∞Ä
    for (let i=0;i<8;i++){
      const d = document.createElement('div');
      d.className = 'jungle-deco';
      d.innerHTML = `<svg viewBox="0 0 12 12" width="12" height="12"><circle cx="6" cy="6" r="4" fill="#fbbf24" opacity=".8"><animate attributeName="opacity" values=".8;.2;.8" dur="${1.5+Math.random()*2}s" repeatCount="indefinite"/></circle><circle cx="6" cy="6" r="6" fill="#fbbf24" opacity=".15"><animate attributeName="r" values="6;10;6" dur="${1.5+Math.random()*2}s" repeatCount="indefinite"/></circle></svg>`;
      d.style.cssText = `left:${Math.random()*95}%;top:${Math.random()*90}%;opacity:1`;
      scene.appendChild(d);
    }
  } else if (hunt.theme === 1) {
    // Î∞îÎã§: SVG Î¨ºÍ≥†Í∏∞, ÏÇ∞Ìò∏, ÌååÎèÑ, Ìï¥Ï¥à
    const seaSVGs = [
      // Î¨ºÍ≥†Í∏∞
      {svg:`<svg viewBox="0 0 70 40" width="65" height="38"><ellipse cx="32" cy="20" rx="22" ry="14" fill="#f97316"/><polygon points="54,20 68,8 68,32" fill="#ea580c"/><circle cx="22" cy="16" r="3" fill="#fff"/><circle cx="23" cy="16" r="1.5" fill="#1e293b"/><path d="M28 25 Q35 28 42 25" fill="none" stroke="#fff" stroke-width="1.5" stroke-linecap="round"/></svg>`,cls:'swim'},
      // ÏÇ∞Ìò∏ 1
      {svg:`<svg viewBox="0 0 60 70" width="55" height="65"><path d="M20 70 Q18 45 10 30 Q5 18 12 10" fill="none" stroke="#f472b6" stroke-width="6" stroke-linecap="round"/><path d="M30 70 Q32 40 25 25 Q20 15 28 5" fill="none" stroke="#ec4899" stroke-width="5" stroke-linecap="round"/><path d="M40 70 Q42 50 48 35 Q52 22 45 12" fill="none" stroke="#f9a8d4" stroke-width="5" stroke-linecap="round"/><circle cx="12" cy="10" r="5" fill="#f472b6"/><circle cx="28" cy="5" r="4" fill="#ec4899"/><circle cx="45" cy="12" r="5" fill="#f9a8d4"/></svg>`},
      // Ìï¥Ï¥à
      {svg:`<svg viewBox="0 0 40 100" width="35" height="90"><path d="M20 100 Q10 75 20 55 Q30 35 20 15 Q15 5 20 0" fill="none" stroke="#22c55e" stroke-width="5" stroke-linecap="round"><animate attributeName="d" values="M20 100 Q10 75 20 55 Q30 35 20 15 Q15 5 20 0;M20 100 Q30 75 20 55 Q10 35 20 15 Q25 5 20 0;M20 100 Q10 75 20 55 Q30 35 20 15 Q15 5 20 0" dur="3s" repeatCount="indefinite"/></path><path d="M22 100 Q32 80 22 60 Q12 40 22 20" fill="none" stroke="#16a34a" stroke-width="4" stroke-linecap="round" opacity=".6"><animate attributeName="d" values="M22 100 Q32 80 22 60 Q12 40 22 20;M22 100 Q12 80 22 60 Q32 40 22 20;M22 100 Q32 80 22 60 Q12 40 22 20" dur="3.5s" repeatCount="indefinite"/></path></svg>`},
      // Î∂àÍ∞ÄÏÇ¨Î¶¨
      {svg:`<svg viewBox="0 0 50 50" width="44" height="44"><polygon points="25,2 30,18 48,18 34,28 39,46 25,35 11,46 16,28 2,18 20,18" fill="#fbbf24" stroke="#f59e0b" stroke-width="1.5"/><circle cx="25" cy="24" r="4" fill="#f59e0b"/></svg>`},
      // Ï°∞Í∞ú
      {svg:`<svg viewBox="0 0 50 40" width="46" height="38"><ellipse cx="25" cy="30" rx="22" ry="10" fill="#e9d5ff"/><path d="M5 28 Q25 -5 45 28" fill="#c4b5fd" stroke="#a78bfa" stroke-width="1.5"/><line x1="25" y1="4" x2="25" y2="28" stroke="#a78bfa" stroke-width="1" opacity=".5"/><line x1="15" y1="8" x2="18" y2="28" stroke="#a78bfa" stroke-width="1" opacity=".3"/><line x1="35" y1="8" x2="32" y2="28" stroke="#a78bfa" stroke-width="1" opacity=".3"/></svg>`}
    ];
    for (let i = 0; i < 8; i++) {
      const item = seaSVGs[Math.floor(Math.random()*seaSVGs.length)];
      const d = document.createElement('div');
      d.className = 'sea-svg-deco' + (item.cls?' '+item.cls:'');
      d.style.cssText = `left:${Math.random()*88}%;top:${15+Math.random()*70}%;--dur:${4+Math.random()*4}s;opacity:${.35+Math.random()*.3}`;
      d.innerHTML = item.svg;
      scene.appendChild(d);
    }
    // Í±∞ÌíàÎèÑ Ïú†ÏßÄ
    for (let i = 0; i < 12; i++) {
      const b = document.createElement('div');
      b.className = 'sea-bubble';
      b.style.cssText = `left:${Math.random()*95}%;bottom:${Math.random()*30}%;--dur:${3+Math.random()*4}s;animation-delay:${Math.random()*3}s;width:${6+Math.random()*12}px;height:${6+Math.random()*12}px`;
      scene.appendChild(b);
    }
  } else {
    // Ïö∞Ï£º: SVG Î≥Ñ, ÌñâÏÑ±, Î°úÏºì
    const spaceSVGs = [
      // ÌñâÏÑ±1 (Ï§ÑÎ¨¥Îä¨)
      {svg:`<svg viewBox="0 0 60 60" width="55" height="55"><circle cx="30" cy="30" r="24" fill="#8b5cf6"/><ellipse cx="30" cy="30" rx="32" ry="6" fill="none" stroke="#c4b5fd" stroke-width="3" opacity=".5" transform="rotate(-20 30 30)"/><path d="M12 22 Q30 18 48 22" fill="none" stroke="#a78bfa" stroke-width="2.5" opacity=".4"/><path d="M10 32 Q30 28 50 32" fill="none" stroke="#ddd6fe" stroke-width="2" opacity=".3"/><circle cx="22" cy="20" r="3" fill="#c4b5fd" opacity=".4"/></svg>`},
      // ÌñâÏÑ±2 (Îπ®Í∞Ñ)
      {svg:`<svg viewBox="0 0 50 50" width="45" height="45"><circle cx="25" cy="25" r="20" fill="#ef4444" opacity=".8"/><circle cx="18" cy="18" r="5" fill="#dc2626" opacity=".4"/><circle cx="32" cy="30" r="3" fill="#b91c1c" opacity=".3"/><circle cx="22" cy="33" r="4" fill="#dc2626" opacity=".3"/></svg>`},
      // Î°úÏºì
      {svg:`<svg viewBox="0 0 40 80" width="36" height="72"><path d="M20 5 Q30 20 30 45 L25 55 L15 55 L10 45 Q10 20 20 5Z" fill="#e2e8f0" stroke="#94a3b8" stroke-width="1.5"/><rect x="13" y="42" width="14" height="8" rx="2" fill="#3b82f6"/><circle cx="20" cy="30" r="5" fill="#0ea5e9" stroke="#0284c7" stroke-width="1.5"/><path d="M10 45 L4 58 L13 50Z" fill="#ef4444"/><path d="M30 45 L36 58 L27 50Z" fill="#ef4444"/><path d="M15 55 Q20 75 25 55" fill="#f97316"><animate attributeName="d" values="M15 55 Q20 75 25 55;M15 55 Q20 68 25 55;M15 55 Q20 75 25 55" dur=".4s" repeatCount="indefinite"/></path></svg>`},
      // Î∞òÏßùÏù¥Îäî Î≥Ñ
      {svg:`<svg viewBox="0 0 40 40" width="35" height="35"><polygon points="20,2 24,14 38,14 27,22 31,36 20,28 9,36 13,22 2,14 16,14" fill="#fbbf24"><animate attributeName="opacity" values="1;.5;1" dur="${1.5+Math.random()*1.5}s" repeatCount="indefinite"/></polygon></svg>`},
      // ÏúÑÏÑ±
      {svg:`<svg viewBox="0 0 50 50" width="40" height="40"><rect x="18" y="18" width="14" height="14" rx="2" fill="#64748b" stroke="#94a3b8" stroke-width="1.5"/><rect x="5" y="22" width="14" height="6" rx="1" fill="#3b82f6" opacity=".7"/><rect x="31" y="22" width="14" height="6" rx="1" fill="#3b82f6" opacity=".7"/><circle cx="25" cy="25" r="2" fill="#22c55e"><animate attributeName="opacity" values="1;.3;1" dur="1s" repeatCount="indefinite"/></circle></svg>`,cls:'orbit'}
    ];
    for (let i = 0; i < 7; i++) {
      const item = spaceSVGs[Math.floor(Math.random()*spaceSVGs.length)];
      const d = document.createElement('div');
      d.className = 'space-svg-deco' + (item.cls?' '+item.cls:'');
      d.style.cssText = `left:${Math.random()*88}%;top:${Math.random()*85}%;--dur:${8+Math.random()*8}s;--orb:${8+Math.random()*12}px;opacity:${.35+Math.random()*.35}`;
      d.innerHTML = item.svg;
      scene.appendChild(d);
    }
    // Í∏∞Ï°¥ Î∞òÏßùÏù¥ Î≥ÑÎèÑ Ïú†ÏßÄ
    for (let i = 0; i < 25; i++) {
      const s = document.createElement('div');
      s.className = 'space-star';
      s.style.cssText = `left:${Math.random()*98}%;top:${Math.random()*95}%;--dur:${1+Math.random()*3}s;animation-delay:${Math.random()*2}s;width:${2+Math.random()*3}px;height:${2+Math.random()*3}px`;
      scene.appendChild(s);
    }
  }

  // ÏïåÌååÎ≤≥ 6Í∞ú ÏÑ†ÌÉù (Ìù¨Í∑ÄÎèÑ Î∞òÏòÅ)
  const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
  const rare = ['Q','X','Z','J','K'];
  const chosen = [];
  // Ìù¨Í∑Ä 1Í∞ú Ìè¨Ìï® ÌôïÎ•† 30%
  if (Math.random() < 0.3) {
    chosen.push(rare[Math.floor(Math.random()*rare.length)]);
  }
  while (chosen.length < 6) {
    const l = letters[Math.floor(Math.random()*letters.length)];
    if (!chosen.includes(l)) chosen.push(l);
  }
  hunt.spots = chosen;

  // ÏúÑÏπò Î∞∞Ïó¥ (Í≤πÏπ® Î∞©ÏßÄ)
  const positions = [
    {x:8,y:10},{x:40,y:8},{x:72,y:12},
    {x:15,y:50},{x:50,y:55},{x:78,y:48}
  ];
  // ÏïΩÍ∞Ñ ÎûúÎç§ Ïò§ÌîÑÏÖã
  positions.forEach(p => {
    p.x += (Math.random()-0.5)*8;
    p.y += (Math.random()-0.5)*8;
  });

  chosen.forEach((letter, i) => {
    const spot = document.createElement('div');
    spot.className = 'hunt-spot';
    spot.id = 'hs-' + i;
    const pos = positions[i];
    const animal = ABC_ANIMALS[letter];
    const isRare = rare.includes(letter);
    const coverEmoji = theme.covers[i % theme.covers.length];

    // Ìù¨Í∑Ä ÏïåÌååÎ≤≥ÏùÄ Ïª§Î≤ÑÍ∞Ä Îçî Ïûò Ïà®ÍπÄ (ÏïΩÍ∞Ñ ÏûëÍ≤å)
    const size = isRare ? 110 : 130;
    spot.style.cssText = `left:${pos.x}%;top:${pos.y}%;width:${size}px;height:${size}px`;

    const bgColors = hunt.theme === 0
      ? 'background:linear-gradient(145deg,rgba(34,197,94,.4),rgba(22,163,74,.5));border:3px solid rgba(255,255,255,.3)'
      : hunt.theme === 1
      ? 'background:linear-gradient(145deg,rgba(56,189,248,.3),rgba(14,165,233,.4));border:3px solid rgba(255,255,255,.2)'
      : 'background:linear-gradient(145deg,rgba(139,92,246,.3),rgba(109,40,217,.4));border:3px solid rgba(255,255,255,.15)';

    spot.innerHTML = `
      <div class="spot-cover" style="${bgColors};backdrop-filter:blur(2px)">${coverEmoji}</div>
      <div class="spot-animal">
        <div class="animal-emoji">${animal[0]}</div>
        <div class="animal-letter">${letter}</div>
        <div class="animal-word">${animal[1]}</div>
      </div>`;

    spot.onclick = () => revealSpot(i, letter);
    scene.appendChild(spot);
  });

  document.getElementById('hunt-found-bar').textContent = 0;
  document.getElementById('hunt-score-bar').textContent = hunt.score;
  document.getElementById('hunt-found').textContent = hunt.totalFound;
  document.getElementById('hunt-score-side').textContent = hunt.score;
  updateHuntCollection();
}

function revealSpot(idx, letter) {
  const spot = document.getElementById('hs-' + idx);
  if (!spot || spot.classList.contains('revealed')) return;

  spot.classList.add('revealed');
  hunt.found++;
  hunt.revealed.push(letter);
  const rare = ['Q','X','Z','J','K'];
  const points = rare.includes(letter) ? 15 : 10;
  hunt.score += points;
  hunt.totalFound++;
  profile.totalCorrect++;
  profile.totalPlayed++;

  SFX.sparkle();

  // ÎèÑÍ∞ê Îì±Î°ù
  if (!collection[letter]) {
    collection[letter] = true;
    speak(`ÏÉàÎ°úÏö¥ Î∞úÍ≤¨! ${ABC_ANIMALS[letter][2]}!`);
  }

  // Î∞úÏùå TTS
  setTimeout(() => speakEn(letter), 300);
  setTimeout(() => speakEn(ABC_ANIMALS[letter][1]), 800);

  // Ìè¨Ìöç Ïù¥ÌéôÌä∏
  const scene = document.getElementById('hunt-scene');
  const rect = spot.getBoundingClientRect();
  const sRect = scene.getBoundingClientRect();
  const cx = rect.left - sRect.left + rect.width/2;
  const cy = rect.top - sRect.top + rect.height/2;

  // Î≥Ñ ÌååÌã∞ÌÅ¥
  const emojis = ['‚≠ê','‚ú®','üåü','üí´','üéâ'];
  for (let i = 0; i < 8; i++) {
    const p = document.createElement('div');
    p.className = 'hunt-particle';
    const angle = (Math.PI*2/8)*i;
    const dist = 50+Math.random()*60;
    p.textContent = emojis[Math.floor(Math.random()*emojis.length)];
    p.style.cssText = `left:${cx}px;top:${cy}px;font-size:${18+Math.random()*14}px;--tx:${Math.cos(angle)*dist}px;--ty:${Math.sin(angle)*dist}px;--dur:${.5+Math.random()*.3}s`;
    scene.appendChild(p);
    setTimeout(() => p.remove(), 800);
  }

  // ÎßÅ Ïù¥ÌéôÌä∏
  for (let i = 0; i < 2; i++) {
    const ring = document.createElement('div');
    ring.className = 'hunt-star-burst';
    const size = 100 + i*60;
    const color = rare.includes(letter) ? '#fbbf24' : '#818cf8';
    ring.style.cssText = `left:${cx}px;top:${cy}px;width:${size}px;height:${size}px;border:4px solid ${color};box-shadow:0 0 20px ${color}`;
    scene.appendChild(ring);
    setTimeout(() => ring.remove(), 600);
  }

  // ÌÖçÏä§Ìä∏ Ìåù
  const pop = document.createElement('div');
  pop.className = 'hunt-catch-effect';
  pop.textContent = rare.includes(letter) ? `üåü ${letter}! +${points}` : `${letter}! +${points}`;
  pop.style.cssText = `left:${cx}px;top:${cy}px;font-size:32px;font-weight:900;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.5)`;
  scene.appendChild(pop);
  setTimeout(() => pop.remove(), 800);

  showScorePopup(scene, points, cx+'px', cy+'px');

  if (hunt.score > hunt.bestScore) hunt.bestScore = hunt.score;

  document.getElementById('hunt-found-bar').textContent = hunt.found;
  document.getElementById('hunt-score-bar').textContent = hunt.score;
  document.getElementById('hunt-found').textContent = hunt.totalFound;
  document.getElementById('hunt-score-side').textContent = hunt.score;
  updateHuntCollection();
  updateProfile();
  saveStats();

  // 6Í∞ú Îã§ Î∞úÍ≤¨ Ïãú
  if (hunt.found >= 6) {
    SFX.fanfare();
    setTimeout(() => {
      speak('ÏôÄ! Ï†ÑÎ∂Ä Ï∞æÏïòÏñ¥Ïöî! Îã§Ïùå ÌÉêÌóòÏùÑ Îñ†ÎÇòÎ≥ºÍπåÏöî?');
      // ÏûêÎèô ÌÖåÎßà Î≥ÄÍ≤Ω
      hunt.theme = (hunt.theme + 1) % HUNT_THEMES.length;
      setTimeout(() => initHuntGame(), 2000);
    }, 1000);
  }
}

function huntHint() {
  const unrevealed = hunt.spots.filter((l, i) => !hunt.revealed.includes(l));
  if (unrevealed.length === 0) { speak('Ï†ÑÎ∂Ä Ï∞æÏïòÏñ¥Ïöî!'); return; }
  const target = unrevealed[0];
  const idx = hunt.spots.indexOf(target);
  const spot = document.getElementById('hs-' + idx);
  if (spot) {
    spot.style.animation = 'gPulse 0.5s ease-in-out 3';
    setTimeout(() => spot.style.animation = '', 1500);
    speak(`${ABC_ANIMALS[target][2]}Í∞Ä Ïà®Ïñ¥ÏûàÏñ¥Ïöî!`);
  }
}

function huntChangeTheme() {
  hunt.theme = (hunt.theme + 1) % HUNT_THEMES.length;
  initHuntGame();
}

function updateHuntCollection() {
  const count = Object.keys(collection).length;
  document.getElementById('hunt-collection').textContent = count + '/26';
}

// ===== Í∏ÄÏûê Îí§ÏßëÍ∏∞ =====
function initFlipGame() {
  flip.matchCount = 0;
  flip.tries = 0;
  flip.firstCard = null;
  flip.secondCard = null;
  flip.locked = false;

  // 3ÏåçÏùò ÏïåÌååÎ≤≥ ÏÑ†ÌÉù
  const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
  const chosen = [];
  while (chosen.length < 3) {
    const l = letters[Math.floor(Math.random()*letters.length)];
    if (!chosen.includes(l)) chosen.push(l);
  }

  // Ïπ¥Îìú Î∞∞Ïó¥: ÎåÄÎ¨∏Ïûê + ÏÜåÎ¨∏Ïûê
  let cards = [];
  chosen.forEach(l => {
    cards.push({letter: l, display: l, type:'upper', matchId: l});
    cards.push({letter: l, display: l.toLowerCase(), type:'lower', matchId: l});
  });

  // ÏÖîÌîå
  for (let i = cards.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [cards[i], cards[j]] = [cards[j], cards[i]];
  }

  flip.cards = cards;

  const grid = document.getElementById('flip-grid');
  const flipFrontSVGs = [
    `<svg class="flip-front-svg" viewBox="0 0 200 180" preserveAspectRatio="none"><polygon points="40,20 46,38 65,38 50,50 55,68 40,58 25,68 30,50 15,38 34,38" fill="#fbbf24" opacity=".25"><animate attributeName="opacity" values=".25;.12;.25" dur="2s" repeatCount="indefinite"/></polygon><polygon points="155,30 159,42 172,42 162,50 165,63 155,56 145,63 148,50 138,42 151,42" fill="#a5b4fc" opacity=".3"><animate attributeName="opacity" values=".3;.15;.3" dur="2.5s" repeatCount="indefinite"/></polygon><circle cx="120" cy="140" r="12" fill="#c4b5fd" opacity=".2"><animate attributeName="r" values="12;15;12" dur="2s" repeatCount="indefinite"/></circle><polygon points="30,130 34,142 47,142 37,150 40,163 30,156 20,163 23,150 13,142 26,142" fill="#fde68a" opacity=".2"><animate attributeName="opacity" values=".2;.1;.2" dur="1.8s" repeatCount="indefinite"/></polygon><circle cx="170" cy="150" r="6" fill="#fff" opacity=".15"><animate attributeName="opacity" values=".15;.05;.15" dur="1.5s" repeatCount="indefinite"/></circle><circle cx="85" cy="25" r="4" fill="#e0e7ff" opacity=".2"/><polygon points="170,80 173,88 182,88 175,93 177,102 170,97 163,102 165,93 158,88 167,88" fill="#fbbf24" opacity=".18"/></svg>`,
    `<svg class="flip-front-svg" viewBox="0 0 200 180" preserveAspectRatio="none"><circle cx="35" cy="35" r="15" fill="#818cf8" opacity=".2"><animate attributeName="r" values="15;18;15" dur="2.5s" repeatCount="indefinite"/></circle><polygon points="160,25 164,37 177,37 167,45 170,58 160,51 150,58 153,45 143,37 156,37" fill="#fbbf24" opacity=".22"><animate attributeName="opacity" values=".22;.1;.22" dur="1.7s" repeatCount="indefinite"/></polygon><polygon points="50,145 54,157 67,157 57,165 60,178 50,171 40,178 43,165 33,157 46,157" fill="#c4b5fd" opacity=".25"/><circle cx="155" cy="135" r="10" fill="#a5b4fc" opacity=".15"><animate attributeName="opacity" values=".15;.08;.15" dur="2s" repeatCount="indefinite"/></circle><polygon points="100,10 103,18 112,18 105,23 107,32 100,27 93,32 95,23 88,18 97,18" fill="#fde68a" opacity=".2"/><circle cx="95" cy="155" r="5" fill="#e0e7ff" opacity=".18"/></svg>`,
    `<svg class="flip-front-svg" viewBox="0 0 200 180" preserveAspectRatio="none"><polygon points="100,10 106,30 128,30 110,42 117,62 100,50 83,62 90,42 72,30 94,30" fill="#fbbf24" opacity=".2"><animate attributeName="opacity" values=".2;.1;.2" dur="2.2s" repeatCount="indefinite"/></polygon><circle cx="30" cy="140" r="12" fill="#818cf8" opacity=".2"/><circle cx="170" cy="45" r="8" fill="#c4b5fd" opacity=".2"><animate attributeName="r" values="8;11;8" dur="1.8s" repeatCount="indefinite"/></circle><polygon points="165,140 168,148 177,148 170,153 172,162 165,157 158,162 160,153 153,148 162,148" fill="#a5b4fc" opacity=".2"/><polygon points="25,45 28,53 37,53 30,58 32,67 25,62 18,67 20,58 13,53 22,53" fill="#fde68a" opacity=".22"/><circle cx="100" cy="160" r="6" fill="#fff" opacity=".12"/></svg>`
  ];
  grid.innerHTML = cards.map((c, i) => `
    <div class="flip-card" id="fc-${i}" onclick="flipCard(${i})">
      <div class="flip-card-inner">
        <div class="flip-card-front">${flipFrontSVGs[i % flipFrontSVGs.length]}<span class="flip-front-q">?</span></div>
        <div class="flip-card-back">
          <span>${c.display}</span>
          <span class="flip-label">${c.type==='upper'?'ÎåÄÎ¨∏Ïûê':'ÏÜåÎ¨∏Ïûê'}</span>
        </div>
      </div>
    </div>`).join('');

  document.getElementById('flip-result').textContent = '';
  updateFlipUI();
}

function flipCard(idx) {
  if (flip.locked) return;
  const card = document.getElementById('fc-' + idx);
  if (!card || card.classList.contains('flipped') || card.classList.contains('matched')) return;

  card.classList.add('flipped');
  SFX.flip();
  speakEn(flip.cards[idx].display);

  if (flip.firstCard === null) {
    flip.firstCard = idx;
  } else {
    flip.secondCard = idx;
    flip.tries++;
    flip.locked = true;
    profile.totalPlayed++;

    const c1 = flip.cards[flip.firstCard];
    const c2 = flip.cards[flip.secondCard];

    if (c1.matchId === c2.matchId && c1.type !== c2.type) {
      // Îß§Ïπ≠ ÏÑ±Í≥µ!
      setTimeout(() => {
        document.getElementById('fc-' + flip.firstCard).classList.add('matched');
        document.getElementById('fc-' + flip.secondCard).classList.add('matched');
        flip.matchCount++;
        flip.streak++;
        const flipPts = 10 + flip.streak * 2;
        flip.score += flipPts;
        profile.totalCorrect++;
        SFX.match();

        // Îß§Ïπ≠ Ïù¥ÌéôÌä∏
        flipMatchEffect(flip.secondCard);
        showScorePopup(document.getElementById('flip-area'), flipPts);
        setMascotEmotion('flip', 'happy');
        speak(`${c1.matchId}! ÎåÄÎ¨∏Ïûê ÏÜåÎ¨∏Ïûê Ïßù!`);

        if (flip.matchCount >= 3) {
          // Ï†ÑÎ∂Ä Îß§Ïπ≠!
          flip.wins++;
          if (flip.tries < flip.bestTries) flip.bestTries = flip.tries;
          if (flip.score > flip.bestScore) flip.bestScore = flip.score;
          document.getElementById('flip-result').textContent = 'üéâ Ï†ÑÎ∂Ä ÎßûÏ∑ÑÏñ¥Ïöî!';
          SFX.fanfare();
          speak('ÎåÄÎã®Ìï¥Ïöî! Ï†ÑÎ∂Ä Ï∞æÏïòÏñ¥Ïöî!');
          flipCelebrateEffect();
          setTimeout(() => initFlipGame(), 3000);
        }

        flip.firstCard = null;
        flip.secondCard = null;
        flip.locked = false;
        updateFlipUI();
        updateProfile();
        saveStats();
      }, 600);
    } else {
      // Îß§Ïπ≠ Ïã§Ìå®
      flip.streak = 0;
      SFX.whoosh();
      setMascotEmotion('flip', 'worried');
      setTimeout(() => {
        document.getElementById('fc-' + flip.firstCard).classList.remove('flipped');
        document.getElementById('fc-' + flip.secondCard).classList.remove('flipped');
        flip.firstCard = null;
        flip.secondCard = null;
        flip.locked = false;
        updateFlipUI();
      }, 1000);
    }
    saveStats();
  }
}

function flipMatchEffect(cardIdx) {
  const area = document.getElementById('flip-area');
  const card = document.getElementById('fc-' + cardIdx);
  if (!card) return;
  const r = card.getBoundingClientRect();
  const ar = area.getBoundingClientRect();
  const cx = r.left - ar.left + r.width/2;
  const cy = r.top - ar.top + r.height/2;

  const emoji = document.createElement('div');
  emoji.className = 'flip-match-effect';
  emoji.textContent = '‚úÖ';
  emoji.style.cssText = `left:${cx}px;top:${cy}px`;
  area.appendChild(emoji);
  setTimeout(() => emoji.remove(), 800);
}

function flipCelebrateEffect() {
  const area = document.getElementById('flip-area');
  const colors = ['#6366f1','#a5b4fc','#818cf8','#fbbf24','#22c55e','#ec4899','#f97316'];
  for (let i = 0; i < 30; i++) {
    const c = document.createElement('div');
    c.className = 'flip-confetti';
    c.style.cssText = `left:${Math.random()*100}%;top:-10px;background:${colors[Math.floor(Math.random()*colors.length)]};--tx:${(Math.random()-.5)*200}px;--ty:${200+Math.random()*400}px;--dur:${.8+Math.random()*.6}s;animation-delay:${Math.random()*.3}s;width:${6+Math.random()*8}px;height:${6+Math.random()*8}px`;
    area.appendChild(c);
    setTimeout(() => c.remove(), 1500);
  }
}

function flipHint() {
  // Ï≤´ Î≤àÏß∏ ÎØ∏Îß§Ïπ≠ Ïπ¥Îìú Ïû†Ïãú Î≥¥Ïó¨Ï£ºÍ∏∞
  const unmatched = flip.cards.map((c, i) => ({...c, idx: i})).filter((c, i) => !document.getElementById('fc-' + i).classList.contains('matched'));
  if (unmatched.length >= 2) {
    const pair = unmatched.filter(c => c.matchId === unmatched[0].matchId);
    if (pair.length === 2) {
      pair.forEach(c => document.getElementById('fc-' + c.idx).classList.add('flipped'));
      speak(`ÌûåÌä∏! ${pair[0].matchId}Î•º Í∏∞ÏñµÌïòÏÑ∏Ïöî!`);
      setTimeout(() => {
        pair.forEach(c => {
          const el = document.getElementById('fc-' + c.idx);
          if (!el.classList.contains('matched')) el.classList.remove('flipped');
        });
      }, 1500);
    }
  }
}

function updateFlipUI() {
  document.getElementById('flip-matched').textContent = flip.matchCount + '/3';
  document.getElementById('flip-tries').textContent = flip.tries;
  document.getElementById('flip-score-side').textContent = flip.score;
  document.getElementById('flip-streak').textContent = flip.streak;
}

// ===== Ï£ºÎ¨∏ ÎßàÎ≤ïÏÇ¨ =====
function initSpellGame() {
  spell.selected = [];
  updateSpellSlots();
  document.getElementById('spell-result-area').innerHTML = '';

  const kb = document.getElementById('spell-keyboard');
  let html = '';
  'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').forEach(l => {
    html += `<div class="spell-key" id="sk-${l}" onclick="spellSelect('${l}')">${l}</div>`;
  });
  kb.innerHTML = html;
}

function spellSelect(letter) {
  if (spell.selected.length >= 3) return;
  spell.selected.push(letter);
  document.getElementById('sk-' + letter).classList.add('used');
  SFX.sparkle();
  speakEn(letter);
  updateSpellSlots();

  if (spell.selected.length === 3) {
    setTimeout(() => spellCast(), 500);
  }
}

function updateSpellSlots() {
  for (let i = 0; i < 3; i++) {
    const slot = document.getElementById('ss' + i);
    if (i < spell.selected.length) {
      slot.textContent = spell.selected[i];
      slot.classList.add('filled');
    } else {
      slot.textContent = '_';
      slot.classList.remove('filled');
    }
  }
}

function spellCast() {
  if (spell.selected.length < 3) {
    speak('Í∏ÄÏûê 3Í∞úÎ•º Í≥®ÎùºÏ£ºÏÑ∏Ïöî!');
    return;
  }

  const word = spell.selected.join('');
  const result = document.getElementById('spell-result-area');
  const area = document.getElementById('spell-area');
  profile.totalPlayed++;

  if (SPELL_DICT[word]) {
    // ÎßàÎ≤ï ÏÑ±Í≥µ!
    const [emoji, korean] = SPELL_DICT[word];
    spell.score += 20;
    spell.successCount++;
    profile.totalCorrect++;
    if (!spell.wordsFound.includes(word)) spell.wordsFound.push(word);
    if (spell.score > spell.bestScore) spell.bestScore = spell.score;

    SFX.spell();
    setTimeout(() => SFX.magic(), 300);

    // ÎßàÎ≤ï Ïù¥ÌéôÌä∏
    spellSuccessEffect();
    showScorePopup(area, 20);
    setMascotEmotion('spell', 'happy');

    result.innerHTML = `<div class="spell-summon">${emoji}</div><div class="spell-word">${word} = ${korean}!</div>`;
    speak(`ÎßàÎ≤ï ÏÑ±Í≥µ! ${korean}!`);
    setTimeout(() => speakEn(word), 1000);

    // ÎèÑÍ∞ê Îì±Î°ù
    word.split('').forEach(l => { if (!collection[l]) collection[l] = true; });

    updateProfile();
    saveStats();

    // 2Ï¥à ÌõÑ Î¶¨ÏÖã
    setTimeout(() => initSpellGame(), 2500);
  } else {
    // ÎßàÎ≤ï Ïã§Ìå®
    SFX.whoosh();
    setMascotEmotion('spell', 'worried');
    result.innerHTML = `<div class="spell-fail">üí® ÎßàÎ≤ï Ïã§Ìå®! ${word}ÏùÄ Îã®Ïñ¥Í∞Ä ÏïÑÎãàÏóêÏöî</div>`;
    speak('ÎßàÎ≤ï Ïã§Ìå®! Îã§Î•∏ Ï°∞Ìï©ÏùÑ ÏãúÎèÑÌï¥Î≥¥ÏÑ∏Ïöî');
    spellFailEffect();
    saveStats();
    setTimeout(() => initSpellGame(), 2000);
  }

  document.getElementById('spell-success').textContent = spell.successCount;
  document.getElementById('spell-score-side').textContent = spell.score;
  document.getElementById('spell-words').textContent = spell.wordsFound.length + '/10';
}

function spellSuccessEffect() {
  const area = document.getElementById('spell-area');
  const emojis = ['‚≠ê','‚ú®','üåü','üí´','üîÆ','üíú','üíô'];
  for (let i = 0; i < 15; i++) {
    const p = document.createElement('div');
    p.className = 'spell-magic-particle';
    p.textContent = emojis[Math.floor(Math.random()*emojis.length)];
    const startX = 50 + (Math.random()-0.5)*40;
    const startY = 40 + (Math.random()-0.5)*20;
    p.style.cssText = `left:${startX}%;top:${startY}%;font-size:${18+Math.random()*20}px;--tx:${(Math.random()-.5)*150}px;--ty:${-60-Math.random()*100}px;--dur:${1+Math.random()*.8}s;animation-delay:${Math.random()*.3}s`;
    area.appendChild(p);
    setTimeout(() => p.remove(), 2000);
  }
  // Ïó∞Í∏∞
  for (let i = 0; i < 5; i++) {
    const s = document.createElement('div');
    s.className = 'spell-smoke';
    const colors = ['rgba(139,92,246,.3)','rgba(99,102,241,.3)','rgba(168,85,247,.3)'];
    s.style.cssText = `left:${45+Math.random()*10}%;top:${35+Math.random()*10}%;width:${40+Math.random()*40}px;height:${40+Math.random()*40}px;background:${colors[Math.floor(Math.random()*colors.length)]};animation-delay:${i*0.1}s`;
    area.appendChild(s);
    setTimeout(() => s.remove(), 1200);
  }
}

function spellFailEffect() {
  const area = document.getElementById('spell-area');
  for (let i = 0; i < 6; i++) {
    const s = document.createElement('div');
    s.className = 'spell-smoke';
    s.style.cssText = `left:${45+Math.random()*10}%;top:${35+Math.random()*10}%;width:${30+Math.random()*30}px;height:${30+Math.random()*30}px;background:rgba(100,116,139,.3);animation-delay:${i*0.08}s`;
    area.appendChild(s);
    setTimeout(() => s.remove(), 1000);
  }
}

function spellClear() {
  initSpellGame();
}

function spellHint() {
  const words = Object.keys(SPELL_DICT);
  const notFound = words.filter(w => !spell.wordsFound.includes(w));
  if (notFound.length === 0) { speak('Î™®Îì† Îã®Ïñ¥Î•º Ï∞æÏïòÏñ¥Ïöî!'); return; }
  const hint = notFound[Math.floor(Math.random()*notFound.length)];
  const [emoji, korean] = SPELL_DICT[hint];
  speak(`ÌûåÌä∏! ${korean}Î•º ÎßåÎì§Ïñ¥Î≥¥ÏÑ∏Ïöî! Ï≤´ Í∏ÄÏûêÎäî ${hint[0]}`);
  // Ï≤´ Í∏ÄÏûê ÌÇ§ ÌïòÏù¥ÎùºÏù¥Ìä∏
  const key = document.getElementById('sk-' + hint[0]);
  if (key) {
    key.style.background = 'linear-gradient(145deg,#fbbf24,#f59e0b)';
    key.style.borderColor = '#f59e0b';
    setTimeout(() => { key.style.background = ''; key.style.borderColor = ''; }, 2000);
  }
}

// ===== ÎÇ¥ Í∏∞Î°ù =====
function updateRecords() {
  document.getElementById('r-total').textContent = profile.totalPlayed;
  document.getElementById('r-correct').textContent = profile.totalCorrect;
  document.getElementById('r-rate').textContent = profile.totalPlayed ? Math.round(profile.totalCorrect / profile.totalPlayed * 100) + '%' : '0%';
  document.getElementById('rec-total').textContent = profile.totalPlayed;
  document.getElementById('rec-rate').textContent = profile.totalPlayed ? Math.round(profile.totalCorrect / profile.totalPlayed * 100) + '%' : '0%';
  document.getElementById('r-hunt-found').textContent = hunt.totalFound;
  document.getElementById('r-hunt-collection').textContent = Object.keys(collection).length;
  document.getElementById('r-hunt-score').textContent = hunt.bestScore;
  document.getElementById('r-flip-wins').textContent = flip.wins;
  document.getElementById('r-flip-best').textContent = flip.bestTries === 99 ? '-' : flip.bestTries;
  document.getElementById('r-flip-score').textContent = flip.bestScore;
  document.getElementById('r-spell-success').textContent = spell.successCount;
  document.getElementById('r-spell-words').textContent = spell.wordsFound.length;
  document.getElementById('r-spell-score').textContent = spell.bestScore;

  // ÎèÑÍ∞ê Í∑∏Î¶¨Îìú
  const grid = document.getElementById('collection-grid');
  let html = '';
  'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').forEach(l => {
    const found = collection[l];
    html += `<div class="collection-item ${found?'collected':''}"><span class="coll-letter">${found ? ABC_ANIMALS[l][0] : '?'}</span>${l}</div>`;
  });
  grid.innerHTML = html;
}

// ===== ÌûàÏñ¥Î°ú: Îã®Ïñ¥ ÌíçÏÑ† =====
function startHeroGame() {
  document.getElementById('hero-game').classList.remove('hidden');
  hg.score = 0; hg.lives = 5; hg.level = 1; hg.running = true; hg.paused = false;
  hg.balloons = []; hg.combo = 0; hg.maxCombo = 0; hg.wordIdx = 0;
  _prevLives = 5; _prevLevel = 1;
  SFX.gameStart();
  updateHgUI();
  addHgClouds();
  hgNextWord();
  hgLoop();
}

function addHgClouds() {
  const arena = document.getElementById('hg-arena');
  arena.querySelectorAll('.hg-cloud').forEach(c => c.remove());
  for (let i = 0; i < 5; i++) {
    const c = document.createElement('div');
    c.className = 'hg-cloud'; c.textContent = '‚òÅÔ∏è';
    c.style.top = (20 + Math.random() * 30) + '%';
    c.style.animationDelay = -(Math.random() * 20) + 's';
    c.style.fontSize = (28 + Math.random() * 28) + 'px';
    arena.appendChild(c);
  }
}

function hgNextWord() {
  // ÏÖîÌîåÎêú Îã®Ïñ¥ Î™©Î°ùÏóêÏÑú ÏàúÏÑúÎåÄÎ°ú
  if (hg.wordIdx >= HG_WORDS.length) hg.wordIdx = 0;
  const w = HG_WORDS[hg.wordIdx];
  hg.wordIdx++;
  hg.currentWord = w;

  // ÎπàÏπ∏ Í≤∞Ï†ï (Î†àÎ≤®Ïóê Îî∞Îùº ÎπàÏπ∏ Ïàò Ï¶ùÍ∞Ä)
  const word = w.word.split('');
  const blankCount = Math.min(1 + Math.floor((hg.level - 1) / 3), word.length);
  const indices = [];
  while (indices.length < blankCount) {
    const idx = Math.floor(Math.random() * word.length);
    if (!indices.includes(idx)) indices.push(idx);
  }
  hg.blanks = indices.sort();

  // Îã®Ïñ¥ ÌëúÏãú
  const display = document.getElementById('hg-word-display');
  display.innerHTML = '';
  word.forEach((l, i) => {
    const div = document.createElement('div');
    div.className = 'hg-word-letter' + (indices.includes(i) ? ' blank' : '');
    div.id = 'hwl-' + i;
    div.textContent = indices.includes(i) ? '_' : l;
    display.appendChild(div);
  });

  // Ïù¥Î™®ÏßÄ ÌëúÏãú
  const emojiEl = document.getElementById('hg-word-emoji');
  emojiEl.textContent = w.emoji;
  emojiEl.className = 'hg-word-emoji';
}

function hgLoop() {
  const interval = Math.max(1200, 2800 - hg.level * 200);
  if (hg.spawnTimer) clearInterval(hg.spawnTimer);
  hg.spawnTimer = setInterval(() => {
    if (!hg.paused && hg.running) hgSpawnBalloon();
  }, interval);
  function tick() {
    if (!hg.running) return;
    if (!hg.paused) hgMoveBalloons();
    hg.animId = requestAnimationFrame(tick);
  }
  hg.animId = requestAnimationFrame(tick);
}

function hgSpawnBalloon() {
  // 5% ÌååÏõåÏóÖ
  if (Math.random() < 0.05) { hgSpawnPower(); return; }

  const arena = document.getElementById('hg-arena');
  const w = arena.offsetWidth;
  const h = arena.offsetHeight;

  // ÌïÑÏöîÌïú Í∏ÄÏûê + ÎûúÎç§ Í∏ÄÏûê ÌòºÌï©
  const needed = hg.blanks
    .filter(i => document.getElementById('hwl-' + i)?.classList.contains('blank'))
    .map(i => hg.currentWord.word[i]);

  let letter;
  if (needed.length > 0 && Math.random() < 0.5) {
    letter = needed[Math.floor(Math.random() * needed.length)];
  } else {
    letter = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'[Math.floor(Math.random() * 26)];
  }

  const balloonColorSets = [
    {main:'#ef4444',light:'#fca5a5',dark:'#dc2626',glow:'rgba(239,68,68,.4)'},
    {main:'#f97316',light:'#fdba74',dark:'#ea580c',glow:'rgba(249,115,22,.4)'},
    {main:'#fbbf24',light:'#fde68a',dark:'#f59e0b',glow:'rgba(251,191,36,.4)'},
    {main:'#22c55e',light:'#86efac',dark:'#16a34a',glow:'rgba(34,197,94,.4)'},
    {main:'#3b82f6',light:'#93c5fd',dark:'#2563eb',glow:'rgba(59,130,246,.4)'},
    {main:'#8b5cf6',light:'#c4b5fd',dark:'#7c3aed',glow:'rgba(139,92,246,.4)'},
    {main:'#ec4899',light:'#f9a8d4',dark:'#db2777',glow:'rgba(236,72,153,.4)'}
  ];
  const bc = balloonColorSets[Math.floor(Math.random() * balloonColorSets.length)];
  const x = Math.random() * (w - 80) + 20;

  const el = document.createElement('div');
  el.className = 'balloon';
  el.style.position = 'absolute';
  el.innerHTML = `<svg width="80" height="130" viewBox="0 0 80 130">
    <defs>
      <radialGradient id="bg${Date.now()}" cx="35%" cy="30%">
        <stop offset="0%" stop-color="${bc.light}" stop-opacity=".9"/>
        <stop offset="50%" stop-color="${bc.main}" stop-opacity=".85"/>
        <stop offset="100%" stop-color="${bc.dark}" stop-opacity=".8"/>
      </radialGradient>
    </defs>
    <ellipse cx="40" cy="42" rx="34" ry="40" fill="url(#bg${Date.now()})" stroke="${bc.dark}" stroke-width="1.5" opacity=".9"/>
    <ellipse cx="28" cy="28" rx="10" ry="14" fill="rgba(255,255,255,.3)" transform="rotate(-20 28 28)"/>
    <ellipse cx="40" cy="42" rx="34" ry="40" fill="none" stroke="rgba(255,255,255,.15)" stroke-width="2"/>
    <polygon points="40,82 35,90 45,90" fill="${bc.main}" opacity=".9"/>
    <path d="M40 90 Q42 100 38 110 Q36 120 40 128" fill="none" stroke="${bc.dark}" stroke-width="1.5" opacity=".5" stroke-dasharray="3,2"/>
  </svg><span class="balloon-letter">${letter}</span>`;
  el.style.left = x + 'px';
  el.style.bottom = '-130px';
  el.onclick = () => hgPopBalloon(letter, el);
  arena.appendChild(el);

  const speed = 0.3 + hg.level * 0.06 + Math.random() * 0.12;
  const sway = (Math.random() - 0.5) * 1.2;
  hg.balloons.push({el, y: h + 120, x, speed, sway, letter});
}

function hgSpawnPower() {
  const types = [{e:'üìñ',fx:'hint',name:'ÏÇ¨Ï†Ñ'},{e:'üí®',fx:'slow',name:'Î∞îÎûå'},{e:'‚≠ê',fx:'auto',name:'Î≥Ñ'}];
  const t = types[Math.floor(Math.random() * types.length)];
  const arena = document.getElementById('hg-arena');
  const w = arena.offsetWidth;
  const x = Math.random() * (w - 60) + 20;
  const el = document.createElement('div');
  el.className = 'hg-powerup';
  el.textContent = t.e;
  el.style.left = x + 'px';
  el.style.bottom = '-60px';
  el.onclick = () => hgUsePower(t.fx, el);
  arena.appendChild(el);
  hg.balloons.push({el, y: arena.offsetHeight + 60, x, speed: 0.2, sway: 0, letter: null, isPower: true, fx: t.fx});
}

function hgUsePower(fx, el) {
  if (fx === 'hint') {
    // ÏÇ¨Ï†Ñ: ÎπàÏπ∏Ïùò Ï†ïÎãµ Í∏ÄÏûê ÌïòÏù¥ÎùºÏù¥Ìä∏
    const needed = hg.blanks.filter(i => document.getElementById('hwl-' + i)?.classList.contains('blank'));
    if (needed.length > 0) {
      speak('ÌûåÌä∏! ÌïÑÏöîÌïú Í∏ÄÏûêÍ∞Ä Î∞òÏßùÏó¨Ïöî');
    }
  } else if (fx === 'slow') {
    hg.balloons.forEach(b => b.speed *= 0.4);
    setTimeout(() => hg.balloons.forEach(b => b.speed *= 2.5), 4000);
    speak('Î∞îÎûå! ÌíçÏÑ†Ïù¥ ÎäêÎ†§Ï†∏Ïöî');
  } else if (fx === 'auto') {
    // ÏûêÎèô ÏôÑÏÑ± 1Í∞ú
    const blank = hg.blanks.find(i => document.getElementById('hwl-' + i)?.classList.contains('blank'));
    if (blank !== undefined) {
      hgFillBlank(blank);
      speak('Î≥Ñ! ÏûêÎèô ÏôÑÏÑ±!');
    }
  }
  hg.balloons = hg.balloons.filter(b => b.el !== el);
  el.remove();
  updateHgUI();
}

function hgPopBalloon(letter, el) {
  if (!hg.running || hg.paused) return;

  // Ìï¥Îãπ Í∏ÄÏûêÍ∞Ä ÎπàÏπ∏Ïóê ÌïÑÏöîÌïúÏßÄ ÌôïÏù∏
  const neededIdx = hg.blanks.find(i => {
    const slot = document.getElementById('hwl-' + i);
    return slot && slot.classList.contains('blank') && hg.currentWord.word[i] === letter;
  });

  const arena = document.getElementById('hg-arena');
  const rect = el.getBoundingClientRect();
  const aRect = arena.getBoundingClientRect();
  const cx = rect.left - aRect.left + rect.width/2;
  const cy = rect.top - aRect.top + rect.height/2;

  // ÌíçÏÑ† ÌÑ∞Îú®Î¶¨Í∏∞ Ïù¥ÌéôÌä∏
  const popEl = document.createElement('div');
  popEl.className = 'balloon-pop';
  popEl.textContent = letter;
  popEl.style.cssText = `left:${cx}px;top:${cy}px;font-size:48px;font-weight:900;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.3)`;
  arena.appendChild(popEl);
  setTimeout(() => popEl.remove(), 600);

  // ÌååÌã∞ÌÅ¥
  const colors = ['#ef4444','#f97316','#fbbf24','#22c55e','#3b82f6','#8b5cf6'];
  for (let i = 0; i < 8; i++) {
    const p = document.createElement('div');
    p.className = 'balloon-pop-particle';
    const angle = (Math.PI*2/8)*i;
    const dist = 30+Math.random()*50;
    p.style.cssText = `left:${cx}px;top:${cy}px;width:${8+Math.random()*8}px;height:${8+Math.random()*8}px;background:${colors[Math.floor(Math.random()*colors.length)]};--tx:${Math.cos(angle)*dist}px;--ty:${Math.sin(angle)*dist}px;--dur:${.3+Math.random()*.3}s`;
    arena.appendChild(p);
    setTimeout(() => p.remove(), 600);
  }

  SFX.pop();

  // ÌíçÏÑ† Ï†úÍ±∞
  hg.balloons = hg.balloons.filter(b => b.el !== el);
  el.remove();

  if (neededIdx !== undefined) {
    hgFillBlank(neededIdx);
    hg.combo++;
    if (hg.combo > hg.maxCombo) hg.maxCombo = hg.combo;
    const hgPts = 2 + Math.min(hg.combo, 5);
    hg.score += hgPts;

    SFX.chime();
    showScorePopup(arena, hgPts, cx+'px', cy+'px');

    // Ï†ïÎãµ ÌîåÎûòÏãú
    const flash = document.createElement('div');
    flash.className = 'hg-flash';
    arena.appendChild(flash);
    setTimeout(() => flash.remove(), 300);
    speakEn(letter);

    if (hg.combo >= 3) {
      SFX.combo(hg.combo);
      const ce = document.createElement('div');
      ce.className = 'hg-combo';
      ce.textContent = `${hg.combo} COMBO!`;
      arena.appendChild(ce);
      setTimeout(() => ce.remove(), 1000);
    }

    updateHgUI();
  } else {
    // ÌãÄÎ¶∞ ÌíçÏÑ† - ÏÉùÎ™Ö ÍπéÏßÄ ÏïäÎêò ÏΩ§Î≥¥ Î¶¨ÏÖã
    hg.combo = 0;
  }
}

function hgFillBlank(idx) {
  const slot = document.getElementById('hwl-' + idx);
  if (!slot) return;
  slot.textContent = hg.currentWord.word[idx];
  slot.classList.remove('blank');
  slot.classList.add('filled');

  // Îã®Ïñ¥ ÏôÑÏÑ± Ï≤¥ÌÅ¨
  const allFilled = hg.blanks.every(i => !document.getElementById('hwl-' + i)?.classList.contains('blank'));
  if (allFilled) {
    hg.score += 10;
    // Îã®Ïñ¥ ÏôÑÏÑ± Ïù¥ÌéôÌä∏!
    const emojiEl = document.getElementById('hg-word-emoji');
    emojiEl.classList.add('completed');
    speak(`${hg.currentWord.hint}! Îã®Ïñ¥ ÏôÑÏÑ±!`);

    // ÎèÑÍ∞ê Îì±Î°ù
    hg.currentWord.word.split('').forEach(l => { if (!collection[l]) collection[l] = true; });
    saveStats();

    const nl = Math.floor(hg.score / 15) + 1;
    if (nl > hg.level) { hg.level = nl; hgUpdateBg(); showLevelUp(nl); }

    // Îã§Ïùå Îã®Ïñ¥
    setTimeout(() => {
      if (hg.running) hgNextWord();
    }, 2000);

    updateHgUI();
  }
}

function hgMoveBalloons() {
  const arena = document.getElementById('hg-arena');
  const h = arena.offsetHeight;
  const w = arena.offsetWidth;
  hg.balloons = hg.balloons.filter(item => {
    item.y -= item.speed;
    if (item.sway) {
      item.x += Math.sin(item.y / 60) * item.sway * 0.3;
      item.x = Math.max(5, Math.min(w - 75, item.x));
      item.el.style.left = item.x + 'px';
    }
    item.el.style.bottom = (h - item.y) + 'px';
    if (item.y <= -120) {
      if (item.isPower) { item.el.remove(); return false; }
      // ÌïÑÏöîÌïú Í∏ÄÏûêÍ∞Ä ÎÜìÏ≥§ÏúºÎ©¥ ÏÉùÎ™Ö Í∞êÏÜå
      if (item.letter) {
        const neededIdx = hg.blanks.find(i => {
          const slot = document.getElementById('hwl-' + i);
          return slot && slot.classList.contains('blank') && hg.currentWord.word[i] === item.letter;
        });
        if (neededIdx !== undefined) {
          hg.lives--;
          hg.combo = 0;
          SFX.whoosh();
          // ÎØ∏Ïä§ ÌîåÎûòÏãú
          const mf = document.createElement('div');
          mf.className = 'hg-miss-flash';
          arena.appendChild(mf);
          setTimeout(() => mf.remove(), 400);
          updateHgUI();
          if (hg.lives <= 0) hgEnd();
        }
      }
      item.el.remove();
      return false;
    }
    return true;
  });
}

function hgUpdateBg() {
  const bgs = [
    'linear-gradient(180deg,#c7d2fe 0%,#a5b4fc 25%,#ddd6fe 75%,#c4b5fd 100%)',
    'linear-gradient(180deg,#fef3c7 0%,#fde68a 25%,#fed7aa 75%,#fdba74 100%)',
    'linear-gradient(180deg,#cffafe 0%,#a5f3fc 25%,#67e8f9 75%,#22d3ee 100%)',
    'linear-gradient(180deg,#0f172a 0%,#1e1b4b 25%,#312e81 75%,#4338ca 100%)'
  ];
  document.getElementById('hero-game').style.background = bgs[(hg.level - 1) % bgs.length];
}

let _prevLives = 5;
let _prevLevel = 1;
function updateHgUI() {
  document.getElementById('hg-score').textContent = hg.score;
  document.getElementById('hg-level').textContent = hg.level;
  const heartsEl = document.getElementById('hg-hearts');
  if (hg.lives < _prevLives && _prevLives > 0) {
    let html = '';
    for (let i = 0; i < 5; i++) {
      if (i < hg.lives) html += '‚ù§Ô∏è';
      else if (i === hg.lives) html += '<span class="hg-heart-lost">‚ù§Ô∏è</span>';
      else html += 'üñ§';
    }
    heartsEl.innerHTML = html;
  } else {
    heartsEl.textContent = '‚ù§Ô∏è'.repeat(Math.max(0,hg.lives)) + 'üñ§'.repeat(Math.max(0, 5 - hg.lives));
  }
  _prevLives = hg.lives;
}

function hgEnd() {
  hg.running = false;
  if (hg.spawnTimer) clearInterval(hg.spawnTimer);
  if (hg.animId) cancelAnimationFrame(hg.animId);
  hg.balloons.forEach(b => b.el.remove());
  hg.balloons = [];
  SFX.gameOver();
  document.getElementById('hg-final-score').textContent = hg.score;
  let msg = 'ÏûòÌñàÏñ¥Ïöî!';
  if (hg.score >= 30) msg = 'ÎåÄÎã®Ìï¥Ïöî! ÏòÅÏñ¥ Ï≤úÏû¨!';
  else if (hg.score >= 20) msg = 'ÏôÄ! Ï†ïÎßê ÏûòÌñàÏñ¥Ïöî!';
  else if (hg.score >= 10) msg = 'Î©ãÏ†∏Ïöî! Í≥ÑÏÜç Ïó∞Ïäµ!';
  document.getElementById('hg-over-msg').textContent = msg;
  document.getElementById('hg-over').classList.remove('hidden');
  speak(msg);
}

function hgRestart() {
  document.getElementById('hg-over').classList.add('hidden');
  const arena = document.getElementById('hg-arena');
  arena.querySelectorAll('.balloon,.balloon-pop,.balloon-pop-particle,.hg-powerup,.hg-combo').forEach(e => e.remove());
  hg.score = 0; hg.lives = 5; hg.level = 1; hg.running = true; hg.paused = false;
  hg.balloons = []; hg.combo = 0; hg.maxCombo = 0; hg.wordIdx = 0;
  _prevLives = 5; _prevLevel = 1;
  SFX.gameStart();
  updateHgUI(); hgUpdateBg(); hgNextWord(); hgLoop();
}

function hgPause() {
  hg.paused = !hg.paused;
  document.getElementById('hg-pause').classList.toggle('hidden', !hg.paused);
}

function hgExit() {
  hg.running = false;
  if (hg.spawnTimer) clearInterval(hg.spawnTimer);
  if (hg.animId) cancelAnimationFrame(hg.animId);
  hg.balloons.forEach(b => b.el.remove());
  hg.balloons = [];
  document.getElementById('hg-over').classList.add('hidden');
  document.getElementById('hg-pause').classList.add('hidden');
  document.getElementById('hero-game').classList.add('hidden');
}

// ===== Ï¥àÍ∏∞Ìôî =====
document.addEventListener('DOMContentLoaded', function() {
  // fitScale
  function fitScale() {
    const c = document.querySelector('.container');
    if (!c || getComputedStyle(c).display === 'none') return;
    const M = 0.03;
    const aW = window.innerWidth * (1 - M * 2);
    const aH = window.innerHeight * (1 - M * 2);
    const s = Math.min(aW / 1920, aH / 1080);
    c.style.transform = `scale(${s})`;
    c.style.left = ((window.innerWidth - 1920 * s) / 2) + 'px';
    c.style.top = ((window.innerHeight - 1080 * s) / 2) + 'px';
  }
  fitScale();
  window.addEventListener('resize', fitScale);
  if (window.visualViewport) window.visualViewport.addEventListener('resize', fitScale);

  // ÌîÑÎ°úÌïÑ
  _prevMainLevel = Math.floor(profile.totalCorrect / 10) + 1;
  updateProfile();
  updateActionButtons();

  // Í≤åÏûÑ Ï¥àÍ∏∞Ìôî
  initHuntGame();
  initFlipGame();
  initSpellGame();
});

// ===== Ï†êÏàò ÌåùÏóÖ =====
function showScorePopup(container, points, x, y) {
  const el = document.createElement('div');
  el.className = 'score-popup';
  el.textContent = `+${points}`;
  el.style.cssText = `left:${x||'50%'};top:${y||'40%'};color:${points>=10?'#a5b4fc':'#22c55e'};transform:translate(-50%,-50%)`;
  container.appendChild(el);
  setTimeout(() => el.remove(), 800);
}

// ===== Î†àÎ≤®ÏóÖ Ïò§Î≤ÑÎ†àÏù¥ =====
function showLevelUp(level) {
  const ov = document.createElement('div');
  ov.className = 'levelup-overlay';
  ov.innerHTML = `<div class="levelup-text">LEVEL ${level}!</div>`;
  document.body.appendChild(ov);
  SFX.levelup();
  setTimeout(() => ov.remove(), 900);
}

// ===== ÎßàÏä§ÏΩîÌä∏ Í∞êÏ†ï =====
function setMascotEmotion(viewId, emotion) {
  const mouthEl = document.getElementById(`mascot-${viewId}-mouth`);
  const speechEl = document.getElementById(`mascot-${viewId}-speech`);
  if (!mouthEl && !speechEl) return;

  if (emotion === 'happy') {
    if (mouthEl) mouthEl.setAttribute('d', 'M38 83 Q50 95 62 83');
    if (speechEl) {
      const msgs = ['ÏûòÌñàÏñ¥!', 'ÎåÄÎã®Ìï¥!', 'Î©ãÏ†∏!', 'ÏµúÍ≥†Ïïº!'];
      speechEl.textContent = msgs[Math.floor(Math.random() * msgs.length)];
      speechEl.style.display = 'block';
    }
  } else if (emotion === 'worried') {
    if (mouthEl) mouthEl.setAttribute('d', 'M40 90 Q50 84 60 90');
    if (speechEl) {
      const msgs = ['Îã§Ïãú Ìï¥Î≥¥Ïûê!', 'Í¥úÏ∞ÆÏïÑ!', 'ÌûòÎÇ¥!'];
      speechEl.textContent = msgs[Math.floor(Math.random() * msgs.length)];
      speechEl.style.display = 'block';
    }
  } else {
    if (mouthEl) mouthEl.setAttribute('d', 'M38 85 Q50 92 62 85');
    if (speechEl) speechEl.style.display = 'block';
  }
  setTimeout(() => setMascotEmotion(viewId, 'idle'), 2500);
}

// ÎçîÎ∏îÌÉ≠ Î∞©ÏßÄ
let lastTouchEnd = 0;
document.addEventListener('touchend', function(e) {
  const now = Date.now();
  if (now - lastTouchEnd <= 300) e.preventDefault();
  lastTouchEnd = now;
}, false);
</script>
</body>
</html>
